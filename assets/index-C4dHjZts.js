const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AboutView-ByZ0hWpW.js","assets/AboutView-CSIvawM9.css"])))=>i.map(i=>d[i]);
var _C=Object.defineProperty;var gC=(a,r,c)=>r in a?_C(a,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[r]=c;var Yt=(a,r,c)=>gC(a,typeof r!="symbol"?r+"":r,c);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))p(g);new MutationObserver(g=>{for(const b of g)if(b.type==="childList")for(const E of b.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&p(E)}).observe(document,{childList:!0,subtree:!0});function c(g){const b={};return g.integrity&&(b.integrity=g.integrity),g.referrerPolicy&&(b.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?b.credentials="include":g.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function p(g){if(g.ep)return;g.ep=!0;const b=c(g);fetch(g.href,b)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function L0(a){const r=Object.create(null);for(const c of a.split(","))r[c]=1;return c=>c in r}const Gn={},Uh=[],sa=()=>{},yC=()=>!1,yg=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&(a.charCodeAt(2)>122||a.charCodeAt(2)<97),k0=a=>a.startsWith("onUpdate:"),ss=Object.assign,O0=(a,r)=>{const c=a.indexOf(r);c>-1&&a.splice(c,1)},xC=Object.prototype.hasOwnProperty,Dn=(a,r)=>xC.call(a,r),en=Array.isArray,Jf=a=>xg(a)==="[object Map]",vC=a=>xg(a)==="[object Set]",Qi=a=>typeof a=="function",kr=a=>typeof a=="string",au=a=>typeof a=="symbol",gr=a=>a!==null&&typeof a=="object",aS=a=>(gr(a)||Qi(a))&&Qi(a.then)&&Qi(a.catch),bC=Object.prototype.toString,xg=a=>bC.call(a),wC=a=>xg(a).slice(8,-1),TC=a=>xg(a)==="[object Object]",F0=a=>kr(a)&&a!=="NaN"&&a[0]!=="-"&&""+parseInt(a,10)===a,Qf=L0(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),vg=a=>{const r=Object.create(null);return c=>r[c]||(r[c]=a(c))},SC=/-(\w)/g,no=vg(a=>a.replace(SC,(r,c)=>c?c.toUpperCase():"")),MC=/\B([A-Z])/g,lu=vg(a=>a.replace(MC,"-$1").toLowerCase()),bg=vg(a=>a.charAt(0).toUpperCase()+a.slice(1)),Dx=vg(a=>a?`on${bg(a)}`:""),Wl=(a,r)=>!Object.is(a,r),zx=(a,...r)=>{for(let c=0;c<a.length;c++)a[c](...r)},lS=(a,r,c,p=!1)=>{Object.defineProperty(a,r,{configurable:!0,enumerable:!1,writable:p,value:c})},EC=a=>{const r=parseFloat(a);return isNaN(r)?a:r};let Gw;const wg=()=>Gw||(Gw=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function B0(a){if(en(a)){const r={};for(let c=0;c<a.length;c++){const p=a[c],g=kr(p)?PC(p):B0(p);if(g)for(const b in g)r[b]=g[b]}return r}else if(kr(a)||gr(a))return a}const AC=/;(?![^(]*\))/g,IC=/:([^]+)/,CC=/\/\*[^]*?\*\//g;function PC(a){const r={};return a.replace(CC,"").split(AC).forEach(c=>{if(c){const p=c.split(IC);p.length>1&&(r[p[0].trim()]=p[1].trim())}}),r}function N0(a){let r="";if(kr(a))r=a;else if(en(a))for(let c=0;c<a.length;c++){const p=N0(a[c]);p&&(r+=p+" ")}else if(gr(a))for(const c in a)a[c]&&(r+=c+" ");return r.trim()}const DC="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",zC=L0(DC);function cS(a){return!!a||a===""}/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let js;class uS{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=js,!r&&js&&(this.index=(js.scopes||(js.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let r,c;if(this.scopes)for(r=0,c=this.scopes.length;r<c;r++)this.scopes[r].pause();for(r=0,c=this.effects.length;r<c;r++)this.effects[r].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let r,c;if(this.scopes)for(r=0,c=this.scopes.length;r<c;r++)this.scopes[r].resume();for(r=0,c=this.effects.length;r<c;r++)this.effects[r].resume()}}run(r){if(this._active){const c=js;try{return js=this,r()}finally{js=c}}}on(){js=this}off(){js=this.parent}stop(r){if(this._active){this._active=!1;let c,p;for(c=0,p=this.effects.length;c<p;c++)this.effects[c].stop();for(this.effects.length=0,c=0,p=this.cleanups.length;c<p;c++)this.cleanups[c]();if(this.cleanups.length=0,this.scopes){for(c=0,p=this.scopes.length;c<p;c++)this.scopes[c].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!r){const g=this.parent.scopes.pop();g&&g!==this&&(this.parent.scopes[this.index]=g,g.index=this.index)}this.parent=void 0}}}function RC(a){return new uS(a)}function LC(){return js}let Vn;const Rx=new WeakSet;class hS{constructor(r){this.fn=r,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,js&&js.active&&js.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Rx.has(this)&&(Rx.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||fS(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Hw(this),pS(this);const r=Vn,c=Co;Vn=this,Co=!0;try{return this.fn()}finally{mS(this),Vn=r,Co=c,this.flags&=-3}}stop(){if(this.flags&1){for(let r=this.deps;r;r=r.nextDep)j0(r);this.deps=this.depsTail=void 0,Hw(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Rx.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){r0(this)&&this.run()}get dirty(){return r0(this)}}let dS=0,ep,tp;function fS(a,r=!1){if(a.flags|=8,r){a.next=tp,tp=a;return}a.next=ep,ep=a}function V0(){dS++}function U0(){if(--dS>0)return;if(tp){let r=tp;for(tp=void 0;r;){const c=r.next;r.next=void 0,r.flags&=-9,r=c}}let a;for(;ep;){let r=ep;for(ep=void 0;r;){const c=r.next;if(r.next=void 0,r.flags&=-9,r.flags&1)try{r.trigger()}catch(p){a||(a=p)}r=c}}if(a)throw a}function pS(a){for(let r=a.deps;r;r=r.nextDep)r.version=-1,r.prevActiveLink=r.dep.activeLink,r.dep.activeLink=r}function mS(a){let r,c=a.depsTail,p=c;for(;p;){const g=p.prevDep;p.version===-1?(p===c&&(c=g),j0(p),kC(p)):r=p,p.dep.activeLink=p.prevActiveLink,p.prevActiveLink=void 0,p=g}a.deps=r,a.depsTail=c}function r0(a){for(let r=a.deps;r;r=r.nextDep)if(r.dep.version!==r.version||r.dep.computed&&(_S(r.dep.computed)||r.dep.version!==r.version))return!0;return!!a._dirty}function _S(a){if(a.flags&4&&!(a.flags&16)||(a.flags&=-17,a.globalVersion===dp))return;a.globalVersion=dp;const r=a.dep;if(a.flags|=2,r.version>0&&!a.isSSR&&a.deps&&!r0(a)){a.flags&=-3;return}const c=Vn,p=Co;Vn=a,Co=!0;try{pS(a);const g=a.fn(a._value);(r.version===0||Wl(g,a._value))&&(a._value=g,r.version++)}catch(g){throw r.version++,g}finally{Vn=c,Co=p,mS(a),a.flags&=-3}}function j0(a,r=!1){const{dep:c,prevSub:p,nextSub:g}=a;if(p&&(p.nextSub=g,a.prevSub=void 0),g&&(g.prevSub=p,a.nextSub=void 0),c.subs===a&&(c.subs=p,!p&&c.computed)){c.computed.flags&=-5;for(let b=c.computed.deps;b;b=b.nextDep)j0(b,!0)}!r&&!--c.sc&&c.map&&c.map.delete(c.key)}function kC(a){const{prevDep:r,nextDep:c}=a;r&&(r.nextDep=c,a.prevDep=void 0),c&&(c.prevDep=r,a.nextDep=void 0)}let Co=!0;const gS=[];function Kl(){gS.push(Co),Co=!1}function Jl(){const a=gS.pop();Co=a===void 0?!0:a}function Hw(a){const{cleanup:r}=a;if(a.cleanup=void 0,r){const c=Vn;Vn=void 0;try{r()}finally{Vn=c}}}let dp=0;class OC{constructor(r,c){this.sub=r,this.dep=c,this.version=c.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class G0{constructor(r){this.computed=r,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(r){if(!Vn||!Co||Vn===this.computed)return;let c=this.activeLink;if(c===void 0||c.sub!==Vn)c=this.activeLink=new OC(Vn,this),Vn.deps?(c.prevDep=Vn.depsTail,Vn.depsTail.nextDep=c,Vn.depsTail=c):Vn.deps=Vn.depsTail=c,yS(c);else if(c.version===-1&&(c.version=this.version,c.nextDep)){const p=c.nextDep;p.prevDep=c.prevDep,c.prevDep&&(c.prevDep.nextDep=p),c.prevDep=Vn.depsTail,c.nextDep=void 0,Vn.depsTail.nextDep=c,Vn.depsTail=c,Vn.deps===c&&(Vn.deps=p)}return c}trigger(r){this.version++,dp++,this.notify(r)}notify(r){V0();try{for(let c=this.subs;c;c=c.prevSub)c.sub.notify()&&c.sub.dep.notify()}finally{U0()}}}function yS(a){if(a.dep.sc++,a.sub.flags&4){const r=a.dep.computed;if(r&&!a.dep.subs){r.flags|=20;for(let p=r.deps;p;p=p.nextDep)yS(p)}const c=a.dep.subs;c!==a&&(a.prevSub=c,c&&(c.nextSub=a)),a.dep.subs=a}}const s0=new WeakMap,tu=Symbol(""),o0=Symbol(""),fp=Symbol("");function ts(a,r,c){if(Co&&Vn){let p=s0.get(a);p||s0.set(a,p=new Map);let g=p.get(c);g||(p.set(c,g=new G0),g.map=p,g.key=c),g.track()}}function Ua(a,r,c,p,g,b){const E=s0.get(a);if(!E){dp++;return}const i=R=>{R&&R.trigger()};if(V0(),r==="clear")E.forEach(i);else{const R=en(a),V=R&&F0(c);if(R&&c==="length"){const j=Number(p);E.forEach((W,te)=>{(te==="length"||te===fp||!au(te)&&te>=j)&&i(W)})}else switch((c!==void 0||E.has(void 0))&&i(E.get(c)),V&&i(E.get(fp)),r){case"add":R?V&&i(E.get("length")):(i(E.get(tu)),Jf(a)&&i(E.get(o0)));break;case"delete":R||(i(E.get(tu)),Jf(a)&&i(E.get(o0)));break;case"set":Jf(a)&&i(E.get(tu));break}}U0()}function Oh(a){const r=Pn(a);return r===a?r:(ts(r,"iterate",fp),Po(a)?r:r.map(ds))}function H0(a){return ts(a=Pn(a),"iterate",fp),a}const FC={__proto__:null,[Symbol.iterator](){return Lx(this,Symbol.iterator,ds)},concat(...a){return Oh(this).concat(...a.map(r=>en(r)?Oh(r):r))},entries(){return Lx(this,"entries",a=>(a[1]=ds(a[1]),a))},every(a,r){return Ra(this,"every",a,r,void 0,arguments)},filter(a,r){return Ra(this,"filter",a,r,c=>c.map(ds),arguments)},find(a,r){return Ra(this,"find",a,r,ds,arguments)},findIndex(a,r){return Ra(this,"findIndex",a,r,void 0,arguments)},findLast(a,r){return Ra(this,"findLast",a,r,ds,arguments)},findLastIndex(a,r){return Ra(this,"findLastIndex",a,r,void 0,arguments)},forEach(a,r){return Ra(this,"forEach",a,r,void 0,arguments)},includes(...a){return kx(this,"includes",a)},indexOf(...a){return kx(this,"indexOf",a)},join(a){return Oh(this).join(a)},lastIndexOf(...a){return kx(this,"lastIndexOf",a)},map(a,r){return Ra(this,"map",a,r,void 0,arguments)},pop(){return kf(this,"pop")},push(...a){return kf(this,"push",a)},reduce(a,...r){return qw(this,"reduce",a,r)},reduceRight(a,...r){return qw(this,"reduceRight",a,r)},shift(){return kf(this,"shift")},some(a,r){return Ra(this,"some",a,r,void 0,arguments)},splice(...a){return kf(this,"splice",a)},toReversed(){return Oh(this).toReversed()},toSorted(a){return Oh(this).toSorted(a)},toSpliced(...a){return Oh(this).toSpliced(...a)},unshift(...a){return kf(this,"unshift",a)},values(){return Lx(this,"values",ds)}};function Lx(a,r,c){const p=H0(a),g=p[r]();return p!==a&&!Po(a)&&(g._next=g.next,g.next=()=>{const b=g._next();return b.value&&(b.value=c(b.value)),b}),g}const BC=Array.prototype;function Ra(a,r,c,p,g,b){const E=H0(a),i=E!==a&&!Po(a),R=E[r];if(R!==BC[r]){const W=R.apply(a,b);return i?ds(W):W}let V=c;E!==a&&(i?V=function(W,te){return c.call(this,ds(W),te,a)}:c.length>2&&(V=function(W,te){return c.call(this,W,te,a)}));const j=R.call(E,V,p);return i&&g?g(j):j}function qw(a,r,c,p){const g=H0(a);let b=c;return g!==a&&(Po(a)?c.length>3&&(b=function(E,i,R){return c.call(this,E,i,R,a)}):b=function(E,i,R){return c.call(this,E,ds(i),R,a)}),g[r](b,...p)}function kx(a,r,c){const p=Pn(a);ts(p,"iterate",fp);const g=p[r](...c);return(g===-1||g===!1)&&W0(c[0])?(c[0]=Pn(c[0]),p[r](...c)):g}function kf(a,r,c=[]){Kl(),V0();const p=Pn(a)[r].apply(a,c);return U0(),Jl(),p}const NC=L0("__proto__,__v_isRef,__isVue"),xS=new Set(Object.getOwnPropertyNames(Symbol).filter(a=>a!=="arguments"&&a!=="caller").map(a=>Symbol[a]).filter(au));function VC(a){au(a)||(a=String(a));const r=Pn(this);return ts(r,"has",a),r.hasOwnProperty(a)}class vS{constructor(r=!1,c=!1){this._isReadonly=r,this._isShallow=c}get(r,c,p){if(c==="__v_skip")return r.__v_skip;const g=this._isReadonly,b=this._isShallow;if(c==="__v_isReactive")return!g;if(c==="__v_isReadonly")return g;if(c==="__v_isShallow")return b;if(c==="__v_raw")return p===(g?b?YC:SS:b?TS:wS).get(r)||Object.getPrototypeOf(r)===Object.getPrototypeOf(p)?r:void 0;const E=en(r);if(!g){let R;if(E&&(R=FC[c]))return R;if(c==="hasOwnProperty")return VC}const i=Reflect.get(r,c,rs(r)?r:p);return(au(c)?xS.has(c):NC(c))||(g||ts(r,"get",c),b)?i:rs(i)?E&&F0(c)?i:i.value:gr(i)?g?ES(i):Tg(i):i}}class bS extends vS{constructor(r=!1){super(!1,r)}set(r,c,p,g){let b=r[c];if(!this._isShallow){const R=ru(b);if(!Po(p)&&!ru(p)&&(b=Pn(b),p=Pn(p)),!en(r)&&rs(b)&&!rs(p))return R?!1:(b.value=p,!0)}const E=en(r)&&F0(c)?Number(c)<r.length:Dn(r,c),i=Reflect.set(r,c,p,rs(r)?r:g);return r===Pn(g)&&(E?Wl(p,b)&&Ua(r,"set",c,p):Ua(r,"add",c,p)),i}deleteProperty(r,c){const p=Dn(r,c);r[c];const g=Reflect.deleteProperty(r,c);return g&&p&&Ua(r,"delete",c,void 0),g}has(r,c){const p=Reflect.has(r,c);return(!au(c)||!xS.has(c))&&ts(r,"has",c),p}ownKeys(r){return ts(r,"iterate",en(r)?"length":tu),Reflect.ownKeys(r)}}class UC extends vS{constructor(r=!1){super(!0,r)}set(r,c){return!0}deleteProperty(r,c){return!0}}const jC=new bS,GC=new UC,HC=new bS(!0);const a0=a=>a,E_=a=>Reflect.getPrototypeOf(a);function qC(a,r,c){return function(...p){const g=this.__v_raw,b=Pn(g),E=Jf(b),i=a==="entries"||a===Symbol.iterator&&E,R=a==="keys"&&E,V=g[a](...p),j=c?a0:r?l0:ds;return!r&&ts(b,"iterate",R?o0:tu),{next(){const{value:W,done:te}=V.next();return te?{value:W,done:te}:{value:i?[j(W[0]),j(W[1])]:j(W),done:te}},[Symbol.iterator](){return this}}}}function A_(a){return function(...r){return a==="delete"?!1:a==="clear"?void 0:this}}function $C(a,r){const c={get(g){const b=this.__v_raw,E=Pn(b),i=Pn(g);a||(Wl(g,i)&&ts(E,"get",g),ts(E,"get",i));const{has:R}=E_(E),V=r?a0:a?l0:ds;if(R.call(E,g))return V(b.get(g));if(R.call(E,i))return V(b.get(i));b!==E&&b.get(g)},get size(){const g=this.__v_raw;return!a&&ts(Pn(g),"iterate",tu),Reflect.get(g,"size",g)},has(g){const b=this.__v_raw,E=Pn(b),i=Pn(g);return a||(Wl(g,i)&&ts(E,"has",g),ts(E,"has",i)),g===i?b.has(g):b.has(g)||b.has(i)},forEach(g,b){const E=this,i=E.__v_raw,R=Pn(i),V=r?a0:a?l0:ds;return!a&&ts(R,"iterate",tu),i.forEach((j,W)=>g.call(b,V(j),V(W),E))}};return ss(c,a?{add:A_("add"),set:A_("set"),delete:A_("delete"),clear:A_("clear")}:{add(g){!r&&!Po(g)&&!ru(g)&&(g=Pn(g));const b=Pn(this);return E_(b).has.call(b,g)||(b.add(g),Ua(b,"add",g,g)),this},set(g,b){!r&&!Po(b)&&!ru(b)&&(b=Pn(b));const E=Pn(this),{has:i,get:R}=E_(E);let V=i.call(E,g);V||(g=Pn(g),V=i.call(E,g));const j=R.call(E,g);return E.set(g,b),V?Wl(b,j)&&Ua(E,"set",g,b):Ua(E,"add",g,b),this},delete(g){const b=Pn(this),{has:E,get:i}=E_(b);let R=E.call(b,g);R||(g=Pn(g),R=E.call(b,g)),i&&i.call(b,g);const V=b.delete(g);return R&&Ua(b,"delete",g,void 0),V},clear(){const g=Pn(this),b=g.size!==0,E=g.clear();return b&&Ua(g,"clear",void 0,void 0),E}}),["keys","values","entries",Symbol.iterator].forEach(g=>{c[g]=qC(g,a,r)}),c}function q0(a,r){const c=$C(a,r);return(p,g,b)=>g==="__v_isReactive"?!a:g==="__v_isReadonly"?a:g==="__v_raw"?p:Reflect.get(Dn(c,g)&&g in p?c:p,g,b)}const WC={get:q0(!1,!1)},ZC={get:q0(!1,!0)},XC={get:q0(!0,!1)};const wS=new WeakMap,TS=new WeakMap,SS=new WeakMap,YC=new WeakMap;function KC(a){switch(a){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function JC(a){return a.__v_skip||!Object.isExtensible(a)?0:KC(wC(a))}function Tg(a){return ru(a)?a:$0(a,!1,jC,WC,wS)}function MS(a){return $0(a,!1,HC,ZC,TS)}function ES(a){return $0(a,!0,GC,XC,SS)}function $0(a,r,c,p,g){if(!gr(a)||a.__v_raw&&!(r&&a.__v_isReactive))return a;const b=g.get(a);if(b)return b;const E=JC(a);if(E===0)return a;const i=new Proxy(a,E===2?p:c);return g.set(a,i),i}function ip(a){return ru(a)?ip(a.__v_raw):!!(a&&a.__v_isReactive)}function ru(a){return!!(a&&a.__v_isReadonly)}function Po(a){return!!(a&&a.__v_isShallow)}function W0(a){return a?!!a.__v_raw:!1}function Pn(a){const r=a&&a.__v_raw;return r?Pn(r):a}function AS(a){return!Dn(a,"__v_skip")&&Object.isExtensible(a)&&lS(a,"__v_skip",!0),a}const ds=a=>gr(a)?Tg(a):a,l0=a=>gr(a)?ES(a):a;function rs(a){return a?a.__v_isRef===!0:!1}function IS(a){return CS(a,!1)}function QC(a){return CS(a,!0)}function CS(a,r){return rs(a)?a:new eP(a,r)}class eP{constructor(r,c){this.dep=new G0,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=c?r:Pn(r),this._value=c?r:ds(r),this.__v_isShallow=c}get value(){return this.dep.track(),this._value}set value(r){const c=this._rawValue,p=this.__v_isShallow||Po(r)||ru(r);r=p?r:Pn(r),Wl(r,c)&&(this._rawValue=r,this._value=p?r:ds(r),this.dep.trigger())}}function jh(a){return rs(a)?a.value:a}const tP={get:(a,r,c)=>r==="__v_raw"?a:jh(Reflect.get(a,r,c)),set:(a,r,c,p)=>{const g=a[r];return rs(g)&&!rs(c)?(g.value=c,!0):Reflect.set(a,r,c,p)}};function PS(a){return ip(a)?a:new Proxy(a,tP)}class iP{constructor(r,c,p){this.fn=r,this.setter=c,this._value=void 0,this.dep=new G0(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=dp-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!c,this.isSSR=p}notify(){if(this.flags|=16,!(this.flags&8)&&Vn!==this)return fS(this,!0),!0}get value(){const r=this.dep.track();return _S(this),r&&(r.version=this.dep.version),this._value}set value(r){this.setter&&this.setter(r)}}function nP(a,r,c=!1){let p,g;return Qi(a)?p=a:(p=a.get,g=a.set),new iP(p,g,c)}const I_={},rg=new WeakMap;let Kc;function rP(a,r=!1,c=Kc){if(c){let p=rg.get(c);p||rg.set(c,p=[]),p.push(a)}}function sP(a,r,c=Gn){const{immediate:p,deep:g,once:b,scheduler:E,augmentJob:i,call:R}=c,V=Ye=>g?Ye:Po(Ye)||g===!1||g===0?jl(Ye,1):jl(Ye);let j,W,te,ne,ge=!1,xe=!1;if(rs(a)?(W=()=>a.value,ge=Po(a)):ip(a)?(W=()=>V(a),ge=!0):en(a)?(xe=!0,ge=a.some(Ye=>ip(Ye)||Po(Ye)),W=()=>a.map(Ye=>{if(rs(Ye))return Ye.value;if(ip(Ye))return V(Ye);if(Qi(Ye))return R?R(Ye,2):Ye()})):Qi(a)?r?W=R?()=>R(a,2):a:W=()=>{if(te){Kl();try{te()}finally{Jl()}}const Ye=Kc;Kc=j;try{return R?R(a,3,[ne]):a(ne)}finally{Kc=Ye}}:W=sa,r&&g){const Ye=W,ct=g===!0?1/0:g;W=()=>jl(Ye(),ct)}const Fe=LC(),Be=()=>{j.stop(),Fe&&Fe.active&&O0(Fe.effects,j)};if(b&&r){const Ye=r;r=(...ct)=>{Ye(...ct),Be()}}let Ke=xe?new Array(a.length).fill(I_):I_;const at=Ye=>{if(!(!(j.flags&1)||!j.dirty&&!Ye))if(r){const ct=j.run();if(g||ge||(xe?ct.some((Lt,rt)=>Wl(Lt,Ke[rt])):Wl(ct,Ke))){te&&te();const Lt=Kc;Kc=j;try{const rt=[ct,Ke===I_?void 0:xe&&Ke[0]===I_?[]:Ke,ne];R?R(r,3,rt):r(...rt),Ke=ct}finally{Kc=Lt}}}else j.run()};return i&&i(at),j=new hS(W),j.scheduler=E?()=>E(at,!1):at,ne=Ye=>rP(Ye,!1,j),te=j.onStop=()=>{const Ye=rg.get(j);if(Ye){if(R)R(Ye,4);else for(const ct of Ye)ct();rg.delete(j)}},r?p?at(!0):Ke=j.run():E?E(at.bind(null,!0),!0):j.run(),Be.pause=j.pause.bind(j),Be.resume=j.resume.bind(j),Be.stop=Be,Be}function jl(a,r=1/0,c){if(r<=0||!gr(a)||a.__v_skip||(c=c||new Set,c.has(a)))return a;if(c.add(a),r--,rs(a))jl(a.value,r,c);else if(en(a))for(let p=0;p<a.length;p++)jl(a[p],r,c);else if(vC(a)||Jf(a))a.forEach(p=>{jl(p,r,c)});else if(TC(a)){for(const p in a)jl(a[p],r,c);for(const p of Object.getOwnPropertySymbols(a))Object.prototype.propertyIsEnumerable.call(a,p)&&jl(a[p],r,c)}return a}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ip(a,r,c,p){try{return p?a(...p):a()}catch(g){Sg(g,r,c)}}function aa(a,r,c,p){if(Qi(a)){const g=Ip(a,r,c,p);return g&&aS(g)&&g.catch(b=>{Sg(b,r,c)}),g}if(en(a)){const g=[];for(let b=0;b<a.length;b++)g.push(aa(a[b],r,c,p));return g}}function Sg(a,r,c,p=!0){const g=r?r.vnode:null,{errorHandler:b,throwUnhandledErrorInProduction:E}=r&&r.appContext.config||Gn;if(r){let i=r.parent;const R=r.proxy,V=`https://vuejs.org/error-reference/#runtime-${c}`;for(;i;){const j=i.ec;if(j){for(let W=0;W<j.length;W++)if(j[W](a,R,V)===!1)return}i=i.parent}if(b){Kl(),Ip(b,null,10,[a,R,V]),Jl();return}}oP(a,c,g,p,E)}function oP(a,r,c,p=!0,g=!1){if(g)throw a;console.error(a)}const fs=[];let ia=-1;const Gh=[];let Nl=null,Nh=0;const DS=Promise.resolve();let sg=null;function zS(a){const r=sg||DS;return a?r.then(this?a.bind(this):a):r}function aP(a){let r=ia+1,c=fs.length;for(;r<c;){const p=r+c>>>1,g=fs[p],b=pp(g);b<a||b===a&&g.flags&2?r=p+1:c=p}return r}function Z0(a){if(!(a.flags&1)){const r=pp(a),c=fs[fs.length-1];!c||!(a.flags&2)&&r>=pp(c)?fs.push(a):fs.splice(aP(r),0,a),a.flags|=1,RS()}}function RS(){sg||(sg=DS.then(kS))}function lP(a){en(a)?Gh.push(...a):Nl&&a.id===-1?Nl.splice(Nh+1,0,a):a.flags&1||(Gh.push(a),a.flags|=1),RS()}function $w(a,r,c=ia+1){for(;c<fs.length;c++){const p=fs[c];if(p&&p.flags&2){if(a&&p.id!==a.uid)continue;fs.splice(c,1),c--,p.flags&4&&(p.flags&=-2),p(),p.flags&4||(p.flags&=-2)}}}function LS(a){if(Gh.length){const r=[...new Set(Gh)].sort((c,p)=>pp(c)-pp(p));if(Gh.length=0,Nl){Nl.push(...r);return}for(Nl=r,Nh=0;Nh<Nl.length;Nh++){const c=Nl[Nh];c.flags&4&&(c.flags&=-2),c.flags&8||c(),c.flags&=-2}Nl=null,Nh=0}}const pp=a=>a.id==null?a.flags&2?-1:1/0:a.id;function kS(a){try{for(ia=0;ia<fs.length;ia++){const r=fs[ia];r&&!(r.flags&8)&&(r.flags&4&&(r.flags&=-2),Ip(r,r.i,r.i?15:14),r.flags&4||(r.flags&=-2))}}finally{for(;ia<fs.length;ia++){const r=fs[ia];r&&(r.flags&=-2)}ia=-1,fs.length=0,LS(),sg=null,(fs.length||Gh.length)&&kS()}}let ps=null,OS=null;function og(a){const r=ps;return ps=a,OS=a&&a.type.__scopeId||null,r}function Qr(a,r=ps,c){if(!r||a._n)return a;const p=(...g)=>{p._d&&n2(-1);const b=og(r);let E;try{E=a(...g)}finally{og(b),p._d&&n2(1)}return E};return p._n=!0,p._c=!0,p._d=!0,p}function qc(a,r,c,p){const g=a.dirs,b=r&&r.dirs;for(let E=0;E<g.length;E++){const i=g[E];b&&(i.oldValue=b[E].value);let R=i.dir[p];R&&(Kl(),aa(R,c,8,[a.el,i,a,r]),Jl())}}const cP=Symbol("_vte"),uP=a=>a.__isTeleport;function X0(a,r){a.shapeFlag&6&&a.component?(a.transition=r,X0(a.component.subTree,r)):a.shapeFlag&128?(a.ssContent.transition=r.clone(a.ssContent),a.ssFallback.transition=r.clone(a.ssFallback)):a.transition=r}/*! #__NO_SIDE_EFFECTS__ */function Mg(a,r){return Qi(a)?ss({name:a.name},r,{setup:a}):a}function FS(a){a.ids=[a.ids[0]+a.ids[2]+++"-",0,0]}function ag(a,r,c,p,g=!1){if(en(a)){a.forEach((ge,xe)=>ag(ge,r&&(en(r)?r[xe]:r),c,p,g));return}if(Hh(p)&&!g){p.shapeFlag&512&&p.type.__asyncResolved&&p.component.subTree.component&&ag(a,r,c,p.component.subTree);return}const b=p.shapeFlag&4?J0(p.component):p.el,E=g?null:b,{i,r:R}=a,V=r&&r.r,j=i.refs===Gn?i.refs={}:i.refs,W=i.setupState,te=Pn(W),ne=W===Gn?()=>!1:ge=>Dn(te,ge);if(V!=null&&V!==R&&(kr(V)?(j[V]=null,ne(V)&&(W[V]=null)):rs(V)&&(V.value=null)),Qi(R))Ip(R,i,12,[E,j]);else{const ge=kr(R),xe=rs(R);if(ge||xe){const Fe=()=>{if(a.f){const Be=ge?ne(R)?W[R]:j[R]:R.value;g?en(Be)&&O0(Be,b):en(Be)?Be.includes(b)||Be.push(b):ge?(j[R]=[b],ne(R)&&(W[R]=j[R])):(R.value=[b],a.k&&(j[a.k]=R.value))}else ge?(j[R]=E,ne(R)&&(W[R]=E)):xe&&(R.value=E,a.k&&(j[a.k]=E))};E?(Fe.id=-1,Vs(Fe,c)):Fe()}}}wg().requestIdleCallback;wg().cancelIdleCallback;const Hh=a=>!!a.type.__asyncLoader,BS=a=>a.type.__isKeepAlive;function hP(a,r){NS(a,"a",r)}function dP(a,r){NS(a,"da",r)}function NS(a,r,c=is){const p=a.__wdc||(a.__wdc=()=>{let g=c;for(;g;){if(g.isDeactivated)return;g=g.parent}return a()});if(Eg(r,p,c),c){let g=c.parent;for(;g&&g.parent;)BS(g.parent.vnode)&&fP(p,r,c,g),g=g.parent}}function fP(a,r,c,p){const g=Eg(r,a,p,!0);VS(()=>{O0(p[r],g)},c)}function Eg(a,r,c=is,p=!1){if(c){const g=c[a]||(c[a]=[]),b=r.__weh||(r.__weh=(...E)=>{Kl();const i=Cp(c),R=aa(r,c,a,E);return i(),Jl(),R});return p?g.unshift(b):g.push(b),b}}const $a=a=>(r,c=is)=>{(!gp||a==="sp")&&Eg(a,(...p)=>r(...p),c)},pP=$a("bm"),mP=$a("m"),_P=$a("bu"),gP=$a("u"),yP=$a("bum"),VS=$a("um"),xP=$a("sp"),vP=$a("rtg"),bP=$a("rtc");function wP(a,r=is){Eg("ec",a,r)}const TP="components";function Ww(a,r){return MP(TP,a,!0,r)||a}const SP=Symbol.for("v-ndc");function MP(a,r,c=!0,p=!1){const g=ps||is;if(g){const b=g.type;{const i=hD(b,!1);if(i&&(i===r||i===no(r)||i===bg(no(r))))return b}const E=Zw(g[a]||b[a],r)||Zw(g.appContext[a],r);return!E&&p?b:E}}function Zw(a,r){return a&&(a[r]||a[no(r)]||a[bg(no(r))])}function Ox(a,r,c={},p,g){if(ps.ce||ps.parent&&Hh(ps.parent)&&ps.parent.ce)return r!=="default"&&(c.name=r),$s(),r2(Hs,null,[jn("slot",c,p)],64);let b=a[r];b&&b._c&&(b._d=!1),$s();const E=b&&US(b(c)),i=c.key||E&&E.key,R=r2(Hs,{key:(i&&!au(i)?i:`_${r}`)+""},E||[],E&&a._===1?64:-2);return b&&b._c&&(b._d=!0),R}function US(a){return a.some(r=>_p(r)?!(r.type===Wh||r.type===Hs&&!US(r.children)):!0)?a:null}const c0=a=>a?lM(a)?J0(a):c0(a.parent):null,np=ss(Object.create(null),{$:a=>a,$el:a=>a.vnode.el,$data:a=>a.data,$props:a=>a.props,$attrs:a=>a.attrs,$slots:a=>a.slots,$refs:a=>a.refs,$parent:a=>c0(a.parent),$root:a=>c0(a.root),$host:a=>a.ce,$emit:a=>a.emit,$options:a=>GS(a),$forceUpdate:a=>a.f||(a.f=()=>{Z0(a.update)}),$nextTick:a=>a.n||(a.n=zS.bind(a.proxy)),$watch:a=>$P.bind(a)}),Fx=(a,r)=>a!==Gn&&!a.__isScriptSetup&&Dn(a,r),EP={get({_:a},r){if(r==="__v_skip")return!0;const{ctx:c,setupState:p,data:g,props:b,accessCache:E,type:i,appContext:R}=a;let V;if(r[0]!=="$"){const ne=E[r];if(ne!==void 0)switch(ne){case 1:return p[r];case 2:return g[r];case 4:return c[r];case 3:return b[r]}else{if(Fx(p,r))return E[r]=1,p[r];if(g!==Gn&&Dn(g,r))return E[r]=2,g[r];if((V=a.propsOptions[0])&&Dn(V,r))return E[r]=3,b[r];if(c!==Gn&&Dn(c,r))return E[r]=4,c[r];u0&&(E[r]=0)}}const j=np[r];let W,te;if(j)return r==="$attrs"&&ts(a.attrs,"get",""),j(a);if((W=i.__cssModules)&&(W=W[r]))return W;if(c!==Gn&&Dn(c,r))return E[r]=4,c[r];if(te=R.config.globalProperties,Dn(te,r))return te[r]},set({_:a},r,c){const{data:p,setupState:g,ctx:b}=a;return Fx(g,r)?(g[r]=c,!0):p!==Gn&&Dn(p,r)?(p[r]=c,!0):Dn(a.props,r)||r[0]==="$"&&r.slice(1)in a?!1:(b[r]=c,!0)},has({_:{data:a,setupState:r,accessCache:c,ctx:p,appContext:g,propsOptions:b}},E){let i;return!!c[E]||a!==Gn&&Dn(a,E)||Fx(r,E)||(i=b[0])&&Dn(i,E)||Dn(p,E)||Dn(np,E)||Dn(g.config.globalProperties,E)},defineProperty(a,r,c){return c.get!=null?a._.accessCache[r]=0:Dn(c,"value")&&this.set(a,r,c.value,null),Reflect.defineProperty(a,r,c)}};function Xw(a){return en(a)?a.reduce((r,c)=>(r[c]=null,r),{}):a}let u0=!0;function AP(a){const r=GS(a),c=a.proxy,p=a.ctx;u0=!1,r.beforeCreate&&Yw(r.beforeCreate,a,"bc");const{data:g,computed:b,methods:E,watch:i,provide:R,inject:V,created:j,beforeMount:W,mounted:te,beforeUpdate:ne,updated:ge,activated:xe,deactivated:Fe,beforeDestroy:Be,beforeUnmount:Ke,destroyed:at,unmounted:Ye,render:ct,renderTracked:Lt,renderTriggered:rt,errorCaptured:Ut,serverPrefetch:si,expose:It,inheritAttrs:Pt,components:Ii,directives:tn,filters:Fn}=r;if(V&&IP(V,p,null),E)for(const pi in E){const Di=E[pi];Qi(Di)&&(p[pi]=Di.bind(c))}if(g){const pi=g.call(c,c);gr(pi)&&(a.data=Tg(pi))}if(u0=!0,b)for(const pi in b){const Di=b[pi],qt=Qi(Di)?Di.bind(c,c):Qi(Di.get)?Di.get.bind(c,c):sa,Hn=!Qi(Di)&&Qi(Di.set)?Di.set.bind(c):sa,ir=Ao({get:qt,set:Hn});Object.defineProperty(p,pi,{enumerable:!0,configurable:!0,get:()=>ir.value,set:Sn=>ir.value=Sn})}if(i)for(const pi in i)jS(i[pi],p,c,pi);if(R){const pi=Qi(R)?R.call(c):R;Reflect.ownKeys(pi).forEach(Di=>{H_(Di,pi[Di])})}j&&Yw(j,a,"c");function mi(pi,Di){en(Di)?Di.forEach(qt=>pi(qt.bind(c))):Di&&pi(Di.bind(c))}if(mi(pP,W),mi(mP,te),mi(_P,ne),mi(gP,ge),mi(hP,xe),mi(dP,Fe),mi(wP,Ut),mi(bP,Lt),mi(vP,rt),mi(yP,Ke),mi(VS,Ye),mi(xP,si),en(It))if(It.length){const pi=a.exposed||(a.exposed={});It.forEach(Di=>{Object.defineProperty(pi,Di,{get:()=>c[Di],set:qt=>c[Di]=qt})})}else a.exposed||(a.exposed={});ct&&a.render===sa&&(a.render=ct),Pt!=null&&(a.inheritAttrs=Pt),Ii&&(a.components=Ii),tn&&(a.directives=tn),si&&FS(a)}function IP(a,r,c=sa){en(a)&&(a=h0(a));for(const p in a){const g=a[p];let b;gr(g)?"default"in g?b=qa(g.from||p,g.default,!0):b=qa(g.from||p):b=qa(g),rs(b)?Object.defineProperty(r,p,{enumerable:!0,configurable:!0,get:()=>b.value,set:E=>b.value=E}):r[p]=b}}function Yw(a,r,c){aa(en(a)?a.map(p=>p.bind(r.proxy)):a.bind(r.proxy),r,c)}function jS(a,r,c,p){let g=p.includes(".")?nM(c,p):()=>c[p];if(kr(a)){const b=r[a];Qi(b)&&q_(g,b)}else if(Qi(a))q_(g,a.bind(c));else if(gr(a))if(en(a))a.forEach(b=>jS(b,r,c,p));else{const b=Qi(a.handler)?a.handler.bind(c):r[a.handler];Qi(b)&&q_(g,b,a)}}function GS(a){const r=a.type,{mixins:c,extends:p}=r,{mixins:g,optionsCache:b,config:{optionMergeStrategies:E}}=a.appContext,i=b.get(r);let R;return i?R=i:!g.length&&!c&&!p?R=r:(R={},g.length&&g.forEach(V=>lg(R,V,E,!0)),lg(R,r,E)),gr(r)&&b.set(r,R),R}function lg(a,r,c,p=!1){const{mixins:g,extends:b}=r;b&&lg(a,b,c,!0),g&&g.forEach(E=>lg(a,E,c,!0));for(const E in r)if(!(p&&E==="expose")){const i=CP[E]||c&&c[E];a[E]=i?i(a[E],r[E]):r[E]}return a}const CP={data:Kw,props:Jw,emits:Jw,methods:qf,computed:qf,beforeCreate:hs,created:hs,beforeMount:hs,mounted:hs,beforeUpdate:hs,updated:hs,beforeDestroy:hs,beforeUnmount:hs,destroyed:hs,unmounted:hs,activated:hs,deactivated:hs,errorCaptured:hs,serverPrefetch:hs,components:qf,directives:qf,watch:DP,provide:Kw,inject:PP};function Kw(a,r){return r?a?function(){return ss(Qi(a)?a.call(this,this):a,Qi(r)?r.call(this,this):r)}:r:a}function PP(a,r){return qf(h0(a),h0(r))}function h0(a){if(en(a)){const r={};for(let c=0;c<a.length;c++)r[a[c]]=a[c];return r}return a}function hs(a,r){return a?[...new Set([].concat(a,r))]:r}function qf(a,r){return a?ss(Object.create(null),a,r):r}function Jw(a,r){return a?en(a)&&en(r)?[...new Set([...a,...r])]:ss(Object.create(null),Xw(a),Xw(r??{})):r}function DP(a,r){if(!a)return r;if(!r)return a;const c=ss(Object.create(null),a);for(const p in r)c[p]=hs(a[p],r[p]);return c}function HS(){return{app:null,config:{isNativeTag:yC,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let zP=0;function RP(a,r){return function(p,g=null){Qi(p)||(p=ss({},p)),g!=null&&!gr(g)&&(g=null);const b=HS(),E=new WeakSet,i=[];let R=!1;const V=b.app={_uid:zP++,_component:p,_props:g,_container:null,_context:b,_instance:null,version:fD,get config(){return b.config},set config(j){},use(j,...W){return E.has(j)||(j&&Qi(j.install)?(E.add(j),j.install(V,...W)):Qi(j)&&(E.add(j),j(V,...W))),V},mixin(j){return b.mixins.includes(j)||b.mixins.push(j),V},component(j,W){return W?(b.components[j]=W,V):b.components[j]},directive(j,W){return W?(b.directives[j]=W,V):b.directives[j]},mount(j,W,te){if(!R){const ne=V._ceVNode||jn(p,g);return ne.appContext=b,te===!0?te="svg":te===!1&&(te=void 0),a(ne,j,te),R=!0,V._container=j,j.__vue_app__=V,J0(ne.component)}},onUnmount(j){i.push(j)},unmount(){R&&(aa(i,V._instance,16),a(null,V._container),delete V._container.__vue_app__)},provide(j,W){return b.provides[j]=W,V},runWithContext(j){const W=qh;qh=V;try{return j()}finally{qh=W}}};return V}}let qh=null;function H_(a,r){if(is){let c=is.provides;const p=is.parent&&is.parent.provides;p===c&&(c=is.provides=Object.create(p)),c[a]=r}}function qa(a,r,c=!1){const p=is||ps;if(p||qh){const g=qh?qh._context.provides:p?p.parent==null?p.vnode.appContext&&p.vnode.appContext.provides:p.parent.provides:void 0;if(g&&a in g)return g[a];if(arguments.length>1)return c&&Qi(r)?r.call(p&&p.proxy):r}}const qS={},$S=()=>Object.create(qS),WS=a=>Object.getPrototypeOf(a)===qS;function LP(a,r,c,p=!1){const g={},b=$S();a.propsDefaults=Object.create(null),ZS(a,r,g,b);for(const E in a.propsOptions[0])E in g||(g[E]=void 0);c?a.props=p?g:MS(g):a.type.props?a.props=g:a.props=b,a.attrs=b}function kP(a,r,c,p){const{props:g,attrs:b,vnode:{patchFlag:E}}=a,i=Pn(g),[R]=a.propsOptions;let V=!1;if((p||E>0)&&!(E&16)){if(E&8){const j=a.vnode.dynamicProps;for(let W=0;W<j.length;W++){let te=j[W];if(Ag(a.emitsOptions,te))continue;const ne=r[te];if(R)if(Dn(b,te))ne!==b[te]&&(b[te]=ne,V=!0);else{const ge=no(te);g[ge]=d0(R,i,ge,ne,a,!1)}else ne!==b[te]&&(b[te]=ne,V=!0)}}}else{ZS(a,r,g,b)&&(V=!0);let j;for(const W in i)(!r||!Dn(r,W)&&((j=lu(W))===W||!Dn(r,j)))&&(R?c&&(c[W]!==void 0||c[j]!==void 0)&&(g[W]=d0(R,i,W,void 0,a,!0)):delete g[W]);if(b!==i)for(const W in b)(!r||!Dn(r,W))&&(delete b[W],V=!0)}V&&Ua(a.attrs,"set","")}function ZS(a,r,c,p){const[g,b]=a.propsOptions;let E=!1,i;if(r)for(let R in r){if(Qf(R))continue;const V=r[R];let j;g&&Dn(g,j=no(R))?!b||!b.includes(j)?c[j]=V:(i||(i={}))[j]=V:Ag(a.emitsOptions,R)||(!(R in p)||V!==p[R])&&(p[R]=V,E=!0)}if(b){const R=Pn(c),V=i||Gn;for(let j=0;j<b.length;j++){const W=b[j];c[W]=d0(g,R,W,V[W],a,!Dn(V,W))}}return E}function d0(a,r,c,p,g,b){const E=a[c];if(E!=null){const i=Dn(E,"default");if(i&&p===void 0){const R=E.default;if(E.type!==Function&&!E.skipFactory&&Qi(R)){const{propsDefaults:V}=g;if(c in V)p=V[c];else{const j=Cp(g);p=V[c]=R.call(null,r),j()}}else p=R;g.ce&&g.ce._setProp(c,p)}E[0]&&(b&&!i?p=!1:E[1]&&(p===""||p===lu(c))&&(p=!0))}return p}const OP=new WeakMap;function XS(a,r,c=!1){const p=c?OP:r.propsCache,g=p.get(a);if(g)return g;const b=a.props,E={},i=[];let R=!1;if(!Qi(a)){const j=W=>{R=!0;const[te,ne]=XS(W,r,!0);ss(E,te),ne&&i.push(...ne)};!c&&r.mixins.length&&r.mixins.forEach(j),a.extends&&j(a.extends),a.mixins&&a.mixins.forEach(j)}if(!b&&!R)return gr(a)&&p.set(a,Uh),Uh;if(en(b))for(let j=0;j<b.length;j++){const W=no(b[j]);Qw(W)&&(E[W]=Gn)}else if(b)for(const j in b){const W=no(j);if(Qw(W)){const te=b[j],ne=E[W]=en(te)||Qi(te)?{type:te}:ss({},te),ge=ne.type;let xe=!1,Fe=!0;if(en(ge))for(let Be=0;Be<ge.length;++Be){const Ke=ge[Be],at=Qi(Ke)&&Ke.name;if(at==="Boolean"){xe=!0;break}else at==="String"&&(Fe=!1)}else xe=Qi(ge)&&ge.name==="Boolean";ne[0]=xe,ne[1]=Fe,(xe||Dn(ne,"default"))&&i.push(W)}}const V=[E,i];return gr(a)&&p.set(a,V),V}function Qw(a){return a[0]!=="$"&&!Qf(a)}const YS=a=>a[0]==="_"||a==="$stable",Y0=a=>en(a)?a.map(ra):[ra(a)],FP=(a,r,c)=>{if(r._n)return r;const p=Qr((...g)=>Y0(r(...g)),c);return p._c=!1,p},KS=(a,r,c)=>{const p=a._ctx;for(const g in a){if(YS(g))continue;const b=a[g];if(Qi(b))r[g]=FP(g,b,p);else if(b!=null){const E=Y0(b);r[g]=()=>E}}},JS=(a,r)=>{const c=Y0(r);a.slots.default=()=>c},QS=(a,r,c)=>{for(const p in r)(c||p!=="_")&&(a[p]=r[p])},BP=(a,r,c)=>{const p=a.slots=$S();if(a.vnode.shapeFlag&32){const g=r._;g?(QS(p,r,c),c&&lS(p,"_",g,!0)):KS(r,p)}else r&&JS(a,r)},NP=(a,r,c)=>{const{vnode:p,slots:g}=a;let b=!0,E=Gn;if(p.shapeFlag&32){const i=r._;i?c&&i===1?b=!1:QS(g,r,c):(b=!r.$stable,KS(r,g)),E=r}else r&&(JS(a,r),E={default:1});if(b)for(const i in g)!YS(i)&&E[i]==null&&delete g[i]},Vs=QP;function VP(a){return UP(a)}function UP(a,r){const c=wg();c.__VUE__=!0;const{insert:p,remove:g,patchProp:b,createElement:E,createText:i,createComment:R,setText:V,setElementText:j,parentNode:W,nextSibling:te,setScopeId:ne=sa,insertStaticContent:ge}=a,xe=(ke,Ue,Ae,bt=null,yt=null,St=null,xt=void 0,Nt=null,jt=!!Ue.dynamicChildren)=>{if(ke===Ue)return;ke&&!Of(ke,Ue)&&(bt=Mt(ke),Sn(ke,yt,St,!0),ke=null),Ue.patchFlag===-2&&(jt=!1,Ue.dynamicChildren=null);const{type:Bt,ref:vi,shapeFlag:Jt}=Ue;switch(Bt){case Ig:Fe(ke,Ue,Ae,bt);break;case Wh:Be(ke,Ue,Ae,bt);break;case Nx:ke==null&&Ke(Ue,Ae,bt,xt);break;case Hs:Ii(ke,Ue,Ae,bt,yt,St,xt,Nt,jt);break;default:Jt&1?ct(ke,Ue,Ae,bt,yt,St,xt,Nt,jt):Jt&6?tn(ke,Ue,Ae,bt,yt,St,xt,Nt,jt):(Jt&64||Jt&128)&&Bt.process(ke,Ue,Ae,bt,yt,St,xt,Nt,jt,me)}vi!=null&&yt&&ag(vi,ke&&ke.ref,St,Ue||ke,!Ue)},Fe=(ke,Ue,Ae,bt)=>{if(ke==null)p(Ue.el=i(Ue.children),Ae,bt);else{const yt=Ue.el=ke.el;Ue.children!==ke.children&&V(yt,Ue.children)}},Be=(ke,Ue,Ae,bt)=>{ke==null?p(Ue.el=R(Ue.children||""),Ae,bt):Ue.el=ke.el},Ke=(ke,Ue,Ae,bt)=>{[ke.el,ke.anchor]=ge(ke.children,Ue,Ae,bt,ke.el,ke.anchor)},at=({el:ke,anchor:Ue},Ae,bt)=>{let yt;for(;ke&&ke!==Ue;)yt=te(ke),p(ke,Ae,bt),ke=yt;p(Ue,Ae,bt)},Ye=({el:ke,anchor:Ue})=>{let Ae;for(;ke&&ke!==Ue;)Ae=te(ke),g(ke),ke=Ae;g(Ue)},ct=(ke,Ue,Ae,bt,yt,St,xt,Nt,jt)=>{Ue.type==="svg"?xt="svg":Ue.type==="math"&&(xt="mathml"),ke==null?Lt(Ue,Ae,bt,yt,St,xt,Nt,jt):si(ke,Ue,yt,St,xt,Nt,jt)},Lt=(ke,Ue,Ae,bt,yt,St,xt,Nt)=>{let jt,Bt;const{props:vi,shapeFlag:Jt,transition:At,dirs:Mi}=ke;if(jt=ke.el=E(ke.type,St,vi&&vi.is,vi),Jt&8?j(jt,ke.children):Jt&16&&Ut(ke.children,jt,null,bt,yt,Bx(ke,St),xt,Nt),Mi&&qc(ke,null,bt,"created"),rt(jt,ke,ke.scopeId,xt,bt),vi){for(const un in vi)un!=="value"&&!Qf(un)&&b(jt,un,null,vi[un],St,bt);"value"in vi&&b(jt,"value",null,vi.value,St),(Bt=vi.onVnodeBeforeMount)&&ea(Bt,bt,ke)}Mi&&qc(ke,null,bt,"beforeMount");const Ui=jP(yt,At);Ui&&At.beforeEnter(jt),p(jt,Ue,Ae),((Bt=vi&&vi.onVnodeMounted)||Ui||Mi)&&Vs(()=>{Bt&&ea(Bt,bt,ke),Ui&&At.enter(jt),Mi&&qc(ke,null,bt,"mounted")},yt)},rt=(ke,Ue,Ae,bt,yt)=>{if(Ae&&ne(ke,Ae),bt)for(let St=0;St<bt.length;St++)ne(ke,bt[St]);if(yt){let St=yt.subTree;if(Ue===St||sM(St.type)&&(St.ssContent===Ue||St.ssFallback===Ue)){const xt=yt.vnode;rt(ke,xt,xt.scopeId,xt.slotScopeIds,yt.parent)}}},Ut=(ke,Ue,Ae,bt,yt,St,xt,Nt,jt=0)=>{for(let Bt=jt;Bt<ke.length;Bt++){const vi=ke[Bt]=Nt?Vl(ke[Bt]):ra(ke[Bt]);xe(null,vi,Ue,Ae,bt,yt,St,xt,Nt)}},si=(ke,Ue,Ae,bt,yt,St,xt)=>{const Nt=Ue.el=ke.el;let{patchFlag:jt,dynamicChildren:Bt,dirs:vi}=Ue;jt|=ke.patchFlag&16;const Jt=ke.props||Gn,At=Ue.props||Gn;let Mi;if(Ae&&$c(Ae,!1),(Mi=At.onVnodeBeforeUpdate)&&ea(Mi,Ae,Ue,ke),vi&&qc(Ue,ke,Ae,"beforeUpdate"),Ae&&$c(Ae,!0),(Jt.innerHTML&&At.innerHTML==null||Jt.textContent&&At.textContent==null)&&j(Nt,""),Bt?It(ke.dynamicChildren,Bt,Nt,Ae,bt,Bx(Ue,yt),St):xt||Di(ke,Ue,Nt,null,Ae,bt,Bx(Ue,yt),St,!1),jt>0){if(jt&16)Pt(Nt,Jt,At,Ae,yt);else if(jt&2&&Jt.class!==At.class&&b(Nt,"class",null,At.class,yt),jt&4&&b(Nt,"style",Jt.style,At.style,yt),jt&8){const Ui=Ue.dynamicProps;for(let un=0;un<Ui.length;un++){const Li=Ui[un],zn=Jt[Li],lr=At[Li];(lr!==zn||Li==="value")&&b(Nt,Li,zn,lr,yt,Ae)}}jt&1&&ke.children!==Ue.children&&j(Nt,Ue.children)}else!xt&&Bt==null&&Pt(Nt,Jt,At,Ae,yt);((Mi=At.onVnodeUpdated)||vi)&&Vs(()=>{Mi&&ea(Mi,Ae,Ue,ke),vi&&qc(Ue,ke,Ae,"updated")},bt)},It=(ke,Ue,Ae,bt,yt,St,xt)=>{for(let Nt=0;Nt<Ue.length;Nt++){const jt=ke[Nt],Bt=Ue[Nt],vi=jt.el&&(jt.type===Hs||!Of(jt,Bt)||jt.shapeFlag&70)?W(jt.el):Ae;xe(jt,Bt,vi,null,bt,yt,St,xt,!0)}},Pt=(ke,Ue,Ae,bt,yt)=>{if(Ue!==Ae){if(Ue!==Gn)for(const St in Ue)!Qf(St)&&!(St in Ae)&&b(ke,St,Ue[St],null,yt,bt);for(const St in Ae){if(Qf(St))continue;const xt=Ae[St],Nt=Ue[St];xt!==Nt&&St!=="value"&&b(ke,St,Nt,xt,yt,bt)}"value"in Ae&&b(ke,"value",Ue.value,Ae.value,yt)}},Ii=(ke,Ue,Ae,bt,yt,St,xt,Nt,jt)=>{const Bt=Ue.el=ke?ke.el:i(""),vi=Ue.anchor=ke?ke.anchor:i("");let{patchFlag:Jt,dynamicChildren:At,slotScopeIds:Mi}=Ue;Mi&&(Nt=Nt?Nt.concat(Mi):Mi),ke==null?(p(Bt,Ae,bt),p(vi,Ae,bt),Ut(Ue.children||[],Ae,vi,yt,St,xt,Nt,jt)):Jt>0&&Jt&64&&At&&ke.dynamicChildren?(It(ke.dynamicChildren,At,Ae,yt,St,xt,Nt),(Ue.key!=null||yt&&Ue===yt.subTree)&&eM(ke,Ue,!0)):Di(ke,Ue,Ae,vi,yt,St,xt,Nt,jt)},tn=(ke,Ue,Ae,bt,yt,St,xt,Nt,jt)=>{Ue.slotScopeIds=Nt,ke==null?Ue.shapeFlag&512?yt.ctx.activate(Ue,Ae,bt,xt,jt):Fn(Ue,Ae,bt,yt,St,xt,jt):Gt(ke,Ue,jt)},Fn=(ke,Ue,Ae,bt,yt,St,xt)=>{const Nt=ke.component=oD(ke,bt,yt);if(BS(ke)&&(Nt.ctx.renderer=me),aD(Nt,!1,xt),Nt.asyncDep){if(yt&&yt.registerDep(Nt,mi,xt),!ke.el){const jt=Nt.subTree=jn(Wh);Be(null,jt,Ue,Ae)}}else mi(Nt,ke,Ue,Ae,yt,St,xt)},Gt=(ke,Ue,Ae)=>{const bt=Ue.component=ke.component;if(KP(ke,Ue,Ae))if(bt.asyncDep&&!bt.asyncResolved){pi(bt,Ue,Ae);return}else bt.next=Ue,bt.update();else Ue.el=ke.el,bt.vnode=Ue},mi=(ke,Ue,Ae,bt,yt,St,xt)=>{const Nt=()=>{if(ke.isMounted){let{next:Jt,bu:At,u:Mi,parent:Ui,vnode:un}=ke;{const wr=tM(ke);if(wr){Jt&&(Jt.el=un.el,pi(ke,Jt,xt)),wr.asyncDep.then(()=>{ke.isUnmounted||Nt()});return}}let Li=Jt,zn;$c(ke,!1),Jt?(Jt.el=un.el,pi(ke,Jt,xt)):Jt=un,At&&zx(At),(zn=Jt.props&&Jt.props.onVnodeBeforeUpdate)&&ea(zn,Ui,Jt,un),$c(ke,!0);const lr=t2(ke),Pr=ke.subTree;ke.subTree=lr,xe(Pr,lr,W(Pr.el),Mt(Pr),ke,yt,St),Jt.el=lr.el,Li===null&&JP(ke,lr.el),Mi&&Vs(Mi,yt),(zn=Jt.props&&Jt.props.onVnodeUpdated)&&Vs(()=>ea(zn,Ui,Jt,un),yt)}else{let Jt;const{el:At,props:Mi}=Ue,{bm:Ui,m:un,parent:Li,root:zn,type:lr}=ke,Pr=Hh(Ue);$c(ke,!1),Ui&&zx(Ui),!Pr&&(Jt=Mi&&Mi.onVnodeBeforeMount)&&ea(Jt,Li,Ue),$c(ke,!0);{zn.ce&&zn.ce._injectChildStyle(lr);const wr=ke.subTree=t2(ke);xe(null,wr,Ae,bt,ke,yt,St),Ue.el=wr.el}if(un&&Vs(un,yt),!Pr&&(Jt=Mi&&Mi.onVnodeMounted)){const wr=Ue;Vs(()=>ea(Jt,Li,wr),yt)}(Ue.shapeFlag&256||Li&&Hh(Li.vnode)&&Li.vnode.shapeFlag&256)&&ke.a&&Vs(ke.a,yt),ke.isMounted=!0,Ue=Ae=bt=null}};ke.scope.on();const jt=ke.effect=new hS(Nt);ke.scope.off();const Bt=ke.update=jt.run.bind(jt),vi=ke.job=jt.runIfDirty.bind(jt);vi.i=ke,vi.id=ke.uid,jt.scheduler=()=>Z0(vi),$c(ke,!0),Bt()},pi=(ke,Ue,Ae)=>{Ue.component=ke;const bt=ke.vnode.props;ke.vnode=Ue,ke.next=null,kP(ke,Ue.props,bt,Ae),NP(ke,Ue.children,Ae),Kl(),$w(ke),Jl()},Di=(ke,Ue,Ae,bt,yt,St,xt,Nt,jt=!1)=>{const Bt=ke&&ke.children,vi=ke?ke.shapeFlag:0,Jt=Ue.children,{patchFlag:At,shapeFlag:Mi}=Ue;if(At>0){if(At&128){Hn(Bt,Jt,Ae,bt,yt,St,xt,Nt,jt);return}else if(At&256){qt(Bt,Jt,Ae,bt,yt,St,xt,Nt,jt);return}}Mi&8?(vi&16&&mn(Bt,yt,St),Jt!==Bt&&j(Ae,Jt)):vi&16?Mi&16?Hn(Bt,Jt,Ae,bt,yt,St,xt,Nt,jt):mn(Bt,yt,St,!0):(vi&8&&j(Ae,""),Mi&16&&Ut(Jt,Ae,bt,yt,St,xt,Nt,jt))},qt=(ke,Ue,Ae,bt,yt,St,xt,Nt,jt)=>{ke=ke||Uh,Ue=Ue||Uh;const Bt=ke.length,vi=Ue.length,Jt=Math.min(Bt,vi);let At;for(At=0;At<Jt;At++){const Mi=Ue[At]=jt?Vl(Ue[At]):ra(Ue[At]);xe(ke[At],Mi,Ae,null,yt,St,xt,Nt,jt)}Bt>vi?mn(ke,yt,St,!0,!1,Jt):Ut(Ue,Ae,bt,yt,St,xt,Nt,jt,Jt)},Hn=(ke,Ue,Ae,bt,yt,St,xt,Nt,jt)=>{let Bt=0;const vi=Ue.length;let Jt=ke.length-1,At=vi-1;for(;Bt<=Jt&&Bt<=At;){const Mi=ke[Bt],Ui=Ue[Bt]=jt?Vl(Ue[Bt]):ra(Ue[Bt]);if(Of(Mi,Ui))xe(Mi,Ui,Ae,null,yt,St,xt,Nt,jt);else break;Bt++}for(;Bt<=Jt&&Bt<=At;){const Mi=ke[Jt],Ui=Ue[At]=jt?Vl(Ue[At]):ra(Ue[At]);if(Of(Mi,Ui))xe(Mi,Ui,Ae,null,yt,St,xt,Nt,jt);else break;Jt--,At--}if(Bt>Jt){if(Bt<=At){const Mi=At+1,Ui=Mi<vi?Ue[Mi].el:bt;for(;Bt<=At;)xe(null,Ue[Bt]=jt?Vl(Ue[Bt]):ra(Ue[Bt]),Ae,Ui,yt,St,xt,Nt,jt),Bt++}}else if(Bt>At)for(;Bt<=Jt;)Sn(ke[Bt],yt,St,!0),Bt++;else{const Mi=Bt,Ui=Bt,un=new Map;for(Bt=Ui;Bt<=At;Bt++){const cr=Ue[Bt]=jt?Vl(Ue[Bt]):ra(Ue[Bt]);cr.key!=null&&un.set(cr.key,Bt)}let Li,zn=0;const lr=At-Ui+1;let Pr=!1,wr=0;const Or=new Array(lr);for(Bt=0;Bt<lr;Bt++)Or[Bt]=0;for(Bt=Mi;Bt<=Jt;Bt++){const cr=ke[Bt];if(zn>=lr){Sn(cr,yt,St,!0);continue}let qn;if(cr.key!=null)qn=un.get(cr.key);else for(Li=Ui;Li<=At;Li++)if(Or[Li-Ui]===0&&Of(cr,Ue[Li])){qn=Li;break}qn===void 0?Sn(cr,yt,St,!0):(Or[qn-Ui]=Bt+1,qn>=wr?wr=qn:Pr=!0,xe(cr,Ue[qn],Ae,null,yt,St,xt,Nt,jt),zn++)}const Ws=Pr?GP(Or):Uh;for(Li=Ws.length-1,Bt=lr-1;Bt>=0;Bt--){const cr=Ui+Bt,qn=Ue[cr],Lo=cr+1<vi?Ue[cr+1].el:bt;Or[Bt]===0?xe(null,qn,Ae,Lo,yt,St,xt,Nt,jt):Pr&&(Li<0||Bt!==Ws[Li]?ir(qn,Ae,Lo,2):Li--)}}},ir=(ke,Ue,Ae,bt,yt=null)=>{const{el:St,type:xt,transition:Nt,children:jt,shapeFlag:Bt}=ke;if(Bt&6){ir(ke.component.subTree,Ue,Ae,bt);return}if(Bt&128){ke.suspense.move(Ue,Ae,bt);return}if(Bt&64){xt.move(ke,Ue,Ae,me);return}if(xt===Hs){p(St,Ue,Ae);for(let Jt=0;Jt<jt.length;Jt++)ir(jt[Jt],Ue,Ae,bt);p(ke.anchor,Ue,Ae);return}if(xt===Nx){at(ke,Ue,Ae);return}if(bt!==2&&Bt&1&&Nt)if(bt===0)Nt.beforeEnter(St),p(St,Ue,Ae),Vs(()=>Nt.enter(St),yt);else{const{leave:Jt,delayLeave:At,afterLeave:Mi}=Nt,Ui=()=>p(St,Ue,Ae),un=()=>{Jt(St,()=>{Ui(),Mi&&Mi()})};At?At(St,Ui,un):un()}else p(St,Ue,Ae)},Sn=(ke,Ue,Ae,bt=!1,yt=!1)=>{const{type:St,props:xt,ref:Nt,children:jt,dynamicChildren:Bt,shapeFlag:vi,patchFlag:Jt,dirs:At,cacheIndex:Mi}=ke;if(Jt===-2&&(yt=!1),Nt!=null&&ag(Nt,null,Ae,ke,!0),Mi!=null&&(Ue.renderCache[Mi]=void 0),vi&256){Ue.ctx.deactivate(ke);return}const Ui=vi&1&&At,un=!Hh(ke);let Li;if(un&&(Li=xt&&xt.onVnodeBeforeUnmount)&&ea(Li,Ue,ke),vi&6)Qn(ke.component,Ae,bt);else{if(vi&128){ke.suspense.unmount(Ae,bt);return}Ui&&qc(ke,null,Ue,"beforeUnmount"),vi&64?ke.type.remove(ke,Ue,Ae,me,bt):Bt&&!Bt.hasOnce&&(St!==Hs||Jt>0&&Jt&64)?mn(Bt,Ue,Ae,!1,!0):(St===Hs&&Jt&384||!yt&&vi&16)&&mn(jt,Ue,Ae),bt&&Qt(ke)}(un&&(Li=xt&&xt.onVnodeUnmounted)||Ui)&&Vs(()=>{Li&&ea(Li,Ue,ke),Ui&&qc(ke,null,Ue,"unmounted")},Ae)},Qt=ke=>{const{type:Ue,el:Ae,anchor:bt,transition:yt}=ke;if(Ue===Hs){ar(Ae,bt);return}if(Ue===Nx){Ye(ke);return}const St=()=>{g(Ae),yt&&!yt.persisted&&yt.afterLeave&&yt.afterLeave()};if(ke.shapeFlag&1&&yt&&!yt.persisted){const{leave:xt,delayLeave:Nt}=yt,jt=()=>xt(Ae,St);Nt?Nt(ke.el,St,jt):jt()}else St()},ar=(ke,Ue)=>{let Ae;for(;ke!==Ue;)Ae=te(ke),g(ke),ke=Ae;g(Ue)},Qn=(ke,Ue,Ae)=>{const{bum:bt,scope:yt,job:St,subTree:xt,um:Nt,m:jt,a:Bt}=ke;e2(jt),e2(Bt),bt&&zx(bt),yt.stop(),St&&(St.flags|=8,Sn(xt,ke,Ue,Ae)),Nt&&Vs(Nt,Ue),Vs(()=>{ke.isUnmounted=!0},Ue),Ue&&Ue.pendingBranch&&!Ue.isUnmounted&&ke.asyncDep&&!ke.asyncResolved&&ke.suspenseId===Ue.pendingId&&(Ue.deps--,Ue.deps===0&&Ue.resolve())},mn=(ke,Ue,Ae,bt=!1,yt=!1,St=0)=>{for(let xt=St;xt<ke.length;xt++)Sn(ke[xt],Ue,Ae,bt,yt)},Mt=ke=>{if(ke.shapeFlag&6)return Mt(ke.component.subTree);if(ke.shapeFlag&128)return ke.suspense.next();const Ue=te(ke.anchor||ke.el),Ae=Ue&&Ue[cP];return Ae?te(Ae):Ue};let ti=!1;const Xt=(ke,Ue,Ae)=>{ke==null?Ue._vnode&&Sn(Ue._vnode,null,null,!0):xe(Ue._vnode||null,ke,Ue,null,null,null,Ae),Ue._vnode=ke,ti||(ti=!0,$w(),LS(),ti=!1)},me={p:xe,um:Sn,m:ir,r:Qt,mt:Fn,mc:Ut,pc:Di,pbc:It,n:Mt,o:a};return{render:Xt,hydrate:void 0,createApp:RP(Xt)}}function Bx({type:a,props:r},c){return c==="svg"&&a==="foreignObject"||c==="mathml"&&a==="annotation-xml"&&r&&r.encoding&&r.encoding.includes("html")?void 0:c}function $c({effect:a,job:r},c){c?(a.flags|=32,r.flags|=4):(a.flags&=-33,r.flags&=-5)}function jP(a,r){return(!a||a&&!a.pendingBranch)&&r&&!r.persisted}function eM(a,r,c=!1){const p=a.children,g=r.children;if(en(p)&&en(g))for(let b=0;b<p.length;b++){const E=p[b];let i=g[b];i.shapeFlag&1&&!i.dynamicChildren&&((i.patchFlag<=0||i.patchFlag===32)&&(i=g[b]=Vl(g[b]),i.el=E.el),!c&&i.patchFlag!==-2&&eM(E,i)),i.type===Ig&&(i.el=E.el)}}function GP(a){const r=a.slice(),c=[0];let p,g,b,E,i;const R=a.length;for(p=0;p<R;p++){const V=a[p];if(V!==0){if(g=c[c.length-1],a[g]<V){r[p]=g,c.push(p);continue}for(b=0,E=c.length-1;b<E;)i=b+E>>1,a[c[i]]<V?b=i+1:E=i;V<a[c[b]]&&(b>0&&(r[p]=c[b-1]),c[b]=p)}}for(b=c.length,E=c[b-1];b-- >0;)c[b]=E,E=r[E];return c}function tM(a){const r=a.subTree.component;if(r)return r.asyncDep&&!r.asyncResolved?r:tM(r)}function e2(a){if(a)for(let r=0;r<a.length;r++)a[r].flags|=8}const HP=Symbol.for("v-scx"),qP=()=>qa(HP);function q_(a,r,c){return iM(a,r,c)}function iM(a,r,c=Gn){const{immediate:p,deep:g,flush:b,once:E}=c,i=ss({},c),R=r&&p||!r&&b!=="post";let V;if(gp){if(b==="sync"){const ne=qP();V=ne.__watcherHandles||(ne.__watcherHandles=[])}else if(!R){const ne=()=>{};return ne.stop=sa,ne.resume=sa,ne.pause=sa,ne}}const j=is;i.call=(ne,ge,xe)=>aa(ne,j,ge,xe);let W=!1;b==="post"?i.scheduler=ne=>{Vs(ne,j&&j.suspense)}:b!=="sync"&&(W=!0,i.scheduler=(ne,ge)=>{ge?ne():Z0(ne)}),i.augmentJob=ne=>{r&&(ne.flags|=4),W&&(ne.flags|=2,j&&(ne.id=j.uid,ne.i=j))};const te=sP(a,r,i);return gp&&(V?V.push(te):R&&te()),te}function $P(a,r,c){const p=this.proxy,g=kr(a)?a.includes(".")?nM(p,a):()=>p[a]:a.bind(p,p);let b;Qi(r)?b=r:(b=r.handler,c=r);const E=Cp(this),i=iM(g,b.bind(p),c);return E(),i}function nM(a,r){const c=r.split(".");return()=>{let p=a;for(let g=0;g<c.length&&p;g++)p=p[c[g]];return p}}const WP=(a,r)=>r==="modelValue"||r==="model-value"?a.modelModifiers:a[`${r}Modifiers`]||a[`${no(r)}Modifiers`]||a[`${lu(r)}Modifiers`];function ZP(a,r,...c){if(a.isUnmounted)return;const p=a.vnode.props||Gn;let g=c;const b=r.startsWith("update:"),E=b&&WP(p,r.slice(7));E&&(E.trim&&(g=c.map(j=>kr(j)?j.trim():j)),E.number&&(g=c.map(EC)));let i,R=p[i=Dx(r)]||p[i=Dx(no(r))];!R&&b&&(R=p[i=Dx(lu(r))]),R&&aa(R,a,6,g);const V=p[i+"Once"];if(V){if(!a.emitted)a.emitted={};else if(a.emitted[i])return;a.emitted[i]=!0,aa(V,a,6,g)}}function rM(a,r,c=!1){const p=r.emitsCache,g=p.get(a);if(g!==void 0)return g;const b=a.emits;let E={},i=!1;if(!Qi(a)){const R=V=>{const j=rM(V,r,!0);j&&(i=!0,ss(E,j))};!c&&r.mixins.length&&r.mixins.forEach(R),a.extends&&R(a.extends),a.mixins&&a.mixins.forEach(R)}return!b&&!i?(gr(a)&&p.set(a,null),null):(en(b)?b.forEach(R=>E[R]=null):ss(E,b),gr(a)&&p.set(a,E),E)}function Ag(a,r){return!a||!yg(r)?!1:(r=r.slice(2).replace(/Once$/,""),Dn(a,r[0].toLowerCase()+r.slice(1))||Dn(a,lu(r))||Dn(a,r))}function t2(a){const{type:r,vnode:c,proxy:p,withProxy:g,propsOptions:[b],slots:E,attrs:i,emit:R,render:V,renderCache:j,props:W,data:te,setupState:ne,ctx:ge,inheritAttrs:xe}=a,Fe=og(a);let Be,Ke;try{if(c.shapeFlag&4){const Ye=g||p,ct=Ye;Be=ra(V.call(ct,Ye,j,W,ne,te,ge)),Ke=i}else{const Ye=r;Be=ra(Ye.length>1?Ye(W,{attrs:i,slots:E,emit:R}):Ye(W,null)),Ke=r.props?i:XP(i)}}catch(Ye){rp.length=0,Sg(Ye,a,1),Be=jn(Wh)}let at=Be;if(Ke&&xe!==!1){const Ye=Object.keys(Ke),{shapeFlag:ct}=at;Ye.length&&ct&7&&(b&&Ye.some(k0)&&(Ke=YP(Ke,b)),at=Zh(at,Ke,!1,!0))}return c.dirs&&(at=Zh(at,null,!1,!0),at.dirs=at.dirs?at.dirs.concat(c.dirs):c.dirs),c.transition&&X0(at,c.transition),Be=at,og(Fe),Be}const XP=a=>{let r;for(const c in a)(c==="class"||c==="style"||yg(c))&&((r||(r={}))[c]=a[c]);return r},YP=(a,r)=>{const c={};for(const p in a)(!k0(p)||!(p.slice(9)in r))&&(c[p]=a[p]);return c};function KP(a,r,c){const{props:p,children:g,component:b}=a,{props:E,children:i,patchFlag:R}=r,V=b.emitsOptions;if(r.dirs||r.transition)return!0;if(c&&R>=0){if(R&1024)return!0;if(R&16)return p?i2(p,E,V):!!E;if(R&8){const j=r.dynamicProps;for(let W=0;W<j.length;W++){const te=j[W];if(E[te]!==p[te]&&!Ag(V,te))return!0}}}else return(g||i)&&(!i||!i.$stable)?!0:p===E?!1:p?E?i2(p,E,V):!0:!!E;return!1}function i2(a,r,c){const p=Object.keys(r);if(p.length!==Object.keys(a).length)return!0;for(let g=0;g<p.length;g++){const b=p[g];if(r[b]!==a[b]&&!Ag(c,b))return!0}return!1}function JP({vnode:a,parent:r},c){for(;r;){const p=r.subTree;if(p.suspense&&p.suspense.activeBranch===a&&(p.el=a.el),p===a)(a=r.vnode).el=c,r=r.parent;else break}}const sM=a=>a.__isSuspense;function QP(a,r){r&&r.pendingBranch?en(a)?r.effects.push(...a):r.effects.push(a):lP(a)}const Hs=Symbol.for("v-fgt"),Ig=Symbol.for("v-txt"),Wh=Symbol.for("v-cmt"),Nx=Symbol.for("v-stc"),rp=[];let qs=null;function $s(a=!1){rp.push(qs=a?null:[])}function eD(){rp.pop(),qs=rp[rp.length-1]||null}let mp=1;function n2(a,r=!1){mp+=a,a<0&&qs&&r&&(qs.hasOnce=!0)}function oM(a){return a.dynamicChildren=mp>0?qs||Uh:null,eD(),mp>0&&qs&&qs.push(a),a}function Ro(a,r,c,p,g,b){return oM(cn(a,r,c,p,g,b,!0))}function r2(a,r,c,p,g){return oM(jn(a,r,c,p,g,!0))}function _p(a){return a?a.__v_isVNode===!0:!1}function Of(a,r){return a.type===r.type&&a.key===r.key}const aM=({key:a})=>a??null,$_=({ref:a,ref_key:r,ref_for:c})=>(typeof a=="number"&&(a=""+a),a!=null?kr(a)||rs(a)||Qi(a)?{i:ps,r:a,k:r,f:!!c}:a:null);function cn(a,r=null,c=null,p=0,g=null,b=a===Hs?0:1,E=!1,i=!1){const R={__v_isVNode:!0,__v_skip:!0,type:a,props:r,key:r&&aM(r),ref:r&&$_(r),scopeId:OS,slotScopeIds:null,children:c,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:b,patchFlag:p,dynamicProps:g,dynamicChildren:null,appContext:null,ctx:ps};return i?(K0(R,c),b&128&&a.normalize(R)):c&&(R.shapeFlag|=kr(c)?8:16),mp>0&&!E&&qs&&(R.patchFlag>0||b&6)&&R.patchFlag!==32&&qs.push(R),R}const jn=tD;function tD(a,r=null,c=null,p=0,g=null,b=!1){if((!a||a===SP)&&(a=Wh),_p(a)){const i=Zh(a,r,!0);return c&&K0(i,c),mp>0&&!b&&qs&&(i.shapeFlag&6?qs[qs.indexOf(a)]=i:qs.push(i)),i.patchFlag=-2,i}if(dD(a)&&(a=a.__vccOpts),r){r=iD(r);let{class:i,style:R}=r;i&&!kr(i)&&(r.class=N0(i)),gr(R)&&(W0(R)&&!en(R)&&(R=ss({},R)),r.style=B0(R))}const E=kr(a)?1:sM(a)?128:uP(a)?64:gr(a)?4:Qi(a)?2:0;return cn(a,r,c,p,g,E,b,!0)}function iD(a){return a?W0(a)||WS(a)?ss({},a):a:null}function Zh(a,r,c=!1,p=!1){const{props:g,ref:b,patchFlag:E,children:i,transition:R}=a,V=r?nD(g||{},r):g,j={__v_isVNode:!0,__v_skip:!0,type:a.type,props:V,key:V&&aM(V),ref:r&&r.ref?c&&b?en(b)?b.concat($_(r)):[b,$_(r)]:$_(r):b,scopeId:a.scopeId,slotScopeIds:a.slotScopeIds,children:i,target:a.target,targetStart:a.targetStart,targetAnchor:a.targetAnchor,staticCount:a.staticCount,shapeFlag:a.shapeFlag,patchFlag:r&&a.type!==Hs?E===-1?16:E|16:E,dynamicProps:a.dynamicProps,dynamicChildren:a.dynamicChildren,appContext:a.appContext,dirs:a.dirs,transition:R,component:a.component,suspense:a.suspense,ssContent:a.ssContent&&Zh(a.ssContent),ssFallback:a.ssFallback&&Zh(a.ssFallback),el:a.el,anchor:a.anchor,ctx:a.ctx,ce:a.ce};return R&&p&&X0(j,R.clone(j)),j}function In(a=" ",r=0){return jn(Ig,null,a,r)}function ra(a){return a==null||typeof a=="boolean"?jn(Wh):en(a)?jn(Hs,null,a.slice()):_p(a)?Vl(a):jn(Ig,null,String(a))}function Vl(a){return a.el===null&&a.patchFlag!==-1||a.memo?a:Zh(a)}function K0(a,r){let c=0;const{shapeFlag:p}=a;if(r==null)r=null;else if(en(r))c=16;else if(typeof r=="object")if(p&65){const g=r.default;g&&(g._c&&(g._d=!1),K0(a,g()),g._c&&(g._d=!0));return}else{c=32;const g=r._;!g&&!WS(r)?r._ctx=ps:g===3&&ps&&(ps.slots._===1?r._=1:(r._=2,a.patchFlag|=1024))}else Qi(r)?(r={default:r,_ctx:ps},c=32):(r=String(r),p&64?(c=16,r=[In(r)]):c=8);a.children=r,a.shapeFlag|=c}function nD(...a){const r={};for(let c=0;c<a.length;c++){const p=a[c];for(const g in p)if(g==="class")r.class!==p.class&&(r.class=N0([r.class,p.class]));else if(g==="style")r.style=B0([r.style,p.style]);else if(yg(g)){const b=r[g],E=p[g];E&&b!==E&&!(en(b)&&b.includes(E))&&(r[g]=b?[].concat(b,E):E)}else g!==""&&(r[g]=p[g])}return r}function ea(a,r,c,p=null){aa(a,r,7,[c,p])}const rD=HS();let sD=0;function oD(a,r,c){const p=a.type,g=(r?r.appContext:a.appContext)||rD,b={uid:sD++,vnode:a,type:p,parent:r,appContext:g,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new uS(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(g.provides),ids:r?r.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:XS(p,g),emitsOptions:rM(p,g),emit:null,emitted:null,propsDefaults:Gn,inheritAttrs:p.inheritAttrs,ctx:Gn,data:Gn,props:Gn,attrs:Gn,slots:Gn,refs:Gn,setupState:Gn,setupContext:null,suspense:c,suspenseId:c?c.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return b.ctx={_:b},b.root=r?r.root:b,b.emit=ZP.bind(null,b),a.ce&&a.ce(b),b}let is=null,cg,f0;{const a=wg(),r=(c,p)=>{let g;return(g=a[c])||(g=a[c]=[]),g.push(p),b=>{g.length>1?g.forEach(E=>E(b)):g[0](b)}};cg=r("__VUE_INSTANCE_SETTERS__",c=>is=c),f0=r("__VUE_SSR_SETTERS__",c=>gp=c)}const Cp=a=>{const r=is;return cg(a),a.scope.on(),()=>{a.scope.off(),cg(r)}},s2=()=>{is&&is.scope.off(),cg(null)};function lM(a){return a.vnode.shapeFlag&4}let gp=!1;function aD(a,r=!1,c=!1){r&&f0(r);const{props:p,children:g}=a.vnode,b=lM(a);LP(a,p,b,r),BP(a,g,c);const E=b?lD(a,r):void 0;return r&&f0(!1),E}function lD(a,r){const c=a.type;a.accessCache=Object.create(null),a.proxy=new Proxy(a.ctx,EP);const{setup:p}=c;if(p){Kl();const g=a.setupContext=p.length>1?uD(a):null,b=Cp(a),E=Ip(p,a,0,[a.props,g]),i=aS(E);if(Jl(),b(),(i||a.sp)&&!Hh(a)&&FS(a),i){if(E.then(s2,s2),r)return E.then(R=>{o2(a,R)}).catch(R=>{Sg(R,a,0)});a.asyncDep=E}else o2(a,E)}else cM(a)}function o2(a,r,c){Qi(r)?a.type.__ssrInlineRender?a.ssrRender=r:a.render=r:gr(r)&&(a.setupState=PS(r)),cM(a)}function cM(a,r,c){const p=a.type;a.render||(a.render=p.render||sa);{const g=Cp(a);Kl();try{AP(a)}finally{Jl(),g()}}}const cD={get(a,r){return ts(a,"get",""),a[r]}};function uD(a){const r=c=>{a.exposed=c||{}};return{attrs:new Proxy(a.attrs,cD),slots:a.slots,emit:a.emit,expose:r}}function J0(a){return a.exposed?a.exposeProxy||(a.exposeProxy=new Proxy(PS(AS(a.exposed)),{get(r,c){if(c in r)return r[c];if(c in np)return np[c](a)},has(r,c){return c in r||c in np}})):a.proxy}function hD(a,r=!0){return Qi(a)?a.displayName||a.name:a.name||r&&a.__name}function dD(a){return Qi(a)&&"__vccOpts"in a}const Ao=(a,r)=>nP(a,r,gp);function uM(a,r,c){const p=arguments.length;return p===2?gr(r)&&!en(r)?_p(r)?jn(a,null,[r]):jn(a,r):jn(a,null,r):(p>3?c=Array.prototype.slice.call(arguments,2):p===3&&_p(c)&&(c=[c]),jn(a,r,c))}const fD="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let p0;const a2=typeof window<"u"&&window.trustedTypes;if(a2)try{p0=a2.createPolicy("vue",{createHTML:a=>a})}catch{}const hM=p0?a=>p0.createHTML(a):a=>a,pD="http://www.w3.org/2000/svg",mD="http://www.w3.org/1998/Math/MathML",Ba=typeof document<"u"?document:null,l2=Ba&&Ba.createElement("template"),_D={insert:(a,r,c)=>{r.insertBefore(a,c||null)},remove:a=>{const r=a.parentNode;r&&r.removeChild(a)},createElement:(a,r,c,p)=>{const g=r==="svg"?Ba.createElementNS(pD,a):r==="mathml"?Ba.createElementNS(mD,a):c?Ba.createElement(a,{is:c}):Ba.createElement(a);return a==="select"&&p&&p.multiple!=null&&g.setAttribute("multiple",p.multiple),g},createText:a=>Ba.createTextNode(a),createComment:a=>Ba.createComment(a),setText:(a,r)=>{a.nodeValue=r},setElementText:(a,r)=>{a.textContent=r},parentNode:a=>a.parentNode,nextSibling:a=>a.nextSibling,querySelector:a=>Ba.querySelector(a),setScopeId(a,r){a.setAttribute(r,"")},insertStaticContent(a,r,c,p,g,b){const E=c?c.previousSibling:r.lastChild;if(g&&(g===b||g.nextSibling))for(;r.insertBefore(g.cloneNode(!0),c),!(g===b||!(g=g.nextSibling)););else{l2.innerHTML=hM(p==="svg"?`<svg>${a}</svg>`:p==="mathml"?`<math>${a}</math>`:a);const i=l2.content;if(p==="svg"||p==="mathml"){const R=i.firstChild;for(;R.firstChild;)i.appendChild(R.firstChild);i.removeChild(R)}r.insertBefore(i,c)}return[E?E.nextSibling:r.firstChild,c?c.previousSibling:r.lastChild]}},gD=Symbol("_vtc");function yD(a,r,c){const p=a[gD];p&&(r=(r?[r,...p]:[...p]).join(" ")),r==null?a.removeAttribute("class"):c?a.setAttribute("class",r):a.className=r}const c2=Symbol("_vod"),xD=Symbol("_vsh"),vD=Symbol(""),bD=/(^|;)\s*display\s*:/;function wD(a,r,c){const p=a.style,g=kr(c);let b=!1;if(c&&!g){if(r)if(kr(r))for(const E of r.split(";")){const i=E.slice(0,E.indexOf(":")).trim();c[i]==null&&W_(p,i,"")}else for(const E in r)c[E]==null&&W_(p,E,"");for(const E in c)E==="display"&&(b=!0),W_(p,E,c[E])}else if(g){if(r!==c){const E=p[vD];E&&(c+=";"+E),p.cssText=c,b=bD.test(c)}}else r&&a.removeAttribute("style");c2 in a&&(a[c2]=b?p.display:"",a[xD]&&(p.display="none"))}const u2=/\s*!important$/;function W_(a,r,c){if(en(c))c.forEach(p=>W_(a,r,p));else if(c==null&&(c=""),r.startsWith("--"))a.setProperty(r,c);else{const p=TD(a,r);u2.test(c)?a.setProperty(lu(p),c.replace(u2,""),"important"):a[p]=c}}const h2=["Webkit","Moz","ms"],Vx={};function TD(a,r){const c=Vx[r];if(c)return c;let p=no(r);if(p!=="filter"&&p in a)return Vx[r]=p;p=bg(p);for(let g=0;g<h2.length;g++){const b=h2[g]+p;if(b in a)return Vx[r]=b}return r}const d2="http://www.w3.org/1999/xlink";function f2(a,r,c,p,g,b=zC(r)){p&&r.startsWith("xlink:")?c==null?a.removeAttributeNS(d2,r.slice(6,r.length)):a.setAttributeNS(d2,r,c):c==null||b&&!cS(c)?a.removeAttribute(r):a.setAttribute(r,b?"":au(c)?String(c):c)}function p2(a,r,c,p,g){if(r==="innerHTML"||r==="textContent"){c!=null&&(a[r]=r==="innerHTML"?hM(c):c);return}const b=a.tagName;if(r==="value"&&b!=="PROGRESS"&&!b.includes("-")){const i=b==="OPTION"?a.getAttribute("value")||"":a.value,R=c==null?a.type==="checkbox"?"on":"":String(c);(i!==R||!("_value"in a))&&(a.value=R),c==null&&a.removeAttribute(r),a._value=c;return}let E=!1;if(c===""||c==null){const i=typeof a[r];i==="boolean"?c=cS(c):c==null&&i==="string"?(c="",E=!0):i==="number"&&(c=0,E=!0)}try{a[r]=c}catch{}E&&a.removeAttribute(g||r)}function SD(a,r,c,p){a.addEventListener(r,c,p)}function MD(a,r,c,p){a.removeEventListener(r,c,p)}const m2=Symbol("_vei");function ED(a,r,c,p,g=null){const b=a[m2]||(a[m2]={}),E=b[r];if(p&&E)E.value=p;else{const[i,R]=AD(r);if(p){const V=b[r]=PD(p,g);SD(a,i,V,R)}else E&&(MD(a,i,E,R),b[r]=void 0)}}const _2=/(?:Once|Passive|Capture)$/;function AD(a){let r;if(_2.test(a)){r={};let p;for(;p=a.match(_2);)a=a.slice(0,a.length-p[0].length),r[p[0].toLowerCase()]=!0}return[a[2]===":"?a.slice(3):lu(a.slice(2)),r]}let Ux=0;const ID=Promise.resolve(),CD=()=>Ux||(ID.then(()=>Ux=0),Ux=Date.now());function PD(a,r){const c=p=>{if(!p._vts)p._vts=Date.now();else if(p._vts<=c.attached)return;aa(DD(p,c.value),r,5,[p])};return c.value=a,c.attached=CD(),c}function DD(a,r){if(en(r)){const c=a.stopImmediatePropagation;return a.stopImmediatePropagation=()=>{c.call(a),a._stopped=!0},r.map(p=>g=>!g._stopped&&p&&p(g))}else return r}const g2=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)>96&&a.charCodeAt(2)<123,zD=(a,r,c,p,g,b)=>{const E=g==="svg";r==="class"?yD(a,p,E):r==="style"?wD(a,c,p):yg(r)?k0(r)||ED(a,r,c,p,b):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):RD(a,r,p,E))?(p2(a,r,p),!a.tagName.includes("-")&&(r==="value"||r==="checked"||r==="selected")&&f2(a,r,p,E,b,r!=="value")):a._isVueCE&&(/[A-Z]/.test(r)||!kr(p))?p2(a,no(r),p,b,r):(r==="true-value"?a._trueValue=p:r==="false-value"&&(a._falseValue=p),f2(a,r,p,E))};function RD(a,r,c,p){if(p)return!!(r==="innerHTML"||r==="textContent"||r in a&&g2(r)&&Qi(c));if(r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&a.tagName==="INPUT"||r==="type"&&a.tagName==="TEXTAREA")return!1;if(r==="width"||r==="height"){const g=a.tagName;if(g==="IMG"||g==="VIDEO"||g==="CANVAS"||g==="SOURCE")return!1}return g2(r)&&kr(c)?!1:r in a}const LD=ss({patchProp:zD},_D);let y2;function kD(){return y2||(y2=VP(LD))}const OD=(...a)=>{const r=kD().createApp(...a),{mount:c}=r;return r.mount=p=>{const g=BD(p);if(!g)return;const b=r._component;!Qi(b)&&!b.render&&!b.template&&(b.template=g.innerHTML),g.nodeType===1&&(g.textContent="");const E=c(g,!1,FD(g));return g instanceof Element&&(g.removeAttribute("v-cloak"),g.setAttribute("data-v-app","")),E},r};function FD(a){if(a instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&a instanceof MathMLElement)return"mathml"}function BD(a){return kr(a)?document.querySelector(a):a}/*!
 * pinia v2.3.0
 * (c) 2024 Eduardo San Martin Morote
 * @license MIT
 */const ND=Symbol();var x2;(function(a){a.direct="direct",a.patchObject="patch object",a.patchFunction="patch function"})(x2||(x2={}));function VD(){const a=RC(!0),r=a.run(()=>IS({}));let c=[],p=[];const g=AS({install(b){g._a=b,b.provide(ND,g),b.config.globalProperties.$pinia=g,p.forEach(E=>c.push(E)),p=[]},use(b){return this._a?c.push(b):p.push(b),this},_p:c,_a:null,_e:a,_s:new Map,state:r});return g}function UD(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Z_={exports:{}},jD=Z_.exports,v2;function GD(){return v2||(v2=1,function(a,r){(function(c,p){a.exports=p()})(jD,function(){var c,p,g;function b(i,R){if(!c)c=R;else if(!p)p=R;else{var V="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+p+")(sharedChunk); self.onerror = null;",j={};c(j),g=R(j),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}b(["exports"],function(i){function R(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var V,j={},W={};function te(){if(V)return W;V=1,Object.defineProperty(W,"__esModule",{value:!0}),W.setMatrixArrayType=function(f){W.ARRAY_TYPE=e=f},W.toRadian=function(f){return f*l},W.equals=function(f,u){return Math.abs(f-u)<=o*Math.max(1,Math.abs(f),Math.abs(u))},W.RANDOM=W.ARRAY_TYPE=W.EPSILON=void 0;var o=1e-6;W.EPSILON=o;var e=typeof Float32Array<"u"?Float32Array:Array;W.ARRAY_TYPE=e;var n=Math.random;W.RANDOM=n;var l=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var f=0,u=arguments.length;u--;)f+=arguments[u]*arguments[u];return Math.sqrt(f)}),W}var ne,ge={};function xe(){if(ne)return ge;function o(u){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},o(u)}ne=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.create=function(){var u=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},ge.clone=function(u){var m=new e.ARRAY_TYPE(4);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m},ge.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u},ge.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u},ge.fromValues=function(u,m,v,S){var P=new e.ARRAY_TYPE(4);return P[0]=u,P[1]=m,P[2]=v,P[3]=S,P},ge.set=function(u,m,v,S,P){return u[0]=m,u[1]=v,u[2]=S,u[3]=P,u},ge.transpose=function(u,m){if(u===m){var v=m[1];u[1]=m[2],u[2]=v}else u[0]=m[0],u[1]=m[2],u[2]=m[1],u[3]=m[3];return u},ge.invert=function(u,m){var v=m[0],S=m[1],P=m[2],x=m[3],M=v*x-P*S;return M?(u[0]=x*(M=1/M),u[1]=-S*M,u[2]=-P*M,u[3]=v*M,u):null},ge.adjoint=function(u,m){var v=m[0];return u[0]=m[3],u[1]=-m[1],u[2]=-m[2],u[3]=v,u},ge.determinant=function(u){return u[0]*u[3]-u[2]*u[1]},ge.multiply=l,ge.rotate=function(u,m,v){var S=m[0],P=m[1],x=m[2],M=m[3],I=Math.sin(v),T=Math.cos(v);return u[0]=S*T+x*I,u[1]=P*T+M*I,u[2]=S*-I+x*T,u[3]=P*-I+M*T,u},ge.scale=function(u,m,v){var S=m[1],P=m[2],x=m[3],M=v[0],I=v[1];return u[0]=m[0]*M,u[1]=S*M,u[2]=P*I,u[3]=x*I,u},ge.fromRotation=function(u,m){var v=Math.sin(m),S=Math.cos(m);return u[0]=S,u[1]=v,u[2]=-v,u[3]=S,u},ge.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=m[1],u},ge.str=function(u){return"mat2("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+")"},ge.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3])},ge.LDU=function(u,m,v,S){return u[2]=S[2]/S[0],v[0]=S[0],v[1]=S[1],v[3]=S[3]-u[2]*v[1],[u,m,v]},ge.add=function(u,m,v){return u[0]=m[0]+v[0],u[1]=m[1]+v[1],u[2]=m[2]+v[2],u[3]=m[3]+v[3],u},ge.subtract=f,ge.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]},ge.equals=function(u,m){var v=u[0],S=u[1],P=u[2],x=u[3],M=m[0],I=m[1],T=m[2],A=m[3];return Math.abs(v-M)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(M))&&Math.abs(S-I)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(I))&&Math.abs(P-T)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(T))&&Math.abs(x-A)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(A))},ge.multiplyScalar=function(u,m,v){return u[0]=m[0]*v,u[1]=m[1]*v,u[2]=m[2]*v,u[3]=m[3]*v,u},ge.multiplyScalarAndAdd=function(u,m,v,S){return u[0]=m[0]+v[0]*S,u[1]=m[1]+v[1]*S,u[2]=m[2]+v[2]*S,u[3]=m[3]+v[3]*S,u},ge.sub=ge.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||o(u)!=="object"&&typeof u!="function")return{default:u};var v=n(void 0);if(v&&v.has(u))return v.get(u);var S={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in u)if(x!=="default"&&Object.prototype.hasOwnProperty.call(u,x)){var M=P?Object.getOwnPropertyDescriptor(u,x):null;M&&(M.get||M.set)?Object.defineProperty(S,x,M):S[x]=u[x]}return S.default=u,v&&v.set(u,S),S}(te());function n(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,v=new WeakMap;return(n=function(S){return S?v:m})(u)}function l(u,m,v){var S=m[0],P=m[1],x=m[2],M=m[3],I=v[0],T=v[1],A=v[2],D=v[3];return u[0]=S*I+x*T,u[1]=P*I+M*T,u[2]=S*A+x*D,u[3]=P*A+M*D,u}function f(u,m,v){return u[0]=m[0]-v[0],u[1]=m[1]-v[1],u[2]=m[2]-v[2],u[3]=m[3]-v[3],u}return ge.mul=l,ge.sub=f,ge}var Fe,Be={};function Ke(){if(Fe)return Be;function o(u){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},o(u)}Fe=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.create=function(){var u=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[4]=0,u[5]=0),u[0]=1,u[3]=1,u},Be.clone=function(u){var m=new e.ARRAY_TYPE(6);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m[4]=u[4],m[5]=u[5],m},Be.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u[4]=m[4],u[5]=m[5],u},Be.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=0,u[5]=0,u},Be.fromValues=function(u,m,v,S,P,x){var M=new e.ARRAY_TYPE(6);return M[0]=u,M[1]=m,M[2]=v,M[3]=S,M[4]=P,M[5]=x,M},Be.set=function(u,m,v,S,P,x,M){return u[0]=m,u[1]=v,u[2]=S,u[3]=P,u[4]=x,u[5]=M,u},Be.invert=function(u,m){var v=m[0],S=m[1],P=m[2],x=m[3],M=m[4],I=m[5],T=v*x-S*P;return T?(u[0]=x*(T=1/T),u[1]=-S*T,u[2]=-P*T,u[3]=v*T,u[4]=(P*I-x*M)*T,u[5]=(S*M-v*I)*T,u):null},Be.determinant=function(u){return u[0]*u[3]-u[1]*u[2]},Be.multiply=l,Be.rotate=function(u,m,v){var S=m[0],P=m[1],x=m[2],M=m[3],I=m[4],T=m[5],A=Math.sin(v),D=Math.cos(v);return u[0]=S*D+x*A,u[1]=P*D+M*A,u[2]=S*-A+x*D,u[3]=P*-A+M*D,u[4]=I,u[5]=T,u},Be.scale=function(u,m,v){var S=m[1],P=m[2],x=m[3],M=m[4],I=m[5],T=v[0],A=v[1];return u[0]=m[0]*T,u[1]=S*T,u[2]=P*A,u[3]=x*A,u[4]=M,u[5]=I,u},Be.translate=function(u,m,v){var S=m[0],P=m[1],x=m[2],M=m[3],I=m[4],T=m[5],A=v[0],D=v[1];return u[0]=S,u[1]=P,u[2]=x,u[3]=M,u[4]=S*A+x*D+I,u[5]=P*A+M*D+T,u},Be.fromRotation=function(u,m){var v=Math.sin(m),S=Math.cos(m);return u[0]=S,u[1]=v,u[2]=-v,u[3]=S,u[4]=0,u[5]=0,u},Be.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=m[1],u[4]=0,u[5]=0,u},Be.fromTranslation=function(u,m){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=m[0],u[5]=m[1],u},Be.str=function(u){return"mat2d("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+")"},Be.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],1)},Be.add=function(u,m,v){return u[0]=m[0]+v[0],u[1]=m[1]+v[1],u[2]=m[2]+v[2],u[3]=m[3]+v[3],u[4]=m[4]+v[4],u[5]=m[5]+v[5],u},Be.subtract=f,Be.multiplyScalar=function(u,m,v){return u[0]=m[0]*v,u[1]=m[1]*v,u[2]=m[2]*v,u[3]=m[3]*v,u[4]=m[4]*v,u[5]=m[5]*v,u},Be.multiplyScalarAndAdd=function(u,m,v,S){return u[0]=m[0]+v[0]*S,u[1]=m[1]+v[1]*S,u[2]=m[2]+v[2]*S,u[3]=m[3]+v[3]*S,u[4]=m[4]+v[4]*S,u[5]=m[5]+v[5]*S,u},Be.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]&&u[4]===m[4]&&u[5]===m[5]},Be.equals=function(u,m){var v=u[0],S=u[1],P=u[2],x=u[3],M=u[4],I=u[5],T=m[0],A=m[1],D=m[2],O=m[3],F=m[4],H=m[5];return Math.abs(v-T)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(T))&&Math.abs(S-A)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(A))&&Math.abs(P-D)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(D))&&Math.abs(x-O)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(O))&&Math.abs(M-F)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(F))&&Math.abs(I-H)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(H))},Be.sub=Be.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||o(u)!=="object"&&typeof u!="function")return{default:u};var v=n(void 0);if(v&&v.has(u))return v.get(u);var S={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in u)if(x!=="default"&&Object.prototype.hasOwnProperty.call(u,x)){var M=P?Object.getOwnPropertyDescriptor(u,x):null;M&&(M.get||M.set)?Object.defineProperty(S,x,M):S[x]=u[x]}return S.default=u,v&&v.set(u,S),S}(te());function n(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,v=new WeakMap;return(n=function(S){return S?v:m})(u)}function l(u,m,v){var S=m[0],P=m[1],x=m[2],M=m[3],I=m[4],T=m[5],A=v[0],D=v[1],O=v[2],F=v[3],H=v[4],q=v[5];return u[0]=S*A+x*D,u[1]=P*A+M*D,u[2]=S*O+x*F,u[3]=P*O+M*F,u[4]=S*H+x*q+I,u[5]=P*H+M*q+T,u}function f(u,m,v){return u[0]=m[0]-v[0],u[1]=m[1]-v[1],u[2]=m[2]-v[2],u[3]=m[3]-v[3],u[4]=m[4]-v[4],u[5]=m[5]-v[5],u}return Be.mul=l,Be.sub=f,Be}var at,Ye={};function ct(){if(at)return Ye;function o(u){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},o(u)}at=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.create=function(){var u=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u},Ye.fromMat4=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[4],u[4]=m[5],u[5]=m[6],u[6]=m[8],u[7]=m[9],u[8]=m[10],u},Ye.clone=function(u){var m=new e.ARRAY_TYPE(9);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m[4]=u[4],m[5]=u[5],m[6]=u[6],m[7]=u[7],m[8]=u[8],m},Ye.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u[4]=m[4],u[5]=m[5],u[6]=m[6],u[7]=m[7],u[8]=m[8],u},Ye.fromValues=function(u,m,v,S,P,x,M,I,T){var A=new e.ARRAY_TYPE(9);return A[0]=u,A[1]=m,A[2]=v,A[3]=S,A[4]=P,A[5]=x,A[6]=M,A[7]=I,A[8]=T,A},Ye.set=function(u,m,v,S,P,x,M,I,T,A){return u[0]=m,u[1]=v,u[2]=S,u[3]=P,u[4]=x,u[5]=M,u[6]=I,u[7]=T,u[8]=A,u},Ye.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Ye.transpose=function(u,m){if(u===m){var v=m[1],S=m[2],P=m[5];u[1]=m[3],u[2]=m[6],u[3]=v,u[5]=m[7],u[6]=S,u[7]=P}else u[0]=m[0],u[1]=m[3],u[2]=m[6],u[3]=m[1],u[4]=m[4],u[5]=m[7],u[6]=m[2],u[7]=m[5],u[8]=m[8];return u},Ye.invert=function(u,m){var v=m[0],S=m[1],P=m[2],x=m[3],M=m[4],I=m[5],T=m[6],A=m[7],D=m[8],O=D*M-I*A,F=-D*x+I*T,H=A*x-M*T,q=v*O+S*F+P*H;return q?(u[0]=O*(q=1/q),u[1]=(-D*S+P*A)*q,u[2]=(I*S-P*M)*q,u[3]=F*q,u[4]=(D*v-P*T)*q,u[5]=(-I*v+P*x)*q,u[6]=H*q,u[7]=(-A*v+S*T)*q,u[8]=(M*v-S*x)*q,u):null},Ye.adjoint=function(u,m){var v=m[0],S=m[1],P=m[2],x=m[3],M=m[4],I=m[5],T=m[6],A=m[7],D=m[8];return u[0]=M*D-I*A,u[1]=P*A-S*D,u[2]=S*I-P*M,u[3]=I*T-x*D,u[4]=v*D-P*T,u[5]=P*x-v*I,u[6]=x*A-M*T,u[7]=S*T-v*A,u[8]=v*M-S*x,u},Ye.determinant=function(u){var m=u[3],v=u[4],S=u[5],P=u[6],x=u[7],M=u[8];return u[0]*(M*v-S*x)+u[1]*(-M*m+S*P)+u[2]*(x*m-v*P)},Ye.multiply=l,Ye.translate=function(u,m,v){var S=m[0],P=m[1],x=m[2],M=m[3],I=m[4],T=m[5],A=m[6],D=m[7],O=m[8],F=v[0],H=v[1];return u[0]=S,u[1]=P,u[2]=x,u[3]=M,u[4]=I,u[5]=T,u[6]=F*S+H*M+A,u[7]=F*P+H*I+D,u[8]=F*x+H*T+O,u},Ye.rotate=function(u,m,v){var S=m[0],P=m[1],x=m[2],M=m[3],I=m[4],T=m[5],A=m[6],D=m[7],O=m[8],F=Math.sin(v),H=Math.cos(v);return u[0]=H*S+F*M,u[1]=H*P+F*I,u[2]=H*x+F*T,u[3]=H*M-F*S,u[4]=H*I-F*P,u[5]=H*T-F*x,u[6]=A,u[7]=D,u[8]=O,u},Ye.scale=function(u,m,v){var S=v[0],P=v[1];return u[0]=S*m[0],u[1]=S*m[1],u[2]=S*m[2],u[3]=P*m[3],u[4]=P*m[4],u[5]=P*m[5],u[6]=m[6],u[7]=m[7],u[8]=m[8],u},Ye.fromTranslation=function(u,m){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=m[0],u[7]=m[1],u[8]=1,u},Ye.fromRotation=function(u,m){var v=Math.sin(m),S=Math.cos(m);return u[0]=S,u[1]=v,u[2]=0,u[3]=-v,u[4]=S,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Ye.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=0,u[4]=m[1],u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Ye.fromMat2d=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=0,u[3]=m[2],u[4]=m[3],u[5]=0,u[6]=m[4],u[7]=m[5],u[8]=1,u},Ye.fromQuat=function(u,m){var v=m[0],S=m[1],P=m[2],x=m[3],M=v+v,I=S+S,T=P+P,A=v*M,D=S*M,O=S*I,F=P*M,H=P*I,q=P*T,U=x*M,$=x*I,Z=x*T;return u[0]=1-O-q,u[3]=D-Z,u[6]=F+$,u[1]=D+Z,u[4]=1-A-q,u[7]=H-U,u[2]=F-$,u[5]=H+U,u[8]=1-A-O,u},Ye.normalFromMat4=function(u,m){var v=m[0],S=m[1],P=m[2],x=m[3],M=m[4],I=m[5],T=m[6],A=m[7],D=m[8],O=m[9],F=m[10],H=m[11],q=m[12],U=m[13],$=m[14],Z=m[15],K=v*I-S*M,ae=v*T-P*M,oe=v*A-x*M,se=S*T-P*I,ye=S*A-x*I,ce=P*A-x*T,ve=D*U-O*q,Se=D*$-F*q,we=D*Z-H*q,Ce=O*$-F*U,ze=O*Z-H*U,Oe=F*Z-H*$,Pe=K*Oe-ae*ze+oe*Ce+se*we-ye*Se+ce*ve;return Pe?(u[0]=(I*Oe-T*ze+A*Ce)*(Pe=1/Pe),u[1]=(T*we-M*Oe-A*Se)*Pe,u[2]=(M*ze-I*we+A*ve)*Pe,u[3]=(P*ze-S*Oe-x*Ce)*Pe,u[4]=(v*Oe-P*we+x*Se)*Pe,u[5]=(S*we-v*ze-x*ve)*Pe,u[6]=(U*ce-$*ye+Z*se)*Pe,u[7]=($*oe-q*ce-Z*ae)*Pe,u[8]=(q*ye-U*oe+Z*K)*Pe,u):null},Ye.projection=function(u,m,v){return u[0]=2/m,u[1]=0,u[2]=0,u[3]=0,u[4]=-2/v,u[5]=0,u[6]=-1,u[7]=1,u[8]=1,u},Ye.str=function(u){return"mat3("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+", "+u[6]+", "+u[7]+", "+u[8]+")"},Ye.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8])},Ye.add=function(u,m,v){return u[0]=m[0]+v[0],u[1]=m[1]+v[1],u[2]=m[2]+v[2],u[3]=m[3]+v[3],u[4]=m[4]+v[4],u[5]=m[5]+v[5],u[6]=m[6]+v[6],u[7]=m[7]+v[7],u[8]=m[8]+v[8],u},Ye.subtract=f,Ye.multiplyScalar=function(u,m,v){return u[0]=m[0]*v,u[1]=m[1]*v,u[2]=m[2]*v,u[3]=m[3]*v,u[4]=m[4]*v,u[5]=m[5]*v,u[6]=m[6]*v,u[7]=m[7]*v,u[8]=m[8]*v,u},Ye.multiplyScalarAndAdd=function(u,m,v,S){return u[0]=m[0]+v[0]*S,u[1]=m[1]+v[1]*S,u[2]=m[2]+v[2]*S,u[3]=m[3]+v[3]*S,u[4]=m[4]+v[4]*S,u[5]=m[5]+v[5]*S,u[6]=m[6]+v[6]*S,u[7]=m[7]+v[7]*S,u[8]=m[8]+v[8]*S,u},Ye.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]&&u[4]===m[4]&&u[5]===m[5]&&u[6]===m[6]&&u[7]===m[7]&&u[8]===m[8]},Ye.equals=function(u,m){var v=u[0],S=u[1],P=u[2],x=u[3],M=u[4],I=u[5],T=u[6],A=u[7],D=u[8],O=m[0],F=m[1],H=m[2],q=m[3],U=m[4],$=m[5],Z=m[6],K=m[7],ae=m[8];return Math.abs(v-O)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(S-F)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(F))&&Math.abs(P-H)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(H))&&Math.abs(x-q)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(q))&&Math.abs(M-U)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(U))&&Math.abs(I-$)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs($))&&Math.abs(T-Z)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(Z))&&Math.abs(A-K)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(K))&&Math.abs(D-ae)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(ae))},Ye.sub=Ye.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||o(u)!=="object"&&typeof u!="function")return{default:u};var v=n(void 0);if(v&&v.has(u))return v.get(u);var S={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in u)if(x!=="default"&&Object.prototype.hasOwnProperty.call(u,x)){var M=P?Object.getOwnPropertyDescriptor(u,x):null;M&&(M.get||M.set)?Object.defineProperty(S,x,M):S[x]=u[x]}return S.default=u,v&&v.set(u,S),S}(te());function n(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,v=new WeakMap;return(n=function(S){return S?v:m})(u)}function l(u,m,v){var S=m[0],P=m[1],x=m[2],M=m[3],I=m[4],T=m[5],A=m[6],D=m[7],O=m[8],F=v[0],H=v[1],q=v[2],U=v[3],$=v[4],Z=v[5],K=v[6],ae=v[7],oe=v[8];return u[0]=F*S+H*M+q*A,u[1]=F*P+H*I+q*D,u[2]=F*x+H*T+q*O,u[3]=U*S+$*M+Z*A,u[4]=U*P+$*I+Z*D,u[5]=U*x+$*T+Z*O,u[6]=K*S+ae*M+oe*A,u[7]=K*P+ae*I+oe*D,u[8]=K*x+ae*T+oe*O,u}function f(u,m,v){return u[0]=m[0]-v[0],u[1]=m[1]-v[1],u[2]=m[2]-v[2],u[3]=m[3]-v[3],u[4]=m[4]-v[4],u[5]=m[5]-v[5],u[6]=m[6]-v[6],u[7]=m[7]-v[7],u[8]=m[8]-v[8],u}return Ye.mul=l,Ye.sub=f,Ye}var Lt,rt={};function Ut(){if(Lt)return rt;function o(x){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},o(x)}Lt=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.create=function(){var x=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},rt.clone=function(x){var M=new e.ARRAY_TYPE(16);return M[0]=x[0],M[1]=x[1],M[2]=x[2],M[3]=x[3],M[4]=x[4],M[5]=x[5],M[6]=x[6],M[7]=x[7],M[8]=x[8],M[9]=x[9],M[10]=x[10],M[11]=x[11],M[12]=x[12],M[13]=x[13],M[14]=x[14],M[15]=x[15],M},rt.copy=function(x,M){return x[0]=M[0],x[1]=M[1],x[2]=M[2],x[3]=M[3],x[4]=M[4],x[5]=M[5],x[6]=M[6],x[7]=M[7],x[8]=M[8],x[9]=M[9],x[10]=M[10],x[11]=M[11],x[12]=M[12],x[13]=M[13],x[14]=M[14],x[15]=M[15],x},rt.fromValues=function(x,M,I,T,A,D,O,F,H,q,U,$,Z,K,ae,oe){var se=new e.ARRAY_TYPE(16);return se[0]=x,se[1]=M,se[2]=I,se[3]=T,se[4]=A,se[5]=D,se[6]=O,se[7]=F,se[8]=H,se[9]=q,se[10]=U,se[11]=$,se[12]=Z,se[13]=K,se[14]=ae,se[15]=oe,se},rt.set=function(x,M,I,T,A,D,O,F,H,q,U,$,Z,K,ae,oe,se){return x[0]=M,x[1]=I,x[2]=T,x[3]=A,x[4]=D,x[5]=O,x[6]=F,x[7]=H,x[8]=q,x[9]=U,x[10]=$,x[11]=Z,x[12]=K,x[13]=ae,x[14]=oe,x[15]=se,x},rt.identity=l,rt.transpose=function(x,M){if(x===M){var I=M[1],T=M[2],A=M[3],D=M[6],O=M[7],F=M[11];x[1]=M[4],x[2]=M[8],x[3]=M[12],x[4]=I,x[6]=M[9],x[7]=M[13],x[8]=T,x[9]=D,x[11]=M[14],x[12]=A,x[13]=O,x[14]=F}else x[0]=M[0],x[1]=M[4],x[2]=M[8],x[3]=M[12],x[4]=M[1],x[5]=M[5],x[6]=M[9],x[7]=M[13],x[8]=M[2],x[9]=M[6],x[10]=M[10],x[11]=M[14],x[12]=M[3],x[13]=M[7],x[14]=M[11],x[15]=M[15];return x},rt.invert=function(x,M){var I=M[0],T=M[1],A=M[2],D=M[3],O=M[4],F=M[5],H=M[6],q=M[7],U=M[8],$=M[9],Z=M[10],K=M[11],ae=M[12],oe=M[13],se=M[14],ye=M[15],ce=I*F-T*O,ve=I*H-A*O,Se=I*q-D*O,we=T*H-A*F,Ce=T*q-D*F,ze=A*q-D*H,Oe=U*oe-$*ae,Pe=U*se-Z*ae,Xe=U*ye-K*ae,lt=$*se-Z*oe,Je=$*ye-K*oe,mt=Z*ye-K*se,pt=ce*mt-ve*Je+Se*lt+we*Xe-Ce*Pe+ze*Oe;return pt?(x[0]=(F*mt-H*Je+q*lt)*(pt=1/pt),x[1]=(A*Je-T*mt-D*lt)*pt,x[2]=(oe*ze-se*Ce+ye*we)*pt,x[3]=(Z*Ce-$*ze-K*we)*pt,x[4]=(H*Xe-O*mt-q*Pe)*pt,x[5]=(I*mt-A*Xe+D*Pe)*pt,x[6]=(se*Se-ae*ze-ye*ve)*pt,x[7]=(U*ze-Z*Se+K*ve)*pt,x[8]=(O*Je-F*Xe+q*Oe)*pt,x[9]=(T*Xe-I*Je-D*Oe)*pt,x[10]=(ae*Ce-oe*Se+ye*ce)*pt,x[11]=($*Se-U*Ce-K*ce)*pt,x[12]=(F*Pe-O*lt-H*Oe)*pt,x[13]=(I*lt-T*Pe+A*Oe)*pt,x[14]=(oe*ve-ae*we-se*ce)*pt,x[15]=(U*we-$*ve+Z*ce)*pt,x):null},rt.adjoint=function(x,M){var I=M[0],T=M[1],A=M[2],D=M[3],O=M[4],F=M[5],H=M[6],q=M[7],U=M[8],$=M[9],Z=M[10],K=M[11],ae=M[12],oe=M[13],se=M[14],ye=M[15];return x[0]=F*(Z*ye-K*se)-$*(H*ye-q*se)+oe*(H*K-q*Z),x[1]=-(T*(Z*ye-K*se)-$*(A*ye-D*se)+oe*(A*K-D*Z)),x[2]=T*(H*ye-q*se)-F*(A*ye-D*se)+oe*(A*q-D*H),x[3]=-(T*(H*K-q*Z)-F*(A*K-D*Z)+$*(A*q-D*H)),x[4]=-(O*(Z*ye-K*se)-U*(H*ye-q*se)+ae*(H*K-q*Z)),x[5]=I*(Z*ye-K*se)-U*(A*ye-D*se)+ae*(A*K-D*Z),x[6]=-(I*(H*ye-q*se)-O*(A*ye-D*se)+ae*(A*q-D*H)),x[7]=I*(H*K-q*Z)-O*(A*K-D*Z)+U*(A*q-D*H),x[8]=O*($*ye-K*oe)-U*(F*ye-q*oe)+ae*(F*K-q*$),x[9]=-(I*($*ye-K*oe)-U*(T*ye-D*oe)+ae*(T*K-D*$)),x[10]=I*(F*ye-q*oe)-O*(T*ye-D*oe)+ae*(T*q-D*F),x[11]=-(I*(F*K-q*$)-O*(T*K-D*$)+U*(T*q-D*F)),x[12]=-(O*($*se-Z*oe)-U*(F*se-H*oe)+ae*(F*Z-H*$)),x[13]=I*($*se-Z*oe)-U*(T*se-A*oe)+ae*(T*Z-A*$),x[14]=-(I*(F*se-H*oe)-O*(T*se-A*oe)+ae*(T*H-A*F)),x[15]=I*(F*Z-H*$)-O*(T*Z-A*$)+U*(T*H-A*F),x},rt.determinant=function(x){var M=x[0],I=x[1],T=x[2],A=x[3],D=x[4],O=x[5],F=x[6],H=x[7],q=x[8],U=x[9],$=x[10],Z=x[11],K=x[12],ae=x[13],oe=x[14],se=x[15];return(M*O-I*D)*($*se-Z*oe)-(M*F-T*D)*(U*se-Z*ae)+(M*H-A*D)*(U*oe-$*ae)+(I*F-T*O)*(q*se-Z*K)-(I*H-A*O)*(q*oe-$*K)+(T*H-A*F)*(q*ae-U*K)},rt.multiply=f,rt.translate=function(x,M,I){var T,A,D,O,F,H,q,U,$,Z,K,ae,oe=I[0],se=I[1],ye=I[2];return M===x?(x[12]=M[0]*oe+M[4]*se+M[8]*ye+M[12],x[13]=M[1]*oe+M[5]*se+M[9]*ye+M[13],x[14]=M[2]*oe+M[6]*se+M[10]*ye+M[14],x[15]=M[3]*oe+M[7]*se+M[11]*ye+M[15]):(A=M[1],D=M[2],O=M[3],F=M[4],H=M[5],q=M[6],U=M[7],$=M[8],Z=M[9],K=M[10],ae=M[11],x[0]=T=M[0],x[1]=A,x[2]=D,x[3]=O,x[4]=F,x[5]=H,x[6]=q,x[7]=U,x[8]=$,x[9]=Z,x[10]=K,x[11]=ae,x[12]=T*oe+F*se+$*ye+M[12],x[13]=A*oe+H*se+Z*ye+M[13],x[14]=D*oe+q*se+K*ye+M[14],x[15]=O*oe+U*se+ae*ye+M[15]),x},rt.scale=function(x,M,I){var T=I[0],A=I[1],D=I[2];return x[0]=M[0]*T,x[1]=M[1]*T,x[2]=M[2]*T,x[3]=M[3]*T,x[4]=M[4]*A,x[5]=M[5]*A,x[6]=M[6]*A,x[7]=M[7]*A,x[8]=M[8]*D,x[9]=M[9]*D,x[10]=M[10]*D,x[11]=M[11]*D,x[12]=M[12],x[13]=M[13],x[14]=M[14],x[15]=M[15],x},rt.rotate=function(x,M,I,T){var A,D,O,F,H,q,U,$,Z,K,ae,oe,se,ye,ce,ve,Se,we,Ce,ze,Oe,Pe,Xe,lt,Je=T[0],mt=T[1],pt=T[2],Tt=Math.hypot(Je,mt,pt);return Tt<e.EPSILON?null:(Je*=Tt=1/Tt,mt*=Tt,pt*=Tt,A=Math.sin(I),D=Math.cos(I),H=M[1],q=M[2],U=M[3],Z=M[5],K=M[6],ae=M[7],se=M[9],ye=M[10],ce=M[11],ve=Je*Je*(O=1-D)+D,Ce=Je*mt*O-pt*A,ze=mt*mt*O+D,Oe=pt*mt*O+Je*A,Pe=Je*pt*O+mt*A,Xe=mt*pt*O-Je*A,lt=pt*pt*O+D,x[0]=(F=M[0])*ve+($=M[4])*(Se=mt*Je*O+pt*A)+(oe=M[8])*(we=pt*Je*O-mt*A),x[1]=H*ve+Z*Se+se*we,x[2]=q*ve+K*Se+ye*we,x[3]=U*ve+ae*Se+ce*we,x[4]=F*Ce+$*ze+oe*Oe,x[5]=H*Ce+Z*ze+se*Oe,x[6]=q*Ce+K*ze+ye*Oe,x[7]=U*Ce+ae*ze+ce*Oe,x[8]=F*Pe+$*Xe+oe*lt,x[9]=H*Pe+Z*Xe+se*lt,x[10]=q*Pe+K*Xe+ye*lt,x[11]=U*Pe+ae*Xe+ce*lt,M!==x&&(x[12]=M[12],x[13]=M[13],x[14]=M[14],x[15]=M[15]),x)},rt.rotateX=function(x,M,I){var T=Math.sin(I),A=Math.cos(I),D=M[4],O=M[5],F=M[6],H=M[7],q=M[8],U=M[9],$=M[10],Z=M[11];return M!==x&&(x[0]=M[0],x[1]=M[1],x[2]=M[2],x[3]=M[3],x[12]=M[12],x[13]=M[13],x[14]=M[14],x[15]=M[15]),x[4]=D*A+q*T,x[5]=O*A+U*T,x[6]=F*A+$*T,x[7]=H*A+Z*T,x[8]=q*A-D*T,x[9]=U*A-O*T,x[10]=$*A-F*T,x[11]=Z*A-H*T,x},rt.rotateY=function(x,M,I){var T=Math.sin(I),A=Math.cos(I),D=M[0],O=M[1],F=M[2],H=M[3],q=M[8],U=M[9],$=M[10],Z=M[11];return M!==x&&(x[4]=M[4],x[5]=M[5],x[6]=M[6],x[7]=M[7],x[12]=M[12],x[13]=M[13],x[14]=M[14],x[15]=M[15]),x[0]=D*A-q*T,x[1]=O*A-U*T,x[2]=F*A-$*T,x[3]=H*A-Z*T,x[8]=D*T+q*A,x[9]=O*T+U*A,x[10]=F*T+$*A,x[11]=H*T+Z*A,x},rt.rotateZ=function(x,M,I){var T=Math.sin(I),A=Math.cos(I),D=M[0],O=M[1],F=M[2],H=M[3],q=M[4],U=M[5],$=M[6],Z=M[7];return M!==x&&(x[8]=M[8],x[9]=M[9],x[10]=M[10],x[11]=M[11],x[12]=M[12],x[13]=M[13],x[14]=M[14],x[15]=M[15]),x[0]=D*A+q*T,x[1]=O*A+U*T,x[2]=F*A+$*T,x[3]=H*A+Z*T,x[4]=q*A-D*T,x[5]=U*A-O*T,x[6]=$*A-F*T,x[7]=Z*A-H*T,x},rt.fromTranslation=function(x,M){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=M[0],x[13]=M[1],x[14]=M[2],x[15]=1,x},rt.fromScaling=function(x,M){return x[0]=M[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=M[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=M[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},rt.fromRotation=function(x,M,I){var T,A,D,O=I[0],F=I[1],H=I[2],q=Math.hypot(O,F,H);return q<e.EPSILON?null:(O*=q=1/q,F*=q,H*=q,T=Math.sin(M),A=Math.cos(M),x[0]=O*O*(D=1-A)+A,x[1]=F*O*D+H*T,x[2]=H*O*D-F*T,x[3]=0,x[4]=O*F*D-H*T,x[5]=F*F*D+A,x[6]=H*F*D+O*T,x[7]=0,x[8]=O*H*D+F*T,x[9]=F*H*D-O*T,x[10]=H*H*D+A,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},rt.fromXRotation=function(x,M){var I=Math.sin(M),T=Math.cos(M);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=T,x[6]=I,x[7]=0,x[8]=0,x[9]=-I,x[10]=T,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},rt.fromYRotation=function(x,M){var I=Math.sin(M),T=Math.cos(M);return x[0]=T,x[1]=0,x[2]=-I,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=I,x[9]=0,x[10]=T,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},rt.fromZRotation=function(x,M){var I=Math.sin(M),T=Math.cos(M);return x[0]=T,x[1]=I,x[2]=0,x[3]=0,x[4]=-I,x[5]=T,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},rt.fromRotationTranslation=u,rt.fromQuat2=function(x,M){var I=new e.ARRAY_TYPE(3),T=-M[0],A=-M[1],D=-M[2],O=M[3],F=M[4],H=M[5],q=M[6],U=M[7],$=T*T+A*A+D*D+O*O;return $>0?(I[0]=2*(F*O+U*T+H*D-q*A)/$,I[1]=2*(H*O+U*A+q*T-F*D)/$,I[2]=2*(q*O+U*D+F*A-H*T)/$):(I[0]=2*(F*O+U*T+H*D-q*A),I[1]=2*(H*O+U*A+q*T-F*D),I[2]=2*(q*O+U*D+F*A-H*T)),u(x,M,I),x},rt.getTranslation=function(x,M){return x[0]=M[12],x[1]=M[13],x[2]=M[14],x},rt.getScaling=m,rt.getRotation=function(x,M){var I=new e.ARRAY_TYPE(3);m(I,M);var T=1/I[0],A=1/I[1],D=1/I[2],O=M[0]*T,F=M[1]*A,H=M[2]*D,q=M[4]*T,U=M[5]*A,$=M[6]*D,Z=M[8]*T,K=M[9]*A,ae=M[10]*D,oe=O+U+ae,se=0;return oe>0?(se=2*Math.sqrt(oe+1),x[3]=.25*se,x[0]=($-K)/se,x[1]=(Z-H)/se,x[2]=(F-q)/se):O>U&&O>ae?(se=2*Math.sqrt(1+O-U-ae),x[3]=($-K)/se,x[0]=.25*se,x[1]=(F+q)/se,x[2]=(Z+H)/se):U>ae?(se=2*Math.sqrt(1+U-O-ae),x[3]=(Z-H)/se,x[0]=(F+q)/se,x[1]=.25*se,x[2]=($+K)/se):(se=2*Math.sqrt(1+ae-O-U),x[3]=(F-q)/se,x[0]=(Z+H)/se,x[1]=($+K)/se,x[2]=.25*se),x},rt.fromRotationTranslationScale=function(x,M,I,T){var A=M[0],D=M[1],O=M[2],F=M[3],H=A+A,q=D+D,U=O+O,$=A*H,Z=A*q,K=A*U,ae=D*q,oe=D*U,se=O*U,ye=F*H,ce=F*q,ve=F*U,Se=T[0],we=T[1],Ce=T[2];return x[0]=(1-(ae+se))*Se,x[1]=(Z+ve)*Se,x[2]=(K-ce)*Se,x[3]=0,x[4]=(Z-ve)*we,x[5]=(1-($+se))*we,x[6]=(oe+ye)*we,x[7]=0,x[8]=(K+ce)*Ce,x[9]=(oe-ye)*Ce,x[10]=(1-($+ae))*Ce,x[11]=0,x[12]=I[0],x[13]=I[1],x[14]=I[2],x[15]=1,x},rt.fromRotationTranslationScaleOrigin=function(x,M,I,T,A){var D=M[0],O=M[1],F=M[2],H=M[3],q=D+D,U=O+O,$=F+F,Z=D*q,K=D*U,ae=D*$,oe=O*U,se=O*$,ye=F*$,ce=H*q,ve=H*U,Se=H*$,we=T[0],Ce=T[1],ze=T[2],Oe=A[0],Pe=A[1],Xe=A[2],lt=(1-(oe+ye))*we,Je=(K+Se)*we,mt=(ae-ve)*we,pt=(K-Se)*Ce,Tt=(1-(Z+ye))*Ce,it=(se+ce)*Ce,Vt=(ae+ve)*ze,_t=(se-ce)*ze,Ft=(1-(Z+oe))*ze;return x[0]=lt,x[1]=Je,x[2]=mt,x[3]=0,x[4]=pt,x[5]=Tt,x[6]=it,x[7]=0,x[8]=Vt,x[9]=_t,x[10]=Ft,x[11]=0,x[12]=I[0]+Oe-(lt*Oe+pt*Pe+Vt*Xe),x[13]=I[1]+Pe-(Je*Oe+Tt*Pe+_t*Xe),x[14]=I[2]+Xe-(mt*Oe+it*Pe+Ft*Xe),x[15]=1,x},rt.fromQuat=function(x,M){var I=M[0],T=M[1],A=M[2],D=M[3],O=I+I,F=T+T,H=A+A,q=I*O,U=T*O,$=T*F,Z=A*O,K=A*F,ae=A*H,oe=D*O,se=D*F,ye=D*H;return x[0]=1-$-ae,x[1]=U+ye,x[2]=Z-se,x[3]=0,x[4]=U-ye,x[5]=1-q-ae,x[6]=K+oe,x[7]=0,x[8]=Z+se,x[9]=K-oe,x[10]=1-q-$,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},rt.frustum=function(x,M,I,T,A,D,O){var F=1/(I-M),H=1/(A-T),q=1/(D-O);return x[0]=2*D*F,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*D*H,x[6]=0,x[7]=0,x[8]=(I+M)*F,x[9]=(A+T)*H,x[10]=(O+D)*q,x[11]=-1,x[12]=0,x[13]=0,x[14]=O*D*2*q,x[15]=0,x},rt.perspectiveNO=v,rt.perspectiveZO=function(x,M,I,T,A){var D,O=1/Math.tan(M/2);return x[0]=O/I,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=O,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,A!=null&&A!==1/0?(x[10]=A*(D=1/(T-A)),x[14]=A*T*D):(x[10]=-1,x[14]=-T),x},rt.perspectiveFromFieldOfView=function(x,M,I,T){var A=Math.tan(M.upDegrees*Math.PI/180),D=Math.tan(M.downDegrees*Math.PI/180),O=Math.tan(M.leftDegrees*Math.PI/180),F=Math.tan(M.rightDegrees*Math.PI/180),H=2/(O+F),q=2/(A+D);return x[0]=H,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=q,x[6]=0,x[7]=0,x[8]=-(O-F)*H*.5,x[9]=(A-D)*q*.5,x[10]=T/(I-T),x[11]=-1,x[12]=0,x[13]=0,x[14]=T*I/(I-T),x[15]=0,x},rt.orthoNO=S,rt.orthoZO=function(x,M,I,T,A,D,O){var F=1/(M-I),H=1/(T-A),q=1/(D-O);return x[0]=-2*F,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*H,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=q,x[11]=0,x[12]=(M+I)*F,x[13]=(A+T)*H,x[14]=D*q,x[15]=1,x},rt.lookAt=function(x,M,I,T){var A,D,O,F,H,q,U,$,Z,K,ae=M[0],oe=M[1],se=M[2],ye=T[0],ce=T[1],ve=T[2],Se=I[0],we=I[1],Ce=I[2];return Math.abs(ae-Se)<e.EPSILON&&Math.abs(oe-we)<e.EPSILON&&Math.abs(se-Ce)<e.EPSILON?l(x):(U=ae-Se,$=oe-we,Z=se-Ce,A=ce*(Z*=K=1/Math.hypot(U,$,Z))-ve*($*=K),D=ve*(U*=K)-ye*Z,O=ye*$-ce*U,(K=Math.hypot(A,D,O))?(A*=K=1/K,D*=K,O*=K):(A=0,D=0,O=0),F=$*O-Z*D,H=Z*A-U*O,q=U*D-$*A,(K=Math.hypot(F,H,q))?(F*=K=1/K,H*=K,q*=K):(F=0,H=0,q=0),x[0]=A,x[1]=F,x[2]=U,x[3]=0,x[4]=D,x[5]=H,x[6]=$,x[7]=0,x[8]=O,x[9]=q,x[10]=Z,x[11]=0,x[12]=-(A*ae+D*oe+O*se),x[13]=-(F*ae+H*oe+q*se),x[14]=-(U*ae+$*oe+Z*se),x[15]=1,x)},rt.targetTo=function(x,M,I,T){var A=M[0],D=M[1],O=M[2],F=T[0],H=T[1],q=T[2],U=A-I[0],$=D-I[1],Z=O-I[2],K=U*U+$*$+Z*Z;K>0&&(U*=K=1/Math.sqrt(K),$*=K,Z*=K);var ae=H*Z-q*$,oe=q*U-F*Z,se=F*$-H*U;return(K=ae*ae+oe*oe+se*se)>0&&(ae*=K=1/Math.sqrt(K),oe*=K,se*=K),x[0]=ae,x[1]=oe,x[2]=se,x[3]=0,x[4]=$*se-Z*oe,x[5]=Z*ae-U*se,x[6]=U*oe-$*ae,x[7]=0,x[8]=U,x[9]=$,x[10]=Z,x[11]=0,x[12]=A,x[13]=D,x[14]=O,x[15]=1,x},rt.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},rt.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},rt.add=function(x,M,I){return x[0]=M[0]+I[0],x[1]=M[1]+I[1],x[2]=M[2]+I[2],x[3]=M[3]+I[3],x[4]=M[4]+I[4],x[5]=M[5]+I[5],x[6]=M[6]+I[6],x[7]=M[7]+I[7],x[8]=M[8]+I[8],x[9]=M[9]+I[9],x[10]=M[10]+I[10],x[11]=M[11]+I[11],x[12]=M[12]+I[12],x[13]=M[13]+I[13],x[14]=M[14]+I[14],x[15]=M[15]+I[15],x},rt.subtract=P,rt.multiplyScalar=function(x,M,I){return x[0]=M[0]*I,x[1]=M[1]*I,x[2]=M[2]*I,x[3]=M[3]*I,x[4]=M[4]*I,x[5]=M[5]*I,x[6]=M[6]*I,x[7]=M[7]*I,x[8]=M[8]*I,x[9]=M[9]*I,x[10]=M[10]*I,x[11]=M[11]*I,x[12]=M[12]*I,x[13]=M[13]*I,x[14]=M[14]*I,x[15]=M[15]*I,x},rt.multiplyScalarAndAdd=function(x,M,I,T){return x[0]=M[0]+I[0]*T,x[1]=M[1]+I[1]*T,x[2]=M[2]+I[2]*T,x[3]=M[3]+I[3]*T,x[4]=M[4]+I[4]*T,x[5]=M[5]+I[5]*T,x[6]=M[6]+I[6]*T,x[7]=M[7]+I[7]*T,x[8]=M[8]+I[8]*T,x[9]=M[9]+I[9]*T,x[10]=M[10]+I[10]*T,x[11]=M[11]+I[11]*T,x[12]=M[12]+I[12]*T,x[13]=M[13]+I[13]*T,x[14]=M[14]+I[14]*T,x[15]=M[15]+I[15]*T,x},rt.exactEquals=function(x,M){return x[0]===M[0]&&x[1]===M[1]&&x[2]===M[2]&&x[3]===M[3]&&x[4]===M[4]&&x[5]===M[5]&&x[6]===M[6]&&x[7]===M[7]&&x[8]===M[8]&&x[9]===M[9]&&x[10]===M[10]&&x[11]===M[11]&&x[12]===M[12]&&x[13]===M[13]&&x[14]===M[14]&&x[15]===M[15]},rt.equals=function(x,M){var I=x[0],T=x[1],A=x[2],D=x[3],O=x[4],F=x[5],H=x[6],q=x[7],U=x[8],$=x[9],Z=x[10],K=x[11],ae=x[12],oe=x[13],se=x[14],ye=x[15],ce=M[0],ve=M[1],Se=M[2],we=M[3],Ce=M[4],ze=M[5],Oe=M[6],Pe=M[7],Xe=M[8],lt=M[9],Je=M[10],mt=M[11],pt=M[12],Tt=M[13],it=M[14],Vt=M[15];return Math.abs(I-ce)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(ce))&&Math.abs(T-ve)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(ve))&&Math.abs(A-Se)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(Se))&&Math.abs(D-we)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(we))&&Math.abs(O-Ce)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(Ce))&&Math.abs(F-ze)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(ze))&&Math.abs(H-Oe)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Oe))&&Math.abs(q-Pe)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(Pe))&&Math.abs(U-Xe)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(Xe))&&Math.abs($-lt)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(lt))&&Math.abs(Z-Je)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Je))&&Math.abs(K-mt)<=e.EPSILON*Math.max(1,Math.abs(K),Math.abs(mt))&&Math.abs(ae-pt)<=e.EPSILON*Math.max(1,Math.abs(ae),Math.abs(pt))&&Math.abs(oe-Tt)<=e.EPSILON*Math.max(1,Math.abs(oe),Math.abs(Tt))&&Math.abs(se-it)<=e.EPSILON*Math.max(1,Math.abs(se),Math.abs(it))&&Math.abs(ye-Vt)<=e.EPSILON*Math.max(1,Math.abs(ye),Math.abs(Vt))},rt.sub=rt.mul=rt.ortho=rt.perspective=void 0;var e=function(x,M){if(x&&x.__esModule)return x;if(x===null||o(x)!=="object"&&typeof x!="function")return{default:x};var I=n(void 0);if(I&&I.has(x))return I.get(x);var T={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var D in x)if(D!=="default"&&Object.prototype.hasOwnProperty.call(x,D)){var O=A?Object.getOwnPropertyDescriptor(x,D):null;O&&(O.get||O.set)?Object.defineProperty(T,D,O):T[D]=x[D]}return T.default=x,I&&I.set(x,T),T}(te());function n(x){if(typeof WeakMap!="function")return null;var M=new WeakMap,I=new WeakMap;return(n=function(T){return T?I:M})(x)}function l(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function f(x,M,I){var T=M[0],A=M[1],D=M[2],O=M[3],F=M[4],H=M[5],q=M[6],U=M[7],$=M[8],Z=M[9],K=M[10],ae=M[11],oe=M[12],se=M[13],ye=M[14],ce=M[15],ve=I[0],Se=I[1],we=I[2],Ce=I[3];return x[0]=ve*T+Se*F+we*$+Ce*oe,x[1]=ve*A+Se*H+we*Z+Ce*se,x[2]=ve*D+Se*q+we*K+Ce*ye,x[3]=ve*O+Se*U+we*ae+Ce*ce,x[4]=(ve=I[4])*T+(Se=I[5])*F+(we=I[6])*$+(Ce=I[7])*oe,x[5]=ve*A+Se*H+we*Z+Ce*se,x[6]=ve*D+Se*q+we*K+Ce*ye,x[7]=ve*O+Se*U+we*ae+Ce*ce,x[8]=(ve=I[8])*T+(Se=I[9])*F+(we=I[10])*$+(Ce=I[11])*oe,x[9]=ve*A+Se*H+we*Z+Ce*se,x[10]=ve*D+Se*q+we*K+Ce*ye,x[11]=ve*O+Se*U+we*ae+Ce*ce,x[12]=(ve=I[12])*T+(Se=I[13])*F+(we=I[14])*$+(Ce=I[15])*oe,x[13]=ve*A+Se*H+we*Z+Ce*se,x[14]=ve*D+Se*q+we*K+Ce*ye,x[15]=ve*O+Se*U+we*ae+Ce*ce,x}function u(x,M,I){var T=M[0],A=M[1],D=M[2],O=M[3],F=T+T,H=A+A,q=D+D,U=T*F,$=T*H,Z=T*q,K=A*H,ae=A*q,oe=D*q,se=O*F,ye=O*H,ce=O*q;return x[0]=1-(K+oe),x[1]=$+ce,x[2]=Z-ye,x[3]=0,x[4]=$-ce,x[5]=1-(U+oe),x[6]=ae+se,x[7]=0,x[8]=Z+ye,x[9]=ae-se,x[10]=1-(U+K),x[11]=0,x[12]=I[0],x[13]=I[1],x[14]=I[2],x[15]=1,x}function m(x,M){var I=M[4],T=M[5],A=M[6],D=M[8],O=M[9],F=M[10];return x[0]=Math.hypot(M[0],M[1],M[2]),x[1]=Math.hypot(I,T,A),x[2]=Math.hypot(D,O,F),x}function v(x,M,I,T,A){var D,O=1/Math.tan(M/2);return x[0]=O/I,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=O,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,A!=null&&A!==1/0?(x[10]=(A+T)*(D=1/(T-A)),x[14]=2*A*T*D):(x[10]=-1,x[14]=-2*T),x}function S(x,M,I,T,A,D,O){var F=1/(M-I),H=1/(T-A),q=1/(D-O);return x[0]=-2*F,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*H,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*q,x[11]=0,x[12]=(M+I)*F,x[13]=(A+T)*H,x[14]=(O+D)*q,x[15]=1,x}function P(x,M,I){return x[0]=M[0]-I[0],x[1]=M[1]-I[1],x[2]=M[2]-I[2],x[3]=M[3]-I[3],x[4]=M[4]-I[4],x[5]=M[5]-I[5],x[6]=M[6]-I[6],x[7]=M[7]-I[7],x[8]=M[8]-I[8],x[9]=M[9]-I[9],x[10]=M[10]-I[10],x[11]=M[11]-I[11],x[12]=M[12]-I[12],x[13]=M[13]-I[13],x[14]=M[14]-I[14],x[15]=M[15]-I[15],x}return rt.perspective=v,rt.ortho=S,rt.mul=f,rt.sub=P,rt}var si,It={},Pt={};function Ii(){if(si)return Pt;function o(A){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},o(A)}si=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=l,Pt.clone=function(A){var D=new e.ARRAY_TYPE(3);return D[0]=A[0],D[1]=A[1],D[2]=A[2],D},Pt.length=f,Pt.fromValues=function(A,D,O){var F=new e.ARRAY_TYPE(3);return F[0]=A,F[1]=D,F[2]=O,F},Pt.copy=function(A,D){return A[0]=D[0],A[1]=D[1],A[2]=D[2],A},Pt.set=function(A,D,O,F){return A[0]=D,A[1]=O,A[2]=F,A},Pt.add=function(A,D,O){return A[0]=D[0]+O[0],A[1]=D[1]+O[1],A[2]=D[2]+O[2],A},Pt.subtract=u,Pt.multiply=m,Pt.divide=v,Pt.ceil=function(A,D){return A[0]=Math.ceil(D[0]),A[1]=Math.ceil(D[1]),A[2]=Math.ceil(D[2]),A},Pt.floor=function(A,D){return A[0]=Math.floor(D[0]),A[1]=Math.floor(D[1]),A[2]=Math.floor(D[2]),A},Pt.min=function(A,D,O){return A[0]=Math.min(D[0],O[0]),A[1]=Math.min(D[1],O[1]),A[2]=Math.min(D[2],O[2]),A},Pt.max=function(A,D,O){return A[0]=Math.max(D[0],O[0]),A[1]=Math.max(D[1],O[1]),A[2]=Math.max(D[2],O[2]),A},Pt.round=function(A,D){return A[0]=Math.round(D[0]),A[1]=Math.round(D[1]),A[2]=Math.round(D[2]),A},Pt.scale=function(A,D,O){return A[0]=D[0]*O,A[1]=D[1]*O,A[2]=D[2]*O,A},Pt.scaleAndAdd=function(A,D,O,F){return A[0]=D[0]+O[0]*F,A[1]=D[1]+O[1]*F,A[2]=D[2]+O[2]*F,A},Pt.distance=S,Pt.squaredDistance=P,Pt.squaredLength=x,Pt.negate=function(A,D){return A[0]=-D[0],A[1]=-D[1],A[2]=-D[2],A},Pt.inverse=function(A,D){return A[0]=1/D[0],A[1]=1/D[1],A[2]=1/D[2],A},Pt.normalize=function(A,D){var O=D[0],F=D[1],H=D[2],q=O*O+F*F+H*H;return q>0&&(q=1/Math.sqrt(q)),A[0]=D[0]*q,A[1]=D[1]*q,A[2]=D[2]*q,A},Pt.dot=M,Pt.cross=function(A,D,O){var F=D[0],H=D[1],q=D[2],U=O[0],$=O[1],Z=O[2];return A[0]=H*Z-q*$,A[1]=q*U-F*Z,A[2]=F*$-H*U,A},Pt.lerp=function(A,D,O,F){var H=D[0],q=D[1],U=D[2];return A[0]=H+F*(O[0]-H),A[1]=q+F*(O[1]-q),A[2]=U+F*(O[2]-U),A},Pt.hermite=function(A,D,O,F,H,q){var U=q*q,$=U*(2*q-3)+1,Z=U*(q-2)+q,K=U*(q-1),ae=U*(3-2*q);return A[0]=D[0]*$+O[0]*Z+F[0]*K+H[0]*ae,A[1]=D[1]*$+O[1]*Z+F[1]*K+H[1]*ae,A[2]=D[2]*$+O[2]*Z+F[2]*K+H[2]*ae,A},Pt.bezier=function(A,D,O,F,H,q){var U=1-q,$=U*U,Z=q*q,K=$*U,ae=3*q*$,oe=3*Z*U,se=Z*q;return A[0]=D[0]*K+O[0]*ae+F[0]*oe+H[0]*se,A[1]=D[1]*K+O[1]*ae+F[1]*oe+H[1]*se,A[2]=D[2]*K+O[2]*ae+F[2]*oe+H[2]*se,A},Pt.random=function(A,D){D=D||1;var O=2*e.RANDOM()*Math.PI,F=2*e.RANDOM()-1,H=Math.sqrt(1-F*F)*D;return A[0]=Math.cos(O)*H,A[1]=Math.sin(O)*H,A[2]=F*D,A},Pt.transformMat4=function(A,D,O){var F=D[0],H=D[1],q=D[2],U=O[3]*F+O[7]*H+O[11]*q+O[15];return A[0]=(O[0]*F+O[4]*H+O[8]*q+O[12])/(U=U||1),A[1]=(O[1]*F+O[5]*H+O[9]*q+O[13])/U,A[2]=(O[2]*F+O[6]*H+O[10]*q+O[14])/U,A},Pt.transformMat3=function(A,D,O){var F=D[0],H=D[1],q=D[2];return A[0]=F*O[0]+H*O[3]+q*O[6],A[1]=F*O[1]+H*O[4]+q*O[7],A[2]=F*O[2]+H*O[5]+q*O[8],A},Pt.transformQuat=function(A,D,O){var F=O[0],H=O[1],q=O[2],U=D[0],$=D[1],Z=D[2],K=H*Z-q*$,ae=q*U-F*Z,oe=F*$-H*U,se=H*oe-q*ae,ye=q*K-F*oe,ce=F*ae-H*K,ve=2*O[3];return ae*=ve,oe*=ve,ye*=2,ce*=2,A[0]=U+(K*=ve)+(se*=2),A[1]=$+ae+ye,A[2]=Z+oe+ce,A},Pt.rotateX=function(A,D,O,F){var H=[],q=[];return H[0]=D[0]-O[0],H[1]=D[1]-O[1],H[2]=D[2]-O[2],q[0]=H[0],q[1]=H[1]*Math.cos(F)-H[2]*Math.sin(F),q[2]=H[1]*Math.sin(F)+H[2]*Math.cos(F),A[0]=q[0]+O[0],A[1]=q[1]+O[1],A[2]=q[2]+O[2],A},Pt.rotateY=function(A,D,O,F){var H=[],q=[];return H[0]=D[0]-O[0],H[1]=D[1]-O[1],H[2]=D[2]-O[2],q[0]=H[2]*Math.sin(F)+H[0]*Math.cos(F),q[1]=H[1],q[2]=H[2]*Math.cos(F)-H[0]*Math.sin(F),A[0]=q[0]+O[0],A[1]=q[1]+O[1],A[2]=q[2]+O[2],A},Pt.rotateZ=function(A,D,O,F){var H=[],q=[];return H[0]=D[0]-O[0],H[1]=D[1]-O[1],H[2]=D[2]-O[2],q[0]=H[0]*Math.cos(F)-H[1]*Math.sin(F),q[1]=H[0]*Math.sin(F)+H[1]*Math.cos(F),q[2]=H[2],A[0]=q[0]+O[0],A[1]=q[1]+O[1],A[2]=q[2]+O[2],A},Pt.angle=function(A,D){var O=A[0],F=A[1],H=A[2],q=D[0],U=D[1],$=D[2],Z=Math.sqrt(O*O+F*F+H*H)*Math.sqrt(q*q+U*U+$*$),K=Z&&M(A,D)/Z;return Math.acos(Math.min(Math.max(K,-1),1))},Pt.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A},Pt.str=function(A){return"vec3("+A[0]+", "+A[1]+", "+A[2]+")"},Pt.exactEquals=function(A,D){return A[0]===D[0]&&A[1]===D[1]&&A[2]===D[2]},Pt.equals=function(A,D){var O=A[0],F=A[1],H=A[2],q=D[0],U=D[1],$=D[2];return Math.abs(O-q)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(q))&&Math.abs(F-U)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(U))&&Math.abs(H-$)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs($))},Pt.forEach=Pt.sqrLen=Pt.len=Pt.sqrDist=Pt.dist=Pt.div=Pt.mul=Pt.sub=void 0;var e=function(A,D){if(A&&A.__esModule)return A;if(A===null||o(A)!=="object"&&typeof A!="function")return{default:A};var O=n(void 0);if(O&&O.has(A))return O.get(A);var F={},H=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in A)if(q!=="default"&&Object.prototype.hasOwnProperty.call(A,q)){var U=H?Object.getOwnPropertyDescriptor(A,q):null;U&&(U.get||U.set)?Object.defineProperty(F,q,U):F[q]=A[q]}return F.default=A,O&&O.set(A,F),F}(te());function n(A){if(typeof WeakMap!="function")return null;var D=new WeakMap,O=new WeakMap;return(n=function(F){return F?O:D})(A)}function l(){var A=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A}function f(A){return Math.hypot(A[0],A[1],A[2])}function u(A,D,O){return A[0]=D[0]-O[0],A[1]=D[1]-O[1],A[2]=D[2]-O[2],A}function m(A,D,O){return A[0]=D[0]*O[0],A[1]=D[1]*O[1],A[2]=D[2]*O[2],A}function v(A,D,O){return A[0]=D[0]/O[0],A[1]=D[1]/O[1],A[2]=D[2]/O[2],A}function S(A,D){return Math.hypot(D[0]-A[0],D[1]-A[1],D[2]-A[2])}function P(A,D){var O=D[0]-A[0],F=D[1]-A[1],H=D[2]-A[2];return O*O+F*F+H*H}function x(A){var D=A[0],O=A[1],F=A[2];return D*D+O*O+F*F}function M(A,D){return A[0]*D[0]+A[1]*D[1]+A[2]*D[2]}Pt.sub=u,Pt.mul=m,Pt.div=v,Pt.dist=S,Pt.sqrDist=P,Pt.len=f,Pt.sqrLen=x;var I,T=(I=l(),function(A,D,O,F,H,q){var U,$;for(D||(D=3),O||(O=0),$=F?Math.min(F*D+O,A.length):A.length,U=O;U<$;U+=D)I[0]=A[U],I[1]=A[U+1],I[2]=A[U+2],H(I,I,q),A[U]=I[0],A[U+1]=I[1],A[U+2]=I[2];return A});return Pt.forEach=T,Pt}var tn,Fn,Gt={};function mi(){if(tn)return Gt;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},o(T)}tn=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=l,Gt.clone=function(T){var A=new e.ARRAY_TYPE(4);return A[0]=T[0],A[1]=T[1],A[2]=T[2],A[3]=T[3],A},Gt.fromValues=function(T,A,D,O){var F=new e.ARRAY_TYPE(4);return F[0]=T,F[1]=A,F[2]=D,F[3]=O,F},Gt.copy=function(T,A){return T[0]=A[0],T[1]=A[1],T[2]=A[2],T[3]=A[3],T},Gt.set=function(T,A,D,O,F){return T[0]=A,T[1]=D,T[2]=O,T[3]=F,T},Gt.add=function(T,A,D){return T[0]=A[0]+D[0],T[1]=A[1]+D[1],T[2]=A[2]+D[2],T[3]=A[3]+D[3],T},Gt.subtract=f,Gt.multiply=u,Gt.divide=m,Gt.ceil=function(T,A){return T[0]=Math.ceil(A[0]),T[1]=Math.ceil(A[1]),T[2]=Math.ceil(A[2]),T[3]=Math.ceil(A[3]),T},Gt.floor=function(T,A){return T[0]=Math.floor(A[0]),T[1]=Math.floor(A[1]),T[2]=Math.floor(A[2]),T[3]=Math.floor(A[3]),T},Gt.min=function(T,A,D){return T[0]=Math.min(A[0],D[0]),T[1]=Math.min(A[1],D[1]),T[2]=Math.min(A[2],D[2]),T[3]=Math.min(A[3],D[3]),T},Gt.max=function(T,A,D){return T[0]=Math.max(A[0],D[0]),T[1]=Math.max(A[1],D[1]),T[2]=Math.max(A[2],D[2]),T[3]=Math.max(A[3],D[3]),T},Gt.round=function(T,A){return T[0]=Math.round(A[0]),T[1]=Math.round(A[1]),T[2]=Math.round(A[2]),T[3]=Math.round(A[3]),T},Gt.scale=function(T,A,D){return T[0]=A[0]*D,T[1]=A[1]*D,T[2]=A[2]*D,T[3]=A[3]*D,T},Gt.scaleAndAdd=function(T,A,D,O){return T[0]=A[0]+D[0]*O,T[1]=A[1]+D[1]*O,T[2]=A[2]+D[2]*O,T[3]=A[3]+D[3]*O,T},Gt.distance=v,Gt.squaredDistance=S,Gt.length=P,Gt.squaredLength=x,Gt.negate=function(T,A){return T[0]=-A[0],T[1]=-A[1],T[2]=-A[2],T[3]=-A[3],T},Gt.inverse=function(T,A){return T[0]=1/A[0],T[1]=1/A[1],T[2]=1/A[2],T[3]=1/A[3],T},Gt.normalize=function(T,A){var D=A[0],O=A[1],F=A[2],H=A[3],q=D*D+O*O+F*F+H*H;return q>0&&(q=1/Math.sqrt(q)),T[0]=D*q,T[1]=O*q,T[2]=F*q,T[3]=H*q,T},Gt.dot=function(T,A){return T[0]*A[0]+T[1]*A[1]+T[2]*A[2]+T[3]*A[3]},Gt.cross=function(T,A,D,O){var F=D[0]*O[1]-D[1]*O[0],H=D[0]*O[2]-D[2]*O[0],q=D[0]*O[3]-D[3]*O[0],U=D[1]*O[2]-D[2]*O[1],$=D[1]*O[3]-D[3]*O[1],Z=D[2]*O[3]-D[3]*O[2],K=A[0],ae=A[1],oe=A[2],se=A[3];return T[0]=ae*Z-oe*$+se*U,T[1]=-K*Z+oe*q-se*H,T[2]=K*$-ae*q+se*F,T[3]=-K*U+ae*H-oe*F,T},Gt.lerp=function(T,A,D,O){var F=A[0],H=A[1],q=A[2],U=A[3];return T[0]=F+O*(D[0]-F),T[1]=H+O*(D[1]-H),T[2]=q+O*(D[2]-q),T[3]=U+O*(D[3]-U),T},Gt.random=function(T,A){var D,O,F,H,q,U;A=A||1;do q=(D=2*e.RANDOM()-1)*D+(O=2*e.RANDOM()-1)*O;while(q>=1);do U=(F=2*e.RANDOM()-1)*F+(H=2*e.RANDOM()-1)*H;while(U>=1);var $=Math.sqrt((1-q)/U);return T[0]=A*D,T[1]=A*O,T[2]=A*F*$,T[3]=A*H*$,T},Gt.transformMat4=function(T,A,D){var O=A[0],F=A[1],H=A[2],q=A[3];return T[0]=D[0]*O+D[4]*F+D[8]*H+D[12]*q,T[1]=D[1]*O+D[5]*F+D[9]*H+D[13]*q,T[2]=D[2]*O+D[6]*F+D[10]*H+D[14]*q,T[3]=D[3]*O+D[7]*F+D[11]*H+D[15]*q,T},Gt.transformQuat=function(T,A,D){var O=A[0],F=A[1],H=A[2],q=D[0],U=D[1],$=D[2],Z=D[3],K=Z*O+U*H-$*F,ae=Z*F+$*O-q*H,oe=Z*H+q*F-U*O,se=-q*O-U*F-$*H;return T[0]=K*Z+se*-q+ae*-$-oe*-U,T[1]=ae*Z+se*-U+oe*-q-K*-$,T[2]=oe*Z+se*-$+K*-U-ae*-q,T[3]=A[3],T},Gt.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=0,T},Gt.str=function(T){return"vec4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+")"},Gt.exactEquals=function(T,A){return T[0]===A[0]&&T[1]===A[1]&&T[2]===A[2]&&T[3]===A[3]},Gt.equals=function(T,A){var D=T[0],O=T[1],F=T[2],H=T[3],q=A[0],U=A[1],$=A[2],Z=A[3];return Math.abs(D-q)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(q))&&Math.abs(O-U)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(U))&&Math.abs(F-$)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs($))&&Math.abs(H-Z)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Z))},Gt.forEach=Gt.sqrLen=Gt.len=Gt.sqrDist=Gt.dist=Gt.div=Gt.mul=Gt.sub=void 0;var e=function(T,A){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var D=n(void 0);if(D&&D.has(T))return D.get(T);var O={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in T)if(H!=="default"&&Object.prototype.hasOwnProperty.call(T,H)){var q=F?Object.getOwnPropertyDescriptor(T,H):null;q&&(q.get||q.set)?Object.defineProperty(O,H,q):O[H]=T[H]}return O.default=T,D&&D.set(T,O),O}(te());function n(T){if(typeof WeakMap!="function")return null;var A=new WeakMap,D=new WeakMap;return(n=function(O){return O?D:A})(T)}function l(){var T=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0,T[3]=0),T}function f(T,A,D){return T[0]=A[0]-D[0],T[1]=A[1]-D[1],T[2]=A[2]-D[2],T[3]=A[3]-D[3],T}function u(T,A,D){return T[0]=A[0]*D[0],T[1]=A[1]*D[1],T[2]=A[2]*D[2],T[3]=A[3]*D[3],T}function m(T,A,D){return T[0]=A[0]/D[0],T[1]=A[1]/D[1],T[2]=A[2]/D[2],T[3]=A[3]/D[3],T}function v(T,A){return Math.hypot(A[0]-T[0],A[1]-T[1],A[2]-T[2],A[3]-T[3])}function S(T,A){var D=A[0]-T[0],O=A[1]-T[1],F=A[2]-T[2],H=A[3]-T[3];return D*D+O*O+F*F+H*H}function P(T){return Math.hypot(T[0],T[1],T[2],T[3])}function x(T){var A=T[0],D=T[1],O=T[2],F=T[3];return A*A+D*D+O*O+F*F}Gt.sub=f,Gt.mul=u,Gt.div=m,Gt.dist=v,Gt.sqrDist=S,Gt.len=P,Gt.sqrLen=x;var M,I=(M=l(),function(T,A,D,O,F,H){var q,U;for(A||(A=4),D||(D=0),U=O?Math.min(O*A+D,T.length):T.length,q=D;q<U;q+=A)M[0]=T[q],M[1]=T[q+1],M[2]=T[q+2],M[3]=T[q+3],F(M,M,H),T[q]=M[0],T[q+1]=M[1],T[q+2]=M[2],T[q+3]=M[3];return T});return Gt.forEach=I,Gt}function pi(){if(Fn)return It;function o(ce){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ve){return typeof ve}:function(ve){return ve&&typeof Symbol=="function"&&ve.constructor===Symbol&&ve!==Symbol.prototype?"symbol":typeof ve},o(ce)}Fn=1,Object.defineProperty(It,"__esModule",{value:!0}),It.create=v,It.identity=function(ce){return ce[0]=0,ce[1]=0,ce[2]=0,ce[3]=1,ce},It.setAxisAngle=S,It.getAxisAngle=function(ce,ve){var Se=2*Math.acos(ve[3]),we=Math.sin(Se/2);return we>e.EPSILON?(ce[0]=ve[0]/we,ce[1]=ve[1]/we,ce[2]=ve[2]/we):(ce[0]=1,ce[1]=0,ce[2]=0),Se},It.getAngle=function(ce,ve){var Se=D(ce,ve);return Math.acos(2*Se*Se-1)},It.multiply=P,It.rotateX=function(ce,ve,Se){Se*=.5;var we=ve[0],Ce=ve[1],ze=ve[2],Oe=ve[3],Pe=Math.sin(Se),Xe=Math.cos(Se);return ce[0]=we*Xe+Oe*Pe,ce[1]=Ce*Xe+ze*Pe,ce[2]=ze*Xe-Ce*Pe,ce[3]=Oe*Xe-we*Pe,ce},It.rotateY=function(ce,ve,Se){Se*=.5;var we=ve[0],Ce=ve[1],ze=ve[2],Oe=ve[3],Pe=Math.sin(Se),Xe=Math.cos(Se);return ce[0]=we*Xe-ze*Pe,ce[1]=Ce*Xe+Oe*Pe,ce[2]=ze*Xe+we*Pe,ce[3]=Oe*Xe-Ce*Pe,ce},It.rotateZ=function(ce,ve,Se){Se*=.5;var we=ve[0],Ce=ve[1],ze=ve[2],Oe=ve[3],Pe=Math.sin(Se),Xe=Math.cos(Se);return ce[0]=we*Xe+Ce*Pe,ce[1]=Ce*Xe-we*Pe,ce[2]=ze*Xe+Oe*Pe,ce[3]=Oe*Xe-ze*Pe,ce},It.calculateW=function(ce,ve){var Se=ve[0],we=ve[1],Ce=ve[2];return ce[0]=Se,ce[1]=we,ce[2]=Ce,ce[3]=Math.sqrt(Math.abs(1-Se*Se-we*we-Ce*Ce)),ce},It.exp=x,It.ln=M,It.pow=function(ce,ve,Se){return M(ce,ve),A(ce,ce,Se),x(ce,ce),ce},It.slerp=I,It.random=function(ce){var ve=e.RANDOM(),Se=e.RANDOM(),we=e.RANDOM(),Ce=Math.sqrt(1-ve),ze=Math.sqrt(ve);return ce[0]=Ce*Math.sin(2*Math.PI*Se),ce[1]=Ce*Math.cos(2*Math.PI*Se),ce[2]=ze*Math.sin(2*Math.PI*we),ce[3]=ze*Math.cos(2*Math.PI*we),ce},It.invert=function(ce,ve){var Se=ve[0],we=ve[1],Ce=ve[2],ze=ve[3],Oe=Se*Se+we*we+Ce*Ce+ze*ze,Pe=Oe?1/Oe:0;return ce[0]=-Se*Pe,ce[1]=-we*Pe,ce[2]=-Ce*Pe,ce[3]=ze*Pe,ce},It.conjugate=function(ce,ve){return ce[0]=-ve[0],ce[1]=-ve[1],ce[2]=-ve[2],ce[3]=ve[3],ce},It.fromMat3=T,It.fromEuler=function(ce,ve,Se,we){var Ce=.5*Math.PI/180;ve*=Ce,Se*=Ce,we*=Ce;var ze=Math.sin(ve),Oe=Math.cos(ve),Pe=Math.sin(Se),Xe=Math.cos(Se),lt=Math.sin(we),Je=Math.cos(we);return ce[0]=ze*Xe*Je-Oe*Pe*lt,ce[1]=Oe*Pe*Je+ze*Xe*lt,ce[2]=Oe*Xe*lt-ze*Pe*Je,ce[3]=Oe*Xe*Je+ze*Pe*lt,ce},It.str=function(ce){return"quat("+ce[0]+", "+ce[1]+", "+ce[2]+", "+ce[3]+")"},It.setAxes=It.sqlerp=It.rotationTo=It.equals=It.exactEquals=It.normalize=It.sqrLen=It.squaredLength=It.len=It.length=It.lerp=It.dot=It.scale=It.mul=It.add=It.set=It.copy=It.fromValues=It.clone=void 0;var e=m(te()),n=m(ct()),l=m(Ii()),f=m(mi());function u(ce){if(typeof WeakMap!="function")return null;var ve=new WeakMap,Se=new WeakMap;return(u=function(we){return we?Se:ve})(ce)}function m(ce,ve){if(ce&&ce.__esModule)return ce;if(ce===null||o(ce)!=="object"&&typeof ce!="function")return{default:ce};var Se=u(ve);if(Se&&Se.has(ce))return Se.get(ce);var we={},Ce=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ze in ce)if(ze!=="default"&&Object.prototype.hasOwnProperty.call(ce,ze)){var Oe=Ce?Object.getOwnPropertyDescriptor(ce,ze):null;Oe&&(Oe.get||Oe.set)?Object.defineProperty(we,ze,Oe):we[ze]=ce[ze]}return we.default=ce,Se&&Se.set(ce,we),we}function v(){var ce=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(ce[0]=0,ce[1]=0,ce[2]=0),ce[3]=1,ce}function S(ce,ve,Se){Se*=.5;var we=Math.sin(Se);return ce[0]=we*ve[0],ce[1]=we*ve[1],ce[2]=we*ve[2],ce[3]=Math.cos(Se),ce}function P(ce,ve,Se){var we=ve[0],Ce=ve[1],ze=ve[2],Oe=ve[3],Pe=Se[0],Xe=Se[1],lt=Se[2],Je=Se[3];return ce[0]=we*Je+Oe*Pe+Ce*lt-ze*Xe,ce[1]=Ce*Je+Oe*Xe+ze*Pe-we*lt,ce[2]=ze*Je+Oe*lt+we*Xe-Ce*Pe,ce[3]=Oe*Je-we*Pe-Ce*Xe-ze*lt,ce}function x(ce,ve){var Se=ve[0],we=ve[1],Ce=ve[2],ze=ve[3],Oe=Math.sqrt(Se*Se+we*we+Ce*Ce),Pe=Math.exp(ze),Xe=Oe>0?Pe*Math.sin(Oe)/Oe:0;return ce[0]=Se*Xe,ce[1]=we*Xe,ce[2]=Ce*Xe,ce[3]=Pe*Math.cos(Oe),ce}function M(ce,ve){var Se=ve[0],we=ve[1],Ce=ve[2],ze=ve[3],Oe=Math.sqrt(Se*Se+we*we+Ce*Ce),Pe=Oe>0?Math.atan2(Oe,ze)/Oe:0;return ce[0]=Se*Pe,ce[1]=we*Pe,ce[2]=Ce*Pe,ce[3]=.5*Math.log(Se*Se+we*we+Ce*Ce+ze*ze),ce}function I(ce,ve,Se,we){var Ce,ze,Oe,Pe,Xe,lt=ve[0],Je=ve[1],mt=ve[2],pt=ve[3],Tt=Se[0],it=Se[1],Vt=Se[2],_t=Se[3];return(ze=lt*Tt+Je*it+mt*Vt+pt*_t)<0&&(ze=-ze,Tt=-Tt,it=-it,Vt=-Vt,_t=-_t),1-ze>e.EPSILON?(Ce=Math.acos(ze),Oe=Math.sin(Ce),Pe=Math.sin((1-we)*Ce)/Oe,Xe=Math.sin(we*Ce)/Oe):(Pe=1-we,Xe=we),ce[0]=Pe*lt+Xe*Tt,ce[1]=Pe*Je+Xe*it,ce[2]=Pe*mt+Xe*Vt,ce[3]=Pe*pt+Xe*_t,ce}function T(ce,ve){var Se,we=ve[0]+ve[4]+ve[8];if(we>0)Se=Math.sqrt(we+1),ce[3]=.5*Se,ce[0]=(ve[5]-ve[7])*(Se=.5/Se),ce[1]=(ve[6]-ve[2])*Se,ce[2]=(ve[1]-ve[3])*Se;else{var Ce=0;ve[4]>ve[0]&&(Ce=1),ve[8]>ve[3*Ce+Ce]&&(Ce=2);var ze=(Ce+1)%3,Oe=(Ce+2)%3;Se=Math.sqrt(ve[3*Ce+Ce]-ve[3*ze+ze]-ve[3*Oe+Oe]+1),ce[Ce]=.5*Se,ce[3]=(ve[3*ze+Oe]-ve[3*Oe+ze])*(Se=.5/Se),ce[ze]=(ve[3*ze+Ce]+ve[3*Ce+ze])*Se,ce[Oe]=(ve[3*Oe+Ce]+ve[3*Ce+Oe])*Se}return ce}It.clone=f.clone,It.fromValues=f.fromValues,It.copy=f.copy,It.set=f.set,It.add=f.add,It.mul=P;var A=f.scale;It.scale=A;var D=f.dot;It.dot=D,It.lerp=f.lerp;var O=f.length;It.length=O,It.len=O;var F=f.squaredLength;It.squaredLength=F,It.sqrLen=F;var H=f.normalize;It.normalize=H,It.exactEquals=f.exactEquals,It.equals=f.equals;var q,U,$,Z=(q=l.create(),U=l.fromValues(1,0,0),$=l.fromValues(0,1,0),function(ce,ve,Se){var we=l.dot(ve,Se);return we<-.999999?(l.cross(q,U,ve),l.len(q)<1e-6&&l.cross(q,$,ve),l.normalize(q,q),S(ce,q,Math.PI),ce):we>.999999?(ce[0]=0,ce[1]=0,ce[2]=0,ce[3]=1,ce):(l.cross(q,ve,Se),ce[0]=q[0],ce[1]=q[1],ce[2]=q[2],ce[3]=1+we,H(ce,ce))});It.rotationTo=Z;var K,ae,oe=(K=v(),ae=v(),function(ce,ve,Se,we,Ce,ze){return I(K,ve,Ce,ze),I(ae,Se,we,ze),I(ce,K,ae,2*ze*(1-ze)),ce});It.sqlerp=oe;var se,ye=(se=n.create(),function(ce,ve,Se,we){return se[0]=Se[0],se[3]=Se[1],se[6]=Se[2],se[1]=we[0],se[4]=we[1],se[7]=we[2],se[2]=-ve[0],se[5]=-ve[1],se[8]=-ve[2],H(ce,T(ce,se))});return It.setAxes=ye,It}var Di,qt={};function Hn(){if(Di)return qt;function o(I){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},o(I)}Di=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.create=function(){var I=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0,I[4]=0,I[5]=0,I[6]=0,I[7]=0),I[3]=1,I},qt.clone=function(I){var T=new e.ARRAY_TYPE(8);return T[0]=I[0],T[1]=I[1],T[2]=I[2],T[3]=I[3],T[4]=I[4],T[5]=I[5],T[6]=I[6],T[7]=I[7],T},qt.fromValues=function(I,T,A,D,O,F,H,q){var U=new e.ARRAY_TYPE(8);return U[0]=I,U[1]=T,U[2]=A,U[3]=D,U[4]=O,U[5]=F,U[6]=H,U[7]=q,U},qt.fromRotationTranslationValues=function(I,T,A,D,O,F,H){var q=new e.ARRAY_TYPE(8);q[0]=I,q[1]=T,q[2]=A,q[3]=D;var U=.5*O,$=.5*F,Z=.5*H;return q[4]=U*D+$*A-Z*T,q[5]=$*D+Z*I-U*A,q[6]=Z*D+U*T-$*I,q[7]=-U*I-$*T-Z*A,q},qt.fromRotationTranslation=m,qt.fromTranslation=function(I,T){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=.5*T[0],I[5]=.5*T[1],I[6]=.5*T[2],I[7]=0,I},qt.fromRotation=function(I,T){return I[0]=T[0],I[1]=T[1],I[2]=T[2],I[3]=T[3],I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},qt.fromMat4=function(I,T){var A=n.create();l.getRotation(A,T);var D=new e.ARRAY_TYPE(3);return l.getTranslation(D,T),m(I,A,D),I},qt.copy=v,qt.identity=function(I){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},qt.set=function(I,T,A,D,O,F,H,q,U){return I[0]=T,I[1]=A,I[2]=D,I[3]=O,I[4]=F,I[5]=H,I[6]=q,I[7]=U,I},qt.getDual=function(I,T){return I[0]=T[4],I[1]=T[5],I[2]=T[6],I[3]=T[7],I},qt.setDual=function(I,T){return I[4]=T[0],I[5]=T[1],I[6]=T[2],I[7]=T[3],I},qt.getTranslation=function(I,T){var A=T[4],D=T[5],O=T[6],F=T[7],H=-T[0],q=-T[1],U=-T[2],$=T[3];return I[0]=2*(A*$+F*H+D*U-O*q),I[1]=2*(D*$+F*q+O*H-A*U),I[2]=2*(O*$+F*U+A*q-D*H),I},qt.translate=function(I,T,A){var D=T[0],O=T[1],F=T[2],H=T[3],q=.5*A[0],U=.5*A[1],$=.5*A[2],Z=T[4],K=T[5],ae=T[6],oe=T[7];return I[0]=D,I[1]=O,I[2]=F,I[3]=H,I[4]=H*q+O*$-F*U+Z,I[5]=H*U+F*q-D*$+K,I[6]=H*$+D*U-O*q+ae,I[7]=-D*q-O*U-F*$+oe,I},qt.rotateX=function(I,T,A){var D=-T[0],O=-T[1],F=-T[2],H=T[3],q=T[4],U=T[5],$=T[6],Z=T[7],K=q*H+Z*D+U*F-$*O,ae=U*H+Z*O+$*D-q*F,oe=$*H+Z*F+q*O-U*D,se=Z*H-q*D-U*O-$*F;return n.rotateX(I,T,A),I[4]=K*(H=I[3])+se*(D=I[0])+ae*(F=I[2])-oe*(O=I[1]),I[5]=ae*H+se*O+oe*D-K*F,I[6]=oe*H+se*F+K*O-ae*D,I[7]=se*H-K*D-ae*O-oe*F,I},qt.rotateY=function(I,T,A){var D=-T[0],O=-T[1],F=-T[2],H=T[3],q=T[4],U=T[5],$=T[6],Z=T[7],K=q*H+Z*D+U*F-$*O,ae=U*H+Z*O+$*D-q*F,oe=$*H+Z*F+q*O-U*D,se=Z*H-q*D-U*O-$*F;return n.rotateY(I,T,A),I[4]=K*(H=I[3])+se*(D=I[0])+ae*(F=I[2])-oe*(O=I[1]),I[5]=ae*H+se*O+oe*D-K*F,I[6]=oe*H+se*F+K*O-ae*D,I[7]=se*H-K*D-ae*O-oe*F,I},qt.rotateZ=function(I,T,A){var D=-T[0],O=-T[1],F=-T[2],H=T[3],q=T[4],U=T[5],$=T[6],Z=T[7],K=q*H+Z*D+U*F-$*O,ae=U*H+Z*O+$*D-q*F,oe=$*H+Z*F+q*O-U*D,se=Z*H-q*D-U*O-$*F;return n.rotateZ(I,T,A),I[4]=K*(H=I[3])+se*(D=I[0])+ae*(F=I[2])-oe*(O=I[1]),I[5]=ae*H+se*O+oe*D-K*F,I[6]=oe*H+se*F+K*O-ae*D,I[7]=se*H-K*D-ae*O-oe*F,I},qt.rotateByQuatAppend=function(I,T,A){var D=A[0],O=A[1],F=A[2],H=A[3],q=T[0],U=T[1],$=T[2],Z=T[3];return I[0]=q*H+Z*D+U*F-$*O,I[1]=U*H+Z*O+$*D-q*F,I[2]=$*H+Z*F+q*O-U*D,I[3]=Z*H-q*D-U*O-$*F,I[4]=(q=T[4])*H+(Z=T[7])*D+(U=T[5])*F-($=T[6])*O,I[5]=U*H+Z*O+$*D-q*F,I[6]=$*H+Z*F+q*O-U*D,I[7]=Z*H-q*D-U*O-$*F,I},qt.rotateByQuatPrepend=function(I,T,A){var D=T[0],O=T[1],F=T[2],H=T[3],q=A[0],U=A[1],$=A[2],Z=A[3];return I[0]=D*Z+H*q+O*$-F*U,I[1]=O*Z+H*U+F*q-D*$,I[2]=F*Z+H*$+D*U-O*q,I[3]=H*Z-D*q-O*U-F*$,I[4]=D*(Z=A[7])+H*(q=A[4])+O*($=A[6])-F*(U=A[5]),I[5]=O*Z+H*U+F*q-D*$,I[6]=F*Z+H*$+D*U-O*q,I[7]=H*Z-D*q-O*U-F*$,I},qt.rotateAroundAxis=function(I,T,A,D){if(Math.abs(D)<e.EPSILON)return v(I,T);var O=Math.hypot(A[0],A[1],A[2]);D*=.5;var F=Math.sin(D),H=F*A[0]/O,q=F*A[1]/O,U=F*A[2]/O,$=Math.cos(D),Z=T[0],K=T[1],ae=T[2],oe=T[3];I[0]=Z*$+oe*H+K*U-ae*q,I[1]=K*$+oe*q+ae*H-Z*U,I[2]=ae*$+oe*U+Z*q-K*H,I[3]=oe*$-Z*H-K*q-ae*U;var se=T[4],ye=T[5],ce=T[6],ve=T[7];return I[4]=se*$+ve*H+ye*U-ce*q,I[5]=ye*$+ve*q+ce*H-se*U,I[6]=ce*$+ve*U+se*q-ye*H,I[7]=ve*$-se*H-ye*q-ce*U,I},qt.add=function(I,T,A){return I[0]=T[0]+A[0],I[1]=T[1]+A[1],I[2]=T[2]+A[2],I[3]=T[3]+A[3],I[4]=T[4]+A[4],I[5]=T[5]+A[5],I[6]=T[6]+A[6],I[7]=T[7]+A[7],I},qt.multiply=S,qt.scale=function(I,T,A){return I[0]=T[0]*A,I[1]=T[1]*A,I[2]=T[2]*A,I[3]=T[3]*A,I[4]=T[4]*A,I[5]=T[5]*A,I[6]=T[6]*A,I[7]=T[7]*A,I},qt.lerp=function(I,T,A,D){var O=1-D;return P(T,A)<0&&(D=-D),I[0]=T[0]*O+A[0]*D,I[1]=T[1]*O+A[1]*D,I[2]=T[2]*O+A[2]*D,I[3]=T[3]*O+A[3]*D,I[4]=T[4]*O+A[4]*D,I[5]=T[5]*O+A[5]*D,I[6]=T[6]*O+A[6]*D,I[7]=T[7]*O+A[7]*D,I},qt.invert=function(I,T){var A=M(T);return I[0]=-T[0]/A,I[1]=-T[1]/A,I[2]=-T[2]/A,I[3]=T[3]/A,I[4]=-T[4]/A,I[5]=-T[5]/A,I[6]=-T[6]/A,I[7]=T[7]/A,I},qt.conjugate=function(I,T){return I[0]=-T[0],I[1]=-T[1],I[2]=-T[2],I[3]=T[3],I[4]=-T[4],I[5]=-T[5],I[6]=-T[6],I[7]=T[7],I},qt.normalize=function(I,T){var A=M(T);if(A>0){A=Math.sqrt(A);var D=T[0]/A,O=T[1]/A,F=T[2]/A,H=T[3]/A,q=T[4],U=T[5],$=T[6],Z=T[7],K=D*q+O*U+F*$+H*Z;I[0]=D,I[1]=O,I[2]=F,I[3]=H,I[4]=(q-D*K)/A,I[5]=(U-O*K)/A,I[6]=($-F*K)/A,I[7]=(Z-H*K)/A}return I},qt.str=function(I){return"quat2("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+")"},qt.exactEquals=function(I,T){return I[0]===T[0]&&I[1]===T[1]&&I[2]===T[2]&&I[3]===T[3]&&I[4]===T[4]&&I[5]===T[5]&&I[6]===T[6]&&I[7]===T[7]},qt.equals=function(I,T){var A=I[0],D=I[1],O=I[2],F=I[3],H=I[4],q=I[5],U=I[6],$=I[7],Z=T[0],K=T[1],ae=T[2],oe=T[3],se=T[4],ye=T[5],ce=T[6],ve=T[7];return Math.abs(A-Z)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(Z))&&Math.abs(D-K)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(K))&&Math.abs(O-ae)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(ae))&&Math.abs(F-oe)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(oe))&&Math.abs(H-se)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(se))&&Math.abs(q-ye)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(ye))&&Math.abs(U-ce)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(ce))&&Math.abs($-ve)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(ve))},qt.sqrLen=qt.squaredLength=qt.len=qt.length=qt.dot=qt.mul=qt.setReal=qt.getReal=void 0;var e=u(te()),n=u(pi()),l=u(Ut());function f(I){if(typeof WeakMap!="function")return null;var T=new WeakMap,A=new WeakMap;return(f=function(D){return D?A:T})(I)}function u(I,T){if(I&&I.__esModule)return I;if(I===null||o(I)!=="object"&&typeof I!="function")return{default:I};var A=f(T);if(A&&A.has(I))return A.get(I);var D={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in I)if(F!=="default"&&Object.prototype.hasOwnProperty.call(I,F)){var H=O?Object.getOwnPropertyDescriptor(I,F):null;H&&(H.get||H.set)?Object.defineProperty(D,F,H):D[F]=I[F]}return D.default=I,A&&A.set(I,D),D}function m(I,T,A){var D=.5*A[0],O=.5*A[1],F=.5*A[2],H=T[0],q=T[1],U=T[2],$=T[3];return I[0]=H,I[1]=q,I[2]=U,I[3]=$,I[4]=D*$+O*U-F*q,I[5]=O*$+F*H-D*U,I[6]=F*$+D*q-O*H,I[7]=-D*H-O*q-F*U,I}function v(I,T){return I[0]=T[0],I[1]=T[1],I[2]=T[2],I[3]=T[3],I[4]=T[4],I[5]=T[5],I[6]=T[6],I[7]=T[7],I}function S(I,T,A){var D=T[0],O=T[1],F=T[2],H=T[3],q=A[4],U=A[5],$=A[6],Z=A[7],K=T[4],ae=T[5],oe=T[6],se=T[7],ye=A[0],ce=A[1],ve=A[2],Se=A[3];return I[0]=D*Se+H*ye+O*ve-F*ce,I[1]=O*Se+H*ce+F*ye-D*ve,I[2]=F*Se+H*ve+D*ce-O*ye,I[3]=H*Se-D*ye-O*ce-F*ve,I[4]=D*Z+H*q+O*$-F*U+K*Se+se*ye+ae*ve-oe*ce,I[5]=O*Z+H*U+F*q-D*$+ae*Se+se*ce+oe*ye-K*ve,I[6]=F*Z+H*$+D*U-O*q+oe*Se+se*ve+K*ce-ae*ye,I[7]=H*Z-D*q-O*U-F*$+se*Se-K*ye-ae*ce-oe*ve,I}qt.getReal=n.copy,qt.setReal=n.copy,qt.mul=S;var P=n.dot;qt.dot=P;var x=n.length;qt.length=x,qt.len=x;var M=n.squaredLength;return qt.squaredLength=M,qt.sqrLen=M,qt}var ir,Sn,Qt={};function ar(){if(ir)return Qt;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},o(T)}ir=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.create=l,Qt.clone=function(T){var A=new e.ARRAY_TYPE(2);return A[0]=T[0],A[1]=T[1],A},Qt.fromValues=function(T,A){var D=new e.ARRAY_TYPE(2);return D[0]=T,D[1]=A,D},Qt.copy=function(T,A){return T[0]=A[0],T[1]=A[1],T},Qt.set=function(T,A,D){return T[0]=A,T[1]=D,T},Qt.add=function(T,A,D){return T[0]=A[0]+D[0],T[1]=A[1]+D[1],T},Qt.subtract=f,Qt.multiply=u,Qt.divide=m,Qt.ceil=function(T,A){return T[0]=Math.ceil(A[0]),T[1]=Math.ceil(A[1]),T},Qt.floor=function(T,A){return T[0]=Math.floor(A[0]),T[1]=Math.floor(A[1]),T},Qt.min=function(T,A,D){return T[0]=Math.min(A[0],D[0]),T[1]=Math.min(A[1],D[1]),T},Qt.max=function(T,A,D){return T[0]=Math.max(A[0],D[0]),T[1]=Math.max(A[1],D[1]),T},Qt.round=function(T,A){return T[0]=Math.round(A[0]),T[1]=Math.round(A[1]),T},Qt.scale=function(T,A,D){return T[0]=A[0]*D,T[1]=A[1]*D,T},Qt.scaleAndAdd=function(T,A,D,O){return T[0]=A[0]+D[0]*O,T[1]=A[1]+D[1]*O,T},Qt.distance=v,Qt.squaredDistance=S,Qt.length=P,Qt.squaredLength=x,Qt.negate=function(T,A){return T[0]=-A[0],T[1]=-A[1],T},Qt.inverse=function(T,A){return T[0]=1/A[0],T[1]=1/A[1],T},Qt.normalize=function(T,A){var D=A[0],O=A[1],F=D*D+O*O;return F>0&&(F=1/Math.sqrt(F)),T[0]=A[0]*F,T[1]=A[1]*F,T},Qt.dot=function(T,A){return T[0]*A[0]+T[1]*A[1]},Qt.cross=function(T,A,D){var O=A[0]*D[1]-A[1]*D[0];return T[0]=T[1]=0,T[2]=O,T},Qt.lerp=function(T,A,D,O){var F=A[0],H=A[1];return T[0]=F+O*(D[0]-F),T[1]=H+O*(D[1]-H),T},Qt.random=function(T,A){A=A||1;var D=2*e.RANDOM()*Math.PI;return T[0]=Math.cos(D)*A,T[1]=Math.sin(D)*A,T},Qt.transformMat2=function(T,A,D){var O=A[0],F=A[1];return T[0]=D[0]*O+D[2]*F,T[1]=D[1]*O+D[3]*F,T},Qt.transformMat2d=function(T,A,D){var O=A[0],F=A[1];return T[0]=D[0]*O+D[2]*F+D[4],T[1]=D[1]*O+D[3]*F+D[5],T},Qt.transformMat3=function(T,A,D){var O=A[0],F=A[1];return T[0]=D[0]*O+D[3]*F+D[6],T[1]=D[1]*O+D[4]*F+D[7],T},Qt.transformMat4=function(T,A,D){var O=A[0],F=A[1];return T[0]=D[0]*O+D[4]*F+D[12],T[1]=D[1]*O+D[5]*F+D[13],T},Qt.rotate=function(T,A,D,O){var F=A[0]-D[0],H=A[1]-D[1],q=Math.sin(O),U=Math.cos(O);return T[0]=F*U-H*q+D[0],T[1]=F*q+H*U+D[1],T},Qt.angle=function(T,A){var D=T[0],O=T[1],F=A[0],H=A[1],q=Math.sqrt(D*D+O*O)*Math.sqrt(F*F+H*H);return Math.acos(Math.min(Math.max(q&&(D*F+O*H)/q,-1),1))},Qt.zero=function(T){return T[0]=0,T[1]=0,T},Qt.str=function(T){return"vec2("+T[0]+", "+T[1]+")"},Qt.exactEquals=function(T,A){return T[0]===A[0]&&T[1]===A[1]},Qt.equals=function(T,A){var D=T[0],O=T[1],F=A[0],H=A[1];return Math.abs(D-F)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(F))&&Math.abs(O-H)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(H))},Qt.forEach=Qt.sqrLen=Qt.sqrDist=Qt.dist=Qt.div=Qt.mul=Qt.sub=Qt.len=void 0;var e=function(T,A){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var D=n(void 0);if(D&&D.has(T))return D.get(T);var O={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in T)if(H!=="default"&&Object.prototype.hasOwnProperty.call(T,H)){var q=F?Object.getOwnPropertyDescriptor(T,H):null;q&&(q.get||q.set)?Object.defineProperty(O,H,q):O[H]=T[H]}return O.default=T,D&&D.set(T,O),O}(te());function n(T){if(typeof WeakMap!="function")return null;var A=new WeakMap,D=new WeakMap;return(n=function(O){return O?D:A})(T)}function l(){var T=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0),T}function f(T,A,D){return T[0]=A[0]-D[0],T[1]=A[1]-D[1],T}function u(T,A,D){return T[0]=A[0]*D[0],T[1]=A[1]*D[1],T}function m(T,A,D){return T[0]=A[0]/D[0],T[1]=A[1]/D[1],T}function v(T,A){return Math.hypot(A[0]-T[0],A[1]-T[1])}function S(T,A){var D=A[0]-T[0],O=A[1]-T[1];return D*D+O*O}function P(T){return Math.hypot(T[0],T[1])}function x(T){var A=T[0],D=T[1];return A*A+D*D}Qt.len=P,Qt.sub=f,Qt.mul=u,Qt.div=m,Qt.dist=v,Qt.sqrDist=S,Qt.sqrLen=x;var M,I=(M=l(),function(T,A,D,O,F,H){var q,U;for(A||(A=2),D||(D=0),U=O?Math.min(O*A+D,T.length):T.length,q=D;q<U;q+=A)M[0]=T[q],M[1]=T[q+1],F(M,M,H),T[q]=M[0],T[q+1]=M[1];return T});return Qt.forEach=I,Qt}function Qn(){if(Sn)return j;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},o(T)}Sn=1,Object.defineProperty(j,"__esModule",{value:!0}),j.vec4=j.vec3=j.vec2=j.quat2=j.quat=j.mat4=j.mat3=j.mat2d=j.mat2=j.glMatrix=void 0;var e=I(te());j.glMatrix=e;var n=I(xe());j.mat2=n;var l=I(Ke());j.mat2d=l;var f=I(ct());j.mat3=f;var u=I(Ut());j.mat4=u;var m=I(pi());j.quat=m;var v=I(Hn());j.quat2=v;var S=I(ar());j.vec2=S;var P=I(Ii());j.vec3=P;var x=I(mi());function M(T){if(typeof WeakMap!="function")return null;var A=new WeakMap,D=new WeakMap;return(M=function(O){return O?D:A})(T)}function I(T,A){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var D=M(A);if(D&&D.has(T))return D.get(T);var O={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in T)if(H!=="default"&&Object.prototype.hasOwnProperty.call(T,H)){var q=F?Object.getOwnPropertyDescriptor(T,H):null;q&&(q.get||q.set)?Object.defineProperty(O,H,q):O[H]=T[H]}return O.default=T,D&&D.set(T,O),O}return j.vec4=x,j}var mn,Mt,ti,Xt,me=Qn(),nn=function(){if(Mt)return mn;function o(e,n,l,f){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=f}return Mt=1,mn=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,f=0;f<8;f++){var u=this.sampleCurveX(l)-e;if(Math.abs(u)<n)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=u/m}var v=0,S=1;for(l=e,f=0;f<20&&(u=this.sampleCurveX(l),!(Math.abs(u-e)<n));f++)e>u?v=l:S=l,l=.5*(S-v)+v;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},mn}(),ke=R(nn);function Ue(){if(Xt)return ti;function o(e,n){this.x=e,this.y=n}return Xt=1,ti=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,n){return this.clone()._rotateAround(e,n)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var n=e.x-this.x,l=e.y-this.y;return n*n+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,n){return Math.atan2(this.x*n-this.y*e,this.x*e+this.y*n)},_matMult:function(e){var n=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var n=Math.cos(e),l=Math.sin(e),f=l*this.x+n*this.y;return this.x=n*this.x-l*this.y,this.y=f,this},_rotateAround:function(e,n){var l=Math.cos(e),f=Math.sin(e),u=n.y+f*(this.x-n.x)+l*(this.y-n.y);return this.x=n.x+l*(this.x-n.x)-f*(this.y-n.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e},ti}var Ae=R(Ue());function bt(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let n=0;n<o.length;n++)if(!bt(o[n],e[n]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const n in o)if(!bt(o[n],e[n]))return!1;return!0}return o===e}const yt=Math.PI/180,St=180/Math.PI;function xt(o){return o*yt}function Nt(o){return o*St}const jt=[[0,0],[1,0],[1,1],[0,1]];function Bt(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,n=e*o;return 4*(o<.5?n:3*(o-e)+n-.75)}function vi(o,e,n,l){const f=new ke(o,e,n,l);return function(u){return f.solve(u)}}const Jt=vi(.25,.1,.25,1);function At(o,e,n){return Math.min(n,Math.max(e,o))}function Mi(o,e,n){return(n=At((n-o)/(e-o),0,1))*n*(3-2*n)}function Ui(o,e,n){const l=n-e,f=((o-e)%l+l)%l+e;return f===e?n:f}function un(o,e,n){if(!o.length)return n(null,[]);let l=o.length;const f=new Array(o.length);let u=null;o.forEach((m,v)=>{e(m,(S,P)=>{S&&(u=S),f[v]=P,--l==0&&n(u,f)})})}function Li(o,...e){for(const n of e)for(const l in n)o[l]=n[l];return o}let zn=1;function lr(){return zn++}function Pr(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function wr(o,e){o.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Or(o,e){return o.indexOf(e,o.length-e.length)!==-1}function Ws(o,e,n){const l={};for(const f in o)l[f]=e.call(this,o[f],f,o);return l}function cr(o,e,n){const l={};for(const f in o)e.call(this,o[f],f,o)&&(l[f]=o[f]);return l}function qn(o){return Array.isArray(o)?o.map(qn):typeof o=="object"&&o?Ws(o,qn):o}const Lo={};function Ti(o){Lo[o]||(typeof console<"u"&&console.warn(o),Lo[o]=!0)}function Zs(o,e,n){return(n.y-o.y)*(e.x-o.x)>(e.y-o.y)*(n.x-o.x)}function uu(o){let e=0;for(let n,l,f=0,u=o.length,m=u-1;f<u;m=f++)n=o[f],l=o[m],e+=(l.x-n.x)*(n.y+l.y);return e}function Fr([o,e,n]){const l=xt(e+90),f=xt(n);return{x:o*Math.cos(l)*Math.sin(f),y:o*Math.sin(l)*Math.sin(f),z:o*Math.cos(f),azimuthal:e,polar:n}}function la(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ec(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,l,f,u)=>{const m=f||u;return e[l]=!m||m.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let tc=null;function Xa(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function ic(o,e,n,l){for(;e<n;){const f=e+n>>1;o[f]<l?e=f+1:n=f}return e}function We(o,e,n,l){for(;e<n;){const f=e+n>>1;o[f]<=l?e=f+1:n=f}return e}function ee(o){return o>0?1/(1.001-o):1+o}function ie(o){return o>0?1-1/(1.001-o):-o}const he={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!he.API_URL)return null;try{const o=new URL(he.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Te(o){return he.API_URL_REGEX.test(o)}function Me(o){return he.API_SPRITE_REGEX.test(o)}let De,Ge,Le,qe,Ze,Qe;function ht(){return De==null&&(De=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),De}const Ct={now:()=>qe!==void 0?qe:performance.now(),setNow(o){qe=o},restoreNow(){qe=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:n,height:l}=o;Ze||(Ze=document.createElement("canvas"));const f=Ze.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(n>Ze.width||l>Ze.height)&&(Ze.width=n,Ze.height=l),f.clearRect(-e,-e,n+2*e,l+2*e),f.drawImage(o,0,0,n,l),f.getImageData(-e,-e,n+2*e,l+2*e)},resolveURL:o=>(Ge||(Ge=document.createElement("a")),Ge.href=o,Ge.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Le==null&&(Le=window.matchMedia("(prefers-reduced-motion: reduce)")),Le.matches)},hasCanvasFingerprintNoise(){if(Qe!==void 0)return Qe;if(!ht())return Qe=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let n=0;for(let f=0;f<o.width;++f)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(f,0,1,1);const l=e.getImageData(0,0,o.width,o.height);n=0;for(let f=0;f<l.data.length;++f)if(f%4!=3&&n++!==l.data[f])return Qe=!0,!0;return Qe=!1,!1}};function zt(o,e){const n=o.indexOf("?");if(n<0)return`${o}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(o.slice(n));for(const f in e)l.set(f,e[f]);return`${o.slice(0,n)}?${l.toString()}`}function ri(o,e={persistentParams:[]}){const n=o.indexOf("?");if(n<0)return o;const l=new URLSearchParams,f=new URLSearchParams(o.slice(n));for(const m of e.persistentParams){const v=f.get(m);v&&l.set(m,v)}const u=l.toString();return`${o.slice(0,n)}${u.length>0?`?${u}`:""}`}const di="mapbox-tiles";let ui=500,ci=50;const Zi=["language","worldview","jobid"];let ji,Si;function qi(){try{return caches}catch{}}function Xi(){const o=qi();o&&ji==null&&(ji=o.open(di))}let $n=1/0;const Dr={supported:!1,testSupport:function(o){!ca&&pr&&(Xs?hu(o):ur=o)}};let ur,pr,ca=!1,Xs=!1;const ed=typeof self<"u"?self:{};function hu(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,pr),o.isContextLost())return;Dr.supported=!0}catch{}o.deleteTexture(e),ca=!0}ed.document&&(pr=ed.document.createElement("img"),pr.onload=function(){ur&&hu(ur),ur=null,Xs=!0},pr.onerror=function(){ca=!0,ur=null},pr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ua={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ua);class du extends Error{constructor(e,n,l){n===401&&Te(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ya=la()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ro=function(o,e){if(!(/^file:/.test(n=o.url)||/^file:/.test(Ya())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,f){const u=new AbortController,m=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Ya(),referrerPolicy:l.referrerPolicy,signal:u.signal});let v=!1,S=!1;const P=(x=m.url).indexOf("sku=")>0&&Te(x);var x;l.type==="json"&&m.headers.set("Accept","application/json");const M=(T,A,D)=>{if(S)return;if(T&&T.message!=="SecurityError"&&Ti(T.toString()),A&&D)return I(A);const O=Date.now();fetch(m).then(F=>{if(F.ok){const H=P?F.clone():null;return I(F,H,O)}return f(new du(F.statusText,F.status,l.url))}).catch(F=>{F.name!=="AbortError"&&f(new Error(`${F.message} ${l.url}`))})},I=(T,A,D)=>{(l.type==="arrayBuffer"?T.arrayBuffer():l.type==="json"?T.json():T.text()).then(O=>{S||(A&&D&&function(F,H,q){if(Xi(),ji==null)return;const U=ec(H.headers.get("Cache-Control")||"");if(U["no-store"])return;const $={status:H.status,statusText:H.statusText,headers:new Headers};H.headers.forEach((ae,oe)=>$.headers.set(oe,ae)),U["max-age"]&&$.headers.set("Expires",new Date(q+1e3*U["max-age"]).toUTCString());const Z=$.headers.get("Expires");if(!Z||new Date(Z).getTime()-q<42e4)return;let K=ri(F.url,{persistentParams:Zi});if(H.status===206){const ae=F.headers.get("Range");if(!ae)return;$.status=200,K=zt(K,{range:ae})}(function(ae,oe){if(Si===void 0)try{new Response(new ReadableStream),Si=!0}catch{Si=!1}Si?oe(ae.body):ae.blob().then(oe)})(H,ae=>{const oe=new Response((se=H.status)!==200&&se!==404&&[101,103,204,205,304].includes(se)?null:ae,$);var se;Xi(),ji!=null&&ji.then(ye=>ye.put(K,oe)).catch(ye=>Ti(ye.message))})}(m,A,D),v=!0,f(null,O,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(O=>{S||f(new Error(O.message))})};return P?function(T,A){if(Xi(),ji==null)return A(null);ji.then(D=>{let O=ri(T.url,{persistentParams:Zi});const F=T.headers.get("Range");F&&(O=zt(O,{range:F})),D.match(O).then(H=>{const q=function(U){if(!U)return!1;const $=new Date(U.headers.get("Expires")||0),Z=ec(U.headers.get("Cache-Control")||"");return $>Date.now()&&!Z["no-cache"]}(H);D.delete(O),q&&D.put(O,H.clone()),A(null,H,q)}).catch(A)}).catch(A)}(m,M):M(null,null),{cancel:()=>{S=!0,v||u.abort()}}}(o,e);if(la()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var n;return function(l,f){const u=new XMLHttpRequest;u.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const m in l.headers)u.setRequestHeader(m,l.headers[m]);return l.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=l.credentials==="include",u.onerror=()=>{f(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let m=u.response;if(l.type==="json")try{m=JSON.parse(u.response)}catch(v){return f(v)}f(null,m,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else f(new du(u.statusText,u.status,l.url))},u.send(l.body),{cancel:()=>u.abort()}}(o,e)},ha=function(o,e){return ro(Li(o,{type:"arrayBuffer"}),e)};function td(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const Rp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let fu,nc;fu=[],nc=0;const pu=function(o,e){if(Dr.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),nc>=he.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return fu.push(u),u}nc++;let n=!1;const l=()=>{if(!n)for(n=!0,nc--;fu.length&&nc<he.MAX_PARALLEL_IMAGE_REQUESTS;){const u=fu.shift(),{requestParameters:m,callback:v,cancelled:S}=u;S||(u.cancel=pu(m,v).cancel)}},f=ha(o,(u,m,v,S)=>{l(),u?e(u):m&&(self.createImageBitmap?function(P,x){const M=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(M).then(I=>{x(null,I)}).catch(I=>{x(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(P,x)=>e(P,x,v,S)):function(P,x){const M=new Image;M.onload=()=>{x(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=Rp})},M.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(P)],{type:"image/png"});M.src=P.byteLength?URL.createObjectURL(I):Rp}(m,(P,x)=>e(P,x,v,S)))});return{cancel:()=>{f.cancel(),l()}}};var id,as,As,ms={exports:{}},Is={exports:{}},so={exports:{}},mu=function(){if(As)return ms.exports;As=1;var o=(id||(id=1,Is.exports=function(n,l){var f,u,m,v,S,P,x,M;for(u=n.length-(f=3&n.length),m=l,S=3432918353,P=461845907,M=0;M<u;)x=255&n.charCodeAt(M)|(255&n.charCodeAt(++M))<<8|(255&n.charCodeAt(++M))<<16|(255&n.charCodeAt(++M))<<24,++M,m=27492+(65535&(v=5*(65535&(m=(m^=x=(65535&(x=(x=(65535&x)*S+(((x>>>16)*S&65535)<<16)&4294967295)<<15|x>>>17))*P+(((x>>>16)*P&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(x=0,f){case 3:x^=(255&n.charCodeAt(M+2))<<16;case 2:x^=(255&n.charCodeAt(M+1))<<8;case 1:m^=x=(65535&(x=(x=(65535&(x^=255&n.charCodeAt(M)))*S+(((x>>>16)*S&65535)<<16)&4294967295)<<15|x>>>17))*P+(((x>>>16)*P&65535)<<16)&4294967295}return m^=n.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Is.exports),e=(as||(as=1,so.exports=function(n,l){for(var f,u=n.length,m=l^u,v=0;u>=4;)f=1540483477*(65535&(f=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(f>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),u-=4,++v;switch(u){case 3:m^=(255&n.charCodeAt(v+2))<<16;case 2:m^=(255&n.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&n.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),so.exports);return ms.exports=o,ms.exports.murmur3=o,ms.exports.murmur2=e,ms.exports}(),rc=R(mu);class ko{constructor(e,...n){Li(this,n[0]||{}),this.type=e}}class Oo extends ko{constructor(e,n={}){super("error",Li({error:e},n))}}function _u(o,e,n){n[o]&&n[o].indexOf(e)!==-1||(n[o]=n[o]||[],n[o].push(e))}function nd(o,e,n){if(n&&n[o]){const l=n[o].indexOf(e);l!==-1&&n[o].splice(l,1)}}class Ka{on(e,n){return this._listeners=this._listeners||{},_u(e,n,this._listeners),this}off(e,n){return nd(e,n,this._listeners),nd(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},_u(e,n,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,n){const l=typeof e=="string"?new ko(e,n):e,f=l.type;if(this.listens(f)){l.target=this;const u=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const S of u)S.call(this,l);const m=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const S of m)nd(f,S,this._oneTimeListeners),S.call(this,l);const v=this._eventedParent;v&&(Li(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(l))}else l instanceof Oo&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var _s,gu={},yu=function(){if(_s)return gu;_s=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(u){return(u=Math.round(u))<0?0:u>255?255:u}function n(u){return e(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function l(u){return(m=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:m>1?1:m;var m}function f(u,m,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?u+(m-u)*v*6:2*v<1?m:3*v<2?u+(m-u)*(2/3-v)*6:u}try{gu.parseCSSColor=function(u){var m,v=u.replace(/ /g,"").toLowerCase();if(v in o)return o[v].slice();if(v[0]==="#")return v.length===4?(m=parseInt(v.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:v.length===7&&(m=parseInt(v.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var S=v.indexOf("("),P=v.indexOf(")");if(S!==-1&&P+1===v.length){var x=v.substr(0,S),M=v.substr(S+1,P-(S+1)).split(","),I=1;switch(x){case"rgba":if(M.length!==4)return null;I=l(M.pop());case"rgb":return M.length!==3?null:[n(M[0]),n(M[1]),n(M[2]),I];case"hsla":if(M.length!==4)return null;I=l(M.pop());case"hsl":if(M.length!==3)return null;var T=(parseFloat(M[0])%360+360)%360/360,A=l(M[1]),D=l(M[2]),O=D<=.5?D*(A+1):D+A-D*A,F=2*D-O;return[e(255*f(F,O,T+1/3)),e(255*f(F,O,T)),e(255*f(F,O,T-1/3)),I];default:return null}}return null}}catch{}return gu}();class Fi{constructor(e,n,l,f=1){this.r=e,this.g=n,this.b=l,this.a=f}static parse(e){if(!e)return;if(e instanceof Fi)return e;if(typeof e!="string")return;const n=yu.parseCSSColor(e);return n?new Fi(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toStringPremultipliedAlpha(){const[e,n,l,f]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(l)},${f})`}toString(){const[e,n,l,f]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*l)},${f})`}toRenderColor(e){const{r:n,g:l,b:f,a:u}=this;return new kg(e,n,l,f,u)}clone(){return new Fi(this.r,this.g,this.b,this.a)}}class kg{constructor(e,n,l,f,u){if(e){const m=e.image.height,v=m*m;n=u===0?0:n/u*(m-1),l=u===0?0:l/u*(m-1),f=u===0?0:f/u*(m-1);const S=Math.floor(n),P=Math.floor(l),x=Math.floor(f),M=Math.ceil(n),I=Math.ceil(l),T=Math.ceil(f),A=n-S,D=l-P,O=f-x,F=e.image.data,H=4*(S+P*v+x*m),q=4*(S+P*v+T*m),U=4*(S+I*v+x*m),$=4*(S+I*v+T*m),Z=4*(M+P*v+x*m),K=4*(M+P*v+T*m),ae=4*(M+I*v+x*m),oe=4*(M+I*v+T*m);if(H<0||oe>=F.length)throw new Error("out of range");this.r=ii(ii(ii(F[H],F[q],O),ii(F[U],F[$],O),D),ii(ii(F[Z],F[K],O),ii(F[ae],F[oe],O),D),A)/255*u,this.g=ii(ii(ii(F[H+1],F[q+1],O),ii(F[U+1],F[$+1],O),D),ii(ii(F[Z+1],F[K+1],O),ii(F[ae+1],F[oe+1],O),D),A)/255*u,this.b=ii(ii(ii(F[H+2],F[q+2],O),ii(F[U+2],F[$+2],O),D),ii(ii(F[Z+2],F[K+2],O),ii(F[ae+2],F[oe+2],O),D),A)/255*u,this.a=u}else this.r=n,this.g=l,this.b=f,this.a=u}toArray(){const{r:e,g:n,b:l,a:f}=this;return f===0?[0,0,0,0]:[255*e/f,255*n/f,255*l/f,f]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:n,b:l,a:f}=this,u=Math.min(Math.max(e/f,0),1),m=Math.min(Math.max(n/f,0),1),v=Math.min(Math.max(l/f,0),1),S=Math.min(u,m,v),P=Math.max(u,m,v),x=(S+P)/2;if(S===P)return[0,0,100*x,f];const M=P-S,I=x>.5?M/(2-P-S):M/(P+S);let T=0;return P===u?T=(m-v)/M+(m<v?6:0):P===m?T=(v-u)/M+2:P===v&&(T=(u-m)/M+4),T*=60,[Math.min(Math.max(T,0),360),Math.min(Math.max(100*I,0),100),Math.min(Math.max(100*x,0),100),f]}toArray01(){const{r:e,g:n,b:l,a:f}=this;return f===0?[0,0,0,0]:[e/f,n/f,l/f,f]}toArray01Scaled(e){const{r:n,g:l,b:f,a:u}=this;return u===0?[0,0,0]:[n/u*e,l/u*e,f/u*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:l,a:f}=this;return[e,n,l,f]}toArray01Linear(){const{r:e,g:n,b:l,a:f}=this;return f===0?[0,0,0,0]:[Math.pow(e/f,2.2),Math.pow(n/f,2.2),Math.pow(l/f,2.2),f]}}function ii(o,e,n){return o*(1-n)+e*n}function rd(o,e,n){return o.map((l,f)=>ii(l,e[f],n))}Fi.black=new Fi(0,0,0,1),Fi.white=new Fi(1,1,1,1),Fi.transparent=new Fi(0,0,0,0),Fi.red=new Fi(1,0,0,1),Fi.blue=new Fi(0,0,1,1);var ki=Object.freeze({__proto__:null,array:rd,color:function(o,e,n){return new Fi(ii(o.r,e.r,n),ii(o.g,e.g,n),ii(o.b,e.b,n),ii(o.a,e.a,n))},number:ii});function xu(o,...e){for(const n of e)for(const l in n)o[l]=n[l];return o}class gs extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class sd{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,f]of n)this.bindings[l]=f}concat(e){return new sd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ja={kind:"null"},kt={kind:"number"},Gi={kind:"string"},Oi={kind:"boolean"},jr={kind:"color"},da={kind:"object"},Ci={kind:"value"},vu={kind:"collator"},oo={kind:"formatted"},fa={kind:"resolvedImage"};function Tr(o,e){return{kind:"array",itemType:o,N:e}}function hn(o){if(o.kind==="array"){const e=hn(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const Lp=[Ja,kt,Gi,Oi,jr,oo,da,Tr(Ci),fa];function sc(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!sc(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const n of Lp)if(!sc(n,e))return null}}return`Expected ${hn(o)} but found ${hn(e)} instead.`}function bu(o,e){return e.some(n=>n.kind===o.kind)}function Qa(o,e){return e.some(n=>n==="null"?o===null:n==="array"?Array.isArray(o):n==="object"?o&&!Array.isArray(o)&&typeof o=="object":n===typeof o)}class wu{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class oc{constructor(e,n,l,f,u){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=l,this.fontStack=f,this.textColor=u}}class Sr{constructor(e){this.sections=e}static fromString(e){return new Sr([new oc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary)}static factory(e){return e instanceof Sr?e:Sr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);const l={};n.fontStack&&(l["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(l["font-scale"]=n.scale),n.textColor&&(l["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(l)}return e}}class Ys{constructor(e,n){if(this.id=e,this.options=n||{params:{}},this.options.transform){const{a:l,b:f,c:u,d:m,e:v,f:S}=this.options.transform;this.options.transform=new DOMMatrix([l,f,u,m,v,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(e){return JSON.parse(e).id}static deserializeFromString(e){const n=JSON.parse(e),{a:l,b:f,c:u,d:m,e:v,f:S}=n.options.transform;return new DOMMatrix([l,f,u,m,v,S]),new Ys(n.id,n.options)}scaleSelf(e){return this.options.transform=this.options.transform.scale(e),this}serialize(){const e={id:this.id};this.options&&(e.options=this.options);const{a:n,b:l,c:f,d:u,e:m,f:v}=this.options.transform;return e.options.transform={a:n,b:l,c:f,d:u,e:m,f:v},JSON.stringify(e)}}class hr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),e.optionsPrimary&&(this.optionsPrimary=e.optionsPrimary),e.optionsSecondary&&(this.optionsSecondary=e.optionsSecondary),this.available=e.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new Ys(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new Ys(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(e){return typeof e=="string"?hr.build(e):e}static build(e,n,l,f){return e?new hr({namePrimary:e,nameSecondary:n,optionsPrimary:l,optionsSecondary:f,available:!1}):null}}function pa(o,e,n,l){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[o,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[o,e,n,l]:[o,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ma(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Fi||o instanceof wu||o instanceof Sr||o instanceof hr)return!0;if(Array.isArray(o)){for(const e of o)if(!ma(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!ma(o[e]))return!1;return!0}return!1}function xn(o){if(o===null)return Ja;if(typeof o=="string")return Gi;if(typeof o=="boolean")return Oi;if(typeof o=="number")return kt;if(o instanceof Fi)return jr;if(o instanceof wu)return vu;if(o instanceof Sr)return oo;if(o instanceof hr)return fa;if(Array.isArray(o)){const e=o.length;let n;for(const l of o){const f=xn(l);if(n){if(n===f)continue;n=Ci;break}n=f}return Tr(n||Ci,e)}return da}function Cs(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof Fi?o.toStringPremultipliedAlpha():o instanceof Sr||o instanceof hr?o.toString():JSON.stringify(o)}class ys{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ma(e[1]))return n.error("invalid value");const l=e[1];let f=xn(l);const u=n.expectedType;return f.kind!=="array"||f.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(f=u),new ys(f,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Fi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Sr?this.value.serialize():this.value}}class Bn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ac={string:Gi,number:kt,boolean:Oi,object:da};class xs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,f=1;const u=e[0];if(u==="array"){let v,S;if(e.length>2){const P=e[1];if(typeof P!="string"||!(P in ac)||P==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=ac[P],f++}else v=Ci;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=e[2],f++}l=Tr(v,S)}else l=ac[u];const m=[];for(;f<e.length;f++){const v=n.parse(e[f],f,Ci);if(!v)return null;m.push(v)}return new xs(l,m)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!sc(this.type,xn(l)))return l;if(n===this.args.length-1)throw new Bn(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${hn(xn(l))} but was expected to be of type ${hn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){n.push(l.kind);const f=e.N;(typeof f=="number"||this.args.length>1)&&n.push(f)}}return n.concat(this.args.map(l=>l.serialize()))}}class ao{constructor(e){this.type=oo,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const f=[];let u=!1;for(let m=1;m<=e.length-1;++m){const v=e[m];if(u&&typeof v=="object"&&!Array.isArray(v)){u=!1;let S=null;if(v["font-scale"]&&(S=n.parseObjectValue(v["font-scale"],m,"font-scale",kt),!S))return null;let P=null;if(v["text-font"]&&(P=n.parseObjectValue(v["text-font"],m,"text-font",Tr(Gi)),!P))return null;let x=null;if(v["text-color"]&&(x=n.parseObjectValue(v["text-color"],m,"text-color",jr),!x))return null;const M=f[f.length-1];M.scale=S,M.font=P,M.textColor=x}else{const S=n.parse(e[m],m,Ci);if(!S)return null;const P=S.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,f.push({content:S,scale:null,font:null,textColor:null})}}return new ao(f)}evaluate(e){return new Sr(this.sections.map(n=>{const l=n.content.evaluate(e);return xn(l)===fa?new oc("",l,null,null,null):new oc(Cs(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const l={};n.scale&&(l["font-scale"]=n.scale.serialize()),n.font&&(l["text-font"]=n.font.serialize()),n.textColor&&(l["text-color"]=n.textColor.serialize()),e.push(l)}return e}}class el{constructor(e,n,l,f){this._imageWarnHistory={},this.type=fa,this.inputPrimary=e,this.inputSecondary=n,this.inputPrimaryParams=l,this.inputSecondaryParams=f}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let l=1;const f=[];function u(){if(l<e.length){const v=n.parse(e[l],l++,Gi);return v?(f.push({image:v,options:void 0}),!0):(n.error(f.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(l<e.length){if((v=e[l])===null||typeof v!="object"||Array.isArray(v))return!0;const S=e[l].params,P=n.concat(l);if(!S)return l++,!0;if(typeof S!="object"||S.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const x={},M=P.concat(void 0,"params");for(const I in S){if(!I)return M.error("Image parameter name should be non-empty"),!1;const T=M.concat(void 0,I).parse(S[I],void 0,jr,void 0,{typeAnnotation:"coerce"});if(!T)return!1;x[I]=T}return f[f.length-1].options=x,l++,!0}var v;return!0}for(let v=0;v<2;v++)if(!u()||!m())return;return new el(f[0].image,f[1]?f[1].image:void 0,f[0].options,f[1]?f[1].options:void 0)}evaluateParams(e,n){const l={};if(n){for(const f in n)if(n[f])try{const u=n[f].evaluate(e),m=`Ignoring image parameter "${f}" with semi-transparent color ${u.toString()}`;if(u.a!==1){this._imageWarnHistory[m]||(console.warn(m),this._imageWarnHistory[m]=!0);continue}l[f]=u}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const n=hr.build(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0,this.inputPrimaryParams?this.evaluateParams(e,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(e,this.inputSecondaryParams):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){if(e(this.inputPrimary),this.inputPrimaryParams)for(const n in this.inputPrimaryParams)this.inputPrimaryParams[n]&&e(this.inputPrimaryParams[n]);if(this.inputSecondary&&(e(this.inputSecondary),this.inputSecondaryParams))for(const n in this.inputSecondaryParams)this.inputSecondaryParams[n]&&e(this.inputSecondaryParams[n])}outputDefined(){return!1}serializeParams(e){const n={};if(e){for(const l in e)e[l]&&(n[l]=e[l].serialize());return{params:n}}}serialize(){const e=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&e.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(e.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&e.push(this.serializeParams(this.inputSecondaryParams))),e}}function _a(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}const Og={"to-boolean":Oi,"to-color":jr,"to-number":kt,"to-string":Gi};class lo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0],f=[];let u=Ja;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);u=Tr(n.expectedType.itemType,m)}else{if(!(m>0&&ma(e[1][0])))return null;u=Tr(xn(e[1][0]),m)}for(let v=0;v<m;v++){const S=e[1][v];let P;if(_a(S)==="array")P=n.parse(S,void 0,u.itemType);else{const x=_a(S);if(x!==u.itemType.kind)return n.error(`Expected ${u.itemType.kind} but found ${x}.`);P=n.registry.literal.parse(["literal",S===void 0?null:S],n)}if(!P)return null;f.push(P)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");u=Og[l];for(let m=1;m<e.length;m++){const v=n.parse(e[m],m,Ci);if(!v)return null;f.push(v)}}return new lo(u,f)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,l;for(const f of this.args){if(n=f.evaluate(e),l=null,n instanceof Fi)return n;if(typeof n=="string"){const u=e.parseColor(n);if(u)return u}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:pa(n[0],n[1],n[2],n[3]),!l))return new Fi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Bn(l||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const f=Number(n);if(!isNaN(f))return f}throw new Bn(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Sr.fromString(Cs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?hr.build(Cs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Cs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ao([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new el(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const kp=["Unknown","Point","LineString","Polygon"];class Tu{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?kp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:l,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*n-e[0])+this.featureDistanceData.bearing[1]*(f*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Fi.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Gr{constructor(e,n,l,f,u){this.name=e,this.type=n,this._evaluate=l,this.args=f,this._overloadIndex=u}evaluate(e){if(!this._evaluate){const n=Gr.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const l=e[0],f=Gr.definitions[l];if(!f)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(f)?f[0]:f.type,m=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,v=[];let S=null,P=-1;for(const[x,M]of m){if(Array.isArray(x)&&x.length!==e.length-1)continue;v.push(x),P++,S=new dd(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);const I=[];let T=!1;for(let A=1;A<e.length;A++){const D=e[A],O=Array.isArray(x)?x[A-1]:x.type,F=S.parse(D,1+I.length,O);if(!F){T=!0;break}I.push(F)}if(!T)if(Array.isArray(x)&&x.length!==I.length)S.error(`Expected ${x.length} arguments, but found ${I.length} instead.`);else{for(let A=0;A<I.length;A++){const D=Array.isArray(x)?x[A]:x.type,O=I[A];S.concat(A+1).checkSubtype(D,O.type)}if(S.errors.length===0)return new Gr(l,u,M,I,P)}}if(v.length===1)n.errors.push(...S.errors);else{const x=(v.length?v:m.map(([I])=>I)).map(Su).join(" | "),M=[];for(let I=1;I<e.length;I++){const T=n.parse(e[I],1+M.length);if(!T)return null;M.push(hn(T.type))}n.error(`Expected arguments of type ${x}, but found (${M.join(", ")}) instead.`)}return null}static register(e,n){Gr.definitions=n;for(const l in n)e[l]=Gr}}function Su(o){return Array.isArray(o)?`(${o.map(hn).join(", ")})`:`(${hn(o.type)}...)`}class Mu{constructor(e,n,l){this.type=vu,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const f=l["case-sensitive"]===void 0?n.parse(!1,1,Oi):n.parseObjectValue(l["case-sensitive"],1,"case-sensitive",Oi);if(!f)return null;const u=l["diacritic-sensitive"]===void 0?n.parse(!1,1,Oi):n.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",Oi);if(!u)return null;let m=null;return l.locale&&(m=n.parseObjectValue(l.locale,1,"locale",Gi),!m)?null:new Mu(f,u,m)}evaluate(e){return new wu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Op(o,e,n=0,l=o.length-1,f=Fg){for(;l>n;){if(l-n>600){const S=l-n+1,P=e-n+1,x=Math.log(S),M=.5*Math.exp(2*x/3),I=.5*Math.sqrt(x*M*(S-M)/S)*(P-S/2<0?-1:1);Op(o,e,Math.max(n,Math.floor(e-P*M/S+I)),Math.min(l,Math.floor(e+(S-P)*M/S+I)),f)}const u=o[e];let m=n,v=l;for(lc(o,n,e),f(o[l],u)>0&&lc(o,n,l);m<v;){for(lc(o,m,v),m++,v--;f(o[m],u)<0;)m++;for(;f(o[v],u)>0;)v--}f(o[n],u)===0?lc(o,n,v):(v++,lc(o,v,l)),v<=e&&(n=v+1),e<=v&&(l=v-1)}}function lc(o,e,n){const l=o[e];o[e]=o[n],o[n]=l}function Fg(o,e){return o<e?-1:o>e?1:0}function Bg(o){let e=0;for(let n,l,f=0,u=o.length,m=u-1;f<u;m=f++)n=o[f],l=o[m],e+=(l.x-n.x)*(n.y+l.y);return e}function cc(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function uc(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function Fp(o,e,n){const l=o[0]-e[0],f=o[1]-e[1],u=o[0]-n[0],m=o[1]-n[1];return l*m-u*f==0&&l*u<=0&&f*m<=0}function Ps(o,e,n=!1){let l=!1;for(let v=0,S=e.length;v<S;v++){const P=e[v];for(let x=0,M=P.length,I=M-1;x<M;I=x++){const T=P[I],A=P[x];if(Fp(o,T,A))return n;(u=T)[1]>(f=o)[1]!=(m=A)[1]>f[1]&&f[0]<(m[0]-u[0])*(f[1]-u[1])/(m[1]-u[1])+u[0]&&(l=!l)}}var f,u,m;return l}function Bp(o,e,n,l){const f=l[0]-n[0],u=l[1]-n[1],m=(o[0]-n[0])*u-f*(o[1]-n[1]),v=(e[0]-n[0])*u-f*(e[1]-n[1]);return m>0&&v<0||m<0&&v>0}function Eu(o,e,n,l){return(f=[l[0]-n[0],l[1]-n[1]])[0]*(u=[e[0]-o[0],e[1]-o[1]])[1]-f[1]*u[0]!=0&&!(!Bp(o,e,n,l)||!Bp(n,l,o,e));var f,u}const Ks=8192;function Ng(o,e){const n=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(n*f*Ks),Math.round(l*f*Ks)]}function Vg(o,e){for(let n=0;n<e.length;n++)if(Ps(o,e[n]))return!0;return!1}function Ug(o,e,n){for(const l of n)for(let f=0,u=l.length,m=u-1;f<u;m=f++)if(Eu(o,e,l[m],l[f]))return!0;return!1}function Np(o,e){for(let n=0;n<o.length;++n)if(!Ps(o[n],e))return!1;for(let n=0;n<o.length-1;++n)if(Ug(o[n],o[n+1],e))return!1;return!0}function tl(o,e){for(let n=0;n<e.length;n++)if(Np(o,e[n]))return!0;return!1}function bi(o,e,n){const l=[];for(let f=0;f<o.length;f++){const u=[];for(let m=0;m<o[f].length;m++){const v=Ng(o[f][m],n);cc(e,v),u.push(v)}l.push(u)}return l}function $t(o,e,n){const l=[];for(let f=0;f<o.length;f++){const u=bi(o[f],e,n);l.push(u)}return l}function Au(o,e,n,l){if(o[0]<n[0]||o[0]>n[2]){const f=.5*l;let u=o[0]-n[0]>f?-l:n[0]-o[0]>f?l:0;u===0&&(u=o[0]-n[2]>f?-l:n[2]-o[0]>f?l:0),o[0]+=u}cc(e,o)}function hi(o,e,n,l){const f=Math.pow(2,l.z)*Ks,u=[l.x*Ks,l.y*Ks],m=[];if(!o)return m;for(const v of o)for(const S of v){const P=[S.x+u[0],S.y+u[1]];Au(P,e,n,f),m.push(P)}return m}function Iu(o,e,n,l){const f=Math.pow(2,l.z)*Ks,u=[l.x*Ks,l.y*Ks],m=[];if(!o)return m;for(const S of o){const P=[];for(const x of S){const M=[x.x+u[0],x.y+u[1]];cc(e,M),P.push(M)}m.push(P)}if(e[2]-e[0]<=f/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const S of m)for(const P of S)Au(P,e,n,f)}var v;return m}class co{constructor(e,n){this.type=Oi,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ma(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let f=0;f<l.features.length;++f){const u=l.features[f].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new co(l,l.features[f].geometry)}else if(l.type==="Feature"){const f=l.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new co(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new co(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,l){const f=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const v=bi(l.coordinates,u,m),S=hi(n.geometry(),f,u,m);if(!uc(f,u))return!1;for(const P of S)if(!Ps(P,v))return!1}if(l.type==="MultiPolygon"){const v=$t(l.coordinates,u,m),S=hi(n.geometry(),f,u,m);if(!uc(f,u))return!1;for(const P of S)if(!Vg(P,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,l){const f=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const v=bi(l.coordinates,u,m),S=Iu(n.geometry(),f,u,m);if(!uc(f,u))return!1;for(const P of S)if(!Np(P,v))return!1}if(l.type==="MultiPolygon"){const v=$t(l.coordinates,u,m),S=Iu(n.geometry(),f,u,m);if(!uc(f,u))return!1;for(const P of S)if(!tl(P,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ni={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},od=1/298.257223563,Cu=od*(2-od),il=Math.PI/180;class nl{static fromTile(e,n,l){const f=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),u=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/il;return new nl(u,l)}static get units(){return ni}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!ni[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(ni).join(", ")}`);const l=6378.137*il*(n?ni[n]:1),f=Math.cos(e*il),u=1/(1-Cu*(1-f*f)),m=Math.sqrt(u);this.kx=l*m*f,this.ky=l*m*u*(1-Cu)}distance(e,n){const l=Hr(e[0]-n[0])*this.kx,f=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+f*f)}bearing(e,n){const l=Hr(n[0]-e[0])*this.kx;return Math.atan2(l,(n[1]-e[1])*this.ky)/il}destination(e,n,l){const f=l*il;return this.offset(e,Math.sin(f)*n,Math.cos(f)*n)}offset(e,n,l){return[e[0]+n/this.kx,e[1]+l/this.ky]}lineDistance(e){let n=0;for(let l=0;l<e.length-1;l++)n+=this.distance(e[l],e[l+1]);return n}area(e){let n=0;for(let l=0;l<e.length;l++){const f=e[l];for(let u=0,m=f.length,v=m-1;u<m;v=u++)n+=Hr(f[u][0]-f[v][0])*(f[u][1]+f[v][1])*(l?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let l=0;if(n<=0)return e[0];for(let f=0;f<e.length-1;f++){const u=e[f],m=e[f+1],v=this.distance(u,m);if(l+=v,l>n)return yr(u,m,(n-(l-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,n,l){let[f,u]=n,m=Hr(l[0]-f)*this.kx,v=(l[1]-u)*this.ky;if(m!==0||v!==0){const S=(Hr(e[0]-f)*this.kx*m+(e[1]-u)*this.ky*v)/(m*m+v*v);S>1?(f=l[0],u=l[1]):S>0&&(f+=m/this.kx*S,u+=v/this.ky*S)}return m=Hr(e[0]-f)*this.kx,v=(e[1]-u)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(e,n){let l=1/0,f=e[0][0],u=e[0][1],m=0,v=0;for(let S=0;S<e.length-1;S++){let P=e[S][0],x=e[S][1],M=Hr(e[S+1][0]-P)*this.kx,I=(e[S+1][1]-x)*this.ky,T=0;M===0&&I===0||(T=(Hr(n[0]-P)*this.kx*M+(n[1]-x)*this.ky*I)/(M*M+I*I),T>1?(P=e[S+1][0],x=e[S+1][1]):T>0&&(P+=M/this.kx*T,x+=I/this.ky*T)),M=Hr(n[0]-P)*this.kx,I=(n[1]-x)*this.ky;const A=M*M+I*I;A<l&&(l=A,f=P,u=x,m=S,v=T)}return{point:[f,u],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(e,n,l){let f=this.pointOnLine(l,e),u=this.pointOnLine(l,n);if(f.index>u.index||f.index===u.index&&f.t>u.t){const P=f;f=u,u=P}const m=[f.point],v=f.index+1,S=u.index;!hc(l[v],m[0])&&v<=S&&m.push(l[v]);for(let P=v+1;P<=S;P++)m.push(l[P]);return hc(l[S],u.point)||m.push(u.point),m}lineSliceAlong(e,n,l){let f=0;const u=[];for(let m=0;m<l.length-1;m++){const v=l[m],S=l[m+1],P=this.distance(v,S);if(f+=P,f>e&&u.length===0&&u.push(yr(v,S,(e-(f-P))/P)),f>=n)return u.push(yr(v,S,(n-(f-P))/P)),u;f>e&&u.push(S)}return u}bufferPoint(e,n){const l=n/this.ky,f=n/this.kx;return[e[0]-f,e[1]-l,e[0]+f,e[1]+l]}bufferBBox(e,n){const l=n/this.ky,f=n/this.kx;return[e[0]-f,e[1]-l,e[2]+f,e[3]+l]}insideBBox(e,n){return Hr(e[0]-n[0])>=0&&Hr(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function hc(o,e){return o[0]===e[0]&&o[1]===e[1]}function yr(o,e,n){const l=Hr(e[0]-o[0]);return[o[0]+l*n,o[1]+(e[1]-o[1])*n]}function Hr(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class Pu{constructor(e=[],n=(l,f)=>l<f?-1:l>f?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,f=n[e];for(;e>0;){const u=e-1>>1,m=n[u];if(l(f,m)>=0)break;n[e]=m,e=u}n[e]=f}_down(e){const{data:n,compare:l}=this,f=this.length>>1,u=n[e];for(;e<f;){let m=1+(e<<1);const v=m+1;if(v<this.length&&l(n[v],n[m])<0&&(m=v),l(n[m],u)>=0)break;n[e]=n[m],e=m}n[e]=u}}var vt=8192;function Du(o,e){return e.dist-o.dist}const uo=100,xr=50;function Vp(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==o[n])return!1;return!0}function zu(o){return o[1]-o[0]+1}function ho(o,e){const n=o[1]>=o[0]&&o[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function rl(o,e){if(o[0]>o[1])return[null,null];const n=zu(o);if(e){if(n===2)return[o,null];const l=Math.floor(n/2);return[[o[0],o[0]+l],[o[0]+l,o[1]]]}{if(n===1)return[o,null];const l=Math.floor(n/2)-1;return[[o[0],o[0]+l],[o[0]+l+1,o[1]]]}}function Fo(o,e){const n=[1/0,1/0,-1/0,-1/0];if(!ho(e,o.length))return n;for(let l=e[0];l<=e[1];++l)cc(n,o[l]);return n}function sl(o){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<o.length;++n)for(let l=0;l<o[n].length;++l)cc(e,o[n][l]);return e}function ol(o,e,n){if(Vp(o)||Vp(e))return NaN;let l=0,f=0;return o[2]<e[0]&&(l=e[0]-o[2]),o[0]>e[2]&&(l=o[0]-e[2]),o[1]>e[3]&&(f=o[1]-e[3]),o[3]<e[1]&&(f=e[1]-o[3]),n.distance([0,0],[l,f])}function jg(o){return 360*o-180}function Gg(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function ad(o,e){const n=Math.pow(2,e.z),l=(o.y/vt+e.y)/n;return[jg((o.x/vt+e.x)/n),Gg(l)]}function Up(o,e){const n=[];for(let l=0;l<o.length;++l)n.push(ad(o[l],e));return n}function jp(o,e,n){const l=n.pointOnLine(e,o).point;return n.distance(o,l)}function Gp(o,e,n,l,f){const u=n.slice(l[0],l[1]+1);let m=1/0;for(let v=e[0];v<=e[1];++v)if((m=Math.min(m,jp(o[v],u,f)))===0)return 0;return m}function fo(o,e,n,l,f){const u=Math.min(f.pointToSegmentDistance(o,n,l),f.pointToSegmentDistance(e,n,l)),m=Math.min(f.pointToSegmentDistance(n,o,e),f.pointToSegmentDistance(l,o,e));return Math.min(u,m)}function Hg(o,e,n,l,f){if(!ho(e,o.length)||!ho(l,n.length))return NaN;let u=1/0;for(let m=e[0];m<e[1];++m)for(let v=l[0];v<l[1];++v){if(Eu(o[m],o[m+1],n[v],n[v+1]))return 0;u=Math.min(u,fo(o[m],o[m+1],n[v],n[v+1],f))}return u}function qg(o,e,n,l,f){if(!ho(e,o.length)||!ho(l,n.length))return NaN;let u=1/0;for(let m=e[0];m<=e[1];++m)for(let v=l[0];v<=l[1];++v)if((u=Math.min(u,f.distance(o[m],n[v])))===0)return u;return u}function ld(o,e,n){if(Ps(o,e,!0))return 0;let l=1/0;for(const f of e){const u=f.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[u-1]&&(l=Math.min(l,n.pointToSegmentDistance(o,f[u-1],f[0])))===0||(l=Math.min(l,jp(o,f,n)))===0)return l}return l}function Hp(o,e,n,l){if(!ho(e,o.length))return NaN;for(let u=e[0];u<=e[1];++u)if(Ps(o[u],n,!0))return 0;let f=1/0;for(let u=e[0];u<e[1];++u)for(const m of n)for(let v=0,S=m.length,P=S-1;v<S;P=v++){if(Eu(o[u],o[u+1],m[P],m[v]))return 0;f=Math.min(f,fo(o[u],o[u+1],m[P],m[v],l))}return f}function cd(o,e){for(const n of o)for(let l=0;l<=n.length-1;++l)if(Ps(n[l],e,!0))return!0;return!1}function Ds(o,e,n,l=1/0){const f=sl(o),u=sl(e);if(l!==1/0&&ol(f,u,n)>=l)return l;if(uc(f,u)){if(cd(o,e))return 0}else if(cd(e,o))return 0;let m=l;for(const v of o)for(let S=0,P=v.length,x=P-1;S<P;x=S++)for(const M of e)for(let I=0,T=M.length,A=T-1;I<T;A=I++){if(Eu(v[x],v[S],M[A],M[I]))return 0;m=Math.min(m,fo(v[x],v[S],M[A],M[I],n))}return m}function dc(o,e,n,l,f,u,m){if(u===null||m===null)return;const v=ol(Fo(l,u),Fo(f,m),n);v<e&&o.push({dist:v,range1:u,range2:m})}function qp(o,e,n,l,f=1/0){let u=Math.min(l.distance(o[0],n[0][0]),f);if(u===0)return u;const m=new Pu([{dist:0,range1:[0,o.length-1],range2:[0,0]}],Du),v=e?xr:uo,S=sl(n);for(;m.length;){const P=m.pop();if(P.dist>=u)continue;const x=P.range1;if(zu(x)<=v){if(!ho(x,o.length))return NaN;if(e){const M=Hp(o,x,n,l);if((u=Math.min(u,M))===0)return u}else for(let M=x[0];M<=x[1];++M){const I=ld(o[M],n,l);if((u=Math.min(u,I))===0)return u}}else{const M=rl(x,e);if(M[0]!==null){const I=ol(Fo(o,M[0]),S,l);I<u&&m.push({dist:I,range1:M[0],range2:[0,0]})}if(M[1]!==null){const I=ol(Fo(o,M[1]),S,l);I<u&&m.push({dist:I,range1:M[1],range2:[0,0]})}}}return u}function ud(o,e,n,l,f,u=1/0){let m=Math.min(u,f.distance(o[0],n[0]));if(m===0)return m;const v=new Pu([{dist:0,range1:[0,o.length-1],range2:[0,n.length-1]}],Du),S=e?xr:uo,P=l?xr:uo;for(;v.length;){const x=v.pop();if(x.dist>=m)continue;const M=x.range1,I=x.range2;if(zu(M)<=S&&zu(I)<=P){if(!ho(M,o.length)||!ho(I,n.length))return NaN;if(e&&l?m=Math.min(m,Hg(o,M,n,I,f)):e||l?e&&!l?m=Math.min(m,Gp(n,I,o,M,f)):!e&&l&&(m=Math.min(m,Gp(o,M,n,I,f))):m=Math.min(m,qg(o,M,n,I,f)),m===0)return m}else{const T=rl(M,e),A=rl(I,l);dc(v,m,f,o,n,T[0],A[0]),dc(v,m,f,o,n,T[0],A[1]),dc(v,m,f,o,n,T[1],A[0]),dc(v,m,f,o,n,T[1],A[1])}}return m}function Ru(o,e,n,l,f=1/0){let u=f;const m=Fo(o,[0,o.length-1]);for(const v of n)if(!(u!==1/0&&ol(m,Fo(v,[0,v.length-1]),l)>=u)&&(u=Math.min(u,ud(o,e,v,!0,l,u)),u===0))return u;return u}function fc(o,e,n,l,f=1/0){let u=f;const m=Fo(o,[0,o.length-1]);for(const v of n){if(u!==1/0&&ol(m,sl(v),l)>=u)continue;const S=qp(o,e,v,l,u);if(isNaN(S))return S;if((u=Math.min(u,S))===0)return u}return u}function Lu(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class Bo{constructor(e,n){this.type=kt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ma(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let f=0;f<l.features.length;++f)if(Lu(l.features[f].geometry.type))return new Bo(l,l.features[f].geometry)}else if(l.type==="Feature"){if(Lu(l.geometry.type))return new Bo(l,l.geometry)}else if(Lu(l.type))return new Bo(l,l)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),l=e.canonicalID();if(n!=null&&l!=null){if(e.geometryType()==="Point")return function(f,u,m){const v=[];for(const P of f)for(const x of P)v.push(ad(x,u));const S=new nl(v[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?ud(v,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",S):m.type==="MultiLineString"?Ru(v,!1,m.coordinates,S):m.type==="Polygon"||m.type==="MultiPolygon"?fc(v,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,S):null}(n,l,this.geometries);if(e.geometryType()==="LineString")return function(f,u,m){const v=[];for(const P of f){const x=[];for(const M of P)x.push(ad(M,u));v.push(x)}const S=new nl(v[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Ru(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,S);if(m.type==="MultiLineString"){let P=1/0;for(let x=0;x<m.coordinates.length;x++){const M=Ru(m.coordinates[x],!0,v,S,P);if(isNaN(M))return M;if((P=Math.min(P,M))===0)return P}return P}if(m.type==="Polygon"||m.type==="MultiPolygon"){let P=1/0;for(let x=0;x<v.length;x++){const M=fc(v[x],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,S,P);if(isNaN(M))return M;if((P=Math.min(P,M))===0)return P}return P}return null}(n,l,this.geometries);if(e.geometryType()==="Polygon")return function(f,u,m){const v=[];for(const P of function(x,M){const I=x.length;if(I<=1)return[x];const T=[];let A,D;for(let O=0;O<I;O++){const F=Bg(x[O]);F!==0&&(x[O].area=Math.abs(F),D===void 0&&(D=F<0),D===F<0?(A&&T.push(A),A=[x[O]]):A.push(x[O]))}return A&&T.push(A),T}(f)){const x=[];for(let M=0;M<P.length;++M)x.push(Up(P[M],u));v.push(x)}const S=new nl(v[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return fc(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,S);if(m.type==="MultiLineString"){let P=1/0;for(let x=0;x<m.coordinates.length;x++){const M=fc(m.coordinates[x],!0,v,S,P);if(isNaN(M))return M;if((P=Math.min(P,M))===0)return P}return P}return m.type==="Polygon"||m.type==="MultiPolygon"?function(P,x,M){let I=1/0;for(const T of P)for(const A of x){const D=Ds(T,A,M,I);if(isNaN(D))return D;if((I=Math.min(I,D))===0)return I}return I}(m.type==="Polygon"?[m.coordinates]:m.coordinates,v,S):null}(n,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ku(o,e){switch(o){case"string":return Cs(e);case"number":return+e;case"boolean":return!!e;case"color":return Fi.parse(e);case"formatted":return Sr.fromString(Cs(e));case"resolvedImage":return hr.build(Cs(e))}return e}function hd(o,e,n,l){return l!==void 0&&(o=l*Math.round(o/l)),e!==void 0&&o<e&&(o=e),n!==void 0&&o>n&&(o=n),o}class ga{constructor(e,n,l){this.type=e,this.key=n,this.scope=l}static parse(e,n){let l=n.expectedType;if(l==null&&(l=Ci),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const f=n.parse(e[1],1);if(!(f instanceof ys))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const u=n.parse(e[2],2);return u instanceof ys?new ga(l,Cs(f.value),Cs(u.value)):n.error("Scope of 'config' expression must be a string literal.")}return new ga(l,Cs(f.value))}evaluate(e){const n=[this.key,this.scope,e.scope].filter(Boolean).join(""),l=e.getConfig(n);if(!l)return null;const{type:f,value:u,values:m,minValue:v,maxValue:S,stepValue:P}=l,x=l.default.evaluate(e);let M=x;if(u){const I=e.scope;e.scope=(I||"").split("").slice(1).join(""),M=u.evaluate(e),e.scope=I}return f&&(M=ku(f,M)),M===void 0||v===void 0&&S===void 0&&P===void 0||(typeof M=="number"?M=hd(M,v,S,P):Array.isArray(M)&&(M=M.map(I=>typeof I=="number"?hd(I,v,S,P):I))),u!==void 0&&M!==void 0&&m&&!m.includes(M)&&(M=x,f&&(M=ku(f,M))),(f&&f!==this.type||M!==void 0&&xn(M)!==this.type)&&(M=ku(this.type.kind,M)),M}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function al(o){if(o instanceof Gr&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof co||o instanceof Bo)return!1;let e=!0;return o.eachChild(n=>{e&&!al(n)&&(e=!1)}),e}function ya(o){if(o instanceof Gr&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(n=>{e&&!ya(n)&&(e=!1)}),e}function xa(o){if(o instanceof ga)return new Set([o.key]);let e=new Set;return o.eachChild(n=>{e=new Set([...e,...xa(n)])}),e}function po(o,e){if(o instanceof Gr&&e.indexOf(o.name)>=0)return!1;let n=!0;return o.eachChild(l=>{n&&!po(l,e)&&(n=!1)}),n}class pc{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new pc(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ou{constructor(e,n=[],l,f=new sd,u=[],m,v){this.registry=e,this.path=n,this.key=n.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=f,this.errors=u,this.expectedType=l,this._scope=m,this.options=v}parse(e,n,l,f,u={}){return n||l?this.concat(n,null,l,f)._parse(e,u):this._parse(e,u)}parseObjectValue(e,n,l,f,u,m={}){return this.concat(n,l,f,u)._parse(e,m)}_parse(e,n){function l(f,u,m){return m==="assert"?new xs(u,[f]):m==="coerce"?new lo(u,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(f){let u=f.parse(e,this);if(!u)return null;if(this.expectedType){const m=this.expectedType,v=u.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else u=l(u,m,n.typeAnnotation||"coerce");else u=l(u,m,n.typeAnnotation||"assert")}if(!(u instanceof ys)&&u.type.kind!=="resolvedImage"&&No(u)){const m=new Tu(this._scope,this.options);try{u=new ys(u.type,u.evaluate(m))}catch(v){return this.error(v.message),null}}return u}return lo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l,f){let u=typeof e=="number"?this.path.concat(e):this.path;u=typeof n=="string"?u.concat(n):u;const m=f?this.scope.concat(f):this.scope;return new Ou(this.registry,u,l||null,m,this.errors,this._scope,this.options)}error(e,...n){const l=`${this.key}${n.map(f=>`[${f}]`).join("")}`;this.errors.push(new gs(l,e))}checkSubtype(e,n){const l=sc(e,n);return l&&this.error(l),l}}var dd=Ou;function No(o){if(o instanceof pc)return No(o.boundExpression);if(o instanceof Gr&&o.name==="error"||o instanceof Mu||o instanceof co||o instanceof Bo||o instanceof ga)return!1;const e=o instanceof lo||o instanceof xs;let n=!0;return o.eachChild(l=>{n=e?n&&No(l):n&&l instanceof ys}),!!n&&al(o)&&po(o,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ai(o,e){const n=o.length-1;let l,f,u=0,m=n,v=0;for(;u<=m;)if(v=Math.floor((u+m)/2),l=o[v],f=o[v+1],l<=e){if(v===n||e<f)return v;u=v+1}else{if(!(l>e))throw new Bn("Input is not a number.");m=v-1}return 0}class mc{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[f,u]of l)this.labels.push(f),this.outputs.push(u)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,kt);if(!l)return null;const f=[];let u=null;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);for(let m=1;m<e.length;m+=2){const v=m===1?-1/0:e[m],S=e[m+1],P=m,x=m+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(f.length&&f[f.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const M=n.parse(S,x,u);if(!M)return null;u=u||M.type,f.push([v,M])}return new mc(u,l,f)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const f=this.input.evaluate(e);if(f<=n[0])return l[0].evaluate(e);const u=n.length;return f>=n[u-1]?l[u-1].evaluate(e):l[Ai(n,f)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const $p=.95047,Wp=1.08883,fd=4/29,ll=6/29,_n=3*ll*ll,$g=ll*ll*ll,Wg=Math.PI/180,Zg=180/Math.PI;function pd(o){return o>$g?Math.pow(o,1/3):o/_n+fd}function md(o){return o>ll?o*o*o:_n*(o-fd)}function _d(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function gd(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Zp(o){const e=gd(o.r),n=gd(o.g),l=gd(o.b),f=pd((.4124564*e+.3575761*n+.1804375*l)/$p),u=pd((.2126729*e+.7151522*n+.072175*l)/1);return{l:116*u-16,a:500*(f-u),b:200*(u-pd((.0193339*e+.119192*n+.9503041*l)/Wp)),alpha:o.a}}function Xp(o){let e=(o.l+16)/116,n=isNaN(o.a)?e:e+o.a/500,l=isNaN(o.b)?e:e-o.b/200;return e=1*md(e),n=$p*md(n),l=Wp*md(l),new Fi(_d(3.2404542*n-1.5371385*e-.4985314*l),_d(-.969266*n+1.8760108*e+.041556*l),_d(.0556434*n-.2040259*e+1.0572252*l),o.alpha)}function Xg(o,e,n){const l=e-o;return o+n*(l>180||l<-180?l-360*Math.round(l/360):l)}const _c={forward:Zp,reverse:Xp,interpolate:function(o,e,n){return{l:ii(o.l,e.l,n),a:ii(o.a,e.a,n),b:ii(o.b,e.b,n),alpha:ii(o.alpha,e.alpha,n)}}},gc={forward:function(o){const{l:e,a:n,b:l}=Zp(o),f=Math.atan2(l,n)*Zg;return{h:f<0?f+360:f,c:Math.sqrt(n*n+l*l),l:e,alpha:o.a}},reverse:function(o){const e=o.h*Wg,n=o.c;return Xp({l:o.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:o.alpha})},interpolate:function(o,e,n){return{h:Xg(o.h,e.h,n),c:ii(o.c,e.c,n),l:ii(o.l,e.l,n),alpha:ii(o.alpha,e.alpha,n)}}};var Yp=Object.freeze({__proto__:null,hcl:gc,lab:_c});class qr{constructor(e,n,l,f,u,m){this.type=e,this.operator=n,this.interpolation=l,this.input=f,this.dynamicStops=u,this.labels=[],this.outputs=[];for(const[v,S]of m)this.labels.push(v),this.outputs.push(S)}static interpolationFactor(e,n,l,f){let u=0;if(e.name==="exponential")u=yd(n,e.base,l,f);else if(e.name==="linear")u=yd(n,1,l,f);else if(e.name==="cubic-bezier"){const m=e.controlPoints;u=new ke(m[0],m[1],m[2],m[3]).solve(yd(n,1,l,f))}return u}static parse(e,n){let[l,f,u,...m]=e;if(!Array.isArray(f)||f.length===0)return n.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const P=f[1];if(typeof P!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:P}}else{if(f[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const P=f.slice(1);if(P.length!==4||P.some(x=>typeof x!="number"||x<0||x>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:P}}}if(e.length-1<3)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(u=n.parse(u,2,kt),!u)return null;const v=[];let S=null;if(l==="interpolate-hcl"||l==="interpolate-lab"?S=jr:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType),e.length-1==3){const P=n.parse(m[0],3,Ci);return P?new qr(S,l,f,u,P,v):null}for(let P=0;P<m.length;P+=2){const x=m[P],M=m[P+1],I=P+3,T=P+4;if(typeof x!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(v.length&&v[v.length-1][0]>=x)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const A=n.parse(M,T,S);if(!A)return null;S=S||A.type,v.push([x,A])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new qr(S,l,f,u,null,v):n.error(`Type ${hn(S)} is not interpolatable.`)}evaluate(e){let n=this.labels,l=this.outputs;if(this.dynamicStops){const x=this.dynamicStops.evaluate(e);if(x.length%2!=0)throw new Bn("Expected an even number of arguments.");n=[],l=[];for(let M=0;M<x.length;M+=2){const I=x[M],T=new ys(kt,x[M+1]);if(typeof I!="number")throw new Bn('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(n.length&&n[n.length-1]>=I)throw new Bn('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');n.push(I),l.push(T)}if(n.length===0)throw new Bn("Expected at least one input/output pair.")}if(n.length===1)return l[0].evaluate(e);const f=this.input.evaluate(e);if(f<=n[0])return l[0].evaluate(e);const u=n.length;if(f>=n[u-1])return l[u-1].evaluate(e);const m=Ai(n,f),v=qr.interpolationFactor(this.interpolation,f,n[m],n[m+1]),S=l[m].evaluate(e),P=l[m+1].evaluate(e);return this.operator==="interpolate"?ki[this.type.kind.toLowerCase()](S,P,v):this.operator==="interpolate-hcl"?gc.reverse(gc.interpolate(gc.forward(S),gc.forward(P),v)):_c.reverse(_c.interpolate(_c.forward(S),_c.forward(P),v))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];if(this.dynamicStops)n.push(this.dynamicStops.serialize());else for(let l=0;l<this.labels.length;l++)n.push(this.labels[l],this.outputs[l].serialize());return n}}function yd(o,e,n,l){const f=l-n,u=o-n;return f===0?0:e===1?u/f:(Math.pow(e,u)-1)/(Math.pow(e,f)-1)}class Fu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let l=null;const f=n.expectedType;f&&f.kind!=="value"&&(l=f);const u=[];for(const v of e.slice(1)){const S=n.parse(v,1+u.length,l,void 0,{typeAnnotation:"omit"});if(!S)return null;l=l||S.type,u.push(S)}const m=f&&u.some(v=>sc(f,v.type));return new Fu(m?Ci:l,u)}evaluate(e){let n,l=null,f=0;for(const u of this.args){if(f++,l=u.evaluate(e),l&&l instanceof hr&&!l.available&&(n||(n=l),l=null,f===this.args.length))return n;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Bu{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let u=1;u<e.length-1;u+=2){const m=e[u];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,u);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",u);const v=n.parse(e[u+1],u+1);if(!v)return null;l.push([m,v])}const f=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return f?new Bu(l,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,l]of this.bindings)e.push(n,l.serialize());return e.push(this.result.serialize()),e}}class xd{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,kt),f=n.parse(e[2],2,Tr(n.expectedType||Ci));return l&&f?new xd(f.type.itemType,l,f):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new Bn(`Array index out of bounds: ${n} < 0.`);if(n>l.length-1)throw new Bn(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n===Math.floor(n))return l[n];const f=Math.floor(n),u=Math.ceil(n),m=l[f],v=l[u];if(typeof m!="number"||typeof v!="number")throw new Bn(`Cannot interpolate between non-number values at index ${n}.`);const S=n-f;return m*(1-S)+v*S}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vd{constructor(e,n){this.type=Oi,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Ci),f=n.parse(e[2],2,Ci);return l&&f?bu(l.type,[Oi,Gi,kt,Ja,Ci])?new vd(l,f):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Qa(n,["boolean","string","number","null"]))throw new Bn(`Expected first argument to be of type boolean, string, number or null, but found ${hn(xn(n))} instead.`);if(!Qa(l,["string","array"]))throw new Bn(`Expected second argument to be of type array or string, but found ${hn(xn(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Nu{constructor(e,n,l){this.type=kt,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Ci),f=n.parse(e[2],2,Ci);if(!l||!f)return null;if(!bu(l.type,[Oi,Gi,kt,Ja,Ci]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(l.type)} instead`);if(e.length===4){const u=n.parse(e[3],3,kt);return u?new Nu(l,f,u):null}return new Nu(l,f)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Qa(n,["boolean","string","number","null"]))throw new Bn(`Expected first argument to be of type boolean, string, number or null, but found ${hn(xn(n))} instead.`);if(!Qa(l,["string","array"]))throw new Bn(`Expected second argument to be of type array or string, but found ${hn(xn(l))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(e);return l.indexOf(n,f)}return l.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class bd{constructor(e,n,l,f,u,m){this.inputType=e,this.type=n,this.input=l,this.cases=f,this.outputs=u,this.otherwise=m}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,f;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);const u={},m=[];for(let P=2;P<e.length-1;P+=2){let x=e[P];const M=e[P+1];Array.isArray(x)||(x=[x]);const I=n.concat(P);if(x.length===0)return I.error("Expected at least one branch label.");for(const A of x){if(typeof A!="number"&&typeof A!="string")return I.error("Branch labels must be numbers or strings.");if(typeof A=="number"&&Math.abs(A)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof A=="number"&&Math.floor(A)!==A)return I.error("Numeric branch labels must be integer values.");if(l){if(I.checkSubtype(l,xn(A)))return null}else l=xn(A);if(u[String(A)]!==void 0)return I.error("Branch labels must be unique.");u[String(A)]=m.length}const T=n.parse(M,P,f);if(!T)return null;f=f||T.type,m.push(T)}const v=n.parse(e[1],1,Ci);if(!v)return null;const S=n.parse(e[e.length-1],e.length-1,f);return S?v.type.kind!=="value"&&n.concat(1).checkSubtype(l,v.type)?null:new bd(l,f,v,u,m,S):null}evaluate(e){const n=this.input.evaluate(e);return(xn(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),l=[],f={};for(const m of n){const v=f[this.cases[m]];v===void 0?(f[this.cases[m]]=l.length,l.push([this.cases[m],[m]])):l[v][1].push(m)}const u=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,v]of l)e.push(v.length===1?u(v[0]):v.map(u)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class wd{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const f=[];for(let m=1;m<e.length-1;m+=2){const v=n.parse(e[m],m,Oi);if(!v)return null;const S=n.parse(e[m+1],m+1,l);if(!S)return null;f.push([v,S]),l=l||S.type}const u=n.parse(e[e.length-1],e.length-1,l);return u?new wd(l,f,u):null}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Vu{constructor(e,n,l,f){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=f}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Ci),f=n.parse(e[2],2,kt);if(!l||!f)return null;if(!bu(l.type,[Tr(Ci),Gi,Ci]))return n.error(`Expected first argument to be of type array or string, but found ${hn(l.type)} instead`);if(e.length===4){const u=n.parse(e[3],3,kt);return u?new Vu(l.type,l,f,u):null}return new Vu(l.type,l,f)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Qa(n,["string","array"]))throw new Bn(`Expected first argument to be of type array or string, but found ${hn(xn(n))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(e);return n.slice(l,f)}return n.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Kp(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Jp(o,e,n,l){return l.compare(e,n)===0}function cl(o,e,n){const l=o!=="=="&&o!=="!=";return class dM{constructor(u,m,v){this.type=Oi,this.lhs=u,this.rhs=m,this.collator=v,this.hasUntypedArgument=u.type.kind==="value"||m.type.kind==="value"}static parse(u,m){if(u.length!==3&&u.length!==4)return m.error("Expected two or three arguments.");const v=u[0];let S=m.parse(u[1],1,Ci);if(!S)return null;if(!Kp(v,S.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${hn(S.type)}'.`);let P=m.parse(u[2],2,Ci);if(!P)return null;if(!Kp(v,P.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${hn(P.type)}'.`);if(S.type.kind!==P.type.kind&&S.type.kind!=="value"&&P.type.kind!=="value")return m.error(`Cannot compare types '${hn(S.type)}' and '${hn(P.type)}'.`);l&&(S.type.kind==="value"&&P.type.kind!=="value"?S=new xs(P.type,[S]):S.type.kind!=="value"&&P.type.kind==="value"&&(P=new xs(S.type,[P])));let x=null;if(u.length===4){if(S.type.kind!=="string"&&P.type.kind!=="string"&&S.type.kind!=="value"&&P.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(x=m.parse(u[3],3,vu),!x)return null}return new dM(S,P,x)}evaluate(u){const m=this.lhs.evaluate(u),v=this.rhs.evaluate(u);if(l&&this.hasUntypedArgument){const S=xn(m),P=xn(v);if(S.kind!==P.kind||S.kind!=="string"&&S.kind!=="number")throw new Bn(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${S.kind}, ${P.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const S=xn(m),P=xn(v);if(S.kind!=="string"||P.kind!=="string")return e(u,m,v)}return this.collator?n(u,m,v,this.collator.evaluate(u)):e(u,m,v)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[o];return this.eachChild(m=>{u.push(m.serialize())}),u}}}const Yg=cl("==",function(o,e,n){return e===n},Jp),Kg=cl("!=",function(o,e,n){return e!==n},function(o,e,n,l){return!Jp(0,e,n,l)}),Jg=cl("<",function(o,e,n){return e<n},function(o,e,n,l){return l.compare(e,n)<0}),Qg=cl(">",function(o,e,n){return e>n},function(o,e,n,l){return l.compare(e,n)>0}),ey=cl("<=",function(o,e,n){return e<=n},function(o,e,n,l){return l.compare(e,n)<=0}),Td=cl(">=",function(o,e,n){return e>=n},function(o,e,n,l){return l.compare(e,n)>=0});class Sd{constructor(e,n,l,f,u,m){this.type=Gi,this.number=e,this.locale=n,this.currency=l,this.unit=f,this.minFractionDigits=u,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,kt);if(!l)return null;const f=e[2];if(typeof f!="object"||Array.isArray(f))return n.error("NumberFormat options argument must be an object.");let u=null;if(f.locale&&(u=n.parseObjectValue(f.locale,2,"locale",Gi),!u))return null;let m=null;if(f.currency&&(m=n.parseObjectValue(f.currency,2,"currency",Gi),!m))return null;let v=null;if(f.unit&&(v=n.parseObjectValue(f.unit,2,"unit",Gi),!v))return null;let S=null;if(f["min-fraction-digits"]&&(S=n.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",kt),!S))return null;let P=null;return f["max-fraction-digits"]&&(P=n.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",kt),!P)?null:new Sd(l,u,m,v,S,P)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Uu{constructor(e){this.type=kt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${hn(l.type)} instead.`):new Uu(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Bn(`Expected value to be of type string or array, but found ${hn(xn(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Qp(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ul={"==":Yg,"!=":Kg,">":Qg,"<":Jg,">=":Td,"<=":ey,array:xs,at:xd,boolean:xs,case:wd,coalesce:Fu,collator:Mu,format:ao,image:el,in:vd,"index-of":Nu,interpolate:qr,"interpolate-hcl":qr,"interpolate-lab":qr,length:Uu,let:Bu,literal:ys,match:bd,number:xs,"number-format":Sd,object:xs,slice:Vu,step:mc,string:xs,"to-boolean":lo,"to-color":lo,"to-number":lo,"to-string":lo,var:pc,within:co,distance:Bo,config:ga};function em(o,[e,n,l,f]){e=e.evaluate(o),n=n.evaluate(o),l=l.evaluate(o);const u=f?f.evaluate(o):1,m=pa(e,n,l,u);if(m)throw new Bn(m);return new Fi(e/255*u,n/255*u,l/255*u,u)}function Md(o,[e,n,l,f]){e=e.evaluate(o),n=n.evaluate(o),l=l.evaluate(o);const u=f?f.evaluate(o):1,m=function(P,x,M,I){return typeof P=="number"&&P>=0&&P<=360?typeof x=="number"&&x>=0&&x<=100&&typeof M=="number"&&M>=0&&M<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[P,x,M,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[P,x,M,I]:[P,x,M]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[P,x,M,I]:[P,x,M]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,l,u);if(m)throw new Bn(m);const v=`hsla(${e}, ${n}%, ${l}%, ${u})`,S=Fi.parse(v);if(!S)throw new Bn(`Failed to parse HSLA color: ${v}`);return S}function Ed(o,e){return o in e}function Vo(o,e){const n=e[o];return n===void 0?null:n}function Uo(o){return{type:o}}function Ad(o){return{result:"success",value:o}}function jo(o){return{result:"error",value:o}}function yc(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function hl(o){return o["property-type"]==="data-driven"}function tm(o){return yc(o.expression,"measure-light")}function im(o){return yc(o.expression,"zoom")}function ju(o){return!!o.expression&&o.expression.interpolated}function Gu(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function ty(o){return o}function nm(o,e){const n=e.type==="color",l=o.stops&&typeof o.stops[0][0]=="object",f=l||!(l||o.property!==void 0),u=o.type||(ju(e)?"exponential":"interval");if(n&&((o=xu({},o)).stops&&(o.stops=o.stops.map(P=>[P[0],Fi.parse(P[1])])),o.default=Fi.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Yp[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let m,v,S;if(u==="exponential")m=vc;else if(u==="interval")m=sm;else if(u==="categorical"){m=rm,v=Object.create(null);for(const P of o.stops)v[P[0]]=P[1];S=typeof o.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);m=iy}if(l){const P={},x=[];for(let T=0;T<o.stops.length;T++){const A=o.stops[T],D=A[0].zoom;P[D]===void 0&&(P[D]={zoom:D,type:o.type,property:o.property,default:o.default,stops:[]},x.push(D)),P[D].stops.push([A[0].value,A[1]])}const M=[];for(const T of x)M.push([P[T].zoom,nm(P[T],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:qr.interpolationFactor.bind(void 0,I),zoomStops:M.map(T=>T[0]),evaluate:({zoom:T},A)=>vc({stops:M,base:o.base},e,T).evaluate(T,A)}}if(f){const P=u==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:qr.interpolationFactor.bind(void 0,P),zoomStops:o.stops.map(x=>x[0]),evaluate:({zoom:x})=>m(o,e,x,v,S)}}return{kind:"source",evaluate(P,x){const M=x&&x.properties?x.properties[o.property]:void 0;return M===void 0?xc(o.default,e.default):m(o,e,M,v,S)}}}function xc(o,e,n){return o!==void 0?o:e!==void 0?e:n!==void 0?n:void 0}function rm(o,e,n,l,f){return xc(typeof n===f?l[n]:void 0,o.default,e.default)}function sm(o,e,n){if(_a(n)!=="number")return xc(o.default,e.default);const l=o.stops.length;if(l===1||n<=o.stops[0][0])return o.stops[0][1];if(n>=o.stops[l-1][0])return o.stops[l-1][1];const f=Ai(o.stops.map(u=>u[0]),n);return o.stops[f][1]}function vc(o,e,n){const l=o.base!==void 0?o.base:1;if(_a(n)!=="number")return xc(o.default,e.default);const f=o.stops.length;if(f===1||n<=o.stops[0][0])return o.stops[0][1];if(n>=o.stops[f-1][0])return o.stops[f-1][1];const u=Ai(o.stops.map(x=>x[0]),n),m=function(x,M,I,T){const A=T-I,D=x-I;return A===0?0:M===1?D/A:(Math.pow(M,D)-1)/(Math.pow(M,A)-1)}(n,l,o.stops[u][0],o.stops[u+1][0]),v=o.stops[u][1],S=o.stops[u+1][1];let P=ki[e.type]||ty;if(o.colorSpace&&o.colorSpace!=="rgb"){const x=Yp[o.colorSpace];P=(M,I)=>x.reverse(x.interpolate(x.forward(M),x.forward(I),m))}return typeof v.evaluate=="function"?{evaluate(...x){const M=v.evaluate.apply(void 0,x),I=S.evaluate.apply(void 0,x);if(M!==void 0&&I!==void 0)return P(M,I,m)}}:P(v,S,m)}function iy(o,e,n){return e.type==="color"?n=Fi.parse(n):e.type==="formatted"?n=Sr.fromString(n.toString()):e.type==="resolvedImage"?n=hr.build(n.toString()):_a(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),xc(n,o.default,e.default)}Gr.register(ul,{error:[{kind:"error"},[Gi],(o,[e])=>{throw new Bn(e.evaluate(o))}],typeof:[Gi,[Ci],(o,[e])=>hn(xn(e.evaluate(o)))],"to-rgba":[Tr(kt,4),[jr],(o,[e])=>e.evaluate(o).toRenderColor(null).toArray()],"to-hsla":[Tr(kt,4),[jr],(o,[e])=>e.evaluate(o).toRenderColor(null).toHslaArray()],rgb:[jr,[kt,kt,kt],em],rgba:[jr,[kt,kt,kt,kt],em],hsl:[jr,[kt,kt,kt],Md],hsla:[jr,[kt,kt,kt,kt],Md],has:{type:Oi,overloads:[[[Gi],(o,[e])=>Ed(e.evaluate(o),o.properties())],[[Gi,da],(o,[e,n])=>Ed(e.evaluate(o),n.evaluate(o))]]},get:{type:Ci,overloads:[[[Gi],(o,[e])=>Vo(e.evaluate(o),o.properties())],[[Gi,da],(o,[e,n])=>Vo(e.evaluate(o),n.evaluate(o))]]},"feature-state":[Ci,[Gi],(o,[e])=>Vo(e.evaluate(o),o.featureState||{})],properties:[da,[],o=>o.properties()],"geometry-type":[Gi,[],o=>o.geometryType()],id:[Ci,[],o=>o.id()],zoom:[kt,[],o=>o.globals.zoom],pitch:[kt,[],o=>o.globals.pitch||0],"distance-from-center":[kt,[],o=>o.distanceFromCenter()],"measure-light":[kt,[Gi],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[kt,[],o=>o.globals.heatmapDensity||0],"line-progress":[kt,[],o=>o.globals.lineProgress||0],"raster-value":[kt,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[kt,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[kt,[],o=>o.globals.skyRadialProgress||0],accumulated:[Ci,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[kt,Uo(kt),(o,e)=>{let n=0;for(const l of e)n+=l.evaluate(o);return n}],"*":[kt,Uo(kt),(o,e)=>{let n=1;for(const l of e)n*=l.evaluate(o);return n}],"-":{type:kt,overloads:[[[kt,kt],(o,[e,n])=>e.evaluate(o)-n.evaluate(o)],[[kt],(o,[e])=>-e.evaluate(o)]]},"/":[kt,[kt,kt],(o,[e,n])=>e.evaluate(o)/n.evaluate(o)],"%":[kt,[kt,kt],(o,[e,n])=>e.evaluate(o)%n.evaluate(o)],ln2:[kt,[],()=>Math.LN2],pi:[kt,[],()=>Math.PI],e:[kt,[],()=>Math.E],"^":[kt,[kt,kt],(o,[e,n])=>Math.pow(e.evaluate(o),n.evaluate(o))],sqrt:[kt,[kt],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[kt,[kt],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[kt,[kt],(o,[e])=>Math.log(e.evaluate(o))],log2:[kt,[kt],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[kt,[kt],(o,[e])=>Math.sin(e.evaluate(o))],cos:[kt,[kt],(o,[e])=>Math.cos(e.evaluate(o))],tan:[kt,[kt],(o,[e])=>Math.tan(e.evaluate(o))],asin:[kt,[kt],(o,[e])=>Math.asin(e.evaluate(o))],acos:[kt,[kt],(o,[e])=>Math.acos(e.evaluate(o))],atan:[kt,[kt],(o,[e])=>Math.atan(e.evaluate(o))],min:[kt,Uo(kt),(o,e)=>Math.min(...e.map(n=>n.evaluate(o)))],max:[kt,Uo(kt),(o,e)=>Math.max(...e.map(n=>n.evaluate(o)))],abs:[kt,[kt],(o,[e])=>Math.abs(e.evaluate(o))],round:[kt,[kt],(o,[e])=>{const n=e.evaluate(o);return n<0?-Math.round(-n):Math.round(n)}],floor:[kt,[kt],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[kt,[kt],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[Oi,[Gi,Ci],(o,[e,n])=>o.properties()[e.value]===n.value],"filter-id-==":[Oi,[Ci],(o,[e])=>o.id()===e.value],"filter-type-==":[Oi,[Gi],(o,[e])=>o.geometryType()===e.value],"filter-<":[Oi,[Gi,Ci],(o,[e,n])=>{const l=o.properties()[e.value],f=n.value;return typeof l==typeof f&&l<f}],"filter-id-<":[Oi,[Ci],(o,[e])=>{const n=o.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[Oi,[Gi,Ci],(o,[e,n])=>{const l=o.properties()[e.value],f=n.value;return typeof l==typeof f&&l>f}],"filter-id->":[Oi,[Ci],(o,[e])=>{const n=o.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[Oi,[Gi,Ci],(o,[e,n])=>{const l=o.properties()[e.value],f=n.value;return typeof l==typeof f&&l<=f}],"filter-id-<=":[Oi,[Ci],(o,[e])=>{const n=o.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[Oi,[Gi,Ci],(o,[e,n])=>{const l=o.properties()[e.value],f=n.value;return typeof l==typeof f&&l>=f}],"filter-id->=":[Oi,[Ci],(o,[e])=>{const n=o.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[Oi,[Ci],(o,[e])=>e.value in o.properties()],"filter-has-id":[Oi,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Oi,[Tr(Gi)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[Oi,[Tr(Ci)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[Oi,[Gi,Tr(Ci)],(o,[e,n])=>n.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[Oi,[Gi,Tr(Ci)],(o,[e,n])=>function(l,f,u,m){for(;u<=m;){const v=u+m>>1;if(f[v]===l)return!0;f[v]>l?m=v-1:u=v+1}return!1}(o.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Oi,overloads:[[[Oi,Oi],(o,[e,n])=>e.evaluate(o)&&n.evaluate(o)],[Uo(Oi),(o,e)=>{for(const n of e)if(!n.evaluate(o))return!1;return!0}]]},any:{type:Oi,overloads:[[[Oi,Oi],(o,[e,n])=>e.evaluate(o)||n.evaluate(o)],[Uo(Oi),(o,e)=>{for(const n of e)if(n.evaluate(o))return!0;return!1}]]},"!":[Oi,[Oi],(o,[e])=>!e.evaluate(o)],"is-supported-script":[Oi,[Gi],(o,[e])=>{const n=o.globals&&o.globals.isSupportedScript;return!n||n(e.evaluate(o))}],upcase:[Gi,[Gi],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[Gi,[Gi],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[Gi,Uo(Ci),(o,e)=>e.map(n=>Cs(n.evaluate(o))).join("")],"resolved-locale":[Gi,[vu],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[kt,[kt,kt,Ci],(o,e)=>{const[n,l,f]=e.map(m=>m.evaluate(o));if(n>l||n===l)return n;let u;if(typeof f=="string")u=function(m){let v=0;if(m.length===0)return v;for(let S=0;S<m.length;S++)v=(v<<5)-v+m.charCodeAt(S),v|=0;return v}(f);else{if(typeof f!="number")throw new Bn(`Invalid seed input: ${f}`);u=f}return n+Qp(u)()*(l-n)}]});class Hu{constructor(e,n,l,f){this.expression=e,this._warningHistory={},this._evaluator=new Tu(l,f),this._defaultValue=n?function(u){return u.type==="color"&&(Gu(u.default)||Array.isArray(u.default))?new Fi(0,0,0,0):u.type==="color"?Fi.parse(u.default)||null:u.default===void 0?null:u.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=xa(e)}evaluateWithoutErrorHandling(e,n,l,f,u,m,v,S){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=f||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,f,u,m,v,S){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=S||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new Bn(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function Id(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in ul}function bc(o,e,n,l){const f=new dd(ul,[],e?function(m){const v={color:jr,string:Gi,number:kt,enum:Gi,boolean:Oi,formatted:oo,resolvedImage:fa};return m.type==="array"?Tr(v[m.value]||Ci,m.length):v[m.type]}(e):void 0,void 0,void 0,n,l),u=f.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Ad(new Hu(u,e,n,l)):jo(f.errors)}class qu{constructor(e,n,l,f){this.kind=e,this._styleExpression=n,this.isLightConstant=l,this.isLineProgressConstant=f,this.isStateDependent=e!=="constant"&&!ya(n.expression),this.configDependencies=xa(n.expression)}evaluateWithoutErrorHandling(e,n,l,f,u,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,f,u,m)}evaluate(e,n,l,f,u,m){return this._styleExpression.evaluate(e,n,l,f,u,m)}}class dl{constructor(e,n,l,f,u,m){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!ya(n.expression),this.isLightConstant=u,this.isLineProgressConstant=m,this.configDependencies=xa(n.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,n,l,f,u,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,f,u,m)}evaluate(e,n,l,f,u,m){return this._styleExpression.evaluate(e,n,l,f,u,m)}interpolationFactor(e,n,l){return this.interpolationType?qr.interpolationFactor(this.interpolationType,e,n,l):0}}function om(o,e,n,l){if((o=bc(o,e,n,l)).result==="error")return o;const f=o.value.expression,u=al(f);if(!u&&!hl(e))return jo([new gs("","data expressions not supported")]);const m=po(f,["zoom","pitch","distance-from-center"]);if(!m&&!im(e))return jo([new gs("","zoom expressions not supported")]);const v=po(f,["measure-light"]);if(!v&&!tm(e))return jo([new gs("","measure-light expression not supported")]);const S=po(f,["line-progress"]);if(!S&&!function(M){return yc(M.expression,"line-progress")}(e))return jo([new gs("","line-progress expression not supported")]);const P=e.expression&&e.expression.relaxZoomRestriction,x=Wu(f);return x||m||P?x instanceof gs?jo([x]):x instanceof qr&&!ju(e)?jo([new gs("",'"interpolate" expressions cannot be used with this property')]):Ad(x?new dl(u&&S?"camera":"composite",o.value,x.labels,x instanceof qr?x.interpolation:void 0,v,S):new qu(u&&S?"constant":"source",o.value,v,S)):jo([new gs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class $u{constructor(e,n){this._parameters=e,this._specification=n,xu(this,nm(this._parameters,this._specification))}static deserialize(e){return new $u(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Wu(o){let e=null;if(o instanceof Bu)e=Wu(o.result);else if(o instanceof Fu){for(const n of o.args)if(e=Wu(n),e)break}else(o instanceof mc||o instanceof qr)&&o.input instanceof Gr&&o.input.name==="zoom"&&(e=o);return e instanceof gs||o.eachChild(n=>{const l=Wu(n);l instanceof gs?e=l:e&&l&&e!==l&&(e=new gs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Zu,am,ny=function(){if(am)return Zu;am=1,Zu=e;var o=3;function e(n,l,f){var u=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var m=new Int32Array(this.arrayBuffer);n=m[0],this.d=(l=m[1])+2*(f=m[2]);for(var v=0;v<this.d*this.d;v++){var S=m[o+v],P=m[o+v+1];u.push(S===P?null:m.subarray(S,P))}var x=m[o+u.length+1];this.keys=m.subarray(m[o+u.length],x),this.bboxes=m.subarray(x),this.insert=this._insertReadonly}else{this.d=l+2*f;for(var M=0;M<this.d*this.d;M++)u.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=n,this.padding=f,this.scale=l/n,this.uid=0;var I=f/l*n;this.min=-I,this.max=n+I}return e.prototype.insert=function(n,l,f,u,m){this._forEachCell(l,f,u,m,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(u),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,l,f,u,m,v){this.cells[m].push(v)},e.prototype.query=function(n,l,f,u,m){var v=this.min,S=this.max;if(n<=v&&l<=v&&S<=f&&S<=u&&!m)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(n,l,f,u,this._queryCell,P,{},m),P},e.prototype._queryCell=function(n,l,f,u,m,v,S,P){var x=this.cells[m];if(x!==null)for(var M=this.keys,I=this.bboxes,T=0;T<x.length;T++){var A=x[T];if(S[A]===void 0){var D=4*A;(P?P(I[D+0],I[D+1],I[D+2],I[D+3]):n<=I[D+2]&&l<=I[D+3]&&f>=I[D+0]&&u>=I[D+1])?(S[A]=!0,v.push(M[A])):S[A]=!1}}},e.prototype._forEachCell=function(n,l,f,u,m,v,S,P){for(var x=this._convertToCellCoord(n),M=this._convertToCellCoord(l),I=this._convertToCellCoord(f),T=this._convertToCellCoord(u),A=x;A<=I;A++)for(var D=M;D<=T;D++){var O=this.d*D+A;if((!P||P(this._convertFromCellCoord(A),this._convertFromCellCoord(D),this._convertFromCellCoord(A+1),this._convertFromCellCoord(D+1)))&&m.call(this,n,l,f,u,O,v,S,P))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,l=o+this.cells.length+1+1,f=0,u=0;u<this.cells.length;u++)f+=this.cells[u].length;var m=new Int32Array(l+f+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var v=l,S=0;S<n.length;S++){var P=n[S];m[o+S]=v,m.set(P,v),v+=P.length}return m[o+n.length]=v,m.set(this.keys,v),m[o+n.length+1]=v+=this.keys.length,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer},Zu}(),va=R(ny);const wc={};function Ot(o,e,n={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),wc[e]={klass:o,omit:n.omit||[]}}Ot(Object,"Object"),va.serialize=function(o,e){const n=o.toArrayBuffer();return e&&e.add(n),{buffer:n}},va.deserialize=function(o){return new va(o.buffer)},Object.defineProperty(va,"name",{value:"Grid"}),Ot(va,"Grid"),typeof DOMMatrix<"u"&&Ot(DOMMatrix,"DOMMatrix"),Ot(Fi,"Color"),Ot(Error,"Error"),Ot(Sr,"Formatted"),Ot(oc,"FormattedSection"),Ot(du,"AJAXError"),Ot(hr,"ResolvedImage"),Ot($u,"StylePropertyFunction"),Ot(Hu,"StyleExpression",{omit:["_evaluator"]}),Ot(Ys,"ImageIdWithOptions"),Ot(dl,"ZoomDependentExpression"),Ot(qu,"ZoomConstantExpression"),Ot(Gr,"CompoundExpression",{omit:["_evaluate"]});for(const o in ul)wc[ul[o]._classRegistryKey]||Ot(ul[o],`Expression${o}`);function lm(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function ba(o){return self.ImageBitmap&&o instanceof ImageBitmap}function wa(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(lm(o)||ba(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const n=[];for(const l of o)n.push(wa(l,e));return n}if(o instanceof Map){const n={$name:"Map"};for(const[l,f]of o.entries())n[l]=wa(f);return n}if(o instanceof Set){const n={$name:"Set"};let l=0;for(const f of o.values())n[++l]=wa(f);return n}if(typeof o=="object"){const n=o.constructor,l=n._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${l}".`);const f=n.serialize?n.serialize(o,e):{};if(!n.serialize){for(const u in o)o.hasOwnProperty(u)&&(wc[l].omit.indexOf(u)>=0||(f[u]=wa(o[u],e)));o instanceof Error&&(f.message=o.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(f.$name=l),f}throw new Error("can't serialize object of type "+typeof o)}function Ta(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||lm(o)||ba(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(Ta);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const f=new Map;for(const u of Object.keys(o))u!=="$name"&&f.set(u,Ta(o[u]));return f}if(e==="Set"){const f=new Set;for(const u of Object.keys(o))u!=="$name"&&f.add(Ta(o[u]));return f}const{klass:n}=wc[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(o);const l=Object.create(n.prototype);for(const f of Object.keys(o))f!=="$name"&&(l[f]=Ta(o[f]));return l}throw new Error("can't deserialize object of type "+typeof o)}const Ht={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function Xu(o){for(const e of o)if(Yu(e.charCodeAt(0)))return!0;return!1}function cm(o){for(const e of o)if(!um(e.charCodeAt(0)))return!1;return!0}function um(o){return!(Ht.Arabic(o)||Ht["Arabic Supplement"](o)||Ht["Arabic Extended-A"](o)||Ht["Arabic Presentation Forms-A"](o)||Ht["Arabic Presentation Forms-B"](o))}function Yu(o){return!(o!==746&&o!==747&&(o<4352||!(Ht["Bopomofo Extended"](o)||Ht.Bopomofo(o)||Ht["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Ht["CJK Compatibility Ideographs"](o)||Ht["CJK Compatibility"](o)||Ht["CJK Radicals Supplement"](o)||Ht["CJK Strokes"](o)||!(!Ht["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Ht["CJK Unified Ideographs Extension A"](o)||Ht["CJK Unified Ideographs"](o)||Ht["Enclosed CJK Letters and Months"](o)||Ht["Hangul Compatibility Jamo"](o)||Ht["Hangul Jamo Extended-A"](o)||Ht["Hangul Jamo Extended-B"](o)||Ht["Hangul Jamo"](o)||Ht["Hangul Syllables"](o)||Ht.Hiragana(o)||Ht["Ideographic Description Characters"](o)||Ht.Kanbun(o)||Ht["Kangxi Radicals"](o)||Ht["Katakana Phonetic Extensions"](o)||Ht.Katakana(o)&&o!==12540||!(!Ht["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Ht["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Ht["Unified Canadian Aboriginal Syllabics"](o)||Ht["Unified Canadian Aboriginal Syllabics Extended"](o)||Ht["Vertical Forms"](o)||Ht["Yijing Hexagram Symbols"](o)||Ht["Yi Syllables"](o)||Ht["Yi Radicals"](o))))}function Ku(o){return!(Yu(o)||function(e){return!!(Ht["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ht["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ht["Letterlike Symbols"](e)||Ht["Number Forms"](e)||Ht["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ht["Control Pictures"](e)&&e!==9251||Ht["Optical Character Recognition"](e)||Ht["Enclosed Alphanumerics"](e)||Ht["Geometric Shapes"](e)||Ht["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ht["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ht["CJK Symbols and Punctuation"](e)||Ht.Katakana(e)||Ht["Private Use Area"](e)||Ht["CJK Compatibility Forms"](e)||Ht["Small Form Variants"](e)||Ht["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(o))}function Ju(o){return o>=1424&&o<=2303||Ht["Arabic Presentation Forms-A"](o)||Ht["Arabic Presentation Forms-B"](o)}function hm(o,e){return!(!e&&Ju(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Ht.Khmer(o))}function ry(o){for(const e of o)if(Ju(e.charCodeAt(0)))return!0;return!1}const Js="deferred",Cd="loading",Pd="loaded";let Qu=null,$r="unavailable",zs=null;const Dd=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&($r="error"),Qu&&Qu(o)};function fl(){eh.fire(new ko("pluginStateChange",{pluginStatus:$r,pluginURL:zs}))}const eh=new Ka,zd=function(){return $r},dm=function(){if($r!==Js||!zs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$r=Cd,fl(),zs&&ha({url:zs},o=>{o?Dd(o):($r=Pd,fl())})},Wr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$r===Pd||Wr.applyArabicShaping!=null,isLoading:()=>$r===Cd,setState(o){$r=o.pluginStatus,zs=o.pluginURL},isParsed:()=>Wr.applyArabicShaping!=null&&Wr.processBidirectionalText!=null&&Wr.processStyledBidirectionalText!=null,getPluginURL:()=>zs};class yn{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,l){for(const f of n)if(!hm(f.charCodeAt(0),l))return!1;return!0}(e,Wr.isLoaded())}}class Tc{constructor(e,n,l,f){this.property=e,this.value=n,this.expression=function(u,m,v,S){if(Gu(u))return new $u(u,m);if(Id(u)||Array.isArray(u)&&u.length>0){const P=om(u,m,v,S);if(P.result==="error")throw new Error(P.value.map(x=>`${x.key}: ${x.message}`).join(", "));return P.value}{let P=u;return typeof u=="string"&&m.type==="color"&&(P=Fi.parse(u)),{kind:"constant",configDependencies:new Set,evaluate:()=>P}}}(n===void 0?e.specification.default:n,e.specification,l,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,l){return this.property.possiblyEvaluate(this,e,n,l)}}class pl{constructor(e,n,l){this.property=e,this.value=new Tc(e,void 0,n,l)}transitioned(e,n){return new fm(this.property,this.value,n,Li({},e.transition,this.transition),e.now)}untransitioned(){return new fm(this.property,this.value,null,{},0)}}class Sa{constructor(e,n,l){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=l,this.configDependencies=new Set}getValue(e){return qn(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new pl(this._values[e].property,this._scope,this._options)),this._values[e].value=new Tc(this._values[e].property,n===null?void 0:qn(n),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,n){n&&(this._options=n);const l=this._properties.properties;if(e)for(const f in e){const u=e[f];if(Or(f,"-transition")){const m=f.slice(0,-11);l[m]&&this.setTransition(m,u)}else l.hasOwnProperty(f)&&this.setValue(f,u)}}getTransition(e){return qn(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new pl(this._values[e].property)),this._values[e].transition=qn(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const f=this.getTransition(n);f!==void 0&&(e[`${n}-transition`]=f)}return e}transitioned(e,n){const l=new pm(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].transitioned(e,n._values[f]);return l}untransitioned(){const e=new pm(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class fm{constructor(e,n,l,f,u){const m=f.delay||0,v=f.duration||0;u=u||0,this.property=e,this.value=n,this.begin=u+m,this.end=this.begin+v,e.specification.transition&&(f.delay||f.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const f=e.now||0,u=this.value.possiblyEvaluate(e,n,l),m=this.prior;if(m){if(f>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(f<this.begin)return m.possiblyEvaluate(e,n,l);{const v=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,n,l),u,Bt(v))}}return u}}class pm{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const f=new _l(this._properties);for(const u of Object.keys(this._values))f._values[u]=this._values[u].possiblyEvaluate(e,n,l);return f}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class sy{constructor(e,n,l){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=l,this.configDependencies=new Set}getValue(e){return qn(this._values[e].value)}setValue(e,n){this._values[e]=new Tc(this._values[e].property,n===null?void 0:qn(n),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l){const f=new _l(this._properties);for(const u of Object.keys(this._values))f._values[u]=this._values[u].possiblyEvaluate(e,n,l);return f}}class ml{constructor(e,n,l){this.property=e,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,f){return this.property.evaluate(this.value,this.parameters,e,n,l,f)}}class _l{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class dt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,l){const f=ki[this.specification.type];return f?f(e,n,l):e}}class Dt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,f){return new ml(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},l,f)}:e.expression,n)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new ml(this,{kind:"constant",value:void 0},e.parameters);const f=ki[this.specification.type];return f?new ml(this,{kind:"constant",value:f(e.value.value,n.value.value,l)},e.parameters):e}evaluate(e,n,l,f,u,m){return e.kind==="constant"?e.value:e.evaluate(n,l,f,u,m)}}class gl{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,f){return!!e.expression.evaluate(n,null,{},l,f)}interpolate(){return!1}}class Mn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new yn(0,{});for(const l in e){const f=e[l];f.specification.overridable&&this.overridableProperties.push(l);const u=this.defaultPropertyValues[l]=new Tc(f,void 0),m=this.defaultTransitionablePropertyValues[l]=new pl(f);this.defaultTransitioningPropertyValues[l]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=u.possiblyEvaluate(n)}}}Ot(Dt,"DataDrivenProperty"),Ot(dt,"DataConstantProperty"),Ot(gl,"ColorRampProperty");var je=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function mm(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function th(o){if(Array.isArray(o))return o.map(th);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const n in o)e[n]=th(o[n]);return e}return mm(o)}function Rd(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!Rd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function _m(o,e="",n=null,l="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Rd(o)||(o=Sc(o));const f=o;let u=!0;try{u=function(x){if(!yl(x))return x;let M=th(x);return ym(M),M=gm(M),M}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let m=null,v=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){v=je[`filter_${l}`];const x=bc(u,v,e,n);if(x.result==="error")throw new Error(x.value.map(M=>`${M.key}: ${M.message}`).join(", "));m=(M,I,T)=>x.value.evaluate(M,I,{},T)}let S=null,P=null;if(u!==f){const x=bc(f,v,e,n);if(x.result==="error")throw new Error(x.value.map(M=>`${M.key}: ${M.message}`).join(", "));S=(M,I,T,A,D)=>x.value.evaluate(M,I,{},T,void 0,void 0,A,D),P=!al(x.value.expression)}return{filter:m,dynamicFilter:S||void 0,needGeometry:Ld(u),needFeature:!!P}}function gm(o){if(!Array.isArray(o))return o;const e=function(n){if(oy.has(n[0])){for(let l=1;l<n.length;l++)if(yl(n[l]))return!0}return n}(o);return e===!0?e:e.map(n=>gm(n))}function ym(o){let e=!1;const n=[];if(o[0]==="case"){for(let l=1;l<o.length-1;l+=2)e=e||yl(o[l]),n.push(o[l+1]);n.push(o[o.length-1])}else if(o[0]==="match"){e=e||yl(o[1]);for(let l=2;l<o.length-1;l+=2)n.push(o[l+1]);n.push(o[o.length-1])}else if(o[0]==="step"){e=e||yl(o[1]);for(let l=1;l<o.length-1;l+=2)n.push(o[l+1])}e&&(o.length=0,o.push("any",...n));for(let l=1;l<o.length;l++)ym(o[l])}function yl(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<o.length;n++)if(yl(o[n]))return!0;return!1}const oy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function xl(o,e){return o<e?-1:o>e?1:0}function Ld(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(Ld(o[e]))return!0;return!1}function Sc(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?vl(o[1],o[2],"=="):e==="!="?Rs(vl(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?vl(o[1],o[2],e):e==="any"?(n=o.slice(1),["any"].concat(n.map(Sc))):e==="all"?["all"].concat(o.slice(1).map(Sc)):e==="none"?["all"].concat(o.slice(1).map(Sc).map(Rs)):e==="in"?xm(o[1],o.slice(2)):e==="!in"?Rs(xm(o[1],o.slice(2))):e==="has"?vm(o[1]):e!=="!has"||Rs(vm(o[1]));var n}function vl(o,e,n){switch(o){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,o,e]}}function xm(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",o,["literal",e.sort(xl)]]:["filter-in-small",o,["literal",e]]}}function vm(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Rs(o){return["!",o]}const Mc="";function Br(o,e){return e?`${o}${Mc}${e}`:o}const bm="-transition",ay=new Set(["fill","line","background","hillshade","raster"]);class Nr extends Ka{constructor(e,n,l,f,u){if(super(),this.id=e.id,this.fqid=Br(this.id,l),this.type=e.type,this.scope=l,this.lut=f,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const m=bc(this.filter,je[`filter_${e.type}`]);m.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...m.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new sy(n.layout,this.scope,u),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),n.paint){this._transitionablePaint=new Sa(n.paint,this.scope,u);for(const m in e.paint)this.setPaintProperty(m,e.paint[m]);for(const m in e.layout)this.setLayoutProperty(m,e.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _l(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&ay.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return Or(e,bm)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){const l=this._transitionablePaint,f=l._properties.properties;if(Or(e,bm)){const M=e.slice(0,-11);return f[M]&&l.setTransition(M,n||void 0),!1}if(!f[e])return!1;const u=l._values[e],m=u.value.isDataDriven(),v=u.value;l.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const S=l._values[e].value,P=S.isDataDriven(),x=Or(e,"pattern")||e==="line-dasharray";return P||m||x||this._handleOverridablePaintPropertyUpdate(e,v,S)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,l){return null}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return cr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof ml&&hl(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=_m(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,l,f,u,m,v,S,P){}}const ly={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ec{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ni(o,e=1){let n=0,l=0;return{members:o.map(f=>{const u=ly[f.type].BYTES_PER_ELEMENT,m=n=Ac(n,Math.max(e,u)),v=f.components||1;return l=Math.max(l,u),n+=u*v,{name:f.name,type:f.type,components:v,offset:m}}),size:Ac(n,Math.max(l,e)),alignment:e}}function Ac(o,e){return Math.ceil(o/e)*e}class mo extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const f=2*e;return this.int16[f+0]=n,this.int16[f+1]=l,e}}mo.prototype.bytesPerElement=4,Ot(mo,"StructArrayLayout2i4");class bl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l)}emplace(e,n,l,f){const u=3*e;return this.int16[u+0]=n,this.int16[u+1]=l,this.int16[u+2]=f,e}}bl.prototype.bytesPerElement=6,Ot(bl,"StructArrayLayout3i6");class wl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l,f)}emplace(e,n,l,f,u){const m=4*e;return this.int16[m+0]=n,this.int16[m+1]=l,this.int16[m+2]=f,this.int16[m+3]=u,e}}wl.prototype.bytesPerElement=8,Ot(wl,"StructArrayLayout4i8");class vs extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,f,u)}emplace(e,n,l,f,u,m){const v=5*e;return this.int16[v+0]=n,this.int16[v+1]=l,this.int16[v+2]=f,this.int16[v+3]=u,this.int16[v+4]=m,e}}vs.prototype.bytesPerElement=10,Ot(vs,"StructArrayLayout5i10");class kd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,l,f,u,m,v)}emplace(e,n,l,f,u,m,v,S){const P=6*e,x=12*e,M=3*e;return this.int16[P+0]=n,this.int16[P+1]=l,this.uint8[x+4]=f,this.uint8[x+5]=u,this.uint8[x+6]=m,this.uint8[x+7]=v,this.float32[M+2]=S,e}}kd.prototype.bytesPerElement=12,Ot(kd,"StructArrayLayout2i4ub1f12");class _o extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l,f)}emplace(e,n,l,f,u){const m=4*e;return this.float32[m+0]=n,this.float32[m+1]=l,this.float32[m+2]=f,this.float32[m+3]=u,e}}_o.prototype.bytesPerElement=16,Ot(_o,"StructArrayLayout4f16");class Go extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l)}emplace(e,n,l,f){const u=3*e;return this.float32[u+0]=n,this.float32[u+1]=l,this.float32[u+2]=f,e}}Go.prototype.bytesPerElement=12,Ot(Go,"StructArrayLayout3f12");class Ho extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,f,u)}emplace(e,n,l,f,u,m){const v=6*e,S=3*e;return this.uint16[v+0]=n,this.uint16[v+1]=l,this.uint16[v+2]=f,this.uint16[v+3]=u,this.float32[S+2]=m,e}}Ho.prototype.bytesPerElement=12,Ot(Ho,"StructArrayLayout4ui1f12");class ih extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,f){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l,f)}emplace(e,n,l,f,u){const m=4*e;return this.uint16[m+0]=n,this.uint16[m+1]=l,this.uint16[m+2]=f,this.uint16[m+3]=u,e}}ih.prototype.bytesPerElement=8,Ot(ih,"StructArrayLayout4ui8");class nh extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,l,f,u,m)}emplace(e,n,l,f,u,m,v){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.int16[S+2]=f,this.int16[S+3]=u,this.int16[S+4]=m,this.int16[S+5]=v,e}}nh.prototype.bytesPerElement=12,Ot(nh,"StructArrayLayout6i12");class Od extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v,S,P,x,M,I){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,f,u,m,v,S,P,x,M,I)}emplace(e,n,l,f,u,m,v,S,P,x,M,I,T){const A=12*e;return this.int16[A+0]=n,this.int16[A+1]=l,this.int16[A+2]=f,this.int16[A+3]=u,this.uint16[A+4]=m,this.uint16[A+5]=v,this.uint16[A+6]=S,this.uint16[A+7]=P,this.int16[A+8]=x,this.int16[A+9]=M,this.int16[A+10]=I,this.int16[A+11]=T,e}}Od.prototype.bytesPerElement=24,Ot(Od,"StructArrayLayout4i4ui4i24");class Fd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,l,f,u,m)}emplace(e,n,l,f,u,m,v){const S=10*e,P=5*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.int16[S+2]=f,this.float32[P+2]=u,this.float32[P+3]=m,this.float32[P+4]=v,e}}Fd.prototype.bytesPerElement=20,Ot(Fd,"StructArrayLayout3i3f20");class Bd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Bd.prototype.bytesPerElement=4,Ot(Bd,"StructArrayLayout1ul4");class qo extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const f=2*e;return this.uint16[f+0]=n,this.uint16[f+1]=l,e}}qo.prototype.bytesPerElement=4,Ot(qo,"StructArrayLayout2ui4");class Nd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v,S,P,x,M,I,T){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,l,f,u,m,v,S,P,x,M,I,T)}emplace(e,n,l,f,u,m,v,S,P,x,M,I,T,A){const D=20*e,O=10*e;return this.int16[D+0]=n,this.int16[D+1]=l,this.int16[D+2]=f,this.int16[D+3]=u,this.int16[D+4]=m,this.float32[O+3]=v,this.float32[O+4]=S,this.float32[O+5]=P,this.float32[O+6]=x,this.int16[D+14]=M,this.uint32[O+8]=I,this.uint16[D+18]=T,this.uint16[D+19]=A,e}}Nd.prototype.bytesPerElement=40,Ot(Nd,"StructArrayLayout5i4f1i1ul2ui40");class Ic extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,l,f,u,m,v)}emplace(e,n,l,f,u,m,v,S){const P=8*e;return this.int16[P+0]=n,this.int16[P+1]=l,this.int16[P+2]=f,this.int16[P+4]=u,this.int16[P+5]=m,this.int16[P+6]=v,this.int16[P+7]=S,e}}Ic.prototype.bytesPerElement=16,Ot(Ic,"StructArrayLayout3i2i2i16");class Vd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,f,u)}emplace(e,n,l,f,u,m){const v=4*e,S=8*e;return this.float32[v+0]=n,this.float32[v+1]=l,this.float32[v+2]=f,this.int16[S+6]=u,this.int16[S+7]=m,e}}Vd.prototype.bytesPerElement=16,Ot(Vd,"StructArrayLayout2f1f2i16");class Ud extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,l,f,u,m)}emplace(e,n,l,f,u,m,v){const S=20*e,P=5*e;return this.uint8[S+0]=n,this.uint8[S+1]=l,this.float32[P+1]=f,this.float32[P+2]=u,this.float32[P+3]=m,this.float32[P+4]=v,e}}Ud.prototype.bytesPerElement=20,Ot(Ud,"StructArrayLayout2ub4f20");class vr extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l)}emplace(e,n,l,f){const u=3*e;return this.uint16[u+0]=n,this.uint16[u+1]=l,this.uint16[u+2]=f,e}}vr.prototype.bytesPerElement=6,Ot(vr,"StructArrayLayout3ui6");class rh extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O,F,H,q,U,$){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O,F,H,q,U,$)}emplace(e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O,F,H,q,U,$,Z){const K=30*e,ae=15*e,oe=60*e;return this.int16[K+0]=n,this.int16[K+1]=l,this.int16[K+2]=f,this.float32[ae+2]=u,this.float32[ae+3]=m,this.uint16[K+8]=v,this.uint16[K+9]=S,this.uint32[ae+5]=P,this.uint32[ae+6]=x,this.uint32[ae+7]=M,this.uint16[K+16]=I,this.uint16[K+17]=T,this.uint16[K+18]=A,this.float32[ae+10]=D,this.float32[ae+11]=O,this.uint8[oe+48]=F,this.uint8[oe+49]=H,this.uint8[oe+50]=q,this.uint32[ae+13]=U,this.int16[K+28]=$,this.uint8[oe+58]=Z,e}}rh.prototype.bytesPerElement=60,Ot(rh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class sh extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O,F,H,q,U,$,Z,K,ae,oe,se,ye,ce,ve,Se,we,Ce){const ze=this.length;return this.resize(ze+1),this.emplace(ze,e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O,F,H,q,U,$,Z,K,ae,oe,se,ye,ce,ve,Se,we,Ce)}emplace(e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O,F,H,q,U,$,Z,K,ae,oe,se,ye,ce,ve,Se,we,Ce,ze){const Oe=20*e,Pe=40*e,Xe=80*e;return this.float32[Oe+0]=n,this.float32[Oe+1]=l,this.int16[Pe+4]=f,this.int16[Pe+5]=u,this.int16[Pe+6]=m,this.int16[Pe+7]=v,this.int16[Pe+8]=S,this.int16[Pe+9]=P,this.int16[Pe+10]=x,this.int16[Pe+11]=M,this.int16[Pe+12]=I,this.uint16[Pe+13]=T,this.uint16[Pe+14]=A,this.uint16[Pe+15]=D,this.uint16[Pe+16]=O,this.uint16[Pe+17]=F,this.uint16[Pe+18]=H,this.uint16[Pe+19]=q,this.uint16[Pe+20]=U,this.uint16[Pe+21]=$,this.uint16[Pe+22]=Z,this.uint16[Pe+23]=K,this.uint16[Pe+24]=ae,this.uint16[Pe+25]=oe,this.uint16[Pe+26]=se,this.uint16[Pe+27]=ye,this.uint32[Oe+14]=ce,this.float32[Oe+15]=ve,this.float32[Oe+16]=Se,this.float32[Oe+17]=we,this.float32[Oe+18]=Ce,this.uint8[Xe+76]=ze,e}}sh.prototype.bytesPerElement=80,Ot(sh,"StructArrayLayout2f9i15ui1ul4f1ub80");class bs extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}bs.prototype.bytesPerElement=4,Ot(bs,"StructArrayLayout1f4");class $o extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,f,u)}emplace(e,n,l,f,u,m){const v=5*e;return this.float32[v+0]=n,this.float32[v+1]=l,this.float32[v+2]=f,this.float32[v+3]=u,this.float32[v+4]=m,e}}$o.prototype.bytesPerElement=20,Ot($o,"StructArrayLayout5f20");class jd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,l,f,u,m,v)}emplace(e,n,l,f,u,m,v,S){const P=7*e;return this.float32[P+0]=n,this.float32[P+1]=l,this.float32[P+2]=f,this.float32[P+3]=u,this.float32[P+4]=m,this.float32[P+5]=v,this.float32[P+6]=S,e}}jd.prototype.bytesPerElement=28,Ot(jd,"StructArrayLayout7f28");class Gd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v,S,P,x,M){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,l,f,u,m,v,S,P,x,M)}emplace(e,n,l,f,u,m,v,S,P,x,M,I){const T=11*e;return this.float32[T+0]=n,this.float32[T+1]=l,this.float32[T+2]=f,this.float32[T+3]=u,this.float32[T+4]=m,this.float32[T+5]=v,this.float32[T+6]=S,this.float32[T+7]=P,this.float32[T+8]=x,this.float32[T+9]=M,this.float32[T+10]=I,e}}Gd.prototype.bytesPerElement=44,Ot(Gd,"StructArrayLayout11f44");class Hd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v,S,P){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,l,f,u,m,v,S,P)}emplace(e,n,l,f,u,m,v,S,P,x){const M=9*e;return this.float32[M+0]=n,this.float32[M+1]=l,this.float32[M+2]=f,this.float32[M+3]=u,this.float32[M+4]=m,this.float32[M+5]=v,this.float32[M+6]=S,this.float32[M+7]=P,this.float32[M+8]=x,e}}Hd.prototype.bytesPerElement=36,Ot(Hd,"StructArrayLayout9f36");class go extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const f=2*e;return this.float32[f+0]=n,this.float32[f+1]=l,e}}go.prototype.bytesPerElement=8,Ot(go,"StructArrayLayout2f8");class oh extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,f){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,l,f)}emplace(e,n,l,f,u){const m=6*e;return this.uint32[3*e+0]=n,this.uint16[m+2]=l,this.uint16[m+3]=f,this.uint16[m+4]=u,e}}oh.prototype.bytesPerElement=12,Ot(oh,"StructArrayLayout1ul3ui12");class qd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}qd.prototype.bytesPerElement=2,Ot(qd,"StructArrayLayout1ui2");class ah extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O)}emplace(e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O,F){const H=16*e;return this.float32[H+0]=n,this.float32[H+1]=l,this.float32[H+2]=f,this.float32[H+3]=u,this.float32[H+4]=m,this.float32[H+5]=v,this.float32[H+6]=S,this.float32[H+7]=P,this.float32[H+8]=x,this.float32[H+9]=M,this.float32[H+10]=I,this.float32[H+11]=T,this.float32[H+12]=A,this.float32[H+13]=D,this.float32[H+14]=O,this.float32[H+15]=F,e}}ah.prototype.bytesPerElement=64,Ot(ah,"StructArrayLayout16f64");class lh extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,u,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,l,f,u,m,v)}emplace(e,n,l,f,u,m,v,S){const P=10*e,x=5*e;return this.uint16[P+0]=n,this.uint16[P+1]=l,this.uint16[P+2]=f,this.uint16[P+3]=u,this.float32[x+2]=m,this.float32[x+3]=v,this.float32[x+4]=S,e}}lh.prototype.bytesPerElement=20,Ot(lh,"StructArrayLayout4ui3f20");class ch extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}ch.prototype.bytesPerElement=2,Ot(ch,"StructArrayLayout1i2");class Tl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Tl.prototype.bytesPerElement=1,Ot(Tl,"StructArrayLayout1ub1");class wm extends Ec{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wm.prototype.size=40;class Tm extends Nd{get(e){return new wm(this,e)}}Ot(Tm,"CollisionBoxArray");class Sm extends Ec{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Sm.prototype.size=60;class Mm extends rh{get(e){return new Sm(this,e)}}Ot(Mm,"PlacedSymbolArray");class Em extends Ec{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Em.prototype.size=80;class Cc extends sh{get(e){return new Em(this,e)}}Ot(Cc,"SymbolInstanceArray");class Pc extends bs{getoffsetX(e){return this.float32[1*e+0]}}Ot(Pc,"GlyphOffsetArray");class Zr extends mo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ot(Zr,"SymbolLineVertexArray");class Dc extends Ec{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Dc.prototype.size=12;class Am extends oh{get(e){return new Dc(this,e)}}Ot(Am,"FeatureIndexArray");class Im extends qo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ot(Im,"FillExtrusionCentroidArray");class Cm extends Ec{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Cm.prototype.size=6;class Pm extends bl{get(e){return new Cm(this,e)}}Ot(Pm,"FillExtrusionWallArray");const $d=Ni([{name:"a_pos",components:2,type:"Int16"}],4),cy=Ni([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class En{constructor(e=[]){this.segments=e}_prepareSegment(e,n,l,f){let u=this.segments[this.segments.length-1];return e>En.MAX_VERTEX_ARRAY_LENGTH&&Ti(`Max vertices per segment is ${En.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>En.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==f)&&(u={vertexOffset:n,primitiveOffset:l,vertexLength:0,primitiveLength:0},f!==void 0&&(u.sortKey=f),this.segments.push(u)),u}prepareSegment(e,n,l,f){return this._prepareSegment(e,n.length,l.length,f)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,f){return new En([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:f,vaos:{},sortKey:0}])}}function Dm(o,e){return 256*(o=At(Math.floor(o),0,255))+At(Math.floor(e),0,255)}En.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot(En,"SegmentVector");const uy=Ni([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Wd=Ni([{name:"a_dash",components:4,type:"Uint16"}]);class zc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,l,f){this.ids.push(Zd(e)),this.positions.push(n,l,f)}eachPosition(e,n){const l=Zd(e);let f=0,u=this.ids.length-1;for(;f<u;){const m=f+u>>1;this.ids[m]>=l?u=m:f=m+1}for(;this.ids[f]===l;)n(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(e,n){const l=new Float64Array(e.ids),f=new Uint32Array(e.positions);return uh(l,f,0,l.length-1),n&&(n.add(l.buffer),n.add(f.buffer)),{ids:l,positions:f}}static deserialize(e){const n=new zc;let l;n.ids=e.ids,n.positions=e.positions;for(const f of n.ids)f!==l&&n.uniqueIds.push(f),l=f;return n.indexed=!0,n}}function Zd(o){const e=+o;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:rc(String(o))}function uh(o,e,n,l){for(;n<l;){const f=o[n+l>>1];let u=n-1,m=l+1;for(;;){do u++;while(o[u]<f);do m--;while(o[m]>f);if(u>=m)break;hh(o,u,m),hh(e,3*u,3*m),hh(e,3*u+1,3*m+1),hh(e,3*u+2,3*m+2)}m-n<l-m?(uh(o,e,n,m),n=m+1):(uh(o,e,m+1,l),l=m)}}function hh(o,e,n){const l=o[e];o[e]=o[n],o[n]=l}Ot(zc,"FeaturePositionMap");class Ls{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ma extends Ls{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class kn extends Ls{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Qs extends Ls{constructor(e){super(e),this.current=[0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class dh extends Ls{constructor(e){super(e),this.current=[0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class fh extends Ls{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class ph extends Ls{constructor(e){super(e),this.current=Fi.transparent.toRenderColor(null)}set(e,n,l){this.fetchUniformLocation(e,n)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const hy=new Float32Array(16);class Rc extends Ls{constructor(e){super(e),this.current=hy}set(e,n,l){if(this.fetchUniformLocation(e,n)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let f=1;f<16;f++)if(l[f]!==this.current[f]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const dy=new Float32Array(9),fy=new Float32Array(4);class mh extends Ls{constructor(e){super(e),this.current=fy}set(e,n,l){if(this.fetchUniformLocation(e,n)){for(let f=0;f<4;f++)if(l[f]!==this.current[f]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function Xd(o){return[Dm(255*o.r,255*o.g),Dm(255*o.b,255*o.a)]}class Sl{constructor(e,n,l,f){this.value=e,this.uniformNames=n.map(u=>`u_${u}`),this.type=l,this.context=f}setUniform(e,n,l,f,u){const m=f.constantOr(this.value);n.set(e,u,m instanceof Fi?m.toRenderColor(this.ignoreLut?null:this.context.lut):m)}getBinding(e,n){return this.type==="color"?new ph(e):new kn(e)}}class Ml{constructor(e,n){this.uniformNames=n.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,l,f,u){const m=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;m&&n.set(e,u,m)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new fh(e):new kn(e)}}class yo{constructor(e,n,l,f){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map(u=>({name:`a_${u}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,n,l,f,u,m,v){const S=this.paintVertexArray.length,P=this.expression.evaluate(new yn(0,{brightness:m}),n,{},u,f,v);this.paintVertexArray.resize(e),this._setPaintValue(S,e,P,this.context)}updatePaintArray(e,n,l,f,u,m,v){const S=this.expression.evaluate({zoom:0,brightness:v},l,f,void 0,u);this._setPaintValue(e,n,S,this.context)}_setPaintValue(e,n,l,f){if(this.type==="color"){const u=Xd(l.toRenderColor(this.ignoreLut?null:f.lut));for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ks{constructor(e,n,l,f,u,m){this.expression=e,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=f,this.context=u,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,n,l,f,u,m,v){const S=this.expression.evaluate(new yn(this.context.zoom,{brightness:m}),n,{},u,f,v),P=this.expression.evaluate(new yn(this.context.zoom+1,{brightness:m}),n,{},u,f,v),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,S,P,this.context)}updatePaintArray(e,n,l,f,u,m,v){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:v},l,f,void 0,u),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},l,f,void 0,u);this._setPaintValue(e,n,S,P,this.context)}_setPaintValue(e,n,l,f,u){if(this.type==="color"){const m=Xd(l.toRenderColor(this.ignoreLut?null:u.lut)),v=Xd(l.toRenderColor(this.ignoreLut?null:u.lut));for(let S=e;S<n;S++)this.paintVertexArray.emplace(S,m[0],m[1],v[0],v[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,l,f);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,l,f,u){const m=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,v=At(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);n.set(e,u,v)}getBinding(e,n){return new kn(e)}}class Wo{constructor(e,n,l,f,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(l==="array"?Wd:uy).members;for(let m=0;m<n.length;++m);this.paintVertexArray=new f}populatePaintArray(e,n,l,f){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],l)}updatePaintArray(e,n,l,f,u,m,v){this._setPaintValues(e,n,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(e,n,l,f){if(!f||!l)return;const u=f[l];if(!u)return;const{tl:m,br:v,pixelRatio:S}=u;for(let P=e;P<n;P++)this.paintVertexArray.emplace(P,m[0],m[1],v[0],v[1],S)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ea{constructor(e,n,l=()=>!0){this.binders={},this._buffers=[],this.context=n;const f=[];for(const u in e.paint._values){const m=e.paint.get(u),v=e.paint.get(`${u}-use-theme`);if(u.endsWith("-use-theme")||!l(u)||!(m instanceof ml&&hl(m.property.specification)))continue;const S=py(u,e.type),P=m.value,x=m.property.specification.type,M=!!m.property.useIntegerZoom,I=u==="line-dasharray"||u.endsWith("pattern"),T=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(P.kind!=="constant"||T)if(P.kind==="source"||T||I){const A=zm(u,x,"source");this.binders[u]=I?new Wo(P,S,x,A,e.id):new yo(P,S,x,A),f.push(`/a_${u}`)}else{const A=zm(u,x,"composite");this.binders[u]=new ks(P,S,x,M,n,A),f.push(`/z_${u}`)}else this.binders[u]=I?new Ml(P.value,S):new Sl(P.value,S,x,n),f.push(`/u_${u}`);v&&(this.binders[u].ignoreLut=v.constantOr("default")==="none",this.binders[u].checkUseTheme=!0)}this.cacheKey=f.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof yo||n instanceof ks?n.maxValue:0}populatePaintArrays(e,n,l,f,u,m,v){for(const S in this.binders){const P=this.binders[S];P.context=this.context,(P instanceof yo||P instanceof ks||P instanceof Wo)&&P.populatePaintArray(e,n,l,f,u,m,v)}}setConstantPatternPositions(e){for(const n in this.binders){const l=this.binders[n];l instanceof Ml&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,n,l,f,u,m,v,S,P){let x=!1;const M=Object.keys(e),I=M.length!==0&&!S,T=I?M:n.uniqueIds;this.context.lut=u.lut;for(const A in this.binders){const D=this.binders[A];if(D.context=this.context,(D instanceof yo||D instanceof ks||D instanceof Wo)&&(D.expression.isStateDependent===!0||D.expression.isLightConstant===!1)){const O=u.paint.get(A);D.expression=O.value;for(const F of T){const H=e[F.toString()];n.eachPosition(F,(q,U,$)=>{const Z=f.feature(q);D.updatePaintArray(U,$,Z,H,m,v,P)})}if(!I)for(const F of l.uniqueIds){const H=e[F.toString()];l.eachPosition(F,(q,U,$)=>{const Z=f.feature(q);D.updatePaintArray(U,$,Z,H,m,v,P)})}x=!0}}return x}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof Sl||l instanceof Ml)&&e.push(...l.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof yo||l instanceof ks||l instanceof Wo)for(let f=0;f<l.paintVertexAttributes.length;f++)e.push(l.paintVertexAttributes[f].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Sl||l instanceof Ml||l instanceof ks)for(const f of l.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof Sl||f instanceof Ml||f instanceof ks)for(const u of f.uniformNames)n.push({name:u,property:l,binding:f.getBinding(e,u)})}return n}setUniforms(e,n,l,f,u){for(const{name:m,property:v,binding:S}of l){if(this.binders[v].checkUseTheme&&this.binders[v]instanceof Sl){const P=f.get(`${v}-use-theme`);P.isConstant()&&(this.binders[v].ignoreLut=P.constantOr("default")==="none")}this.binders[v].setUniform(e,S,u,f.get(v),m)}}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof yo||n instanceof ks||n instanceof Wo)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof yo||l instanceof ks||l instanceof Wo)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof yo||n instanceof ks||n instanceof Wo)&&n.destroy()}}}class Zo{constructor(e,n,l=()=>!0){this.programConfigurations={};for(const f of e)this.programConfigurations[f.id]=new Ea(f,n,l);this.needsUpload=!1,this._featureMap=new zc,this._featureMapWithoutIds=new zc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,l,f,u,m,v,S){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(e,n,f,u,m,v,S);n.id!==void 0?this._featureMap.add(n.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,f,u,m,v){for(const S of l)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,S,f,u,m,v||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const _h={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function py(o,e){return _h[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const my={"line-pattern":{source:Ho,composite:Ho},"fill-pattern":{source:Ho,composite:Ho},"fill-extrusion-pattern":{source:Ho,composite:Ho},"line-dasharray":{source:ih,composite:ih}},gh={color:{source:go,composite:_o},number:{source:bs,composite:go}};function zm(o,e,n){const l=my[o];return l&&l[n]||gh[e][n]}Ot(Sl,"ConstantBinder"),Ot(Ml,"PatternConstantBinder"),Ot(yo,"SourceExpressionBinder"),Ot(Wo,"PatternCompositeBinder"),Ot(ks,"CompositeExpressionBinder"),Ot(Ea,"ProgramConfiguration",{omit:["_buffers"]}),Ot(Zo,"ProgramConfigurationSet");const Mr=vt/Math.PI/2,Yd=5,Kd=6,Rm=16383,Aa=64,Jd=[Aa,32,16],ws=-Mr,Ts=Mr;function Ia(o,e,n,l=Mr){return n=xt(n),[o*Math.sin(n)*l,-e*l,o*Math.cos(n)*l]}function Ca(o,e,n){return Ia(Math.cos(xt(o)),Math.sin(xt(o)),e,n)}const El=63710088e-1,Qd=2*Math.PI*El;class Bi{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Bi(Ui(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,f=e.lat*n,u=Math.sin(l)*Math.sin(f)+Math.cos(l)*Math.cos(f)*Math.cos((e.lng-this.lng)*n);return El*Math.acos(Math.min(u,1))}toBounds(e=0){const n=360*e/40075017,l=n/Math.cos(Math.PI/180*this.lat);return new Xo({lng:this.lng-l,lat:this.lat-n},{lng:this.lng+l,lat:this.lat+n})}toEcef(e){return Ca(this.lat,this.lng,Mr+e*Mr/El)}static convert(e){if(e instanceof Bi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Bi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Bi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Xo{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){const l=e;this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]])}else{const l=e;this.setSouthWest(l[0]).setNorthEast(l[1])}}setNorthEast(e){return this._ne=e instanceof Bi?new Bi(e.lng,e.lat):Bi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Bi?new Bi(e.lng,e.lat):Bi.convert(e),this}extend(e){const n=this._sw,l=this._ne;let f,u;if(e instanceof Bi)f=e,u=e;else{if(!(e instanceof Xo))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Xo.convert(e)):this.extend(Bi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Bi.convert(e)):this;if(f=e._sw,u=e._ne,!f||!u)return this}return n||l?(n.lng=Math.min(f.lng,n.lng),n.lat=Math.min(f.lat,n.lat),l.lng=Math.max(u.lng,l.lng),l.lat=Math.max(u.lat,l.lat)):(this._sw=new Bi(f.lng,f.lat),this._ne=new Bi(u.lng,u.lat)),this}getCenter(){return new Bi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Bi(this.getWest(),this.getNorth())}getSouthEast(){return new Bi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:l}=Bi.convert(e);let f=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&f}static convert(e){if(e)return e instanceof Xo?e:new Xo(e)}}const Lm=0,ef=25.5;function Lc(o){return Qd*Math.cos(o*Math.PI/180)}function Yo(o){return(180+o)/360}function xo(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function zr(o,e){return o/Lc(e)}function Xr(o){return 360*o-180}function mr(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function tf(o,e){return o*Lc(mr(e))}const Yr=85.051129;function h(o){return Math.cos(xt(At(o,-85.051129,Yr)))}function t(o,e){const n=At(e,Lm,ef),l=Math.pow(2,n);return h(o)*Qd/(512*l)}function s(o){return 1/Math.cos(o*Math.PI/180)}function d(o,e=0){const n=Math.exp(Math.PI*(1-(o.y+e/vt)/(1<<o.z)*2));return 80150034*n/(n*n+1)/vt/(1<<o.z)}class _{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=Bi.convert(e);return new _(Yo(l.lng),xo(l.lat),zr(n,l.lat))}toLngLat(){return new Bi(Xr(this.x),mr(this.y))}toAltitude(){return tf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Qd*s(mr(this.y))}}function y(o,e,n,l,f,u,m,v,S){const P=(e+l)/2,x=(n+f)/2,M=new Ae(P,x);v(M),function(I,T,A,D,O,F){const H=A-O,q=D-F;return Math.abs((D-T)*H-(A-I)*q)/Math.hypot(H,q)}(M.x,M.y,u.x,u.y,m.x,m.y)>=S?(y(o,e,n,P,x,u,M,v,S),y(o,P,x,l,f,M,m,v,S)):o.push(m)}function w(o,e,n){let l=o[0],f=l.x,u=l.y;e(l);const m=[l];for(let v=1;v<o.length;v++){const S=o[v],{x:P,y:x}=S;e(S),y(m,f,u,P,x,l,S,e,n),f=P,u=x,l=S}return m}function C(o,e,n,l){if(l(e,n)){const f=e.add(n)._mult(.5);C(o,e,f,l),C(o,f,n,l)}else o.push(n)}function z(o,e){let n=o[0];const l=[n];for(let f=1;f<o.length;f++){const u=o[f];C(l,n,u,e),n=u}return l}const L=Math.pow(2,14)-1,k=-L-1;function N(o,e){const n=Math.round(o.x*e),l=Math.round(o.y*e);return o.x=At(n,k,L),o.y=At(l,k,L),(n<o.x||n>o.x+1||l<o.y||l>o.y+1)&&Ti("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function B(o,e,n){const l=o.loadGeometry(),f=o.extent,u=vt/f;if(e&&n&&n.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:v,x:S,y:P,projection:x}=n,M=I=>{const T=Xr((e.x+I.x/f)/m),A=mr((e.y+I.y/f)/m),D=x.project(T,A);I.x=(D.x*v-S)*f,I.y=(D.y*v-P)*f};for(let I=0;I<l.length;I++)if(o.type!==1)l[I]=w(l[I],M,1);else{const T=[];for(const A of l[I])A.x<0||A.x>=f||A.y<0||A.y>=f||(M(A),T.push(A));l[I]=T}}for(const m of l)for(const v of m)N(v,u);return l}function G(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?B(o):[]}}function Y(o,e,n,l,f){o.emplaceBack(2*e+(l+1)/2,2*n+(f+1)/2)}function X(o,e,n){o.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class J{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new mo,this.indexArray=new vr,this.segments=new En,this.programConfigurations=new Zo(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,l,f){const u=this.layers[0],m=[];let v=null;u.type==="circle"&&(v=u.layout.get("circle-sort-key"));for(const{feature:P,id:x,index:M,sourceLayerIndex:I}of e){const T=this.layers[0]._featureFilter.needGeometry,A=G(P,T);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),A,l))continue;const D=v?v.evaluate(A,{},l):void 0,O={id:x,properties:P.properties,type:P.type,sourceLayerIndex:I,index:M,geometry:T?A.geometry:B(P,l,f),patterns:{},sortKey:D};m.push(O)}v&&m.sort((P,x)=>P.sortKey-x.sortKey);let S=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new nh,S=f.projection);for(const P of m){const{geometry:x,index:M,sourceLayerIndex:I}=P,T=e[M].feature;this.addFeature(P,x,M,n.availableImages,l,S,n.brightness),n.featureIndex.insert(T,x,M,I,this.index)}}update(e,n,l,f,u,m,v){this.programConfigurations.updatePaintArrays(e,n,u,l,f,m,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$d.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,cy.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,l,f,u,m,v){for(const S of n)for(const P of S){const x=P.x,M=P.y;if(x<0||x>=vt||M<0||M>=vt)continue;if(m){const A=m.projectTilePoint(x,M,u),D=m.upVector(u,x,M),O=this.globeExtVertexArray;X(O,A,D),X(O,A,D),X(O,A,D),X(O,A,D)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),T=I.vertexLength;Y(this.layoutVertexArray,x,M,-1,-1),Y(this.layoutVertexArray,x,M,1,-1),Y(this.layoutVertexArray,x,M,1,1),Y(this.layoutVertexArray,x,M,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+2,T+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},f,u,v)}}function Q(o,e){for(let n=0;n<o.length;n++)if(Ie(e,o[n]))return!0;for(let n=0;n<e.length;n++)if(Ie(o,e[n]))return!0;return!!_e(o,e)}function re(o,e,n){return!!Ie(o,e)||!!pe(e,o,n)}function ue(o,e){if(o.length===1)return be(e,o[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let f=0;f<l.length;f++)if(Ie(o,l[f]))return!0}for(let n=0;n<o.length;n++)if(be(e,o[n]))return!0;for(let n=0;n<e.length;n++)if(_e(o,e[n]))return!0;return!1}function le(o,e,n){if(o.length>1){if(_e(o,e))return!0;for(let l=0;l<e.length;l++)if(pe(e[l],o,n))return!0}for(let l=0;l<o.length;l++)if(pe(o[l],e,n))return!0;return!1}function _e(o,e){if(o.length===0||e.length===0)return!1;for(let n=0;n<o.length-1;n++){const l=o[n],f=o[n+1];for(let u=0;u<e.length-1;u++)if(fe(l,f,e[u],e[u+1]))return!0}return!1}function fe(o,e,n,l){return Zs(o,n,l)!==Zs(e,n,l)&&Zs(o,e,n)!==Zs(o,e,l)}function pe(o,e,n){const l=n*n;if(e.length===1)return o.distSqr(e[0])<l;for(let f=1;f<e.length;f++)if(de(o,e[f-1],e[f])<l)return!0;return!1}function de(o,e,n){const l=e.distSqr(n);if(l===0)return o.distSqr(e);const f=((o.x-e.x)*(n.x-e.x)+(o.y-e.y)*(n.y-e.y))/l;return o.distSqr(f<0?e:f>1?n:n.sub(e)._mult(f)._add(e))}function be(o,e){let n,l,f,u=!1;for(let m=0;m<o.length;m++){n=o[m];for(let v=0,S=n.length-1;v<n.length;S=v++)l=n[v],f=n[S],l.y>e.y!=f.y>e.y&&e.x<(f.x-l.x)*(e.y-l.y)/(f.y-l.y)+l.x&&(u=!u)}return u}function Ie(o,e){let n=!1;for(let l=0,f=o.length-1;l<o.length;f=l++){const u=o[l],m=o[f];u.y>e.y!=m.y>e.y&&e.x<(m.x-u.x)*(e.y-u.y)/(m.y-u.y)+u.x&&(n=!n)}return n}function He(o,e,n,l,f){for(const m of o)if(e<=m.x&&n<=m.y&&l>=m.x&&f>=m.y)return!0;const u=[new Ae(e,n),new Ae(e,f),new Ae(l,f),new Ae(l,n)];if(o.length>2){for(const m of u)if(Ie(o,m))return!0}for(let m=0;m<o.length-1;m++)if(Ve(o[m],o[m+1],u))return!0;return!1}function Ve(o,e,n){const l=n[0],f=n[2];if(o.x<l.x&&e.x<l.x||o.x>f.x&&e.x>f.x||o.y<l.y&&e.y<l.y||o.y>f.y&&e.y>f.y)return!1;const u=Zs(o,e,n[0]);return u!==Zs(o,e,n[1])||u!==Zs(o,e,n[2])||u!==Zs(o,e,n[3])}function Ee(o,e,n,l,f,u){let m=e.y-o.y,v=o.x-e.x;if(u=u||0){const S=m*m+v*v;if(S===0)return!0;const P=Math.sqrt(S);m/=P,v/=P}return!((n.x-o.x)*m+(n.y-o.y)*v-u<0||(l.x-o.x)*m+(l.y-o.y)*v-u<0||(f.x-o.x)*m+(f.y-o.y)*v-u<0)}function Re(o,e,n,l,f,u,m){return!(Ee(o,e,l,f,u,m)||Ee(e,n,l,f,u,m)||Ee(n,o,l,f,u,m)||Ee(l,f,o,e,n,m)||Ee(f,u,o,e,n,m)||Ee(u,l,o,e,n,m))}function et(o,e,n){const l=e.paint.get(o).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(o)}function ot(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function ft(o,e,n,l,f){if(!e[0]&&!e[1])return o;const u=Ae.convert(e)._mult(f);n==="viewport"&&u._rotate(-l);const m=[];for(let v=0;v<o.length;v++)m.push(o[v].sub(u));return m}function Ne(o,e,n,l){const f=Ae.convert(o)._mult(l);return e==="viewport"&&f._rotate(-n),f}let nt,$e;Ot(J,"CircleBucket",{omit:["layers"]});var ut,st={exports:{}},tt=(ut||(ut=1,function(o,e){(function(n){function l(u,m,v){var S=f(256*u,256*(m=Math.pow(2,v)-m-1),v),P=f(256*(u+1),256*(m+1),v);return S[0]+","+S[1]+","+P[0]+","+P[1]}function f(u,m,v){var S=2*Math.PI*6378137/256/Math.pow(2,v);return[u*S-2*Math.PI*6378137/2,m*S-2*Math.PI*6378137/2]}n.getURL=function(u,m,v,S,P,x){return x=x||{},u+"?"+["bbox="+l(v,S,P),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+m].join("&")},n.getTileBBox=l,n.getMercCoords=f,Object.defineProperty(n,"__esModule",{value:!0})})(e)}(0,st.exports)),st.exports);class wt{constructor(e,n,l){this.z=e,this.x=n,this.y=l,this.key=Rt(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const l=tt.getTileBBox(this.x,this.y,this.z),f=function(u,m,v){let S,P="";for(let x=u;x>0;x--)S=1<<x-1,P+=(m&S?1:0)+(v&S?2:0);return P}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Et{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Rt(e,n.z,n.z,n.x,n.y)}}class gt{constructor(e,n,l,f,u){this.overscaledZ=e,this.wrap=n,this.canonical=new wt(l,+f,+u),this.key=n===0&&e===l?this.canonical.key:Rt(n,e,l,f,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new gt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gt(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Rt(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Rt(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new gt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,f=2*this.canonical.y;return[new gt(n,this.wrap,n,l,f),new gt(n,this.wrap,n,l+1,f),new gt(n,this.wrap,n,l,f+1),new gt(n,this.wrap,n,l+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new gt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new gt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Et(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Rt(o,e,n,l,f){const u=1<<Math.min(n,22);let m=u*(f%u)+l%u;return o&&n<22&&(m+=u*u*((o<0?-2*o-1:2*o)%(1<<2*(22-n)))),16*(32*m+n)+(e-n)}const oi=[o=>{let e=o.canonical.x-1,n=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,n--),new gt(o.overscaledZ,n,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,n=o.wrap;return e===1<<o.canonical.z&&(e=0,n++),new gt(o.overscaledZ,n,o.canonical.z,e,o.canonical.y)},o=>new gt(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new gt(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Ot(wt,"CanonicalTileID"),Ot(gt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Zt=Ni([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Wt}=Zt,ai=Ni([{name:"a_pos_3",components:3,type:"Int16"}]);var Pi=Ni([{name:"a_pos",type:"Int16",components:2}]);class yi{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,l){const f=me.vec3.dot(n,this.dir);if(Math.abs(f)<1e-6)return!1;const u=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/f;return l[0]=this.pos[0]+this.dir[0]*u,l[1]=this.pos[1]+this.dir[1]*u,l[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,n,l){if(me.vec3.equals(this.pos,e)||n===0)return l[0]=l[1]=l[2]=0,!1;const[f,u,m]=this.dir,v=this.pos[0]-e[0],S=this.pos[1]-e[1],P=this.pos[2]-e[2],x=f*f+u*u+m*m,M=2*(v*f+S*u+P*m),I=M*M-4*x*(v*v+S*S+P*P-n*n);if(I<0){const T=Math.max(-M/2,0),A=v+f*T,D=S+u*T,O=P+m*T,F=Math.hypot(A,D,O);return l[0]=A*n/F,l[1]=D*n/F,l[2]=O*n/F,!1}{const T=(-M-Math.sqrt(I))/(2*x);if(T<0){const A=Math.hypot(v,S,P);return l[0]=v*n/A,l[1]=S*n/A,l[2]=P*n/A,!1}return l[0]=v+f*T,l[1]=S+u*T,l[2]=P+m*T,!0}}}class gn{constructor(e,n,l,f,u){this.TL=e,this.TR=n,this.BR=l,this.BL=f,this.horizon=u}static fromInvProjectionMatrix(e,n,l){const f=[-1,1,1],u=[1,1,1],m=[1,-1,1],v=[-1,-1,1],S=me.vec3.transformMat4(f,f,e),P=me.vec3.transformMat4(u,u,e),x=me.vec3.transformMat4(m,m,e),M=me.vec3.transformMat4(v,v,e);return new gn(S,P,x,M,n/l)}}function an(o,e,n){let l=1/0,f=-1/0;const u=[];for(const m of o){me.vec3.sub(u,m,e);const v=me.vec3.dot(u,n);l=Math.min(l,v),f=Math.max(f,v)}return[l,f]}function Hi(o,e){let n=!0;for(let l=0;l<o.planes.length;l++){const f=o.planes[l];let u=0;for(let m=0;m<e.length;m++)u+=me.vec3.dot(f,e[m])+f[3]>=0;if(u===0)return 0;u!==e.length&&(n=!1)}return n?2:1}function Yi(o,e){for(const n of o.projections){const l=an(e,o.points[0],n.axis);if(n.projection[1]<l[0]||n.projection[0]>l[1])return 0}return 1}function xi(o,e){let n=0;const l=[0,0,0,0];for(let f=0;f<o.length;f++)l[0]=o[f][0],l[1]=o[f][1],l[2]=o[f][2],l[3]=1,me.vec4.dot(l,e)>=0&&n++;return n}class zi{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=ei.fromPoints(this.points),this.projections=[],this.frustumEdges=[me.vec3.sub([],this.points[2],this.points[3]),me.vec3.sub([],this.points[0],this.points[3]),me.vec3.sub([],this.points[4],this.points[0]),me.vec3.sub([],this.points[5],this.points[1]),me.vec3.sub([],this.points[6],this.points[2]),me.vec3.sub([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const f=[0,-l[2],l[1]],u=[l[2],0,-l[0]];this.projections.push({axis:f,projection:an(this.points,this.points[0],f)}),this.projections.push({axis:u,projection:an(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,n,l,f){const u=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const x=me.vec4.transformMat4([],P,e),M=1/x[3]/n*u;return me.vec4.mul(x,x,[M,M,f?1/x[3]:M,M])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const x=me.vec3.sub([],m[P[0]],m[P[1]]),M=me.vec3.sub([],m[P[2]],m[P[1]]),I=me.vec3.normalize([],me.vec3.cross([],x,M)),T=-me.vec3.dot(I,m[P[1]]);return I.concat(T)}),S=[];for(let P=0;P<m.length;P++)S.push([m[P][0],m[P][1],m[P][2]]);return new zi(S,v)}intersectsPrecise(e,n,l){for(let f=0;f<n.length;f++)if(!xi(e,n[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!xi(e,this.planes[f]))return 0;for(const f of l)for(const u of this.frustumEdges){const m=me.vec3.cross([],f,u),v=me.vec3.length(m);if(v===0)continue;me.vec3.scale(m,m,1/v);const S=an(this.points,this.points[0],m),P=an(e,this.points[0],m);if(S[0]>P[1]||P[0]>S[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const l=n[3];if(me.vec3.dot([n[0],n[1],n[2]],e)+l<0)return!1}return!0}}class ei{static fromPoints(e){const n=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const f of e)me.vec3.min(n,n,f),me.vec3.max(l,l,f);return new ei(n,l)}static fromTileIdAndHeight(e,n,l){const f=1<<e.canonical.z,u=e.canonical.x,m=e.canonical.y;return new ei([u/f,m/f,n],[(u+1)/f,(m+1)/f,l])}static applyTransform(e,n){const l=e.getCorners();for(let f=0;f<l.length;++f)me.vec3.transformMat4(l[f],l[f],n);return ei.fromPoints(l)}static applyTransformFast(e,n){const l=[n[12],n[13],n[14]],f=[...l];for(let u=0;u<3;u++)for(let m=0;m<3;m++){const v=n[4*m+u],S=v*e.min[m],P=v*e.max[m];l[u]+=Math.min(S,P),f[u]+=Math.max(S,P)}return new ei(l,f)}static projectAabbCorners(e,n){const l=e.getCorners();for(let f=0;f<l.length;++f)me.vec3.transformMat4(l[f],l[f],n);return l}constructor(e,n){this.min=e,this.max=n,this.center=me.vec3.scale([],me.vec3.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],l=me.vec3.clone(this.min),f=me.vec3.clone(this.max);for(let u=0;u<n.length;u++)l[u]=n[u]?this.min[u]:this.center[u],f[u]=n[u]?this.center[u]:this.max[u];return f[2]=this.max[2],new ei(l,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Hi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Hi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Yi(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Yi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Vi(o){return o*Mr/El}Ot(ei,"Aabb");const Tn=[new ei([ws,ws,ws],[Ts,Ts,Ts]),new ei([ws,ws,ws],[0,0,Ts]),new ei([0,ws,ws],[Ts,0,Ts]),new ei([ws,0,ws],[0,Ts,Ts]),new ei([0,0,ws],[Ts,Ts,Ts])];function dr(o,e,n,l=!0){const f=me.vec3.scale([],o._camera.position,o.worldSize),u=[e,n,1,1];me.vec4.transformMat4(u,u,o.pixelMatrixInverse),me.vec4.scale(u,u,1/u[3]);const m=me.vec3.sub([],u,f),v=me.vec3.normalize([],m),S=o.globeMatrix,P=[S[12],S[13],S[14]],x=me.vec3.sub([],P,f),M=me.vec3.length(x),I=me.vec3.normalize([],x),T=o.worldSize/(2*Math.PI),A=me.vec3.dot(I,v),D=Math.asin(T/M);if(D<Math.acos(A)){if(!l)return null;const ye=[],ce=[];me.vec3.scale(ye,v,M/A),me.vec3.normalize(ce,me.vec3.sub(ce,ye,x)),me.vec3.normalize(v,me.vec3.add(v,x,me.vec3.scale(v,ce,Math.tan(D)*M)))}const O=[];new yi(f,v).closestPointOnSphere(P,T,O);const F=me.vec3.normalize([],Xa(S,0)),H=me.vec3.normalize([],Xa(S,1)),q=me.vec3.normalize([],Xa(S,2)),U=me.vec3.dot(F,O),$=me.vec3.dot(H,O),Z=me.vec3.dot(q,O),K=Nt(Math.asin(-$/T));let ae=Nt(Math.atan2(U,Z));ae=o.center.lng+function(ye,ce){const ve=(ce-ye+180)%360-180;return ve<-180?ve+360:ve}(o.center.lng,ae);const oe=Yo(ae),se=At(xo(K),0,1);return new _(oe,se)}class Kr{constructor(e,n,l){this.a=me.vec3.sub([],e,l),this.b=me.vec3.sub([],n,l),this.center=l;const f=me.vec3.normalize([],this.a),u=me.vec3.normalize([],this.b);this.angle=Math.acos(me.vec3.dot(f,u))}}function Er(o,e){if(o.angle===0)return null;let n;return n=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),n<0||n>1?null:function(l,f,u,m){const v=Math.sin(u);return l*(Math.sin((1-m)*u)/v)+f*(Math.sin(m*u)/v)}(o.a[e],o.b[e],o.angle,At(n,0,1))+o.center[e]}function nr(o){if(o.z<=1)return Tn[o.z+2*o.y+o.x];const e=Ri(rn(o));return ei.fromPoints(e)}function Nn(o,e,n){return me.vec3.scale(o,o,1-n),me.vec3.scaleAndAdd(o,o,e,n)}function Rn(o,e,n){for(const l of o)me.vec3.transformMat4(l,l,e),me.vec3.scale(l,l,n)}function fn(o,e,n,l){const f=e/o.worldSize,u=o.globeMatrix;if(n.z<=1){const oe=nr(n).getCorners();return Rn(oe,u,f),ei.fromPoints(oe)}const m=rn(n,l),v=Ri(m,Mr+Vi(o._tileCoverLift));Rn(v,u,f);const S=Number.MAX_VALUE,P=[-S,-S,-S],x=[S,S,S];if(m.contains(o.center)){for(const ye of v)me.vec3.min(x,x,ye),me.vec3.max(P,P,ye);P[2]=0;const oe=o.point,se=[oe.x*f,oe.y*f,0];return me.vec3.min(x,x,se),me.vec3.max(P,P,se),new ei(x,P)}if(o._tileCoverLift>0){for(const oe of v)me.vec3.min(x,x,oe),me.vec3.max(P,P,oe);return new ei(x,P)}const M=[u[12]*f,u[13]*f,u[14]*f],I=m.getCenter(),T=At(o.center.lat,-85.051129,Yr),A=At(I.lat,-85.051129,Yr),D=Yo(o.center.lng),O=xo(T);let F=D-Yo(I.lng);const H=O-xo(A);F>.5?F-=1:F<-.5&&(F+=1);let q=0;if(Math.abs(F)>Math.abs(H))q=F>=0?1:3;else{q=H>=0?0:2;const oe=[u[4]*f,u[5]*f,u[6]*f],se=-Math.sin(xt(H>=0?m.getSouth():m.getNorth()))*Mr;me.vec3.scaleAndAdd(M,M,oe,se)}const U=v[q],$=v[(q+1)%4],Z=new Kr(U,$,M),K=[Er(Z,0)||U[0],Er(Z,1)||U[1],Er(Z,2)||U[2]],ae=Ar(o.zoom);if(ae>0){const oe=function({x:ye,y:ce,z:ve},Se,we,Ce,ze){const Oe=1/(1<<ve);let Pe=ye*Oe,Xe=Pe+Oe,lt=ce*Oe,Je=lt+Oe,mt=0;const pt=(Pe+Xe)/2-Ce;return pt>.5?mt=-1:pt<-.5&&(mt=1),Pe=((Pe+mt)*Se-(Ce*=Se))*we+Ce,Xe=((Xe+mt)*Se-Ce)*we+Ce,lt=(lt*Se-(ze*=Se))*we+ze,Je=(Je*Se-ze)*we+ze,[[Pe,Je,0],[Xe,Je,0],[Xe,lt,0],[Pe,lt,0]]}(n,e,o._pixelsPerMercatorPixel,D,O);for(let ye=0;ye<v.length;ye++)Nn(v[ye],oe[ye],ae);const se=me.vec3.add([],oe[q],oe[(q+1)%4]);me.vec3.scale(se,se,.5),Nn(K,se,ae)}for(const oe of v)me.vec3.min(x,x,oe),me.vec3.max(P,P,oe);return x[2]=Math.min(U[2],$[2]),me.vec3.min(x,x,K),me.vec3.max(P,P,K),new ei(x,P)}function rn({x:o,y:e,z:n},l=!1){const f=1/(1<<n),u=new Bi(Xr(o*f),e===(1<<n)-1&&l?-90:mr((e+1)*f)),m=new Bi(Xr((o+1)*f),e===0&&l?90:mr(e*f));return new Xo(u,m)}function Ri(o,e=Mr){const n=xt(o.getNorth()),l=xt(o.getSouth()),f=Math.cos(n),u=Math.cos(l),m=Math.sin(n),v=Math.sin(l),S=o.getWest(),P=o.getEast();return[Ia(u,v,S,e),Ia(u,v,P,e),Ia(f,m,P,e),Ia(f,m,S,e)]}function An(o,e,n,l){const f=1<<n.z,u=(o/vt+n.x)/f;return Ca(mr((e/vt+n.y)/f),Xr(u),l)}function rr({min:o,max:e}){return Rm/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const ln=new Float64Array(16);function br(o){const e=rr(o),n=me.mat4.fromScaling(ln,[e,e,e]);return me.mat4.translate(n,n,me.vec3.negate([],o.min))}function ls(o){const e=me.mat4.fromTranslation(ln,o.min),n=1/rr(o);return me.mat4.scale(e,e,[n,n,n])}function Vr(o){const e=vt/(2*Math.PI);return o/(2*Math.PI)/e}function vo(o,e){return vt/(512*Math.pow(2,o))*rr(nr(e))}function eo(o,e,n,l,f){const u=Vr(n),m=[o,e,-n/(2*Math.PI)],v=me.mat4.identity(new Float64Array(16));return me.mat4.translate(v,v,m),me.mat4.scale(v,v,[u,u,u]),me.mat4.rotateX(v,v,xt(-f)),me.mat4.rotateY(v,v,xt(-l)),v}function Ar(o){return Mi(Yd,Kd,o)}function cs(o,e){const n=Ca(e.lat,e.lng),l=function(u){const m=Ca(u._center.lat,u._center.lng),v=me.vec3.fromValues(0,1,0);let S=me.vec3.cross([],v,m);const P=me.mat4.fromRotation([],-u.angle,m);S=me.vec3.transformMat4(S,S,P),me.mat4.fromRotation(P,-u._pitch,S);const x=me.vec3.normalize([],m);return me.vec3.scale(x,x,Vi(u.cameraToCenterDistance/u.pixelsPerMeter)),me.vec3.transformMat4(x,x,P),me.vec3.add([],m,x)}(o),f=me.vec3.subtract([],l,n);return me.vec3.angle(f,n)}function bo(o,e){return cs(o,e)>Math.PI/2*1.01}const Os=xt(85),Pa=Math.cos(Os),kc=Math.sin(Os),nf=me.mat4.create(),yh=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function xv(o,e,n,l,f,u,m,v,S){if(u&&o.queryGeometry.isAboveHorizon)return!1;u&&(S*=o.pixelToTileUnitsFactor);const P=o.tileID.canonical,x=n.projection.upVectorScale(P,n.center.lat,n.worldSize).metersToTile;for(const M of e)for(const I of M){const T=I.add(v),A=f&&n.elevation?n.elevation.exaggeration()*f.getElevationAt(T.x,T.y,!0):0,D=n.projection.projectTilePoint(T.x,T.y,P);if(A>0){const q=n.projection.upVector(P,T.x,T.y);D.x+=q[0]*x*A,D.y+=q[1]*x*A,D.z+=q[2]*x*A}const O=u?T:wE(D.x,D.y,D.z,l),F=u?o.tilespaceRays.map(q=>SE(q,A)):o.queryGeometry.screenGeometry,H=me.vec4.transformMat4([],[D.x,D.y,D.z,1],l);if(!m&&u?S*=H[3]/n.cameraToCenterDistance:m&&!u&&(S*=n.cameraToCenterDistance/H[3]),u){const q=mr((I.y/vt+P.y)/(1<<P.z));S/=n.projection.pixelsPerMeter(q,1)/zr(1,q)}if(re(F,O,S))return!0}return!1}function wE(o,e,n,l){const f=me.vec4.transformMat4([],[o,e,n,1],l);return new Ae(f[0]/f[3],f[1]/f[3])}const vv=me.vec3.fromValues(0,0,0),TE=me.vec3.fromValues(0,0,1);function SE(o,e){const n=me.vec3.create();return vv[2]=e,o.intersectsPlane(vv,TE,n),new Ae(n[0],n[1])}class bv extends J{}let wv,Tv,Sv,Mv;function Ev(o,{width:e,height:n},l,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*n*l)throw new RangeError("mismatched image size")}else f=new Uint8Array(e*n*l);return o.width=e,o.height=n,o.data=f,o}function Av(o,e,n){const{width:l,height:f}=e;l===o.width&&f===o.height||(_y(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,l),height:Math.min(o.height,f)},n,null),o.width=l,o.height=f,o.data=e.data)}function _y(o,e,n,l,f,u,m,v){if(f.width===0||f.height===0)return e;if(f.width>o.width||f.height>o.height||n.x>o.width-f.width||n.y>o.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||l.x>e.width-f.width||l.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const S=o.data,P=e.data,x=u===4&&v;for(let M=0;M<f.height;M++){const I=((n.y+M)*o.width+n.x)*u,T=((l.y+M)*e.width+l.x)*u;if(x)for(let A=0;A<f.width;A++){const D=I+A*u+3,O=T+A*u;P[O+0]=255,P[O+1]=255,P[O+2]=255,P[O+3]=S[D]}else if(m)for(let A=0;A<f.width;A++){const D=I+A*u,O=T+A*u,F=S[D+3],H=new Fi(S[D+0]/255*F,S[D+1]/255*F,S[D+2]/255*F,F).toRenderColor(m).toArray();P[O+0]=H[0],P[O+1]=H[1],P[O+2]=H[2],P[O+3]=H[3]}else for(let A=0;A<f.width*u;A++)P[T+A]=S[I+A]}return e}Ot(bv,"HeatmapBucket",{omit:["layers"]});class Al{constructor(e,n){Ev(this,e,1,n)}resize(e){Av(this,new Al(e),1)}clone(){return new Al({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,f,u){_y(e,n,l,f,u,1,null)}}class Rr{constructor(e,n){Ev(this,e,4,n)}resize(e){Av(this,new Rr(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Rr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,f,u,m,v){_y(e,n,l,f,u,4,m,v)}}class Iv{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function rf(o){const e={},n=o.resolution||256,l=o.clips?o.clips.length:1,f=o.image||new Rr({width:n,height:l}),u=(m,v,S)=>{e[o.evaluationKey]=S;const P=o.expression.evaluate(e);P&&(f.data[m+v+0]=Math.floor(255*P.r/P.a),f.data[m+v+1]=Math.floor(255*P.g/P.a),f.data[m+v+2]=Math.floor(255*P.b/P.a),f.data[m+v+3]=Math.floor(255*P.a))};if(o.clips)for(let m=0,v=0;m<l;++m,v+=4*n)for(let S=0,P=0;S<n;S++,P+=4){const x=S/(n-1),{start:M,end:I}=o.clips[m];u(v,P,M*(1-x)+I*x)}else for(let m=0,v=0;m<n;m++,v+=4)u(0,v,m/(n-1));return f}Ot(Al,"AlphaImage"),Ot(Rr,"RGBAImage");const ME=Ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:EE}=ME;function sf(o,e,n=2){const l=e&&e.length,f=l?e[0]*n:o.length;let u=Cv(o,0,f,n,!0);const m=[];if(!u||u.next===u.prev)return m;let v,S,P;if(l&&(u=function(x,M,I,T){const A=[];for(let D=0,O=M.length;D<O;D++){const F=Cv(x,M[D]*T,D<O-1?M[D+1]*T:x.length,T,!1);F===F.next&&(F.steiner=!0),A.push(LE(F))}A.sort(DE);for(let D=0;D<A.length;D++)I=zE(A[D],I);return I}(o,e,u,n)),o.length>80*n){v=1/0,S=1/0;let x=-1/0,M=-1/0;for(let I=n;I<f;I+=n){const T=o[I],A=o[I+1];T<v&&(v=T),A<S&&(S=A),T>x&&(x=T),A>M&&(M=A)}P=Math.max(x-v,M-S),P=P!==0?32767/P:0}return of(u,m,n,v,S,P,0),m}function Cv(o,e,n,l,f){let u;if(f===function(m,v,S,P){let x=0;for(let M=v,I=S-P;M<S;M+=P)x+=(m[I]-m[M])*(m[M+1]+m[I+1]),I=M;return x}(o,e,n,l)>0)for(let m=e;m<n;m+=l)u=zv(m/l|0,o[m],o[m+1],u);else for(let m=n-l;m>=e;m-=l)u=zv(m/l|0,o[m],o[m+1],u);return u&&km(u,u.next)&&(lf(u),u=u.next),u}function Oc(o,e){if(!o)return o;e||(e=o);let n,l=o;do if(n=!1,l.steiner||!km(l,l.next)&&sr(l.prev,l,l.next)!==0)l=l.next;else{if(lf(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function of(o,e,n,l,f,u,m){if(!o)return;!m&&u&&function(S,P,x,M){let I=S;do I.z===0&&(I.z=gy(I.x,I.y,P,x,M)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==S);I.prevZ.nextZ=null,I.prevZ=null,function(T){let A,D=1;do{let O,F=T;T=null;let H=null;for(A=0;F;){A++;let q=F,U=0;for(let Z=0;Z<D&&(U++,q=q.nextZ,q);Z++);let $=D;for(;U>0||$>0&&q;)U!==0&&($===0||!q||F.z<=q.z)?(O=F,F=F.nextZ,U--):(O=q,q=q.nextZ,$--),H?H.nextZ=O:T=O,O.prevZ=H,H=O;F=q}H.nextZ=null,D*=2}while(A>1)}(I)}(o,l,f,u);let v=o;for(;o.prev!==o.next;){const S=o.prev,P=o.next;if(u?IE(o,l,f,u):AE(o))e.push(S.i,o.i,P.i),lf(o),o=P.next,v=P.next;else if((o=P)===v){m?m===1?of(o=CE(Oc(o),e),e,n,l,f,u,2):m===2&&PE(o,e,n,l,f,u):of(Oc(o),e,n,l,f,u,1);break}}}function AE(o){const e=o.prev,n=o,l=o.next;if(sr(e,n,l)>=0)return!1;const f=e.x,u=n.x,m=l.x,v=e.y,S=n.y,P=l.y,x=f<u?f<m?f:m:u<m?u:m,M=v<S?v<P?v:P:S<P?S:P,I=f>u?f>m?f:m:u>m?u:m,T=v>S?v>P?v:P:S>P?S:P;let A=l.next;for(;A!==e;){if(A.x>=x&&A.x<=I&&A.y>=M&&A.y<=T&&xh(f,v,u,S,m,P,A.x,A.y)&&sr(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function IE(o,e,n,l){const f=o.prev,u=o,m=o.next;if(sr(f,u,m)>=0)return!1;const v=f.x,S=u.x,P=m.x,x=f.y,M=u.y,I=m.y,T=v<S?v<P?v:P:S<P?S:P,A=x<M?x<I?x:I:M<I?M:I,D=v>S?v>P?v:P:S>P?S:P,O=x>M?x>I?x:I:M>I?M:I,F=gy(T,A,e,n,l),H=gy(D,O,e,n,l);let q=o.prevZ,U=o.nextZ;for(;q&&q.z>=F&&U&&U.z<=H;){if(q.x>=T&&q.x<=D&&q.y>=A&&q.y<=O&&q!==f&&q!==m&&xh(v,x,S,M,P,I,q.x,q.y)&&sr(q.prev,q,q.next)>=0||(q=q.prevZ,U.x>=T&&U.x<=D&&U.y>=A&&U.y<=O&&U!==f&&U!==m&&xh(v,x,S,M,P,I,U.x,U.y)&&sr(U.prev,U,U.next)>=0))return!1;U=U.nextZ}for(;q&&q.z>=F;){if(q.x>=T&&q.x<=D&&q.y>=A&&q.y<=O&&q!==f&&q!==m&&xh(v,x,S,M,P,I,q.x,q.y)&&sr(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;U&&U.z<=H;){if(U.x>=T&&U.x<=D&&U.y>=A&&U.y<=O&&U!==f&&U!==m&&xh(v,x,S,M,P,I,U.x,U.y)&&sr(U.prev,U,U.next)>=0)return!1;U=U.nextZ}return!0}function CE(o,e){let n=o;do{const l=n.prev,f=n.next.next;!km(l,f)&&Pv(l,n,n.next,f)&&af(l,f)&&af(f,l)&&(e.push(l.i,n.i,f.i),lf(n),lf(n.next),n=o=f),n=n.next}while(n!==o);return Oc(n)}function PE(o,e,n,l,f,u){let m=o;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&kE(m,v)){let S=Dv(m,v);return m=Oc(m,m.next),S=Oc(S,S.next),of(m,e,n,l,f,u,0),void of(S,e,n,l,f,u,0)}v=v.next}m=m.next}while(m!==o)}function DE(o,e){return o.x-e.x}function zE(o,e){const n=function(f,u){let m=u;const v=f.x,S=f.y;let P,x=-1/0;do{if(S<=m.y&&S>=m.next.y&&m.next.y!==m.y){const D=m.x+(S-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(D<=v&&D>x&&(x=D,P=m.x<m.next.x?m:m.next,D===v))return P}m=m.next}while(m!==u);if(!P)return null;const M=P,I=P.x,T=P.y;let A=1/0;m=P;do{if(v>=m.x&&m.x>=I&&v!==m.x&&xh(S<T?v:x,S,I,T,S<T?x:v,S,m.x,m.y)){const D=Math.abs(S-m.y)/(v-m.x);af(m,f)&&(D<A||D===A&&(m.x>P.x||m.x===P.x&&RE(P,m)))&&(P=m,A=D)}m=m.next}while(m!==M);return P}(o,e);if(!n)return e;const l=Dv(n,o);return Oc(l,l.next),Oc(n,n.next)}function RE(o,e){return sr(o.prev,o,e.prev)<0&&sr(e.next,o,o.next)<0}function gy(o,e,n,l,f){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-n)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function LE(o){let e=o,n=o;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==o);return n}function xh(o,e,n,l,f,u,m,v){return(f-m)*(e-v)>=(o-m)*(u-v)&&(o-m)*(l-v)>=(n-m)*(e-v)&&(n-m)*(u-v)>=(f-m)*(l-v)}function kE(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(n,l){let f=n;do{if(f.i!==n.i&&f.next.i!==n.i&&f.i!==l.i&&f.next.i!==l.i&&Pv(f,f.next,n,l))return!0;f=f.next}while(f!==n);return!1}(o,e)&&(af(o,e)&&af(e,o)&&function(n,l){let f=n,u=!1;const m=(n.x+l.x)/2,v=(n.y+l.y)/2;do f.y>v!=f.next.y>v&&f.next.y!==f.y&&m<(f.next.x-f.x)*(v-f.y)/(f.next.y-f.y)+f.x&&(u=!u),f=f.next;while(f!==n);return u}(o,e)&&(sr(o.prev,o,e.prev)||sr(o,e.prev,e))||km(o,e)&&sr(o.prev,o,o.next)>0&&sr(e.prev,e,e.next)>0)}function sr(o,e,n){return(e.y-o.y)*(n.x-e.x)-(e.x-o.x)*(n.y-e.y)}function km(o,e){return o.x===e.x&&o.y===e.y}function Pv(o,e,n,l){const f=Fm(sr(o,e,n)),u=Fm(sr(o,e,l)),m=Fm(sr(n,l,o)),v=Fm(sr(n,l,e));return f!==u&&m!==v||!(f!==0||!Om(o,n,e))||!(u!==0||!Om(o,l,e))||!(m!==0||!Om(n,o,l))||!(v!==0||!Om(n,e,l))}function Om(o,e,n){return e.x<=Math.max(o.x,n.x)&&e.x>=Math.min(o.x,n.x)&&e.y<=Math.max(o.y,n.y)&&e.y>=Math.min(o.y,n.y)}function Fm(o){return o>0?1:o<0?-1:0}function af(o,e){return sr(o.prev,o,o.next)<0?sr(o,e,o.next)>=0&&sr(o,o.prev,e)>=0:sr(o,e,o.prev)<0||sr(o,o.next,e)<0}function Dv(o,e){const n=yy(o.i,o.x,o.y),l=yy(e.i,e.x,e.y),f=o.next,u=e.prev;return o.next=e,e.prev=o,n.next=f,f.prev=n,l.next=n,n.prev=l,u.next=l,l.prev=u,l}function zv(o,e,n,l){const f=yy(o,e,n);return l?(f.next=l.next,f.prev=l,l.next.prev=f,l.next=f):(f.prev=f,f.next=f),f}function lf(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function yy(o,e,n){return{i:o,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Bm(o,e){const n=o.length;if(n<=1)return[o];const l=[];let f,u;for(let m=0;m<n;m++){const v=uu(o[m]);v!==0&&(o[m].area=Math.abs(v),u===void 0&&(u=v<0),u===v<0?(f&&l.push(f),f=[o[m]]):f.push(o[m]))}if(f&&l.push(f),e>1)for(let m=0;m<l.length;m++)l[m].length<=e||(Op(l[m],e,1,l[m].length-1,OE),l[m]=l[m].slice(0,e));return l}function OE(o,e){return e.area-o.area}function Rv(o,e){if(!o)return null;const n=typeof o=="string"?o:o.getPrimary().id;e[n]||(e[n]=[]);const l=hr.from(o).getPrimary();return e[n].push(l),l.serialize()}function xy(o,e,n){const l=n.patternDependencies;let f=!1;for(const u of e){const m=u.paint.get(`${o}-pattern`);m.isConstant()||(f=!0),Rv(m.constantOr(null),l)&&(f=!0)}return f}function vy(o,e,n,l,f){const u=f.patternDependencies;for(const m of e){const v=m.paint.get(`${o}-pattern`).value;if(v.kind!=="constant"){let S=v.evaluate({zoom:l},n,{},f.availableImages);S=S&&S.name?S.name:S;const P=Rv(S,u);P&&(n.patterns[m.id]=P)}}return n}class by{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mo,this.indexArray=new vr,this.indexArray2=new qo,this.programConfigurations=new Zo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new En,this.segments2=new En,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,l,f){this.hasPattern=xy("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:S,index:P,sourceLayerIndex:x}of e){const M=this.layers[0]._featureFilter.needGeometry,I=G(v,M);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),I,l))continue;const T=u?u.evaluate(I,{},l,n.availableImages):void 0,A={id:S,properties:v.properties,type:v.type,sourceLayerIndex:x,index:P,geometry:M?I.geometry:B(v,l,f),patterns:{},sortKey:T};m.push(A)}u&&m.sort((v,S)=>v.sortKey-S.sortKey);for(const v of m){const{geometry:S,index:P,sourceLayerIndex:x}=v;if(this.hasPattern){const M=vy("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(v,S,P,l,{},n.availableImages,n.brightness);n.featureIndex.insert(e[P].feature,S,P,x,this.index)}}update(e,n,l,f,u,m,v){this.programConfigurations.updatePaintArrays(e,n,u,l,f,m,v)}addFeatures(e,n,l,f,u,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,n,l,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,EE),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,l,f,u,m=[],v){for(const S of Bm(n,500)){let P=0;for(const D of S)P+=D.length;const x=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),M=x.vertexLength,I=[],T=[];for(const D of S){if(D.length===0)continue;D!==S[0]&&T.push(I.length/2);const O=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),F=O.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(F+D.length-1,F),I.push(D[0].x),I.push(D[0].y);for(let H=1;H<D.length;H++)this.layoutVertexArray.emplaceBack(D[H].x,D[H].y),this.indexArray2.emplaceBack(F+H-1,F+H),I.push(D[H].x),I.push(D[H].y);O.vertexLength+=D.length,O.primitiveLength+=D.length}const A=sf(I,T);for(let D=0;D<A.length;D+=3)this.indexArray.emplaceBack(M+A[D],M+A[D+1],M+A[D+2]);x.vertexLength+=P,x.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,u,m,f,v)}}let Lv,kv,Ov,Fv;Ot(by,"FillBucket",{omit:["layers","patternFeatures"]});class wy{constructor(e,n,l,f){if(this.triangleCount=n.length/3,this.min=new Ae(0,0),this.max=new Ae(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[u,m]=[e[0].clone(),e[0].clone()];for(let M=1;M<e.length;++M){const I=e[M];u.x=Math.min(u.x,I.x),u.y=Math.min(u.y,I.y),m.x=Math.max(m.x,I.x),m.y=Math.max(m.y,I.y)}if(f){const M=Math.ceil(Math.max(m.x-u.x,m.y-u.y)/f);l=Math.max(l,M)}if(l===0)return;this.min=u,this.max=m;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const S=Math.max(v.x,v.y)/l;this.cellsX=Math.max(1,Math.ceil(v.x/S)),this.cellsY=Math.max(1,Math.ceil(v.y/S)),this.xScale=1/S,this.yScale=1/S;const P=[];for(let M=0;M<this.triangleCount;M++){const I=e[n[3*M+0]].sub(this.min),T=e[n[3*M+1]].sub(this.min),A=e[n[3*M+2]].sub(this.min),D=Ko(Math.floor(Math.min(I.x,T.x,A.x)),this.xScale,this.cellsX),O=Ko(Math.floor(Math.max(I.x,T.x,A.x)),this.xScale,this.cellsX),F=Ko(Math.floor(Math.min(I.y,T.y,A.y)),this.yScale,this.cellsY),H=Ko(Math.floor(Math.max(I.y,T.y,A.y)),this.yScale,this.cellsY),q=new Ae(0,0),U=new Ae(0,0),$=new Ae(0,0),Z=new Ae(0,0);for(let K=F;K<=H;++K){q.y=U.y=K*S,$.y=Z.y=(K+1)*S;for(let ae=D;ae<=O;++ae)q.x=$.x=ae*S,U.x=Z.x=(ae+1)*S,(Re(I,T,A,q,U,Z)||Re(I,T,A,q,Z,$))&&P.push({cellIdx:K*this.cellsX+ae,triIdx:M})}}if(P.length===0)return;P.sort((M,I)=>M.cellIdx-I.cellIdx||M.triIdx-I.triIdx);let x=0;for(;x<P.length;){const M=P[x].cellIdx,I={start:this.payload.length,len:0};for(;x<P.length&&P[x].cellIdx===M;)++I.len,this.payload.push(P[x++].triIdx);this.cells[M]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=Ko(e.x-this.min.x,this.xScale,this.cellsX),f=Ko(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[f*this.cellsX+l];if(u){this._lazyInitLookup();for(let m=0;m<u.len;m++){const v=this.payload[u.start+m],S=Math.floor(v/8),P=1<<v%8;if(!(this.lookup[S]&P)&&(this.lookup[S]|=P,n.push(v),n.length===this.triangleCount))return}}}query(e,n,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const f=Ko(e.x-this.min.x,this.xScale,this.cellsX),u=Ko(n.x-this.min.x,this.xScale,this.cellsX),m=Ko(e.y-this.min.y,this.yScale,this.cellsY),v=Ko(n.y-this.min.y,this.yScale,this.cellsY);for(let S=m;S<=v;S++)for(let P=f;P<=u;P++){const x=this.cells[S*this.cellsX+P];if(x)for(let M=0;M<x.len;M++){const I=this.payload[x.start+M],T=Math.floor(I/8),A=1<<I%8;if(!(this.lookup[T]&A)&&(this.lookup[T]|=A,l.push(I),l.length===this.triangleCount))return}}}}function Ko(o,e,n){return Math.max(0,Math.min(n-1,Math.floor(o*e)))}Ot(wy,"TriangleGridIndex");class Bv{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(const l of this.footprints)n.push({footprint:l,id:e})}populate(e,n,l,f){const u=[];for(const{feature:m,id:v,index:S,sourceLayerIndex:P}of e){const x=this.layers[0]._featureFilter.needGeometry,M=G(m,x);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),M,l))continue;const I={id:v,properties:m.properties,type:m.type,sourceLayerIndex:P,index:S,geometry:x?M.geometry:B(m,l,f),patterns:{}};u.push(I)}for(const m of u){const{geometry:v,index:S,sourceLayerIndex:P}=m;this.addFeature(m,v,S,l,{},n.availableImages,n.brightness),n.featureIndex.insert(e[S].feature,v,S,P,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,l,f,u,m,v){}destroy(){}addFeature(e,n,l,f,u,m=[],v){for(const S of Bm(n,2)){const P=[],x=[],M=[],I=new Ae(1/0,1/0),T=new Ae(-1/0,-1/0);for(const O of S)if(O.length!==0){O!==S[0]&&M.push(x.length/2);for(let F=0;F<O.length;F++)x.push(O[F].x),x.push(O[F].y),P.push(O[F]),I.x=Math.min(I.x,O[F].x),I.y=Math.min(I.y,O[F].y),T.x=Math.max(T.x,O[F].x),T.y=Math.max(T.y,O[F].y)}const A=sf(x,M),D=new wy(P,A,8,256);this.footprints.push({vertices:P,indices:A,grid:D,min:I,max:T})}}}Ot(Bv,"ClipBucket",{omit:["layers"]});const FE=Ni([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),BE=Ni([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),NE=Ni([{name:"a_centroid_pos",components:2,type:"Uint16"}]),VE=Ni([{name:"a_join_normal_inside",components:3,type:"Int16"}]),UE=Ni([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),jE=Ni([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:GE}=FE;var Ty,Nv,Sy,Vv,My,Uv,jv,Nm={};function Gv(){if(Nv)return Ty;Nv=1;var o=Ue();function e(f,u,m,v,S){this.properties={},this.extent=m,this.type=0,this._pbf=f,this._geometry=-1,this._keys=v,this._values=S,f.readFields(n,this,u)}function n(f,u,m){f==1?u.id=m.readVarint():f==2?function(v,S){for(var P=v.readVarint()+v.pos;v.pos<P;){var x=S._keys[v.readVarint()],M=S._values[v.readVarint()];S.properties[x]=M}}(m,u):f==3?u.type=m.readVarint():f==4&&(u._geometry=m.pos)}function l(f){for(var u,m,v=0,S=0,P=f.length,x=P-1;S<P;x=S++)v+=((m=f[x]).x-(u=f[S]).x)*(u.y+m.y);return v}return Ty=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var u,m=f.readVarint()+f.pos,v=1,S=0,P=0,x=0,M=[];f.pos<m;){if(S<=0){var I=f.readVarint();v=7&I,S=I>>3}if(S--,v===1||v===2)P+=f.readSVarint(),x+=f.readSVarint(),v===1&&(u&&M.push(u),u=[]),u.push(new o(P,x));else{if(v!==7)throw new Error("unknown command "+v);u&&u.push(u[0].clone())}}return u&&M.push(u),M},e.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var u=f.readVarint()+f.pos,m=1,v=0,S=0,P=0,x=1/0,M=-1/0,I=1/0,T=-1/0;f.pos<u;){if(v<=0){var A=f.readVarint();m=7&A,v=A>>3}if(v--,m===1||m===2)(S+=f.readSVarint())<x&&(x=S),S>M&&(M=S),(P+=f.readSVarint())<I&&(I=P),P>T&&(T=P);else if(m!==7)throw new Error("unknown command "+m)}return[x,I,M,T]},e.prototype.toGeoJSON=function(f,u,m){var v,S,P=this.extent*Math.pow(2,m),x=this.extent*f,M=this.extent*u,I=this.loadGeometry(),T=e.types[this.type];function A(F){for(var H=0;H<F.length;H++){var q=F[H];F[H]=[360*(q.x+x)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+M)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(v=0;v<I.length;v++)D[v]=I[v][0];A(I=D);break;case 2:for(v=0;v<I.length;v++)A(I[v]);break;case 3:for(I=function(F){var H=F.length;if(H<=1)return[F];for(var q,U,$=[],Z=0;Z<H;Z++){var K=l(F[Z]);K!==0&&(U===void 0&&(U=K<0),U===K<0?(q&&$.push(q),q=[F[Z]]):q.push(F[Z]))}return q&&$.push(q),$}(I),v=0;v<I.length;v++)for(S=0;S<I[v].length;S++)A(I[v][S])}I.length===1?I=I[0]:T="Multi"+T;var O={type:"Feature",geometry:{type:T,coordinates:I},properties:this.properties};return"id"in this&&(O.id=this.id),O},Ty}function Hv(){if(Vv)return Sy;Vv=1;var o=Gv();function e(l,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(n,this,f),this.length=this._features.length}function n(l,f,u){l===15?f.version=u.readVarint():l===1?f.name=u.readString():l===5?f.extent=u.readVarint():l===2?f._features.push(u.pos):l===3?f._keys.push(u.readString()):l===4&&f._values.push(function(m){for(var v=null,S=m.readVarint()+m.pos;m.pos<S;){var P=m.readVarint()>>3;v=P===1?m.readString():P===2?m.readFloat():P===3?m.readDouble():P===4?m.readVarint64():P===5?m.readVarint():P===6?m.readSVarint():P===7?m.readBoolean():null}return v}(u))}return Sy=e,e.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var f=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,f,this.extent,this._keys,this._values)},Sy}function qv(){return jv||(jv=1,Nm.VectorTile=function(){if(Uv)return My;Uv=1;var o=Hv();function e(n,l,f){if(n===3){var u=new o(f,f.readVarint()+f.pos);u.length&&(l[u.name]=u)}}return My=function(n,l){this.layers=n.readFields(e,{},l)},My}(),Nm.VectorTileFeature=Gv(),Nm.VectorTileLayer=Hv()),Nm}var vh=qv();class Fc extends Ae{constructor(e,n,l){super(e,n),this.z=l}}class $v extends Fc{constructor(e,n,l,f){super(e,n,l),this.w=f}}function Vm(o,e,n,l){const f=[],u=l===0?(m,v,S,P,x,M)=>{m.push(new Ae(M,S+(M-v)/(P-v)*(x-S)))}:(m,v,S,P,x,M)=>{m.push(new Ae(v+(M-S)/(x-S)*(P-v),M))};for(const m of o){const v=[];for(const S of m){if(S.length<=2)continue;const P=[];for(let I=0;I<S.length-1;I++){const T=S[I].x,A=S[I].y,D=S[I+1].x,O=S[I+1].y,F=l===0?T:A,H=l===0?D:O;F<e?H>e&&u(P,T,A,D,O,e):F>n?H<n&&u(P,T,A,D,O,n):P.push(S[I]),H<e&&F>=e&&u(P,T,A,D,O,e),H>n&&F<=n&&u(P,T,A,D,O,n)}let x=S[S.length-1];const M=l===0?x.x:x.y;M>=e&&M<=n&&P.push(x),P.length&&(x=P[P.length-1],P[0].x===x.x&&P[0].y===x.y||P.push(P[0]),v.push(P))}v.length&&f.push(v)}return f}function Wv(o,e,n,l){const f=n==="x"?"y":"x",u=(l-o[n])/(e[n]-o[n]);o[f]=o[f]+(e[f]-o[f])*u,o[n]=l,o.hasOwnProperty("z")&&(o.z=ii(o.z,e.z,u)),o.hasOwnProperty("w")&&(o.w=ii(o.w,e.w,u))}function Zv(o,e,n,l){const f=n,u=l;for(const m of["x","y"]){let v=o,S=e;v[m]>=S[m]&&(v=e,S=o),v[m]<f&&S[m]>f&&Wv(v,S,m,f),v[m]<u&&S[m]>u&&Wv(S,v,m,u)}}const Um=Number.MAX_SAFE_INTEGER;function Xv(o,e,n,l){return o.order<e||o.order===Um||!(o.clipMask&n)||function(f,u){return u.length!==0&&u.find(m=>m===f)===void 0}(l,o.clipScope)}function jm(o,e){return o.x-e.x||o.y-e.y}function Yv(o,e){return jm(o.min,e.min)===0&&jm(o.max,e.max)===0}function Ey(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function Ay(o,e){if(o.length!==e.length)return!1;for(let n=0;n<o.length;n++)if(o[n].sourceId!==e[n].sourceId||!Yv(o[n],e[n])||o[n].order!==e[n].order||o[n].clipMask!==e[n].clipMask||!bt(o[n].clipScope,e[n].clipScope))return!1;return!0}function Kv(o,e,n){const l=1/vt,f=1/(1<<n.canonical.z),u=(e.x*l+n.canonical.x)*f+n.wrap,m=(e.y*l+n.canonical.y)*f;return{min:new Ae((o.x*l+n.canonical.x)*f+n.wrap,(o.y*l+n.canonical.y)*f),max:new Ae(u,m)}}function HE(o,e,n){const l=1<<n.canonical.z,f=((e.x-n.wrap)*l-n.canonical.x)*vt,u=(e.y*l-n.canonical.y)*vt;return{min:new Ae(((o.x-n.wrap)*l-n.canonical.x)*vt,(o.y*l-n.canonical.y)*vt),max:new Ae(f,u)}}function Jv(o,e,n,l,f,u,m){const v=o.indices,S=o.vertices,P=[];for(let x=l;x<l+f;x+=3){const M=e[n[x+0]+u],I=e[n[x+1]+u],T=e[n[x+2]+u],A=Math.min(M.x,I.x,T.x),D=Math.max(M.x,I.x,T.x),O=Math.min(M.y,I.y,T.y),F=Math.max(M.y,I.y,T.y);P.length=0,o.grid.query(new Ae(A,O),new Ae(D,F),P);for(let H=0;H<P.length;H++){const q=P[H];if(Re(S[v[3*q+0]],S[v[3*q+1]],S[v[3*q+2]],M,I,T,m))return!0}}return!1}function Qv(o,e,n,l){if(!o||!n)return!1;let f=o.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(n.vertices.length<o.vertices.length)return Qv(n,l,o,e);const u=e.canonical,m=l.canonical,v=Math.pow(2,m.z-u.z);f=o.vertices.map(S=>new Ae((S.x+u.x*vt)*v-m.x*vt,(S.y+u.y*vt)*v-m.y*vt))}return Jv(n,f,o.indices,0,o.indices.length,0,0)}function eb(o,e,n,l){const f=Math.pow(2,l.z-n.z);return new Ae((o+n.x*vt)*f-l.x*vt,(e+n.y*vt)*f-l.y*vt)}function tb(o,e){const n=[];e.grid.queryPoint(o,n);const l=e.indices,f=e.vertices;for(let u=0;u<n.length;u++){const m=n[u];if(Ie([f[l[3*m+0]],f[l[3*m+1]],f[l[3*m+2]]],o))return!0}return!1}const Iy=[new Ae(0,0),new Ae(vt,0),new Ae(vt,vt),new Ae(0,vt)];function ib(o,e){const n=[];let l=[];if(!e||o.length<2)return[o];if(o.length===2)return Ve(o[0],o[1],Iy)?[o]:[];for(let f=0;f<o.length+2;f++){const u=o[f%o.length],m=o[(f+1)%o.length],v=Ve(f===0?o[o.length-1]:o[(f-1)%o.length],u,Iy),S=Ve(u,m,Iy),P=v||S;P&&l.push(u),P&&S||l.length>0&&(l.length>1&&n.push(l),l=[])}return l.length>1&&n.push(l),n}const Cy=vh.VectorTileFeature.types,qE=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],$E=["fill-extrusion-flood-light-ground-radius"],WE=Math.pow(2,13),ZE=Math.pow(2,15)-1,nb=new Ae(0,1),Il=2147483648;function cf(o,e,n,l,f,u,m,v){o.emplaceBack((e<<1)+m,(n<<1)+u,(Math.floor(l*WE)<<1)+f,Math.round(v))}function uf(o,e,n){o.emplaceBack(e.x*vt,e.y*vt,n?1:0)}function Gm(o,e,n,l,f,u){o.emplaceBack(e.x,e.y,(n.x<<1)+l,(n.y<<1)+f,u)}function hf(o,e,n){o.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class rb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class sb{constructor(){this.centroidXY=new Ae(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ae(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ae(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ae(this.max.x-this.min.x,this.max.y-this.min.y)}}class ob{constructor(){this.acc=new Ae(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,l){this.accCount++,this.acc._add(n);let f=!!this.borders;n.x<e.min.x?(e.min.x=n.x,f=!0):n.x>e.max.x&&(e.max.x=n.x,f=!0),n.y<e.min.y?(e.min.y=n.y,f=!0):n.y>e.max.y&&(e.max.y=n.y,f=!0),((n.x===0||n.x===vt)&&n.x===l.x)!=((n.y===0||n.y===vt)&&n.y===l.y)&&this.processBorderOverlap(n,l),f&&this.checkBorderIntersection(n,l)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,ii(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>vt!=e.x>vt&&this.addBorderIntersection(1,ii(n.y,e.y,(vt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,ii(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>vt!=e.y>vt&&this.addBorderIntersection(3,ii(n.x,e.x,(vt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];n<l[0]&&(l[0]=n),n>l[1]&&(l[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,n.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,n.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new Ae(0,0):new Ae(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function ab(o,e){const n=o.add(e)._unit(),l=At(o.x*n.x+o.y*n.y,-1,1);var f,u,m;return m=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(m)))/4*ZE*((f=o).x*(u=e).y-f.y*u.x<0?-1:1)}const XE=[o=>o.x<0,o=>o.x>vt,o=>o.y<0,o=>o.y>vt];function YE(o,e,n,l){const f=[4];if(l===0)return f;n._mult(l);const u=o.sub(n),m=e.sub(n),v=[o,e,u,m];for(let S=0;S<4;S++)for(const P of v)if(XE[S](P)){f.push(S);break}return f}class lb{constructor(e){this.vertexArray=new vs,this.indexArray=new vr,this.programConfigurations=new Zo(e.layers,{zoom:e.zoom,lut:e.lut},n=>$E.includes(n)),this._segments=new En,this.hiddenByLandmarkVertexArray=new Tl,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new En}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,l,f=!1){const u=e.length;if(u>2){let m=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let S;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const P=e[0],x=e[1];S=ab(P.sub(e[u-1])._perp()._unit(),x.sub(P)._perp()._unit())}for(let P=0;P<u;P++){const x=P===u-1?0:P+1,M=e[P],I=e[x],T=e[x===u-1?0:x+1],A=I.sub(M)._perp()._unit(),D=ab(A,T.sub(I)._perp()._unit()),O=S,F=D;if(Py(M,I,n)||f&&hb(M,n)&&hb(I,n)){S=D;continue}const H=v.vertexLength;Gm(this.vertexArray,M,I,1,1,O),Gm(this.vertexArray,M,I,1,0,O),Gm(this.vertexArray,M,I,0,1,F),Gm(this.vertexArray,M,I,0,0,F),v.vertexLength+=4;const q=YE(M,I,A,l);for(const U of q)this._segmentToGroundQuads[m].push({id:H,region:U}),this._segmentToRegionTriCounts[m][U]+=2,v.primitiveLength+=2;S=D}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let l=0;l<n;l++)this._segmentToGroundQuads[l].sort((f,u)=>f.region-u.region);for(let l=0;l<n;l++){const f=this._segmentToGroundQuads[l],u=e[l],m=this._segmentToRegionTriCounts[l];m.reduce((S,P)=>S+P,0);let v=0;for(let S=0;S<=4;S++){const P=m[S];if(P!==0){let x=this.regionSegments[S];x||(x=this.regionSegments[S]=new En);const M={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+v,vertexLength:u.vertexLength,primitiveLength:P};x.get().push(M)}v+=P}for(let S=0;S<f.length;S++){const P=f[S].id;this.indexArray.emplaceBack(P,P+1,P+3),this.indexArray.emplaceBack(P,P+3,P+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,l,f,u,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,l,f,u,m)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,BE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,l,f,u,m,v){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,l,f,u,m,v)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const l=e.flags&Il?1:0;for(let f=e.groundVertexArrayOffset;f<n;++f)this.hiddenByLandmarkVertexArray.emplace(f,l);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,UE.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class Hm{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new vr,this.footprintVertices=new mo,this.footprintSegments=[],this.layoutVertexArray=new wl,this.centroidVertexArray=new Im,this.wallVertexArray=new Pm,this.indexArray=new vr,this.programConfigurations=new Zo(e.layers,{zoom:e.zoom,lut:e.lut},n=>qE.includes(n)),this.segments=new En,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new lb(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,l,f){this.features=[],this.hasPattern=xy("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=d(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:u,id:m,index:v,sourceLayerIndex:S}of e){const P=this.layers[0]._featureFilter.needGeometry,x=G(u,P);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),x,l))continue;const M={id:m,sourceLayerIndex:S,index:v,geometry:P?x.geometry:B(u,l,f),properties:u.properties,type:u.type,patterns:{}},I=this.layoutVertexArray.length,T=Cy[M.type]==="Polygon";if(this.hasPattern)this.features.push(vy("fill-extrusion",this.layers,M,this.zoom,n));else if(this.wallMode)for(const A of M.geometry)for(const D of ib(A,T))this.addFeature(M,[D],v,l,{},n.availableImages,f,n.brightness);else this.addFeature(M,M.geometry,v,l,{},n.availableImages,f,n.brightness);n.featureIndex.insert(u,M.geometry,v,S,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,l,f,u,m){for(const v of this.features){const S=Cy[v.type]==="Polygon",{geometry:P}=v;if(this.wallMode)for(const x of P)for(const M of ib(x,S))this.addFeature(v,[M],v.index,n,l,f,u,m);else this.addFeature(v,P,v.index,n,l,f,u,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,l,f,u,m,v){this.programConfigurations.updatePaintArrays(e,n,u,l,f,m,v),this.groundEffect.update(e,n,u,l,f,m,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,GE),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,VE.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,jE.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,NE.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,f,u,m,v,S){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,x=[new Ae(0,0),new Ae(vt,vt)],M=v.projection,I=M.name==="globe",T=this.wallMode||Cy[e.type]==="Polygon",A=new ob;A.centroidDataIndex=this.centroidData.length;const D=new sb,O=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},f)<=0,F=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},f);let H;if(D.height=F,D.vertexArrayOffset=this.layoutVertexArray.length,D.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new nh),this.wallMode){if(I)return void Ti("Non zero fill-extrusion-line-width is not yet supported on globe.");if(n.length!==1)return;H=function(se){const ye=se[0].x===se[se.length-1].x&&se[0].y===se[se.length-1].y;(function(Tt){let it=0;const Vt=Tt.length;for(let _t=0;_t<Vt;_t++)it+=(Tt[(_t+1)%Vt].x-Tt[_t].x)*(Tt[(_t+1)%Vt].y+Tt[_t].y);return it>=0})(se)||(se=se.reverse());const ve={geometry:[],joinNormals:[],indices:[]},Se=[],we=[],Ce=[];let ze=se.length;for(;ze>=2&&se[ze-1].equals(se[ze-2]);)ze--;if(ze<(ye?3:2))return ve;let Oe,Pe,Xe,lt,Je,mt=0;for(;mt<ze-1&&se[mt].equals(se[mt+1]);)mt++;ye&&(Oe=se[ze-2],Je=se[mt].sub(Oe)._unit()._perp());for(let Tt=mt;Tt<ze;Tt++){if(Xe=Tt===ze-1?ye?se[mt+1]:void 0:se[Tt+1],Xe&&se[Tt].equals(Xe))continue;Je&&(lt=Je),Oe&&(Pe=Oe),Oe=se[Tt],Je=Xe?Xe.sub(Oe)._unit()._perp():lt,lt=lt||Je;let it=lt.add(Je);it.x===0&&it.y===0||it._unit();const Vt=it.x*Je.x+it.y*Je.y,_t=Vt!==0?1/Vt:1/0,Ft=lt.x*Je.y-lt.y*Je.x>0;let Kt="miter";const fi=2;Kt==="miter"&&_t>fi&&(Kt="bevel"),Kt==="bevel"&&(_t>100&&(Kt="flipbevel"),_t<fi&&(Kt="miter"));const _i=(wi,gi,Ei,sn)=>{const Ki=new Ae(wi.x,wi.y),li=new Ae(wi.x,wi.y);Ki.x+=gi.x*sn,Ki.y+=gi.y*sn,li.x-=gi.x*Math.max(Ei,1),li.y-=gi.y*Math.max(Ei,1),Ce.push(gi),Se.push(Ki),we.push(li)};if(Kt==="miter")it._mult(_t),_i(Oe,it,0,0);else if(Kt==="flipbevel")it=Je.mult(-1),_i(Oe,it,0,0),_i(Oe,it.mult(-1),0,0);else{const wi=-Math.sqrt(_t*_t-1),gi=Ft?wi:0,Ei=Ft?0:wi;Pe&&_i(Oe,lt,gi,Ei),Xe&&_i(Oe,Je,gi,Ei)}}ve.geometry=[...Se,...we.reverse(),Se[0]],ve.joinNormals=[...Ce,...Ce.reverse(),Ce[Ce.length-1]];const pt=ve.geometry.length-1;for(let Tt=0;Tt<pt/2;Tt++)if(Tt+1<pt/2){let it=Tt,Vt=Tt+1,_t=pt-1-Tt,Ft=pt-2-Tt;it=it===0?pt-1:it-1,Vt=Vt===0?pt-1:Vt-1,_t=_t===0?pt-1:_t-1,Ft=Ft===0?pt-1:Ft-1,ve.indices.push(_t),ve.indices.push(Vt),ve.indices.push(it),ve.indices.push(_t),ve.indices.push(Ft),ve.indices.push(Vt)}return ve}(n[0]),n=[H.geometry]}const q=(se,ye)=>se<(ye.length-1)/2||se===ye.length-1,U=this.wallMode?[n]:Bm(n,500);for(let se=U.length-1;se>=0;se--){const ye=U[se];(ye.length===0||($=ye[0]).every(ce=>ce.x<=0)||$.every(ce=>ce.x>=vt)||$.every(ce=>ce.y<=0)||$.every(ce=>ce.y>=vt))&&U.splice(se,1)}var $;let Z;if(I)Z=mb(U,x,f);else{Z=[];for(const se of U)Z.push({polygon:se,bounds:x})}const K=T?this.edgeRadius:0,ae=K>0&&this.zoom<17,oe=(se,ye)=>{if(se.length===0)return!1;const ce=se[se.length-1];return ye.x===ce.x&&ye.y===ce.y};for(const{polygon:se,bounds:ye}of Z){let ce=0,ve=0;for(const ze of se)T&&!ze[0].equals(ze[ze.length-1])&&ze.push(ze[0]),ve+=T?ze.length-1:ze.length;const Se=this.segments.prepareSegment((T?5:4)*ve,this.layoutVertexArray,this.indexArray);D.footprintSegIdx<0&&(D.footprintSegIdx=this.footprintSegments.length),D.polygonSegIdx<0&&(D.polygonSegIdx=this.polygonSegments.length);const we={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ce=new rb;if(Ce.vertexOffset=this.footprintVertices.length,Ce.indexOffset=3*this.footprintIndices.length,Ce.ringIndices=[],T){const ze=[],Oe=[];ce=Se.vertexLength;for(let Xe=0;Xe<se.length;Xe++){const lt=se[Xe];lt.length&&Xe!==0&&Oe.push(ze.length/2);const Je=[];let mt,pt;mt=lt[1].sub(lt[0])._perp()._unit(),Ce.ringIndices.push(lt.length-1);for(let Tt=1;Tt<lt.length;Tt++){const it=lt[Tt],Vt=lt[Tt===lt.length-1?1:Tt+1],_t=it.clone();if(K){pt=Vt.sub(it)._perp()._unit();const Ft=mt.add(pt)._unit(),Kt=K*Math.min(4,1/(mt.x*Ft.x+mt.y*Ft.y));_t.x+=Kt*Ft.x,_t.y+=Kt*Ft.y,_t.x=Math.round(_t.x),_t.y=Math.round(_t.y),mt=pt}if(!O||K!==0&&!ae||oe(Je,_t)||Je.push(_t),cf(this.layoutVertexArray,_t.x,_t.y,0,0,1,1,0),this.wallMode){const Ft=q(Tt,lt);uf(this.wallVertexArray,H.joinNormals[Tt],!Ft)}Se.vertexLength++,this.footprintVertices.emplaceBack(it.x,it.y),ze.push(it.x,it.y),I&&hf(this.layoutVertexExtArray,M.projectTilePoint(_t.x,_t.y,f),M.upVector(f,_t.x,_t.y))}O&&(K===0||ae)&&(Je.length!==0&&oe(Je,Je[0])&&Je.pop(),this.groundEffect.addData(Je,ye,P))}const Pe=this.wallMode?H.indices:sf(ze,Oe);for(let Xe=0;Xe<Pe.length;Xe+=3)this.footprintIndices.emplaceBack(Ce.vertexOffset+Pe[Xe+0],Ce.vertexOffset+Pe[Xe+1],Ce.vertexOffset+Pe[Xe+2]),this.indexArray.emplaceBack(ce+Pe[Xe],ce+Pe[Xe+2],ce+Pe[Xe+1]),Se.primitiveLength++;Ce.indexCount+=Pe.length,Ce.vertexCount+=this.footprintVertices.length-Ce.vertexOffset}for(let ze=0;ze<se.length;ze++){const Oe=se[ze];A.startRing(D,Oe[0]);let Pe=Oe.length>4&&db(Oe[Oe.length-2],Oe[0],Oe[1]),Xe=K?KE(Oe[Oe.length-2],Oe[0],Oe[1],K):0;const lt=[];let Je,mt,pt;mt=Oe[1].sub(Oe[0])._perp()._unit();let Tt=!0;for(let it=1,Vt=0;it<Oe.length;it++){let _t=Oe[it-1],Ft=Oe[it];const Kt=Oe[it===Oe.length-1?1:it+1];if(A.appendEdge(D,Ft,_t),Py(Ft,_t,ye)){K&&(mt=Kt.sub(Ft)._perp()._unit(),Tt=!Tt);continue}const fi=Ft.sub(_t)._perp(),_i=fi.x/(Math.abs(fi.x)+Math.abs(fi.y)),wi=fi.y>0?1:0,gi=_t.dist(Ft);if(Vt+gi>32768&&(Vt=0),K){pt=Kt.sub(Ft)._perp()._unit();let li=ub(_t,Ft,Kt,cb(mt,pt),K);isNaN(li)&&(li=0);const Ji=Ft.sub(_t)._unit();_t=_t.add(Ji.mult(Xe))._round(),Ft=Ft.add(Ji.mult(-li))._round(),Xe=li,mt=pt,O&&this.zoom>=17&&(oe(lt,_t)||lt.push(_t),oe(lt,Ft)||lt.push(Ft))}const Ei=Se.vertexLength,sn=Oe.length>4&&db(_t,Ft,Kt);let Ki=fb(Vt,Pe,Tt);if(cf(this.layoutVertexArray,_t.x,_t.y,_i,wi,0,0,Ki),cf(this.layoutVertexArray,_t.x,_t.y,_i,wi,0,1,Ki),this.wallMode){const li=q(it-1,Oe),Ji=H.joinNormals[it-1];uf(this.wallVertexArray,Ji,li),uf(this.wallVertexArray,Ji,li)}if(Vt+=gi,Ki=fb(Vt,sn,!Tt),Pe=sn,cf(this.layoutVertexArray,Ft.x,Ft.y,_i,wi,0,0,Ki),cf(this.layoutVertexArray,Ft.x,Ft.y,_i,wi,0,1,Ki),this.wallMode){const li=q(it,Oe),Ji=H.joinNormals[it];uf(this.wallVertexArray,Ji,li),uf(this.wallVertexArray,Ji,li)}if(Se.vertexLength+=4,this.indexArray.emplaceBack(Ei+0,Ei+1,Ei+2),this.indexArray.emplaceBack(Ei+1,Ei+3,Ei+2),Se.primitiveLength+=2,K){const li=ce+(it===1?Oe.length-2:it-2),Ji=it===1?ce:li+1;if(this.indexArray.emplaceBack(Ei+1,li,Ei+3),this.indexArray.emplaceBack(li,Ji,Ei+3),Se.primitiveLength+=2,Je===void 0&&(Je=Ei),!Py(Kt,Oe[it],ye)){const $i=it===Oe.length-1?Je:Se.vertexLength;this.indexArray.emplaceBack(Ei+2,Ei+3,$i),this.indexArray.emplaceBack(Ei+3,$i+1,$i),this.indexArray.emplaceBack(Ei+3,Ji,$i+1),Se.primitiveLength+=3}Tt=!Tt}if(I){const li=this.layoutVertexExtArray,Ji=M.projectTilePoint(_t.x,_t.y,f),$i=M.projectTilePoint(Ft.x,Ft.y,f),on=M.upVector(f,_t.x,_t.y),Zn=M.upVector(f,Ft.x,Ft.y);hf(li,Ji,on),hf(li,Ji,on),hf(li,$i,Zn),hf(li,$i,Zn)}}T&&(ce+=Oe.length-1),O&&K&&this.zoom>=17&&(lt.length!==0&&oe(lt,lt[0])&&lt.pop(),this.groundEffect.addData(lt,ye,P,K>0))}this.footprintSegments.push(Ce),we.triangleCount=this.indexArray.length-we.triangleArrayOffset,this.polygonSegments.push(we),++D.footprintSegLen,++D.polygonSegLen}if(D.vertexCount=this.layoutVertexArray.length-D.vertexArrayOffset,D.groundVertexCount=this.groundEffect.vertexArray.length-D.groundVertexArrayOffset,D.vertexCount!==0){if(D.centroidXY=A.borders?nb:this.encodeCentroid(A,D),this.centroidData.push(D),A.borders){this.featuresOnBorder.push(A);const se=this.featuresOnBorder.length-1;for(let ye=0;ye<A.borders.length;ye++)A.borders[ye][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ye].push(se)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,u,m,f,S),this.groundEffect.addPaintPropertiesData(e,l,u,m,f,S),this.maxHeight=Math.max(this.maxHeight,F)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,l)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const S=this.centroidData[v],P=+(S.min.y+S.max.y>vt),x=2*P+(+(S.min.x+S.max.x>vt)^P);for(let M=0;M<S.polygonSegLen;M++){const I=S.polygonSegIdx+M;e.push({centroidIdx:v,subtile:x,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const n=new vr;e.sort((v,S)=>v.triangleSegmentIdx===S.triangleSegmentIdx?v.subtile-S.subtile:v.triangleSegmentIdx-S.triangleSegmentIdx);let l=0,f=0,u=0;for(const v of e){if(v.triangleSegmentIdx!==l)break;u++}const m=e.length;for(;f!==e.length;){l=e[f].triangleSegmentIdx;let v=0,S=f,P=f;for(let x=S;x<u&&e[x].subtile===v;x++)P++;for(;S!==u;){const x=e[S];v=x.subtile;const M=this.centroidData[x.centroidIdx].min.clone(),I=this.centroidData[x.centroidIdx].max.clone(),T={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let A=S;A<P;A++){const D=e[A],O=this.polygonSegments[D.polygonSegmentIdx],F=this.centroidData[D.centroidIdx].min,H=this.centroidData[D.centroidIdx].max,q=this.indexArray.uint16;for(let U=O.triangleArrayOffset;U<O.triangleArrayOffset+O.triangleCount;U++)n.emplaceBack(q[3*U],q[3*U+1],q[3*U+2]);T.primitiveLength+=O.triangleCount,M.x=Math.min(M.x,F.x),M.y=Math.min(M.y,F.y),I.x=Math.max(I.x,H.x),I.y=Math.max(I.y,H.y)}T.primitiveLength>0&&this.triangleSubSegments.push({segment:T,min:M,max:I}),S=P;for(let A=S;A<u&&e[A].subtile===e[S].subtile;A++)P++}f=u;for(let x=f;x<m&&e[x].triangleSegmentIdx===e[f].triangleSegmentIdx;x++)u++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,l){const f=new En;if(this.wallMode){for(const D of this.triangleSubSegments)f.segments.push(D.segment);return f}let u=0,m=0;const v=1<<e.canonical.z;if(n){const D=n.getMinMaxForTile(e);D&&(u=D.min,m=D.max)}m+=this.maxHeight;const S=e.toUnwrapped();let P;const x=[S.canonical.x/v+S.wrap,S.canonical.y/v],M=[(S.canonical.x+1)/v+S.wrap,(S.canonical.y+1)/v],I=(D,O,F)=>[D[0]*(1-F[0])+O[0]*F[0],D[1]*(1-F[1])+O[1]*F[1]],T=[],A=[];for(const D of this.triangleSubSegments){T[0]=D.min.x/vt,T[1]=D.min.y/vt,A[0]=D.max.x/vt,A[1]=D.max.y/vt;const O=I(x,M,T),F=I(x,M,A);if(new ei([O[0],O[1],u],[F[0],F[1],m]).intersectsPrecise(l)===0){P&&(f.segments.push(P),P=void 0);continue}const H=D.segment;P&&P.vertexOffset!==H.vertexOffset&&(f.segments.push(P),P=void 0),P?(P.vertexLength+=H.vertexLength,P.primitiveLength+=H.primitiveLength):P={vertexOffset:H.vertexOffset,primitiveLength:H.primitiveLength,vertexLength:H.vertexLength,primitiveOffset:H.primitiveOffset,sortKey:void 0,vaos:{}}}return P&&f.segments.push(P),f}encodeCentroid(e,n){const l=e.centroid(),f=n.span(),u=Math.min(7,Math.round(f.x*this.tileToMeter/10)),m=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new Ae(At(l.x,1,vt-1)<<3|u,At(l.y,1,vt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new Ae(0,0);const n=e.borders,l=Number.MAX_VALUE;if(n[0][0]!==l||n[1][0]!==l){const f=n[0][0]!==l?0:1;return new Ae(6|(n[0][0]!==l?0:65528),(n[f][0]+n[f][1])/2<<3|6)}{const f=n[2][0]!==l?2:3;return new Ae((n[f][0]+n[f][1])/2<<3|6,6|(n[2][0]!==l?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=Il,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,f=e.flags&Il?nb:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==f.y||u!==f.x){for(let m=n;m<l;++m)this.centroidVertexArray.emplace(m,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,l){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const f=n.getReplacementRegionsForTile(e.toUnwrapped());if(Ay(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const u=[];for(const m of this.activeReplacements){if(m.order<l)continue;const v=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const S of this.centroidData)if(!(S.flags&Il||m.min.x>S.max.x||S.min.x>m.max.x||m.min.y>S.max.y||S.min.y>m.max.y))for(let P=0;P<S.footprintSegLen;P++){const x=this.footprintSegments[S.footprintSegIdx+P];if(u.length=0,JE(this.footprintVertices,x.vertexOffset,x.vertexCount,m.footprintTileId.canonical,e.canonical,u),Jv(m.footprint,u,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-v)){S.flags|=Il;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,l){let f=!1;for(let u=0;u<l.footprintSegLen;u++){const m=this.footprintSegments[l.footprintSegIdx+u];let v=0;for(const S of m.ringIndices){for(let P=v,x=S+v-1;P<S+v;x=P++){const M=this.footprintVertices.int16[2*(P+m.vertexOffset)+0],I=this.footprintVertices.int16[2*(P+m.vertexOffset)+1],T=this.footprintVertices.int16[2*(x+m.vertexOffset)+1];I>n!=T>n&&e<(this.footprintVertices.int16[2*(x+m.vertexOffset)+0]-M)*(n-I)/(T-I)+M&&(f=!f)}v=S}}return f}getHeightAtTileCoord(e,n){let l=Number.NEGATIVE_INFINITY,f=!0;const u=4*(e+vt)*vt+(n+vt);if(this.partLookup.hasOwnProperty(u)){const m=this.partLookup[u];return m?{height:m.height,hidden:!!(m.flags&Il)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||n>m.max.y||m.min.y>n||this.footprintContainsPoint(e,n,m)&&m&&m.height>l&&(l=m.height,this.partLookup[u]=m,f=!!(m.flags&Il));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:f};this.partLookup[u]=void 0}}function cb(o,e){const n=o.add(e)._unit();return o.x*n.x+o.y*n.y}function KE(o,e,n,l){const f=e.sub(o)._perp()._unit(),u=n.sub(e)._perp()._unit();return ub(o,e,n,cb(f,u),l)}function ub(o,e,n,l,f){const u=Math.sqrt(1-l*l);return Math.min(o.dist(e)/3,e.dist(n)/3,f*u/l)}function Py(o,e,n){return o.x<n[0].x&&e.x<n[0].x||o.x>n[1].x&&e.x>n[1].x||o.y<n[0].y&&e.y<n[0].y||o.y>n[1].y&&e.y>n[1].y}function hb(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function db(o,e,n){if(o.x<0||o.x>=vt||e.x<0||e.x>=vt||n.x<0||n.x>=vt)return!1;const l=n.sub(e),f=l.perp(),u=o.sub(e);return(l.x*u.x+l.y*u.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(u.x*u.x+u.y*u.y))>-.866&&f.x*u.x+f.y*u.y<0}function fb(o,e,n){const l=e?2|o:-3&o;return n?1|l:-2&l}function pb(){const o=Math.PI/32,e=Math.tan(o),n=El;return n*Math.sqrt(1+2*e*e)-n}function mb(o,e,n){const l=1<<n.z,f=Xr(n.x/l),u=Xr((n.x+1)/l),m=mr(n.y/l),v=mr((n.y+1)/l);return function(S,P,x,M,I=0,T){const A=[];if(!S.length||!x||!M)return A;const D=(Z,K)=>{for(const ae of Z)A.push({polygon:ae,bounds:K})},O=Math.ceil(Math.log2(x)),F=Math.ceil(Math.log2(M)),H=O-F,q=[];for(let Z=0;Z<Math.abs(H);Z++)q.push(H>0?0:1);for(let Z=0;Z<Math.min(O,F);Z++)q.push(0),q.push(1);let U=S;if(U=Vm(U,P[0].y-I,P[1].y+I,1),U=Vm(U,P[0].x-I,P[1].x+I,0),!U.length)return A;const $=[];for(q.length?$.push({polygons:U,bounds:P,depth:0}):D(U,P);$.length;){const Z=$.pop(),K=Z.depth,ae=q[K],oe=Z.bounds[0],se=Z.bounds[1],ye=ae===0?oe.x:oe.y,ce=ae===0?se.x:se.y,ve=T(ae,ye,ce),Se=Vm(Z.polygons,ye-I,ve+I,ae),we=Vm(Z.polygons,ve-I,ce+I,ae);if(Se.length){const Ce=[oe,new Ae(ae===0?ve:se.x,ae===1?ve:se.y)];q.length>K+1?$.push({polygons:Se,bounds:Ce,depth:K+1}):D(Se,Ce)}if(we.length){const Ce=[new Ae(ae===0?ve:oe.x,ae===1?ve:oe.y),se];q.length>K+1?$.push({polygons:we,bounds:Ce,depth:K+1}):D(we,Ce)}}return A}(o,e,Math.ceil((u-f)/11.25),Math.ceil((m-v)/11.25),1,(S,P,x)=>{if(S===0)return .5*(P+x);{const M=mr((n.y+P/vt)/l);return(xo(.5*(mr((n.y+x/vt)/l)+M))*l-n.y)*vt}})}function JE(o,e,n,l,f,u){const m=Math.pow(2,l.z-f.z);for(let v=0;v<n;v++){let S=o.int16[2*(v+e)+0],P=o.int16[2*(v+e)+1];S=(S+f.x*vt)*m-l.x*vt,P=(P+f.y*vt)*m-l.y*vt,u.push(new Ae(S,P))}}let _b,gb;function df(o,e){return o.x*e.x+o.y*e.y}function yb(o,e){if(o.length===1){let n=0;const l=e[n++];let f;for(;!f||l.equals(f);)if(f=e[n++],!f)return 1/0;for(;n<e.length;n++){const u=e[n],m=o[0],v=f.sub(l),S=u.sub(l),P=m.sub(l),x=df(v,v),M=df(v,S),I=df(S,S),T=df(P,v),A=df(P,S),D=x*I-M*M,O=(I*T-M*A)/D,F=(x*A-M*T)/D,H=l.z*(1-O-F)+f.z*O+u.z*F;if(isFinite(H))return H}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}function xb(o,e,n,l,f,u,m,v){const S=m*f.getElevationAt(o,e,!0,!0),P=u[0]!==0,x=P?u[1]===0?m*(u[0]/7-450):m*function(M,I,T){const A=Math.floor(I[0]/8),D=Math.floor(I[1]/8),O=10*(I[0]-8*A),F=10*(I[1]-8*D),H=M.getElevationAt(A,D,!0,!0),q=M.getMeterToDEM(T),U=Math.floor(.5*(O*q-1)),$=Math.floor(.5*(F*q-1)),Z=M.tileCoordToPixel(A,D),K=2*U+1,ae=2*$+1,oe=function(we,Ce,ze,Oe,Pe){return[we.getElevationAtPixel(Ce,ze,!0),we.getElevationAtPixel(Ce+Pe,ze,!0),we.getElevationAtPixel(Ce,ze+Pe,!0),we.getElevationAtPixel(Ce+Oe,ze+Pe,!0)]}(M,Z.x-U,Z.y-$,K,ae),se=Math.abs(oe[0]-oe[1]),ye=Math.abs(oe[2]-oe[3]),ce=Math.abs(oe[0]-oe[2])+Math.abs(oe[1]-oe[3]),ve=Math.min(.25,.5*q*(se+ye)/K),Se=Math.min(.25,.5*q*ce/ae);return H+Math.max(ve*O,Se*F)}(f,u,v):S;return{base:S+(n===0?-1:n),top:P?Math.max(x+l,S+n+2):S+l}}Ot(Hm,"FillExtrusionBucket",{omit:["layers","features"]}),Ot(sb,"PartData"),Ot(rb,"FootprintSegment"),Ot(ob,"BorderCentroidData"),Ot(lb,"GroundEffect");const QE=Ni([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),eA=Ni([{name:"a_z_offset_width",components:2,type:"Float32"}],4),{members:tA}=QE,iA=Ni([{name:"a_packed",components:4,type:"Float32"}]),{members:nA}=iA,rA=Ni([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:sA}=rA;class vb{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Al({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const l=this.getKey(e,n);return this.positions[l]}trim(){const e=this.width,n=this.height=Pr(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,l){const f=[];let u=e.length%2==1?-e[e.length-1]*l:0,m=e[0]*l,v=!0;f.push({left:u,right:m,isDash:v,zeroLength:e[0]===0});let S=e[0];for(let P=1;P<e.length;P++){v=!v;const x=e[P];u=S*l,S+=x,m=S*l,f.push({left:u,right:m,isDash:v,zeroLength:x===0})}return f}addRoundDash(e,n,l){const f=n/2;for(let u=-l;u<=l;u++){const m=this.width*(this.nextRow+l+u);let v=0,S=e[v];for(let P=0;P<this.width;P++){P/S.right>1&&(S=e[++v]);const x=Math.abs(P-S.left),M=Math.abs(P-S.right),I=Math.min(x,M);let T;const A=u/l*(f+1);if(S.isDash){const D=f-Math.abs(A);T=Math.sqrt(I*I+D*D)}else T=f-Math.sqrt(I*I+A*A);this.image.data[m+P]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(e,n){for(let S=e.length-1;S>=0;--S){const P=e[S],x=e[S+1];P.zeroLength?e.splice(S,1):x&&x.isDash===P.isDash&&(x.left=P.left,e.splice(S,1))}const l=e[0],f=e[e.length-1];l.isDash===f.isDash&&(l.left=f.left-this.width,f.right=l.right+this.width);const u=this.width*this.nextRow;let m=0,v=e[m];for(let S=0;S<this.width;S++){S/v.right>1&&(v=e[++m]);const P=Math.abs(S-v.left),x=Math.abs(S-v.right),M=Math.min(P,x);this.image.data[u+S]=Math.max(0,Math.min(255,(v.isDash?M:-M)+n+128))}}addDash(e,n){const l=this.getKey(e,n);if(this.positions[l])return this.positions[l];const f=n==="round",u=f?7:0,m=2*u+1;if(this.nextRow+m>this.height)return Ti("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let x=0;x<e.length;x++)e[x]<0&&(Ti("Negative value is found in line dasharray, replacing values with 0"),e[x]=0),v+=e[x];if(v!==0){const x=this.width/v,M=this.getDashRanges(e,this.width,x);f?this.addRoundDash(M,x,u):this.addRegularDash(M,n==="square"?.5*x:0)}const S=this.nextRow+u;this.nextRow+=m;const P={tl:[S,u],br:[v,0]};return this.positions[l]=P,P}}Ot(vb,"LineAtlas");const oA=vh.VectorTileFeature.types,aA=Math.cos(Math.PI/180*37.5),lA=Math.cos(Math.PI/180*5);class Dy{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new kd,this.layoutVertexArray2=new _o,this.patternVertexArray=new Go,this.indexArray=new vr,this.programConfigurations=new Zo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new En,this.maxLineLength=0,this.zOffsetVertexArray=new go,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:vt/64}updateFootprints(e,n){}populate(e,n,l,f){this.hasPattern=xy("line",this.layers,n);const u=this.layers[0].layout.get("line-sort-key");this.tileToMeter=d(l),this.hasZOffset=!this.layers[0].isDraped();const m=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&m==="none"&&Ti(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&v!==void 0;const S=[];for(const{feature:I,id:T,index:A,sourceLayerIndex:D}of e){const O=this.layers[0]._featureFilter.needGeometry,F=G(I,O);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),F,l))continue;const H=u?u.evaluate(F,{},l):void 0,q={id:T,properties:I.properties,type:I.type,sourceLayerIndex:D,index:A,geometry:O?F.geometry:B(I,l,f),patterns:{},sortKey:H};S.push(q)}u&&S.sort((I,T)=>I.sortKey-T.sortKey);const{lineAtlas:P,featureIndex:x}=n,M=this.addConstantDashes(P);for(const I of S){const{geometry:T,index:A,sourceLayerIndex:D}=I;if(M&&this.addFeatureDashes(I,P),this.hasPattern){const O=vy("line",this.layers,I,this.zoom,n);this.patternFeatures.push(O)}else this.addFeature(I,T,A,l,P.positions,n.availableImages,n.brightness);x.insert(e[A].feature,T,A,D,this.index)}}addConstantDashes(e){let n=!1;for(const l of this.layers){const f=l.paint.get("line-dasharray").value,u=l.layout.get("line-cap").value;if(f.kind!=="constant"||u.kind!=="constant")n=!0;else{const m=u.value,v=f.value;if(!v)continue;e.addDash(v,m)}}return n}addFeatureDashes(e,n){const l=this.zoom;for(const f of this.layers){const u=f.paint.get("line-dasharray").value,m=f.layout.get("line-cap").value;if(u.kind==="constant"&&m.kind==="constant")continue;let v,S;if(u.kind==="constant"){if(v=u.value,!v)continue}else v=u.evaluate({zoom:l},e);S=m.kind==="constant"?m.value:m.evaluate({zoom:l},e),n.addDash(v,S),e.patterns[f.id]=n.getKey(v,S)}}update(e,n,l,f,u,m,v){this.programConfigurations.updatePaintArrays(e,n,u,l,f,m,v)}addFeatures(e,n,l,f,u,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,n,l,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,nA)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,sA)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,eA.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,l,f,u,m,v){const S=this.layers[0].layout,P=S.get("line-join").evaluate(e,{}),x=S.get("line-cap").evaluate(e,{}),M=S.get("line-miter-limit"),I=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=S.get("line-z-offset").value;const T=this.layers[0].paint.get("line-width").value;T.kind!=="constant"&&T.isLineProgressConstant===!1&&(this.variableWidthValue=T);for(const A of n)this.addLine(A,e,f,P,x,M,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,u,m,f,v)}addLine(e,n,l,f,u,m,v){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const S=f==="none";if(this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<e.length-1;q++)this.totalDistance+=e[q].dist(e[q+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=oA[n.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let M=0;for(;M<x-1&&e[M].equals(e[M+1]);)M++;if(x<(P?3:2))return;f==="bevel"&&(m=1.05);const I=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let T,A,D,O,F,H;this.e1=this.e2=-1,P&&(T=e[x-2],F=e[M].sub(T)._unit()._perp());for(let q=M;q<x;q++){if(D=q===x-1?P?e[M+1]:void 0:e[q+1],D&&e[q].equals(D))continue;F&&(O=F),T&&(A=T),T=e[q],H=this.evaluateLineProgressFeatures(A?A.dist(T):0),F=D?D.sub(T)._unit()._perp():O,O=O||F;const U=A&&D;let $=U?f:P||S?"butt":u;const Z=O.x*F.x+O.y*F.y;if(S){const Se=function(we){if(we.patternJoinNone){const Ce=we.segmentPoints.length/2,ze=we.lineSoFar-we.segmentStart;for(let Oe=0;Oe<Ce;++Oe){const Pe=we.segmentPoints[2*Oe+1],Xe=Math.round(we.segmentPoints[2*Oe])+.5+.25*Pe;we.patternVertexArray.emplaceBack(Xe,ze,we.segmentStart),we.patternVertexArray.emplaceBack(Xe,ze,we.segmentStart)}we.segmentPoints.length=0}we.e1=we.e2=-1};if(U&&Z<lA){this.updateDistance(A,T),this.addCurrentVertex(T,O,1,1,I,H),Se(this),this.addCurrentVertex(T,F,-1,-1,I,H);continue}if(A){if(!D){this.updateDistance(A,T),this.addCurrentVertex(T,O,1,1,I,H),Se(this);continue}$="miter"}}let K=O.add(F);K.x===0&&K.y===0||K._unit();const ae=K.x*F.x+K.y*F.y,oe=ae!==0?1/ae:1/0,se=2*Math.sqrt(2-2*ae),ye=ae<aA&&A&&D,ce=O.x*F.y-O.y*F.x>0,ve=this.overscaling<=16?15*vt/(512*this.overscaling):0;if(U&&$==="round"){if(oe<v)$="miter";else if(oe<=2){const Se=zy(T,-10,vt+10);$=this.hasZOffset&&(Se||this.hasCrossSlope)?"miter":"fakeround"}}if($==="miter"&&oe>m&&($="bevel"),$==="bevel"&&(oe>2&&($="flipbevel"),oe<m&&($="miter")),A&&!($==="miter"&&ye)&&this.updateDistance(A,T),$==="miter")if(ye){const Se=T.dist(A);if(Se>2*ve){const Ce=T.sub(T.sub(A)._mult(ve/Se)._round());this.updateDistance(A,Ce),this.addCurrentVertex(Ce,O,0,0,I,H),A=Ce}this.updateDistance(A,T),K._mult(oe),this.addCurrentVertex(T,K,0,0,I,H);const we=T.dist(D);if(we>2*ve){const Ce=T.add(D.sub(T)._mult(ve/we)._round());this.updateDistance(T,Ce),this.addCurrentVertex(Ce,F,0,0,I,H),T=Ce}}else K._mult(oe),this.addCurrentVertex(T,K,0,0,I,H);else if($==="flipbevel"){if(oe>100)K=F.mult(-1);else{const Se=oe*O.add(F).mag()/O.sub(F).mag();K._perp()._mult(Se*(ce?-1:1))}this.addCurrentVertex(T,K,0,0,I,H),this.addCurrentVertex(T,K.mult(-1),0,0,I,H)}else if($==="bevel"||$==="fakeround"){H!=null&&A&&this.addCurrentVertex(T,O,-1,-1,I,H);const Se=T.dist(A)<=2*ve&&$!=="bevel",we=K.mult(ce?1:-1);we._mult(oe);const Ce=F.mult(ce?-1:1),ze=O.mult(ce?-1:1),Oe=this.evaluateLineProgressFeatures(this.distance);if(H==null&&(this.addHalfVertex(T,we.x,we.y,!1,!ce,0,I,Oe),Se||this.addHalfVertex(T,we.x+2*ze.x,we.y+2*ze.y,!1,ce,0,I,Oe)),$==="fakeround"){const Pe=Math.round(180*se/Math.PI/20);this.addHalfVertex(T,ze.x,ze.y,!1,ce,0,I,Oe);for(let Xe=0;Xe<Pe;Xe++){let lt=Xe/Pe;if(lt!==.5){const mt=lt-.5;lt+=lt*mt*(lt-1)*((1.0904+Z*(Z*(3.55645-1.43519*Z)-3.2452))*mt*mt+(.848013+Z*(.215638*Z-1.06021)))}const Je=Ce.sub(ze)._mult(lt)._add(ze)._unit();this.addHalfVertex(T,Je.x,Je.y,!1,ce,0,I,Oe)}this.addHalfVertex(T,Ce.x,Ce.y,!1,ce,0,I,Oe)}Se||H!=null||this.addHalfVertex(T,we.x+2*Ce.x,we.y+2*Ce.y,!1,ce,0,I,Oe),H!=null&&D&&this.addCurrentVertex(T,F,1,1,I,H)}else $==="butt"?this.addCurrentVertex(T,K,0,0,I,H):$==="square"?(A||this.addCurrentVertex(T,K,-1,-1,I,H),this.addCurrentVertex(T,K,0,0,I,H),A&&this.addCurrentVertex(T,K,1,1,I,H)):$==="round"&&(A&&(this.addCurrentVertex(T,O,0,0,I,H),this.addCurrentVertex(T,O,1,1,I,H,!0)),D&&(this.addCurrentVertex(T,F,-1,-1,I,H,!0),this.addCurrentVertex(T,F,0,0,I,H)))}}addVerticesTo(e,n,l,f,u,m,v,S,P,x){const M=(n.w-e.w)/this.tessellationStep|0;let I=0;const T=this.scaledDistance;if(M>1){this.lineSoFar=e.w;const D=(n.x-e.x)/M,O=(n.y-e.y)/M,F=(n.z-e.z)/M,H=(n.w-e.w)/M;for(let q=1;q<M;++q){e.x+=D,e.y+=O,e.z+=F,this.lineSoFar+=H,I+=H;const U=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(e,l,f,x,!1,v,P,U),this.addHalfVertex(e,u,m,x,!0,-S,P,U)}}this.lineSoFar=n.w,this.scaledDistance=T;const A=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,l,f,x,!1,v,P,A),this.addHalfVertex(n,u,m,x,!0,-S,P,A)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ti(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}:{zOffset:0,variableWidth:n}}addCurrentVertex(e,n,l,f,u,m,v=!1){const S=n.x+n.y*l,P=n.y-n.x*l,x=n.y*f-n.x,M=-n.y-n.x*f;if(m!=null){const I=this.hasZOffset,T=-10,A=vt+10,D=m.zOffset,O=new $v(e.x,e.y,D,this.lineSoFar),F=!!I&&zy(e,T,A),H=this.lineSoFar,q=this.distance;if(this.currentVertex)if(F){const U=this.currentVertexIsOutside,$=this.currentVertex,Z=new $v(e.x,e.y,D,this.lineSoFar);if(Zv($,Z,T,A),!zy(Z,T,A)){if(U){this.e1=this.e2=-1,this.distance-=$.dist(O),this.lineSoFar=$.w;const K=this.evaluateLineProgressFeatures($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,S,P,v,!1,l,u,K),this.addHalfVertex($,x,M,v,!0,-f,u,K),this.prevDistance=this.distance}this.distance=this.prevDistance+$.dist(Z),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo($,Z,S,P,x,M,l,f,u,v),this.distance=q,this.scaledDistance=this.distance/this.totalDistance}}else{const U=this.currentVertex;if(this.currentVertexIsOutside){Zv(U,O,T,A),this.e1=this.e2=-1,this.distance-=U.dist(O),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=U.w;const $=this.evaluateLineProgressFeatures(U.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(U,S,P,v,!1,l,u,$),this.addHalfVertex(U,x,M,v,!0,-f,u,$),this.prevDistance=this.distance,this.distance=q,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(U,O,S,P,x,M,l,f,u,v)}else F||(this.addHalfVertex(e,S,P,v,!1,l,u,m),this.addHalfVertex(e,x,M,v,!0,-f,u,m));this.currentVertex=O,this.currentVertexIsOutside=F,this.lineSoFar=H}else this.addHalfVertex(e,S,P,v,!1,l,u,m),this.addHalfVertex(e,x,M,v,!0,-f,u,m)}addHalfVertex({x:e,y:n},l,f,u,m,v,S,P){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(n<<1)+(m?1:0),Math.round(63*l)+128,Math.round(63*f)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),S.primitiveLength++),m?this.e2=x:this.e1=x,P!=null&&this.zOffsetVertexArray.emplaceBack(P.zOffset,P.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function zy(o,e,n){return o.x<e||o.x>n||o.y<e||o.y>n}let bb,wb;function Tb(o,e,n){return e*(vt/(o.tileSize*Math.pow(2,n-o.tileID.overscaledZ)))}Ot(Dy,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Sb=(o,e,n)=>(1-n)*o+n*e;function Mb(o,e){return 1/Tb(o,1,e.tileZoom)}function Eb(o,e,n,l){return o.translatePosMatrix(l||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Ab=o=>{const e=[];Ib(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=o.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=o.layout.get("line-join").constantOr("miter")==="none",f=!!o.paint.get("line-pattern").constantOr(1);return l&&f&&e.push("LINE_JOIN_NONE"),e};function Ib(o){const e=o.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Ry;const Cb=()=>Ry||(Ry={layout:bb||(bb=new Mn({"line-cap":new Dt(je.layout_line["line-cap"]),"line-join":new Dt(je.layout_line["line-join"]),"line-miter-limit":new dt(je.layout_line["line-miter-limit"]),"line-round-limit":new dt(je.layout_line["line-round-limit"]),"line-sort-key":new Dt(je.layout_line["line-sort-key"]),"line-z-offset":new Dt(je.layout_line["line-z-offset"]),"line-elevation-reference":new dt(je.layout_line["line-elevation-reference"]),"line-cross-slope":new dt(je.layout_line["line-cross-slope"]),visibility:new dt(je.layout_line.visibility),"line-width-unit":new dt(je.layout_line["line-width-unit"])})),paint:wb||(wb=new Mn({"line-opacity":new Dt(je.paint_line["line-opacity"]),"line-color":new Dt(je.paint_line["line-color"]),"line-translate":new dt(je.paint_line["line-translate"]),"line-translate-anchor":new dt(je.paint_line["line-translate-anchor"]),"line-width":new Dt(je.paint_line["line-width"]),"line-gap-width":new Dt(je.paint_line["line-gap-width"]),"line-offset":new Dt(je.paint_line["line-offset"]),"line-blur":new Dt(je.paint_line["line-blur"]),"line-dasharray":new Dt(je.paint_line["line-dasharray"]),"line-pattern":new Dt(je.paint_line["line-pattern"]),"line-gradient":new gl(je.paint_line["line-gradient"]),"line-trim-offset":new dt(je.paint_line["line-trim-offset"]),"line-trim-fade-range":new dt(je.paint_line["line-trim-fade-range"]),"line-trim-color":new dt(je.paint_line["line-trim-color"]),"line-emissive-strength":new dt(je.paint_line["line-emissive-strength"]),"line-border-width":new Dt(je.paint_line["line-border-width"]),"line-border-color":new Dt(je.paint_line["line-border-color"]),"line-occlusion-opacity":new dt(je.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},Ry);class cA extends Dt{possiblyEvaluate(e,n){return n=new yn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,l,f){return n=Li({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,l,f)}}let ff;function Pb(o,e){return e>0?e+2*o:o}const uA=Ni([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hA=Ni([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),dA=Ni([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ni([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const fA=Ni([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),pA=Ni([{name:"a_texb",components:2,type:"Uint16"}]),mA=Ni([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),_A=Ni([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ni([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Db=Ni([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),gA=Ni([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ni([{name:"triangle",components:3,type:"Uint16"}]),Ni([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ni([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ni([{type:"Float32",name:"offsetX"}]),Ni([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ir=24;const wo=128;function qm(o,e,n,l,f){if(o.kind==="camera")return o.maxSize;if(o.kind==="composite"){const u=e.possiblyEvaluate(new yn(o.maxZoom),n).evaluate(f,{},n),m=e.possiblyEvaluate(new yn(o.minZoom),n).evaluate(f,{},n);return Math.max(u,m)}return e.possiblyEvaluate(new yn(l)).evaluate(f,{},n)}function Ly(o,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new yn(o+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:f}=n;let u=0;for(;u<l.length&&l[u]<=o;)u++;u=Math.max(0,u-1);let m=u;for(;m<l.length&&l[m]<o+1;)m++;m=Math.min(l.length-1,m);const v=l[u],S=l[m];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:S,interpolationType:f}:{kind:"camera",minZoom:v,maxZoom:S,minSize:n.evaluate(new yn(v)),maxSize:n.evaluate(new yn(S)),interpolationType:f}}}function $m(o,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:f}){return o.kind==="source"?l/wo:o.kind==="composite"?ii(l/wo,f/wo,n):e}function bh(o,e,n=1){let l=0,f=0;if(o.kind==="constant")f=o.layoutSize*n;else if(o.kind!=="source"){const{interpolationType:u,minZoom:m,maxZoom:v}=o,S=u?At(qr.interpolationFactor(u,e,m,v),0,1):0;o.kind==="camera"?f=ii(o.minSize,o.maxSize,S)*n:l=S*n}return{uSizeT:l,uSize:f}}var yA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:wo,evaluateSizeForFeature:$m,evaluateSizeForZoom:bh,getRasterizedIconSize:qm,getSizeData:Ly});function xA(o,e,n){return o.sections.forEach(l=>{l.text=function(f,u,m){const v=u.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?f=f.toLocaleUpperCase():v==="lowercase"&&(f=f.toLocaleLowerCase()),Wr.applyArabicShaping&&(f=Wr.applyArabicShaping(f)),f}(l.text,e,n)}),o}const pf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function vA(o){return o==="︶"||o==="﹈"||o==="︸"||o==="﹄"||o==="﹂"||o==="︾"||o==="︼"||o==="︺"||o==="︘"||o==="﹀"||o==="︐"||o==="︓"||o==="︔"||o==="｀"||o==="￣"||o==="︑"||o==="︒"}function bA(o){return o==="︵"||o==="﹇"||o==="︷"||o==="﹃"||o==="﹁"||o==="︽"||o==="︻"||o==="︹"||o==="︗"||o==="︿"}var zb,ky,Rb,Oy={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function wA(){return zb||(zb=1,Oy.read=function(o,e,n,l,f){var u,m,v=8*f-l-1,S=(1<<v)-1,P=S>>1,x=-7,M=n?f-1:0,I=n?-1:1,T=o[e+M];for(M+=I,u=T&(1<<-x)-1,T>>=-x,x+=v;x>0;u=256*u+o[e+M],M+=I,x-=8);for(m=u&(1<<-x)-1,u>>=-x,x+=l;x>0;m=256*m+o[e+M],M+=I,x-=8);if(u===0)u=1-P;else{if(u===S)return m?NaN:1/0*(T?-1:1);m+=Math.pow(2,l),u-=P}return(T?-1:1)*m*Math.pow(2,u-l)},Oy.write=function(o,e,n,l,f,u){var m,v,S,P=8*u-f-1,x=(1<<P)-1,M=x>>1,I=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=l?0:u-1,A=l?1:-1,D=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,m=x):(m=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-m))<1&&(m--,S*=2),(e+=m+M>=1?I/S:I*Math.pow(2,1-M))*S>=2&&(m++,S/=2),m+M>=x?(v=0,m=x):m+M>=1?(v=(e*S-1)*Math.pow(2,f),m+=M):(v=e*Math.pow(2,M-1)*Math.pow(2,f),m=0));f>=8;o[n+T]=255&v,T+=A,v/=256,f-=8);for(m=m<<f|v,P+=f;P>0;o[n+T]=255&m,T+=A,m/=256,P-=8);o[n+T-A]|=128*D}),Oy}function Lb(){if(Rb)return ky;Rb=1,ky=e;var o=wA();function e(U){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(U)?U:new Uint8Array(U||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var n=4294967296,l=1/n,f=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function u(U){return U.type===e.Bytes?U.readVarint()+U.pos:U.pos+1}function m(U,$,Z){return Z?4294967296*$+(U>>>0):4294967296*($>>>0)+(U>>>0)}function v(U,$,Z){var K=$<=16383?1:$<=2097151?2:$<=268435455?3:Math.floor(Math.log($)/(7*Math.LN2));Z.realloc(K);for(var ae=Z.pos-1;ae>=U;ae--)Z.buf[ae+K]=Z.buf[ae]}function S(U,$){for(var Z=0;Z<U.length;Z++)$.writeVarint(U[Z])}function P(U,$){for(var Z=0;Z<U.length;Z++)$.writeSVarint(U[Z])}function x(U,$){for(var Z=0;Z<U.length;Z++)$.writeFloat(U[Z])}function M(U,$){for(var Z=0;Z<U.length;Z++)$.writeDouble(U[Z])}function I(U,$){for(var Z=0;Z<U.length;Z++)$.writeBoolean(U[Z])}function T(U,$){for(var Z=0;Z<U.length;Z++)$.writeFixed32(U[Z])}function A(U,$){for(var Z=0;Z<U.length;Z++)$.writeSFixed32(U[Z])}function D(U,$){for(var Z=0;Z<U.length;Z++)$.writeFixed64(U[Z])}function O(U,$){for(var Z=0;Z<U.length;Z++)$.writeSFixed64(U[Z])}function F(U,$){return(U[$]|U[$+1]<<8|U[$+2]<<16)+16777216*U[$+3]}function H(U,$,Z){U[Z]=$,U[Z+1]=$>>>8,U[Z+2]=$>>>16,U[Z+3]=$>>>24}function q(U,$){return(U[$]|U[$+1]<<8|U[$+2]<<16)+(U[$+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(U,$,Z){for(Z=Z||this.length;this.pos<Z;){var K=this.readVarint(),ae=K>>3,oe=this.pos;this.type=7&K,U(ae,$,this),this.pos===oe&&this.skip(K)}return $},readMessage:function(U,$){return this.readFields(U,$,this.readVarint()+this.pos)},readFixed32:function(){var U=F(this.buf,this.pos);return this.pos+=4,U},readSFixed32:function(){var U=q(this.buf,this.pos);return this.pos+=4,U},readFixed64:function(){var U=F(this.buf,this.pos)+F(this.buf,this.pos+4)*n;return this.pos+=8,U},readSFixed64:function(){var U=F(this.buf,this.pos)+q(this.buf,this.pos+4)*n;return this.pos+=8,U},readFloat:function(){var U=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,U},readDouble:function(){var U=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,U},readVarint:function(U){var $,Z,K=this.buf;return $=127&(Z=K[this.pos++]),Z<128?$:($|=(127&(Z=K[this.pos++]))<<7,Z<128?$:($|=(127&(Z=K[this.pos++]))<<14,Z<128?$:($|=(127&(Z=K[this.pos++]))<<21,Z<128?$:function(ae,oe,se){var ye,ce,ve=se.buf;if(ye=(112&(ce=ve[se.pos++]))>>4,ce<128||(ye|=(127&(ce=ve[se.pos++]))<<3,ce<128)||(ye|=(127&(ce=ve[se.pos++]))<<10,ce<128)||(ye|=(127&(ce=ve[se.pos++]))<<17,ce<128)||(ye|=(127&(ce=ve[se.pos++]))<<24,ce<128)||(ye|=(1&(ce=ve[se.pos++]))<<31,ce<128))return m(ae,ye,oe);throw new Error("Expected varint not more than 10 bytes")}($|=(15&(Z=K[this.pos]))<<28,U,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var U=this.readVarint();return U%2==1?(U+1)/-2:U/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var U=this.readVarint()+this.pos,$=this.pos;return this.pos=U,U-$>=12&&f?function(Z,K,ae){return f.decode(Z.subarray(K,ae))}(this.buf,$,U):function(Z,K,ae){for(var oe="",se=K;se<ae;){var ye,ce,ve,Se=Z[se],we=null,Ce=Se>239?4:Se>223?3:Se>191?2:1;if(se+Ce>ae)break;Ce===1?Se<128&&(we=Se):Ce===2?(192&(ye=Z[se+1]))==128&&(we=(31&Se)<<6|63&ye)<=127&&(we=null):Ce===3?(ce=Z[se+2],(192&(ye=Z[se+1]))==128&&(192&ce)==128&&((we=(15&Se)<<12|(63&ye)<<6|63&ce)<=2047||we>=55296&&we<=57343)&&(we=null)):Ce===4&&(ce=Z[se+2],ve=Z[se+3],(192&(ye=Z[se+1]))==128&&(192&ce)==128&&(192&ve)==128&&((we=(15&Se)<<18|(63&ye)<<12|(63&ce)<<6|63&ve)<=65535||we>=1114112)&&(we=null)),we===null?(we=65533,Ce=1):we>65535&&(we-=65536,oe+=String.fromCharCode(we>>>10&1023|55296),we=56320|1023&we),oe+=String.fromCharCode(we),se+=Ce}return oe}(this.buf,$,U)},readBytes:function(){var U=this.readVarint()+this.pos,$=this.buf.subarray(this.pos,U);return this.pos=U,$},readPackedVarint:function(U,$){if(this.type!==e.Bytes)return U.push(this.readVarint($));var Z=u(this);for(U=U||[];this.pos<Z;)U.push(this.readVarint($));return U},readPackedSVarint:function(U){if(this.type!==e.Bytes)return U.push(this.readSVarint());var $=u(this);for(U=U||[];this.pos<$;)U.push(this.readSVarint());return U},readPackedBoolean:function(U){if(this.type!==e.Bytes)return U.push(this.readBoolean());var $=u(this);for(U=U||[];this.pos<$;)U.push(this.readBoolean());return U},readPackedFloat:function(U){if(this.type!==e.Bytes)return U.push(this.readFloat());var $=u(this);for(U=U||[];this.pos<$;)U.push(this.readFloat());return U},readPackedDouble:function(U){if(this.type!==e.Bytes)return U.push(this.readDouble());var $=u(this);for(U=U||[];this.pos<$;)U.push(this.readDouble());return U},readPackedFixed32:function(U){if(this.type!==e.Bytes)return U.push(this.readFixed32());var $=u(this);for(U=U||[];this.pos<$;)U.push(this.readFixed32());return U},readPackedSFixed32:function(U){if(this.type!==e.Bytes)return U.push(this.readSFixed32());var $=u(this);for(U=U||[];this.pos<$;)U.push(this.readSFixed32());return U},readPackedFixed64:function(U){if(this.type!==e.Bytes)return U.push(this.readFixed64());var $=u(this);for(U=U||[];this.pos<$;)U.push(this.readFixed64());return U},readPackedSFixed64:function(U){if(this.type!==e.Bytes)return U.push(this.readSFixed64());var $=u(this);for(U=U||[];this.pos<$;)U.push(this.readSFixed64());return U},skip:function(U){var $=7&U;if($===e.Varint)for(;this.buf[this.pos++]>127;);else if($===e.Bytes)this.pos=this.readVarint()+this.pos;else if($===e.Fixed32)this.pos+=4;else{if($!==e.Fixed64)throw new Error("Unimplemented type: "+$);this.pos+=8}},writeTag:function(U,$){this.writeVarint(U<<3|$)},realloc:function(U){for(var $=this.length||16;$<this.pos+U;)$*=2;if($!==this.length){var Z=new Uint8Array($);Z.set(this.buf),this.buf=Z,this.length=$}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(U){this.realloc(4),H(this.buf,U,this.pos),this.pos+=4},writeSFixed32:function(U){this.realloc(4),H(this.buf,U,this.pos),this.pos+=4},writeFixed64:function(U){this.realloc(8),H(this.buf,-1&U,this.pos),H(this.buf,Math.floor(U*l),this.pos+4),this.pos+=8},writeSFixed64:function(U){this.realloc(8),H(this.buf,-1&U,this.pos),H(this.buf,Math.floor(U*l),this.pos+4),this.pos+=8},writeVarint:function(U){(U=+U||0)>268435455||U<0?function($,Z){var K,ae;if($>=0?(K=$%4294967296|0,ae=$/4294967296|0):(ae=~(-$/4294967296),4294967295^(K=~(-$%4294967296))?K=K+1|0:(K=0,ae=ae+1|0)),$>=18446744073709552e3||$<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Z.realloc(10),function(oe,se,ye){ye.buf[ye.pos++]=127&oe|128,oe>>>=7,ye.buf[ye.pos++]=127&oe|128,oe>>>=7,ye.buf[ye.pos++]=127&oe|128,oe>>>=7,ye.buf[ye.pos++]=127&oe|128,ye.buf[ye.pos]=127&(oe>>>=7)}(K,0,Z),function(oe,se){var ye=(7&oe)<<4;se.buf[se.pos++]|=ye|((oe>>>=3)?128:0),oe&&(se.buf[se.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(se.buf[se.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(se.buf[se.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(se.buf[se.pos++]=127&oe|((oe>>>=7)?128:0),oe&&(se.buf[se.pos++]=127&oe)))))}(ae,Z)}(U,this):(this.realloc(4),this.buf[this.pos++]=127&U|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=U>>>7&127))))},writeSVarint:function(U){this.writeVarint(U<0?2*-U-1:2*U)},writeBoolean:function(U){this.writeVarint(!!U)},writeString:function(U){U=String(U),this.realloc(4*U.length),this.pos++;var $=this.pos;this.pos=function(K,ae,oe){for(var se,ye,ce=0;ce<ae.length;ce++){if((se=ae.charCodeAt(ce))>55295&&se<57344){if(!ye){se>56319||ce+1===ae.length?(K[oe++]=239,K[oe++]=191,K[oe++]=189):ye=se;continue}if(se<56320){K[oe++]=239,K[oe++]=191,K[oe++]=189,ye=se;continue}se=ye-55296<<10|se-56320|65536,ye=null}else ye&&(K[oe++]=239,K[oe++]=191,K[oe++]=189,ye=null);se<128?K[oe++]=se:(se<2048?K[oe++]=se>>6|192:(se<65536?K[oe++]=se>>12|224:(K[oe++]=se>>18|240,K[oe++]=se>>12&63|128),K[oe++]=se>>6&63|128),K[oe++]=63&se|128)}return oe}(this.buf,U,this.pos);var Z=this.pos-$;Z>=128&&v($,Z,this),this.pos=$-1,this.writeVarint(Z),this.pos+=Z},writeFloat:function(U){this.realloc(4),o.write(this.buf,U,this.pos,!0,23,4),this.pos+=4},writeDouble:function(U){this.realloc(8),o.write(this.buf,U,this.pos,!0,52,8),this.pos+=8},writeBytes:function(U){var $=U.length;this.writeVarint($),this.realloc($);for(var Z=0;Z<$;Z++)this.buf[this.pos++]=U[Z]},writeRawMessage:function(U,$){this.pos++;var Z=this.pos;U($,this);var K=this.pos-Z;K>=128&&v(Z,K,this),this.pos=Z-1,this.writeVarint(K),this.pos+=K},writeMessage:function(U,$,Z){this.writeTag(U,e.Bytes),this.writeRawMessage($,Z)},writePackedVarint:function(U,$){$.length&&this.writeMessage(U,S,$)},writePackedSVarint:function(U,$){$.length&&this.writeMessage(U,P,$)},writePackedBoolean:function(U,$){$.length&&this.writeMessage(U,I,$)},writePackedFloat:function(U,$){$.length&&this.writeMessage(U,x,$)},writePackedDouble:function(U,$){$.length&&this.writeMessage(U,M,$)},writePackedFixed32:function(U,$){$.length&&this.writeMessage(U,T,$)},writePackedSFixed32:function(U,$){$.length&&this.writeMessage(U,A,$)},writePackedFixed64:function(U,$){$.length&&this.writeMessage(U,D,$)},writePackedSFixed64:function(U,$){$.length&&this.writeMessage(U,O,$)},writeBytesField:function(U,$){this.writeTag(U,e.Bytes),this.writeBytes($)},writeFixed32Field:function(U,$){this.writeTag(U,e.Fixed32),this.writeFixed32($)},writeSFixed32Field:function(U,$){this.writeTag(U,e.Fixed32),this.writeSFixed32($)},writeFixed64Field:function(U,$){this.writeTag(U,e.Fixed64),this.writeFixed64($)},writeSFixed64Field:function(U,$){this.writeTag(U,e.Fixed64),this.writeSFixed64($)},writeVarintField:function(U,$){this.writeTag(U,e.Varint),this.writeVarint($)},writeSVarintField:function(U,$){this.writeTag(U,e.Varint),this.writeSVarint($)},writeStringField:function(U,$){this.writeTag(U,e.Bytes),this.writeString($)},writeFloatField:function(U,$){this.writeTag(U,e.Fixed32),this.writeFloat($)},writeDoubleField:function(U,$){this.writeTag(U,e.Fixed64),this.writeDouble($)},writeBooleanField:function(U,$){this.writeVarintField(U,!!$)}},ky}var Wm=R(Lb());const Fy=3;function TA(o,e,n){e.glyphs=[],o===1&&n.readMessage(SA,e)}function SA(o,e,n){if(o===3){const{id:l,bitmap:f,width:u,height:m,left:v,top:S,advance:P}=n.readMessage(MA,{});e.glyphs.push({id:l,bitmap:new Al({width:u+2*Fy,height:m+2*Fy},f),metrics:{width:u,height:m,left:v,top:S,advance:P}})}else o===4?e.ascender=n.readSVarint():o===5&&(e.descender=n.readSVarint())}function MA(o,e,n){o===1?e.id=n.readVarint():o===2?e.bitmap=n.readBytes():o===3?e.width=n.readVarint():o===4?e.height=n.readVarint():o===5?e.left=n.readSVarint():o===6?e.top=n.readSVarint():o===7&&(e.advance=n.readVarint())}const EA=Fy,Fs={horizontal:1,vertical:2,horizontalOnly:3};class mf{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const l=new mf;return l.scale=e||1,l.fontStack=n,l}static forImage(e){const n=new mf;return n.image=e,n}}class wh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const l=new wh;for(let f=0;f<e.sections.length;f++){const u=e.sections[f];u.image?l.addImageSection(u):l.addTextSection(u,n)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,l){let f="";for(let u=0;u<n.length;u++){const m=n.charCodeAt(u+1)||null,v=n.charCodeAt(u-1)||null;f+=!l&&(m&&Ku(m)&&!pf[n[u+1]]||v&&Ku(v)&&!pf[n[u-1]])||!pf[n[u]]?n[u]:pf[n[u]]}return f}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Zm[this.text.charCodeAt(l)];l++)e++;let n=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Zm[this.text.charCodeAt(l)];l--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const l=new wh;return l.text=this.text.substring(e,n),l.sectionIndex=this.sectionIndex.slice(e,n),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(mf.forText(e.scale,e.fontStack||n));const l=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(l)}addImageSection(e){const n=e.image&&e.image.namePrimary?e.image.getPrimary():null;if(!n)return void Ti("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(mf.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Ti("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function By(o,e,n,l,f,u,m,v,S,P,x,M,I,T,A){const D=wh.fromFeature(o,f);M===Fs.vertical&&D.verticalizePunctuation(I);let O=[];const F=function(Z,K,ae,oe,se,ye){if(!Z)return[];const ce=[],ve=function(ze,Oe,Pe,Xe,lt,Je){let mt=0;for(let pt=0;pt<ze.length();pt++){const Tt=ze.getSection(pt);mt+=kb(ze.getCodePoint(pt),Tt,Xe,lt,Oe,Je)}return mt/Math.max(1,Math.ceil(mt/Pe))}(Z,K,ae,oe,se,ye),Se=Z.text.indexOf("​")>=0;let we=0;for(let ze=0;ze<Z.length();ze++){const Oe=Z.getSection(ze),Pe=Z.getCodePoint(ze);if(Zm[Pe]||(we+=kb(Pe,Oe,oe,se,K,ye)),ze<Z.length()-1){const Xe=!((Ce=Pe)<11904||!(Ht["Bopomofo Extended"](Ce)||Ht.Bopomofo(Ce)||Ht["CJK Compatibility Forms"](Ce)||Ht["CJK Compatibility Ideographs"](Ce)||Ht["CJK Compatibility"](Ce)||Ht["CJK Radicals Supplement"](Ce)||Ht["CJK Strokes"](Ce)||Ht["CJK Symbols and Punctuation"](Ce)||Ht["CJK Unified Ideographs Extension A"](Ce)||Ht["CJK Unified Ideographs"](Ce)||Ht["Enclosed CJK Letters and Months"](Ce)||Ht["Halfwidth and Fullwidth Forms"](Ce)||Ht.Hiragana(Ce)||Ht["Ideographic Description Characters"](Ce)||Ht["Kangxi Radicals"](Ce)||Ht["Katakana Phonetic Extensions"](Ce)||Ht.Katakana(Ce)||Ht["Vertical Forms"](Ce)||Ht["Yi Radicals"](Ce)||Ht["Yi Syllables"](Ce)));(AA[Pe]||Xe||Oe.image)&&ce.push(Fb(ze+1,we,ve,ce,IA(Pe,Z.getCodePoint(ze+1),Xe&&Se),!1))}}var Ce;return Bb(Fb(Z.length(),we,ve,ce,0,!0))}(D,P,u,e,l,T),{processBidirectionalText:H,processStyledBidirectionalText:q}=Wr;if(H&&D.sections.length===1){const Z=H(D.toString(),F);for(const K of Z){const ae=new wh;ae.text=K,ae.sections=D.sections;for(let oe=0;oe<K.length;oe++)ae.sectionIndex.push(0);O.push(ae)}}else if(q){const Z=q(D.text,D.sectionIndex,F);for(const K of Z){const ae=new wh;ae.text=K[0],ae.sectionIndex=K[1],ae.sections=D.sections,O.push(ae)}}else O=function(Z,K){const ae=[],oe=Z.text;let se=0;for(const ye of K)ae.push(Z.substring(se,ye)),se=ye;return se<oe.length&&ae.push(Z.substring(se,oe.length)),ae}(D,F);const U=[],$={positionedLines:U,text:D.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Z,K,ae,oe,se,ye,ce,ve,Se,we,Ce,ze){let Oe=0,Pe=0,Xe=0;const lt=ve==="right"?1:ve==="left"?0:.5;let Je=!1;for(const _t of se){const Ft=_t.getSections();for(const Kt of Ft){if(Kt.image)continue;const fi=K[Kt.fontStack];if(fi&&(Je=fi.ascender!==void 0&&fi.descender!==void 0,!Je))break}if(!Je)break}let mt=0;for(const _t of se){_t.trim();const Ft=_t.getMaxScale(),Kt=(Ft-1)*Ir,fi={positionedGlyphs:[],lineOffset:0};Z.positionedLines[mt]=fi;const _i=fi.positionedGlyphs;let wi=0;if(!_t.length()){Pe+=ye,++mt;continue}let gi=0,Ei=0;for(let Ki=0;Ki<_t.length();Ki++){const li=_t.getSection(Ki),Ji=_t.getSectionIndex(Ki),$i=_t.getCodePoint(Ki);let on=li.scale,Zn=null,Xn=null,On=null,Jr=Ir,vn=0;const wn=!(Se===Fs.horizontal||!Ce&&!Yu($i)||Ce&&(Zm[$i]||(pt=$i,Ht.Arabic(pt)||Ht["Arabic Supplement"](pt)||Ht["Arabic Extended-A"](pt)||Ht["Arabic Presentation Forms-A"](pt)||Ht["Arabic Presentation Forms-B"](pt))));if(li.image){const Ur=oe[li.image.serialize()];if(!Ur)continue;On=li.image.id,Z.iconsInText=Z.iconsInText||!0,Xn=Ur.paddedRect;const Yn=Ur.displaySize;on=on*Ir/ze,Zn={width:Yn[0],height:Yn[1],left:0,top:-3,advance:wn?Yn[1]:Yn[0],localGlyph:!1},vn=Je?-Zn.height*on:Ft*Ir-17-Yn[1]*on,Jr=Zn.advance;const us=(wn?Yn[0]:Yn[1])*on-Ir*Ft;us>0&&us>wi&&(wi=us)}else{const Ur=ae[li.fontStack];if(!Ur)continue;Ur[$i]&&(Xn=Ur[$i]);const Yn=K[li.fontStack];if(!Yn)continue;const us=Yn.glyphs[$i];if(!us)continue;if(Zn=us.metrics,Jr=$i!==8203?Ir:0,Je){const or=Yn.ascender!==void 0?Math.abs(Yn.ascender):0,Jo=Yn.descender!==void 0?Math.abs(Yn.descender):0,Rl=(or+Jo)*on;gi<Rl&&(gi=Rl,Ei=(or-Jo)/2*on),vn=-or*on}else vn=(Ft-on)*Ir-17}wn?(Z.verticalizable=!0,_i.push({glyph:$i,imageName:On,x:Oe,y:Pe+vn,vertical:wn,scale:on,localGlyph:Zn.localGlyph,fontStack:li.fontStack,sectionIndex:Ji,metrics:Zn,rect:Xn}),Oe+=Jr*on+we):(_i.push({glyph:$i,imageName:On,x:Oe,y:Pe+vn,vertical:wn,scale:on,localGlyph:Zn.localGlyph,fontStack:li.fontStack,sectionIndex:Ji,metrics:Zn,rect:Xn}),Oe+=Zn.advance*on+we)}_i.length!==0&&(Xe=Math.max(Oe-we,Xe),Je?Nb(_i,lt,wi,Ei,ye*Ft/2):Nb(_i,lt,wi,0,ye/2)),Oe=0;const sn=ye*Ft+wi;fi.lineOffset=Math.max(wi,Kt),Pe+=sn,++mt}var pt;const Tt=Pe,{horizontalAlign:it,verticalAlign:Vt}=Ny(ce);(function(_t,Ft,Kt,fi,_i,wi){const gi=(Ft-Kt)*_i,Ei=-wi*fi;for(const sn of _t)for(const Ki of sn.positionedGlyphs)Ki.x+=gi,Ki.y+=Ei})(Z.positionedLines,lt,it,Vt,Xe,Tt),Z.top+=-Vt*Tt,Z.bottom=Z.top+Tt,Z.left+=-it*Xe,Z.right=Z.left+Xe,Z.hasBaseline=Je}($,e,n,l,O,m,v,S,M,P,I,A),!function(Z){for(const K of Z)if(K.positionedGlyphs.length!==0)return!1;return!0}(U)&&$}const Zm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},AA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function kb(o,e,n,l,f,u){if(e.image){const m=l[e.image.serialize()];return m?m.displaySize[0]*e.scale*Ir/u+f:0}{const m=n[e.fontStack],v=m&&m.glyphs[o];return v?v.metrics.advance*e.scale+f:0}}function Ob(o,e,n,l){const f=Math.pow(o-e,2);return l?o<e?f/2:2*f:f+Math.abs(n)*n}function IA(o,e,n){let l=0;return o===10&&(l-=1e4),n&&(l+=150),o!==40&&o!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function Fb(o,e,n,l,f,u){let m=null,v=Ob(e,n,f,u);for(const S of l){const P=Ob(e-S.x,n,f,u)+S.badness;P<=v&&(m=S,v=P)}return{index:o,x:e,priorBreak:m,badness:v}}function Bb(o){return o?Bb(o.priorBreak).concat(o.index):[]}function Ny(o){let e=.5,n=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Nb(o,e,n,l,f){if(!(e||n||l||f))return;const u=o.length-1,m=o[u],v=(m.x+m.metrics.advance*m.scale)*e;for(let S=0;S<=u;S++)o[S].x-=v,o[S].y+=n+l+f}function CA(o,e,n,l){const{horizontalAlign:f,verticalAlign:u}=Ny(l),m=n[0]-o.displaySize[0]*f,v=n[1]-o.displaySize[1]*u;return{imagePrimary:o,imageSecondary:e,top:v,bottom:v+o.displaySize[1],left:m,right:m+o.displaySize[0]}}function Vb(o,e,n,l,f,u){const m=o.imagePrimary;let v;if(m.content){const O=m.content,F=m.pixelRatio||1;v=[O[0]/F,O[1]/F,m.displaySize[0]-O[2]/F,m.displaySize[1]-O[3]/F]}const S=e.left*u,P=e.right*u;let x,M,I,T;n==="width"||n==="both"?(T=f[0]+S-l[3],M=f[0]+P+l[1]):(T=f[0]+(S+P-m.displaySize[0])/2,M=T+m.displaySize[0]);const A=e.top*u,D=e.bottom*u;return n==="height"||n==="both"?(x=f[1]+A-l[0],I=f[1]+D+l[2]):(x=f[1]+(A+D-m.displaySize[1])/2,I=x+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:x,right:M,bottom:I,left:T,collisionPadding:v}}class Da extends Ae{constructor(e,n,l,f,u){super(e,n),this.angle=f,this.z=l,u!==void 0&&(this.segment=u)}clone(){return new Da(this.x,this.y,this.z,this.angle,this.segment)}}function Ub(o,e,n,l,f){if(e.segment===void 0)return!0;let u=e,m=e.segment+1,v=0;for(;v>-n/2;){if(m--,m<0)return!1;v-=o[m].dist(u),u=o[m]}v+=o[m].dist(o[m+1]),m++;const S=[];let P=0;for(;v<n/2;){const x=o[m],M=o[m+1];if(!M)return!1;let I=o[m-1].angleTo(x)-x.angleTo(M);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:I}),P+=I;v-S[0].distance>l;)P-=S.shift().angleDelta;if(P>f)return!1;m++,v+=x.dist(M)}return!0}function jb(o){let e=0;for(let n=0;n<o.length-1;n++)e+=o[n].dist(o[n+1]);return e}function Gb(o,e,n){return o?.6*e*n:0}function Hb(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function PA(o,e,n,l,f,u){const m=Gb(n,f,u),v=Hb(n,l)*u;let S=0;const P=jb(o)/2;for(let x=0;x<o.length-1;x++){const M=o[x],I=o[x+1],T=M.dist(I);if(S+T>P){const A=(P-S)/T,D=ii(M.x,I.x,A),O=ii(M.y,I.y,A),F=new Da(D,O,0,I.angleTo(M),x);return!m||Ub(o,F,v,m,e)?F:void 0}S+=T}}function DA(o,e,n,l,f,u,m,v,S){const P=Gb(l,u,m),x=Hb(l,f),M=x*m,I=o[0].x===0||o[0].x===S||o[0].y===0||o[0].y===S;return e-M<e/4&&(e=M+e/4),qb(o,I?e/2*v%e:(x/2+2*u)*m*v%e,e,P,n,M,I,!1,S)}function qb(o,e,n,l,f,u,m,v,S){const P=u/2,x=jb(o);let M=0,I=e-n,T=[];for(let A=0;A<o.length-1;A++){const D=o[A],O=o[A+1],F=D.dist(O),H=O.angleTo(D);for(;I+n<M+F;){I+=n;const q=(I-M)/F,U=ii(D.x,O.x,q),$=ii(D.y,O.y,q);if(U>=0&&U<S&&$>=0&&$<S&&I-P>=0&&I+P<=x){const Z=new Da(U,$,0,H,A);l&&!Ub(o,Z,u,l,f)||T.push(Z)}}M+=F}return v||T.length||m||(T=qb(o,M/2,n,l,f,u,m,!0,S)),T}function $b(o,e,n,l,f){const u=[];for(let m=0;m<o.length;m++){const v=o[m];let S;for(let P=0;P<v.length-1;P++){let x=v[P],M=v[P+1];x.x<e&&M.x<e||(x.x<e?x=new Ae(e,x.y+(e-x.x)/(M.x-x.x)*(M.y-x.y))._round():M.x<e&&(M=new Ae(e,x.y+(e-x.x)/(M.x-x.x)*(M.y-x.y))._round()),x.y<n&&M.y<n||(x.y<n?x=new Ae(x.x+(n-x.y)/(M.y-x.y)*(M.x-x.x),n)._round():M.y<n&&(M=new Ae(x.x+(n-x.y)/(M.y-x.y)*(M.x-x.x),n)._round()),x.x>=l&&M.x>=l||(x.x>=l?x=new Ae(l,x.y+(l-x.x)/(M.x-x.x)*(M.y-x.y))._round():M.x>=l&&(M=new Ae(l,x.y+(l-x.x)/(M.x-x.x)*(M.y-x.y))._round()),x.y>=f&&M.y>=f||(x.y>=f?x=new Ae(x.x+(f-x.y)/(M.y-x.y)*(M.x-x.x),f)._round():M.y>=f&&(M=new Ae(x.x+(f-x.y)/(M.y-x.y)*(M.x-x.x),f)._round()),S&&x.equals(S[S.length-1])||(S=[x],u.push(S)),S.push(M)))))}}return u}function Wb(o){let e=0,n=0;for(const m of o)e+=m.w*m.h,n=Math.max(n,m.w);o.sort((m,v)=>v.h-m.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let f=0,u=0;for(const m of o)for(let v=l.length-1;v>=0;v--){const S=l[v];if(!(m.w>S.w||m.h>S.h)){if(m.x=S.x,m.y=S.y,u=Math.max(u,m.y+m.h),f=Math.max(f,m.x+m.w),m.w===S.w&&m.h===S.h){const P=l.pop();v<l.length&&(l[v]=P)}else m.h===S.h?(S.x+=m.w,S.w-=m.w):m.w===S.w?(S.y+=m.h,S.h-=m.h):(l.push({x:S.x+m.w,y:S.y,w:S.w-m.w,h:m.h}),S.y+=m.h,S.h-=m.h);break}}return{w:f,h:u,fill:e/(f*u)||0}}Ot(Da,"Anchor");const _f=1;class Vy{constructor(e,{pixelRatio:n,version:l,stretchX:f,stretchY:u,content:m},v){this.paddedRect=e,this.pixelRatio=n,this.stretchX=f,this.stretchY=u,this.content=m,this.version=l,this.padding=v}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class Zb{constructor(e,n,l){const f={},u={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,f,_f,m),this.addImages(n,u,2,m);const{w:v,h:S}=Wb(m),P=new Rr({width:v||1,height:S||1});for(const x in e){const M=e[x],I=f[x].paddedRect;Rr.copy(M.data,P,{x:0,y:0},{x:I.x+_f,y:I.y+_f},M.data,l,M.sdf)}for(const x in n){const M=n[x],I=u[x].paddedRect;let T=u[x].padding;const A=I.x+T,D=I.y+T,O=M.data.width,F=M.data.height;T=T>1?T-1:T,Rr.copy(M.data,P,{x:0,y:0},{x:A,y:D},M.data,l),Rr.copy(M.data,P,{x:0,y:F-T},{x:A,y:D-T},{width:O,height:T},l),Rr.copy(M.data,P,{x:0,y:0},{x:A,y:D+F},{width:O,height:T},l),Rr.copy(M.data,P,{x:O-T,y:0},{x:A-T,y:D},{width:T,height:F},l),Rr.copy(M.data,P,{x:0,y:0},{x:A+O,y:D},{width:T,height:F},l),Rr.copy(M.data,P,{x:O-T,y:F-T},{x:A-T,y:D-T},{width:T,height:T},l),Rr.copy(M.data,P,{x:0,y:F-T},{x:A+O,y:D-T},{width:T,height:T},l),Rr.copy(M.data,P,{x:0,y:0},{x:A+O,y:D+F},{width:T,height:T},l),Rr.copy(M.data,P,{x:O-T,y:0},{x:A-T,y:D+F},{width:T,height:T},l)}this.image=P,this.iconPositions=f,this.patternPositions=u}addImages(e,n,l,f){for(const u in e){const m=e[u],v={x:0,y:0,w:m.data.width+2*l,h:m.data.height+2*l};f.push(v),n[u]=new Vy(v,m,l),m.hasRenderCallback&&this.haveRenderCallbacks.push(Ys.deserializeId(u))}}patchUpdatedImages(e,n,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>e.hasImage(f,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const f in e.getUpdatedImages(l)){for(const u of Object.keys(this.iconPositions))Ys.deserializeId(u)===f&&this.patchUpdatedImage(this.iconPositions[u],e.getImage(f,l),n);for(const u of Object.keys(this.patternPositions))Ys.deserializeId(u)===f&&this.patchUpdatedImage(this.patternPositions[u],e.getImage(f,l),n)}}patchUpdatedImage(e,n,l){if(!e||!n||e.version===n.version)return;e.version=n.version;const[f,u]=e.tl;l.update(n.data,{position:{x:f,y:u}})}}Ot(Vy,"ImagePosition"),Ot(Zb,"ImageAtlas");const Xm=1e20;function Xb(o,e,n,l,f,u,m,v,S){for(let P=e;P<e+l;P++)Yb(o,n*u+P,u,f,m,v,S);for(let P=n;P<n+f;P++)Yb(o,P*u+e,1,l,m,v,S)}function Yb(o,e,n,l,f,u,m){u[0]=0,m[0]=-1e20,m[1]=Xm,f[0]=o[e];for(let v=1,S=0,P=0;v<l;v++){f[v]=o[e+v*n];const x=v*v;do{const M=u[S];P=(f[v]-f[M]+x-M*M)/(v-M)/2}while(P<=m[S]&&--S>-1);S++,u[S]=v,m[S]=P,m[S+1]=Xm}for(let v=0,S=0;v<l;v++){for(;m[S+1]<v;)S++;const P=u[S],x=v-P;o[e+v*n]=f[P]+x*x}}const To=2,Uy={none:0,ideographs:1,all:2};class Th{constructor(e,n,l){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=l,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,l){const f=[],u=this.urls[n]||he.GLYPHS_URL;for(const m in e)for(const v of e[m])f.push({stack:m,id:v});un(f,({stack:m,id:v},S)=>{let P=this.entries[m];P||(P=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=P.glyphs[v];if(x!==void 0)return void S(null,{stack:m,id:v,glyph:x});if(x=this._tinySDF(P,m,v),x)return P.glyphs[v]=x,void S(null,{stack:m,id:v,glyph:x});const M=Math.floor(v/256);if(256*M>65535)return Ti("glyphs > 65535 not supported"),void S(null,{stack:m,id:v,glyph:x});if(P.ranges[M])return void S(null,{stack:m,id:v,glyph:x});let I=P.requests[M];I||(I=P.requests[M]=[],Th.loadGlyphRange(m,M,u,this.requestManager,(T,A)=>{if(A){P.ascender=A.ascender,P.descender=A.descender;for(const D in A.glyphs)this._doesCharSupportLocalGlyph(+D)||(P.glyphs[+D]=A.glyphs[+D]);P.ranges[M]=!0}for(const D of I)D(T,A);delete P.requests[M]})),I.push((T,A)=>{T?S(T):A&&S(null,{stack:m,id:v,glyph:A.glyphs[v]||null})})},(m,v)=>{if(m)l(m);else if(v){const S={};for(const{stack:P,id:x,glyph:M}of v)S[P]===void 0&&(S[P]={}),S[P].glyphs===void 0&&(S[P].glyphs={}),S[P].glyphs[x]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},S[P].ascender=this.entries[P].ascender,S[P].descender=this.entries[P].descender;l(null,S)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Uy.none&&(this.localGlyphMode===Uy.all?!!this.localFontFamily:!!this.localFontFamily&&(Ht["CJK Unified Ideographs"](e)||Ht["Hangul Syllables"](e)||Ht.Hiragana(e)||Ht.Katakana(e)||Ht["CJK Symbols and Punctuation"](e)||Ht["CJK Unified Ideographs Extension A"](e)||Ht["CJK Unified Ideographs Extension B"](e)||Ht.Osage(e)))}_tinySDF(e,n,l){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(l))return;let u=e.tinySDF;if(!u){let D="400";/bold/i.test(n)?D="900":/medium/i.test(n)?D="500":/light/i.test(n)&&(D="200"),u=e.tinySDF=new Th.TinySDF({fontFamily:f,fontWeight:D,fontSize:24*To,buffer:3*To,radius:8*To}),u.fontWeight=D}if(this.localGlyphs[u.fontWeight][l])return this.localGlyphs[u.fontWeight][l];const m=String.fromCodePoint(l),{data:v,width:S,height:P,glyphWidth:x,glyphHeight:M,glyphLeft:I,glyphTop:T,glyphAdvance:A}=u.draw(m);return this.localGlyphs[u.fontWeight][l]={id:l,bitmap:new Al({width:S,height:P},v),metrics:{width:x/To,height:M/To,left:I/To,top:T/To-27,advance:A/To,localGlyph:!0}}}}Th.loadGlyphRange=function(o,e,n,l,f){const u=256*e,m=u+255,v=l.transformRequest(l.normalizeGlyphsURL(n).replace("{fontstack}",o).replace("{range}",`${u}-${m}`),ua.Glyphs);ha(v,(S,P)=>{if(S)f(S);else if(P){const x={},M=function(I){return new Wm(I).readFields(TA,{})}(P);for(const I of M.glyphs)x[I.id]=I;f(null,{glyphs:x,ascender:M.ascender,descender:M.descender})}})},Th.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:n=8,cutoff:l=.25,fontFamily:f="sans-serif",fontWeight:u="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=n;const v=this.size=o+4*e,S=this._createCanvas(v),P=this.ctx=S.getContext("2d",{willReadFrequently:!0});P.font=`${m} ${u} ${o}px ${f}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:f,actualBoundingBoxRight:u}=this.ctx.measureText(o),m=Math.ceil(n),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-f))),S=Math.min(this.size-this.buffer,m+Math.ceil(l)),P=v+2*this.buffer,x=S+2*this.buffer,M=Math.max(P*x,0),I=new Uint8ClampedArray(M),T={data:I,width:P,height:x,glyphWidth:v,glyphHeight:S,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(v===0||S===0)return T;const{ctx:A,buffer:D,gridInner:O,gridOuter:F}=this;A.clearRect(D,D,v,S),A.fillText(o,D,D+m);const H=A.getImageData(D,D,v,S);F.fill(Xm,0,M),O.fill(0,0,M);for(let q=0;q<S;q++)for(let U=0;U<v;U++){const $=H.data[4*(q*v+U)+3]/255;if($===0)continue;const Z=(q+D)*P+U+D;if($===1)F[Z]=0,O[Z]=Xm;else{const K=.5-$;F[Z]=K>0?K*K:0,O[Z]=K<0?K*K:0}}Xb(F,0,0,P,x,P,this.f,this.v,this.z),Xb(O,D,D,v,S,P,this.f,this.v,this.z);for(let q=0;q<M;q++){const U=Math.sqrt(F[q])-Math.sqrt(O[q]);I[q]=Math.round(255-255*(U/this.radius+this.cutoff))}return T}};const Bc=_f;function Kb(o,e){return o+e[1]-e[0]}function Jb(o,e,n,l,f=1){const u=[],m=o.imagePrimary,v=m.pixelRatio,S=m.paddedRect.w-2*Bc,P=m.paddedRect.h-2*Bc,x=(o.right-o.left)*f,M=(o.bottom-o.top)*f,I=m.stretchX||[[0,S]],T=m.stretchY||[[0,P]],A=I.reduce(Kb,0),D=T.reduce(Kb,0),O=S-A,F=P-D;let H=0,q=A,U=0,$=D,Z=0,K=O,ae=0,oe=F;if(m.content&&l){const ye=m.content;H=Ym(I,0,ye[0]),U=Ym(T,0,ye[1]),q=Ym(I,ye[0],ye[2]),$=Ym(T,ye[1],ye[3]),Z=ye[0]-H,ae=ye[1]-U,K=ye[2]-ye[0]-q,oe=ye[3]-ye[1]-$}const se=(ye,ce,ve,Se)=>{const we=Km(ye.stretch-H,q,x,o.left*f),Ce=Jm(ye.fixed-Z,K,ye.stretch,A),ze=Km(ce.stretch-U,$,M,o.top*f),Oe=Jm(ce.fixed-ae,oe,ce.stretch,D),Pe=Km(ve.stretch-H,q,x,o.left*f),Xe=Jm(ve.fixed-Z,K,ve.stretch,A),lt=Km(Se.stretch-U,$,M,o.top*f),Je=Jm(Se.fixed-ae,oe,Se.stretch,D),mt=new Ae(we,ze),pt=new Ae(Pe,ze),Tt=new Ae(Pe,lt),it=new Ae(we,lt),Vt=new Ae(Ce/v,Oe/v),_t=new Ae(Xe/v,Je/v),Ft=e*Math.PI/180;if(Ft){const Ei=Math.sin(Ft),sn=Math.cos(Ft),Ki=[sn,-Ei,Ei,sn];mt._matMult(Ki),pt._matMult(Ki),it._matMult(Ki),Tt._matMult(Ki)}const Kt=ye.stretch+ye.fixed,fi=ve.stretch+ve.fixed,_i=ce.stretch+ce.fixed,wi=Se.stretch+Se.fixed,gi=o.imageSecondary;return{tl:mt,tr:pt,bl:it,br:Tt,texPrimary:{x:m.paddedRect.x+Bc+Kt,y:m.paddedRect.y+Bc+_i,w:fi-Kt,h:wi-_i},texSecondary:gi?{x:gi.paddedRect.x+Bc+Kt,y:gi.paddedRect.y+Bc+_i,w:fi-Kt,h:wi-_i}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vt,pixelOffsetBR:_t,minFontScaleX:K/v/x,minFontScaleY:oe/v/M,isSDF:n}};if(l&&(m.stretchX||m.stretchY)){const ye=Qb(I,O,A),ce=Qb(T,F,D);for(let ve=0;ve<ye.length-1;ve++){const Se=ye[ve],we=ye[ve+1];for(let Ce=0;Ce<ce.length-1;Ce++)u.push(se(Se,ce[Ce],we,ce[Ce+1]))}}else u.push(se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:P+1}));return u}function Ym(o,e,n){let l=0;for(const f of o)l+=Math.max(e,Math.min(n,f[1]))-Math.max(e,Math.min(n,f[0]));return l}function Qb(o,e,n){const l=[{fixed:-1,stretch:0}];for(const[f,u]of o){const m=l[l.length-1];l.push({fixed:f-m.stretch,stretch:m.stretch}),l.push({fixed:f-m.stretch,stretch:m.stretch+(u-f)})}return l.push({fixed:e+Bc,stretch:n}),l}function Km(o,e,n,l){return o/e*n+l}function Jm(o,e,n,l){return o-e*n/l}function zA(o,e,n,l){const f=e+o.positionedLines[l].lineOffset;return l===0?n+f/2:n+(f+(e+o.positionedLines[l-1].lineOffset))/2}function RA(o,e=1,n=!1){let l=1/0,f=1/0,u=-1/0,m=-1/0;const v=o[0];for(let T=0;T<v.length;T++){const A=v[T];(!T||A.x<l)&&(l=A.x),(!T||A.y<f)&&(f=A.y),(!T||A.x>u)&&(u=A.x),(!T||A.y>m)&&(m=A.y)}const S=Math.min(u-l,m-f);let P=S/2;const x=new Pu([],LA);if(S===0)return new Ae(l,f);for(let T=l;T<u;T+=S)for(let A=f;A<m;A+=S)x.push(new Sh(T+P,A+P,P,o));let M=function(T){let A=0,D=0,O=0;const F=T[0];for(let H=0,q=F.length,U=q-1;H<q;U=H++){const $=F[H],Z=F[U],K=$.x*Z.y-Z.x*$.y;D+=($.x+Z.x)*K,O+=($.y+Z.y)*K,A+=3*K}return new Sh(D/A,O/A,0,T)}(o),I=x.length;for(;x.length;){const T=x.pop();(T.d>M.d||!M.d)&&(M=T,n&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,I)),T.max-M.d<=e||(P=T.h/2,x.push(new Sh(T.p.x-P,T.p.y-P,P,o)),x.push(new Sh(T.p.x+P,T.p.y-P,P,o)),x.push(new Sh(T.p.x-P,T.p.y+P,P,o)),x.push(new Sh(T.p.x+P,T.p.y+P,P,o)),I+=4)}return n&&(console.log(`num probes: ${I}`),console.log(`best distance: ${M.d}`)),M.p}function LA(o,e){return e.max-o.max}class Sh{constructor(e,n,l,f){this.p=new Ae(e,n),this.h=l,this.d=function(u,m){let v=!1,S=1/0;for(let P=0;P<m.length;P++){const x=m[P];for(let M=0,I=x.length,T=I-1;M<I;T=M++){const A=x[M],D=x[T];A.y>u.y!=D.y>u.y&&u.x<(D.x-A.x)*(u.y-A.y)/(D.y-A.y)+A.x&&(v=!v),S=Math.min(S,de(u,A,D))}}return(v?1:-1)*Math.sqrt(S)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const jy=Number.POSITIVE_INFINITY,kA=Math.sqrt(2);function e1(o,[e,n]){let l=0,f=0;if(n===jy){e<0&&(e=0);const u=e/kA;switch(o){case"top-right":case"top-left":f=u-7;break;case"bottom-right":case"bottom-left":f=7-u;break;case"bottom":f=7-e;break;case"top":f=e-7}switch(o){case"top-right":case"bottom-right":l=-u;break;case"top-left":case"bottom-left":l=u;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),o){case"top-right":case"top-left":case"top":f=n-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-n}switch(o){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,f]}function Gy(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function OA(o,e,n,l,f,u,m,v,S,P,x,M,I,T,A,D){let O=u.textMaxSize.evaluate(e,{},I);O===void 0?O=m*u.textScaleFactor:O*=u.textScaleFactor;const F=o.layers[0].layout,H=F.get("icon-offset").evaluate(e,{},I),q=i1(n.horizontal)||n.vertical,U=T.name==="globe",$=Ir,Z=m*u.textScaleFactor/$,K=o.tilePixelRatio*O/$,ae=(Ce=o.overscaling,o.zoom>18&&Ce>2&&(Ce>>=1),Math.max(vt/(512*Ce),1)*F.get("symbol-spacing")),oe=F.get("text-padding")*o.tilePixelRatio,se=F.get("icon-padding")*o.tilePixelRatio,ye=xt(F.get("text-max-angle")),ce=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",ve=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Se=F.get("symbol-placement"),we=ae/2;var Ce;const ze=F.get("icon-text-fit").evaluate(e,{},I),Oe=F.get("icon-text-fit-padding").evaluate(e,{},I),Pe=ze!=="none";let Xe;o.hasAnyIconTextFit===!1&&Pe&&(o.hasAnyIconTextFit=!0),l&&Pe&&(o.allowVerticalPlacement&&n.vertical&&(Xe=Vb(l,n.vertical,ze,Oe,H,Z)),q&&(l=Vb(l,q,ze,Oe,H,Z)));const lt=(Je,mt,pt)=>{if(mt.x<0||mt.x>=vt||mt.y<0||mt.y>=vt)return;let Tt=null;if(U){const{x:it,y:Vt,z:_t}=T.projectTilePoint(mt.x,mt.y,pt);Tt={anchor:new Da(it,Vt,_t,0,void 0),up:T.upVector(pt,mt.x,mt.y)}}(function(it,Vt,_t,Ft,Kt,fi,_i,wi,gi,Ei,sn,Ki,li,Ji,$i,on,Zn,Xn,On,Jr,vn,wn,Ur,Yn,us,or,Jo,Rl){const Ll=it.addToLineVertexArray(Vt,Ft);let za,kl,Ol,M_,Lw,kw,Ow,Fw=0,Bw=0,Nw=0,Vw=0,Sx=-1,Mx=-1;const Qo={};let Uw=rc("");const Gc=_t?_t.anchor:Vt,Ex=gi.layout.get("icon-text-fit").evaluate(vn,{},or)!=="none";let Ax=0,Ix=0;if(gi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ax,Ix]=gi.layout.get("text-offset").evaluate(vn,{},or).map(Ns=>Ns*Ir):(Ax=gi.layout.get("text-radial-offset").evaluate(vn,{},or)*Ir,Ix=jy),it.allowVerticalPlacement&&Kt.vertical){const Ns=Kt.vertical;if($i)kw=Hy(Ns),wi&&(Ow=Hy(wi));else{const Ss=gi.layout.get("text-rotate").evaluate(vn,{},or)+90;Ol=Qm(Ei,Gc,Vt,sn,Ki,li,Ns,Ji,Ss,on),wi&&(M_=Qm(Ei,Gc,Vt,sn,Ki,li,wi,Xn,Ss))}}if(fi){const Ns=it.iconSizeData,Ss=Yn?qm(it.iconSizeData,it.layers[0]._unevaluatedLayout._values["icon-size"],or,it.zoom,vn):1,kh=gi.layout.get("icon-rotate").evaluate(vn,{},or),jw=Jb(fi,kh,Ur,Ex,Yn?1/Ss:wn.iconScaleFactor),Px=wi?Jb(wi,kh,Ur,Ex,wn.iconScaleFactor):void 0;kl=Qm(Ei,Gc,Vt,sn,Ki,li,fi,Xn,kh,null,Yn?wn.iconScaleFactor*Ss:1),Fw=4*jw.length;let Hc=null;Ns.kind==="source"?(Hc=[wo*gi.layout.get("icon-size").evaluate(vn,{},or)*wn.iconScaleFactor],Hc[0]>Cl&&Ti(`${it.layerIds[0]}: Value for "icon-size" is >= ${gf}. Reduce your "icon-size".`)):Ns.kind==="composite"&&(Hc=[wo*wn.compositeIconSizes[0].evaluate(vn,{},or)*wn.iconScaleFactor,wo*wn.compositeIconSizes[1].evaluate(vn,{},or)*wn.iconScaleFactor],(Hc[0]>Cl||Hc[1]>Cl)&&Ti(`${it.layerIds[0]}: Value for "icon-size" is >= ${gf}. Reduce your "icon-size".`)),it.addSymbols(it.icon,jw,Hc,Jr,On,vn,!1,_t,Vt,Ll.lineStartIndex,Ll.lineLength,-1,us,or,Jo,Rl),Sx=it.icon.placedSymbolArray.length-1,Px&&(Bw=4*Px.length,it.addSymbols(it.icon,Px,Hc,Jr,On,vn,Fs.vertical,_t,Vt,Ll.lineStartIndex,Ll.lineLength,-1,us,or,Jo,Rl),Mx=it.icon.placedSymbolArray.length-1)}for(const Ns in Kt.horizontal){const Ss=Kt.horizontal[Ns];za||(Uw=rc(Ss.text),$i?Lw=Hy(Ss):za=Qm(Ei,Gc,Vt,sn,Ki,li,Ss,Ji,gi.layout.get("text-rotate").evaluate(vn,{},or),on));const kh=Ss.positionedLines.length===1;if(Nw+=t1(it,_t,Vt,Ss,_i,gi,$i,vn,on,Ll,Kt.vertical?Fs.horizontal:Fs.horizontalOnly,kh?Object.keys(Kt.horizontal):[Ns],Qo,Sx,wn,us,or,Jo),kh)break}Kt.vertical&&(Vw+=t1(it,_t,Vt,Kt.vertical,_i,gi,$i,vn,on,Ll,Fs.vertical,["vertical"],Qo,Mx,wn,us,or,Jo));let Fl=-1;const Cx=(Ns,Ss)=>Ns?Math.max(Ns,Ss):Ss;Fl=Cx(Lw,Fl),Fl=Cx(kw,Fl),Fl=Cx(Ow,Fl);const mC=Fl>-1?1:0;it.glyphOffsetArray.length>=65535&&Ti("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vn.sortKey!==void 0&&it.addToSortKeyRanges(it.symbolInstances.length,vn.sortKey),it.symbolInstances.emplaceBack(Vt.x,Vt.y,Gc.x,Gc.y,Gc.z,Qo.right>=0?Qo.right:-1,Qo.center>=0?Qo.center:-1,Qo.left>=0?Qo.left:-1,Qo.vertical>=0?Qo.vertical:-1,Sx,Mx,Uw,za!==void 0?za:it.collisionBoxArray.length,za!==void 0?za+1:it.collisionBoxArray.length,Ol!==void 0?Ol:it.collisionBoxArray.length,Ol!==void 0?Ol+1:it.collisionBoxArray.length,kl!==void 0?kl:it.collisionBoxArray.length,kl!==void 0?kl+1:it.collisionBoxArray.length,M_||it.collisionBoxArray.length,M_?M_+1:it.collisionBoxArray.length,sn,Nw,Vw,Fw,Bw,mC,0,Ax,Ix,Fl,0,Ex?1:0)})(o,mt,Tt,Je,n,l,f,Xe,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,oe,ce,S,0,se,ve,H,e,u,P,x,M,I,A,D)};if(Se==="line")for(const Je of $b(e.geometry,0,0,vt,vt)){const mt=DA(Je,ae,ye,n.vertical||q,l,$,K,o.overscaling,vt);for(const pt of mt)q&&FA(o,q.text,we,pt)||lt(Je,pt,I)}else if(Se==="line-center"){for(const Je of e.geometry)if(Je.length>1){const mt=PA(Je,ye,n.vertical||q,l,$,K);mt&&lt(Je,mt,I)}}else if(e.type==="Polygon")for(const Je of Bm(e.geometry,0)){const mt=RA(Je,16);lt(Je[0],new Da(mt.x,mt.y,0,0,void 0),I)}else if(e.type==="LineString")for(const Je of e.geometry)lt(Je,new Da(Je[0].x,Je[0].y,0,0,void 0),I);else if(e.type==="Point")for(const Je of e.geometry)for(const mt of Je)lt([mt],new Da(mt.x,mt.y,0,0,void 0),I)}const gf=255,Cl=gf*wo;function t1(o,e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O,F){const H=function($,Z,K,ae,oe,se,ye,ce){const ve=[];if(Z.positionedLines.length===0)return ve;const Se=ae.layout.get("text-rotate").evaluate(se,{})*Math.PI/180,we=function(Xe){const lt=Xe[0],Je=Xe[1],mt=lt*Je;return mt>0?[lt,-Je]:mt<0?[-lt,Je]:lt===0?[Je,lt]:[Je,-lt]}(K);let Ce=Math.abs(Z.top-Z.bottom);for(const Xe of Z.positionedLines)Ce-=Xe.lineOffset;const ze=Z.positionedLines.length,Oe=Ce/ze;let Pe=Z.top-K[1];for(let Xe=0;Xe<ze;++Xe){const lt=Z.positionedLines[Xe];Pe=zA(Z,Oe,Pe,Xe);for(const Je of lt.positionedGlyphs){if(!Je.rect)continue;const mt=Je.rect||{};let pt=EA+1,Tt=!0,it=1,Vt=0;if(Je.imageName){const On=ye[hr.build(Je.imageName).getSerializedPrimary()];if(!On)continue;if(On.sdf){Ti("SDF images are not supported in formatted text and will be ignored.");continue}Tt=!1,it=On.pixelRatio,pt=_f/it}const _t=(oe||ce)&&Je.vertical,Ft=Je.metrics.advance*Je.scale/2,Kt=Je.metrics,fi=Je.rect;if(fi===null)continue;ce&&Z.verticalizable&&(Vt=Je.imageName?Ft-Je.metrics.width*Je.scale/2:0);const _i=oe?[Je.x+Ft,Je.y]:[0,0];let wi=[0,0],gi=[0,0],Ei=!1;oe||(_t?(gi=[Je.x+Ft+we[0],Je.y+we[1]-Vt],Ei=!0):wi=[Je.x+Ft+K[0],Je.y+K[1]-Vt]);const sn=fi.w*Je.scale/(it*(Je.localGlyph?To:1)),Ki=fi.h*Je.scale/(it*(Je.localGlyph?To:1));let li,Ji,$i,on;if(_t){const On=Je.y-Pe,Jr=new Ae(-Ft,Ft-On),vn=-Math.PI/2,wn=new Ae(...gi);li=new Ae(-Ft+wi[0],wi[1]),li._rotateAround(vn,Jr)._add(wn),li.x+=-On+Ft,li.y-=(Kt.left-pt)*Je.scale;const Ur=Je.imageName?Kt.advance*Je.scale:Ir*Je.scale,Yn=String.fromCodePoint(Je.glyph);vA(Yn)?li.x+=(1-pt)*Je.scale:bA(Yn)?li.x+=Ur-Kt.height*Je.scale+(-pt-1)*Je.scale:li.x+=Je.imageName||Kt.width+2*pt===fi.w&&Kt.height+2*pt===fi.h?(Ur-Ki)/2:(Ur-(Kt.height+2*pt)*Je.scale)/2,Ji=new Ae(li.x,li.y-sn),$i=new Ae(li.x+Ki,li.y),on=new Ae(li.x+Ki,li.y-sn)}else{const On=(Kt.left-pt)*Je.scale-Ft+wi[0],Jr=(-Kt.top-pt)*Je.scale+wi[1],vn=On+sn,wn=Jr+Ki;li=new Ae(On,Jr),Ji=new Ae(vn,Jr),$i=new Ae(On,wn),on=new Ae(vn,wn)}if(Se){let On;On=oe?new Ae(0,0):Ei?new Ae(we[0],we[1]):new Ae(K[0],K[1]),li._rotateAround(Se,On),Ji._rotateAround(Se,On),$i._rotateAround(Se,On),on._rotateAround(Se,On)}const Zn=new Ae(0,0),Xn=new Ae(0,0);ve.push({tl:li,tr:Ji,bl:$i,br:on,texPrimary:mt,texSecondary:void 0,writingMode:Z.writingMode,glyphOffset:_i,sectionIndex:Je.sectionIndex,isSDF:Tt,pixelOffsetTL:Zn,pixelOffsetBR:Xn,minFontScaleX:0,minFontScaleY:0})}}return ve}(0,l,S,u,m,v,f,o.allowVerticalPlacement),q=o.textSizeData;let U=null;q.kind==="source"?(U=[wo*u.layout.get("text-size").evaluate(v,{},O)*A.textScaleFactor],U[0]>Cl&&Ti(`${o.layerIds[0]}: Value for "text-size" is >= ${gf}. Reduce your "text-size".`)):q.kind==="composite"&&(U=[wo*A.compositeTextSizes[0].evaluate(v,{},O)*A.textScaleFactor,wo*A.compositeTextSizes[1].evaluate(v,{},O)*A.textScaleFactor],(U[0]>Cl||U[1]>Cl)&&Ti(`${o.layerIds[0]}: Value for "text-size" is >= ${gf}. Reduce your "text-size".`)),o.addSymbols(o.text,H,U,S,m,v,x,e,n,P.lineStartIndex,P.lineLength,T,D,O,F,!1);for(const $ of M)I[$]=o.text.placedSymbolArray.length-1;return 4*H.length}function i1(o){for(const e in o)return o[e];return null}function Qm(o,e,n,l,f,u,m,v,S,P,x=1){let M=m.top/x,I=m.bottom/x,T=m.left/x,A=m.right/x;const D=m.collisionPadding;if(D&&(T-=D[0],M-=D[1],A+=D[2],I+=D[3]),S){const O=new Ae(T,M),F=new Ae(A,M),H=new Ae(T,I),q=new Ae(A,I),U=xt(S);let $=new Ae(0,0);P&&($=new Ae(P[0],P[1])),O._rotateAround(U,$),F._rotateAround(U,$),H._rotateAround(U,$),q._rotateAround(U,$),T=Math.min(O.x,F.x,H.x,q.x),A=Math.max(O.x,F.x,H.x,q.x),M=Math.min(O.y,F.y,H.y,q.y),I=Math.max(O.y,F.y,H.y,q.y)}return o.emplaceBack(e.x,e.y,e.z,n.x,n.y,T,M,A,I,v,l,f,u),o.length-1}function Hy(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function FA(o,e,n,l){const f=o.compareText;if(e in f){const u=f[e];for(let m=u.length-1;m>=0;m--)if(l.dist(u[m])<n)return!0}else f[e]=[];return f[e].push(l),!1}function n1(o,e){const n=o.fovAboveCenter,l=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,f=(o._camera.position[2]*o.worldSize-l)/Math.cos(o._pitch),u=Math.sin(n)*f/Math.sin(Math.max(Math.PI/2-o._pitch-n,.01));let m=Math.sin(o._pitch)*u+f;const v=f*(1/o._horizonShift);return o.elevation&&o.elevation.exaggeration()!==0||(m*=1+Math.max(o.zoom-17,0)),Math.min(1.01*m,v)}function yf(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const n=Math.pow(2,-o.z),l=o.x*n,f=(o.x+1)*n,u=o.y*n,m=(o.y+1)*n,v=Xr(l),S=Xr(f),P=mr(u),x=mr(m),M=e.project(v,P),I=e.project(S,P),T=e.project(S,x),A=e.project(v,x);let D=Math.min(M.x,I.x,T.x,A.x),O=Math.min(M.y,I.y,T.y,A.y),F=Math.max(M.x,I.x,T.x,A.x),H=Math.max(M.y,I.y,T.y,A.y);const q=n/16;function U(Z,K,ae,oe,se,ye){const ce=(ae+se)/2,ve=(oe+ye)/2,Se=e.project(Xr(ce),mr(ve)),we=Math.max(0,D-Se.x,O-Se.y,Se.x-F,Se.y-H);D=Math.min(D,Se.x),F=Math.max(F,Se.x),O=Math.min(O,Se.y),H=Math.max(H,Se.y),we>q&&(U(Z,Se,ae,oe,ce,ve),U(Se,K,ce,ve,se,ye))}U(M,I,l,u,f,u),U(I,T,f,u,f,m),U(T,A,f,m,l,m),U(A,M,l,m,l,u),D-=q,O-=q,F+=q,H+=q;const $=1/Math.max(F-D,H-O);return{scale:$,x:D*$,y:O*$,x2:F*$,y2:H*$,projection:e}}function r1(o,{x:e,y:n},l=0){return new Ae(((e-l)*o.scale-o.x)*vt,(n*o.scale-o.y)*vt)}const BA=me.mat4.identity(new Float32Array(16));class Pl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Bi(0,0)}projectTilePoint(e,n,l){return{x:e,y:n,z:0}}locationPoint(e,n,l=!0){return e._coordinatePoint(e.locationCoordinate(n),l)}pixelsPerMeter(e,n){return zr(1,e)*n}pixelSpaceConversion(e,n,l){return 1}farthestPixelDistance(e){return n1(e,e.pixelsPerMeter)}pointCoordinate(e,n,l,f){const u=e.horizonLineFromTop(!1),m=new Ae(n,Math.max(u,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,f))}pointCoordinate3D(e,n,l){const f=new Ae(n,l);if(e.elevation)return e.elevation.pointCoordinate(f);{const u=this.pointCoordinate(e,f.x,f.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const l=e.horizonLineFromTop();return n.y<l}createInversionMatrix(e,n){return BA}createTileMatrix(e,n,l){let f,u,m;const v=l.canonical,S=me.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=yf(v,this);f=1,u=P.x+l.wrap*P.scale,m=P.y,me.mat4.scale(S,S,[f/P.scale,f/P.scale,e.pixelsPerMeter/n])}else f=n/e.zoomScale(v.z),u=(v.x+Math.pow(2,v.z)*l.wrap)*f,m=v.y*f;return me.mat4.translate(S,S,[u,m,0]),me.mat4.scale(S,S,[f/vt,f/vt,1]),S}upVector(e,n,l){return[0,0,1]}upVectorScale(e,n,l){return{metersToTile:1}}}class NA extends Pl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,l]=this.parallels=e.parallels||[29.5,45.5],f=Math.sin(xt(n));this.n=(f+Math.sin(xt(l)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:l,c:f,r0:u}=this,m=xt(e-this.center[0]),v=xt(n),S=Math.sqrt(f-2*l*Math.sin(v))/l;return{x:S*Math.sin(m*l),y:S*Math.cos(m*l)-u,z:0}}unproject(e,n){const{n:l,c:f,r0:u}=this,m=u+n;let v=Math.atan2(e,Math.abs(m))*Math.sign(m);m*l<0&&(v-=Math.PI*Math.sign(e)*Math.sign(m));const S=xt(this.center[0])*l;v=Ui(v,-Math.PI-S,Math.PI-S);const P=At(Nt(v/l)+this.center[0],-180,180),x=Math.asin(At((f-(e*e+m*m)*l*l)/(2*l),-1,1)),M=At(Nt(x),-85.051129,Yr);return new Bi(P,M)}}const xf=1.340264,vf=-.081106,bf=893e-6,wf=.003796,e_=Math.sqrt(3)/2;class VA extends Pl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(e_*Math.sin(n)),f=l*l,u=f*f*f;return{x:.5*(e*Math.cos(l)/(e_*(xf+3*vf*f+u*(7*bf+9*wf*f)))/Math.PI+.5),y:1-.5*(l*(xf+vf*f+u*(bf+wf*f))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,f=l*l,u=f*f*f;for(let x,M,I,T=0;T<12&&(M=l*(xf+vf*f+u*(bf+wf*f))-n,I=xf+3*vf*f+u*(7*bf+9*wf*f),x=M/I,l=At(l-x,-Math.PI/3,Math.PI/3),f=l*l,u=f*f*f,!(Math.abs(x)<1e-12));++T);const m=e_*e*(xf+3*vf*f+u*(7*bf+9*wf*f))/Math.cos(l),v=Math.asin(Math.sin(l)/e_),S=At(180*m/Math.PI,-180,180),P=At(180*v/Math.PI,-85.051129,Yr);return new Bi(S,P)}}class UA extends Pl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const l=360*(e-.5),f=At(360*(.5-n),-85.051129,Yr);return new Bi(l,f)}}const Mh=Math.PI/2;function t_(o){return Math.tan((Mh+o)/2)}class jA extends Pl{constructor(e){super(e),this.center=e.center||[0,30];const[n,l]=this.parallels=e.parallels||[30,30];let f=xt(n),u=xt(l);this.southernCenter=f+u<0,this.southernCenter&&(f=-f,u=-u);const m=Math.cos(f),v=t_(f);this.n=f===u?Math.sin(f):Math.log(m/Math.cos(u))/Math.log(t_(u)/v),this.f=m*Math.pow(t_(f),this.n)/this.n}project(e,n){n=xt(n),this.southernCenter&&(n=-n),e=xt(e-this.center[0]);const l=1e-6,{n:f,f:u}=this;u>0?n<-Mh+l&&(n=-Mh+l):n>Mh-l&&(n=Mh-l);const m=u/Math.pow(t_(n),f);let v=m*Math.sin(f*e),S=u-m*Math.cos(f*e);return v=.5*(v/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:v,y:this.southernCenter?S:1-S,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:l,f}=this,u=f-n,m=Math.sign(u),v=Math.sign(l)*Math.sqrt(e*e+u*u);let S=Math.atan2(e,Math.abs(u))*m;u*l<0&&(S-=Math.PI*Math.sign(e)*m);const P=At(Nt(S/l)+this.center[0],-180,180),x=At(Nt(2*Math.atan(Math.pow(f/v,1/l))-Mh),-85.051129,Yr);return new Bi(P,this.southernCenter?-x:x)}}class s1 extends Pl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Yo(e),y:xo(n),z:0}}unproject(e,n){const l=Xr(e),f=mr(n);return new Bi(l,f)}}const o1=xt(Yr);class GA extends Pl{project(e,n){const l=(n=xt(n))*n,f=l*l;return{x:.5*((e=xt(e))*(.8707-.131979*l+f*(f*(.003971*l-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+l*(.015085+f*(.028874*l-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,f=25,u=0,m=l*l;do{m=l*l;const P=m*m;u=(l*(1.007226+m*(.015085+P*(.028874*m-.044475-.005916*P)))-n)/(1.007226+m*(.045255+P*(.259866*m-.311325-.005916*11*P))),l=At(l-u,-o1,o1)}while(Math.abs(u)>1e-6&&--f>0);m=l*l;const v=At(Nt(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),S=Nt(l);return new Bi(v,S)}}const a1=xt(Yr);class HA extends Pl{project(e,n){n=xt(n),e=xt(e);const l=Math.cos(n),f=2/Math.PI,u=Math.acos(l*Math.cos(e/2)),m=Math.sin(u)/u,v=.5*(e*f+2*l*Math.sin(e/2)/m)||0,S=.5*(n+Math.sin(n)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,n){let l=e=(2*e-.5)*Math.PI,f=n=(2*(1-n)-1)*Math.PI,u=25;const m=1e-6;let v=0,S=0;do{const P=Math.cos(f),x=Math.sin(f),M=2*x*P,I=x*x,T=P*P,A=Math.cos(l/2),D=Math.sin(l/2),O=2*A*D,F=D*D,H=1-T*A*A,q=H?1/H:0,U=H?Math.acos(P*A)*Math.sqrt(1/H):0,$=.5*(2*U*P*D+2*l/Math.PI)-e,Z=.5*(U*x+f)-n,K=.5*q*(T*F+U*P*A*I)+1/Math.PI,ae=q*(O*M/4-U*x*D),oe=.125*q*(M*D-U*x*T*O),se=.5*q*(I*A+U*F*P)+.5,ye=ae*oe-se*K;v=(Z*ae-$*se)/ye,S=($*oe-Z*K)/ye,l=At(l-v,-Math.PI,Math.PI),f=At(f-S,-a1,a1)}while((Math.abs(v)>m||Math.abs(S)>m)&&--u>0);return new Bi(Nt(l),Nt(f))}}class l1 extends Pl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(xt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:l,cosPhi:f}=this;return{x:xt(e)*f*l+.5,y:-Math.sin(xt(n))/f*l+.5,z:0}}unproject(e,n){const{scale:l,cosPhi:f}=this,u=-(n-.5)/l,m=At(Nt((e-.5)/l)/f,-180,180),v=Math.asin(At(u*f,-1,1)),S=At(Nt(v),-85.051129,Yr);return new Bi(m,S)}}class qA extends s1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,l){const f=An(e,n,l),u=br(nr(l));return me.vec3.transformMat4(f,f,u),{x:f[0],y:f[1],z:f[2]}}locationPoint(e,n){const l=Ca(n.lat,n.lng),f=me.vec3.normalize([],l),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,m=zr(1,0)*vt*u;me.vec3.scaleAndAdd(l,l,f,m);const v=me.mat4.identity(new Float64Array(16));return me.mat4.multiply(v,e.pixelMatrix,e.globeMatrix),me.vec3.transformMat4(l,l,v),new Ae(l[0],l[1])}pixelsPerMeter(e,n){return zr(1,0)*n}pixelSpaceConversion(e,n,l){const f=zr(1,e)*n,u=ii(zr(1,45)*n,f,l);return this.pixelsPerMeter(e,n)/u}createTileMatrix(e,n,l){const f=ls(nr(l.canonical));return me.mat4.multiply(new Float64Array(16),e.globeMatrix,f)}createInversionMatrix(e,n){const{center:l}=e,f=br(nr(n));return me.mat4.rotateY(f,f,xt(l.lng)),me.mat4.rotateX(f,f,xt(l.lat)),me.mat4.scale(f,f,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(e,n,l,f){return dr(e,n,l,!0)||new _(0,0)}pointCoordinate3D(e,n,l){const f=this.pointCoordinate(e,n,l,0);return[f.x,f.y,f.z]}isPointAboveHorizon(e,n){return!dr(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(f,u){const m=f.cameraToCenterDistance,v=f._centerAltitude*u,S=f._camera,P=f._camera.forward(),x=me.vec3.add([],me.vec3.scale([],P,-m),[0,0,v]),M=f.worldSize/(2*Math.PI),I=[0,0,-M],T=f.width/f.height,A=Math.tan(f.fovAboveCenter),D=me.vec3.scale([],S.up(),A),O=me.vec3.scale([],S.right(),A*T),F=me.vec3.normalize([],me.vec3.add([],me.vec3.add([],P,D),O)),H=[];let q;if(new yi(x,F).closestPointOnSphere(I,M,H)){const U=me.vec3.add([],H,I),$=me.vec3.sub([],U,x);q=Math.cos(f.fovAboveCenter)*me.vec3.length($)}else{const U=me.vec3.sub([],x,I),$=me.vec3.sub([],I,x);me.vec3.normalize($,$);const Z=me.vec3.length(U)-M;q=Math.sqrt(Z*(Z+2*M));const K=Math.acos(q/(M+Z))-Math.acos(me.vec3.dot(P,$));q*=Math.cos(K)}return 1.01*q}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Ar(e.zoom);if(l>0){const f=n1(e,zr(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ii(n,f+u*(1-Math.cos(m)),Math.pow(l,10))}return n}upVector(e,n,l){return An(n,l,e,1)}upVectorScale(e){return{metersToTile:Vi(rr(nr(e)))}}}function c1(o){const e=o.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new s1(o);case"equirectangular":return new UA(o);case"naturalEarth":return new GA(o);case"equalEarth":return new VA(o);case"winkelTripel":return new HA(o);case"albers":return n?new l1(o):new NA(o);case"lambertConformalConic":return n?new l1(o):new jA(o);case"globe":return new qA(o)}throw new Error(`Invalid projection name: ${o.name}`)}const $A=vh.VectorTileFeature.types,WA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function i_(o,e,n,l,f,u,m,v,S,P,x,M,I){const T=v?Math.min(Cl,Math.round(v[0])):0,A=v?Math.min(Cl,Math.round(v[1])):0;o.emplaceBack(e,n,Math.round(32*l),Math.round(32*f),u,m,(T<<1)+(S?1:0),A,16*P,16*x,256*M,256*I)}function n_(o,e,n){o.emplaceBack(e,n)}function r_(o,e,n,l,f,u,m){o.emplaceBack(e,n,l,f,u,m)}function s_(o,e,n,l,f){o.emplaceBack(e,n,l,f),o.emplaceBack(e,n,l,f),o.emplaceBack(e,n,l,f),o.emplaceBack(e,n,l,f)}function ZA(o){for(const e of o.sections)if(ry(e.text))return!0;return!1}class qy{constructor(e){this.layoutVertexArray=new Od,this.indexArray=new vr,this.programConfigurations=e,this.segments=new En,this.dynamicLayoutVertexArray=new _o,this.opacityVertexArray=new Bd,this.placedSymbolArray=new Mm,this.iconTransitioningVertexArray=new qo,this.globeExtVertexArray=new Fd,this.zOffsetVertexArray=new bs}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,l,f,u){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,dA.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,WA,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,pA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,hA.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,fA.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ot(qy,"SymbolBuffers");class $y{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new En,this.collisionVertexArray=new Ud,this.collisionVertexArrayExt=new _o}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,mA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,_A.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ot($y,"CollisionBuffers");class o_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=me.mat4.identity([]),this.placementViewportMatrix=me.mat4.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ly(this.zoom,n["text-size"]),this.iconSizeData=Ly(this.zoom,n["icon-size"]);const l=this.layers[0].layout,f=l.get("symbol-sort-key"),u=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(m=>Fs[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=l.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new qy(new Zo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new qy(new Zo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Pc,this.lineVertexArray=new Zr,this.symbolInstances=new Cc}calculateGlyphDependencies(e,n,l,f,u){for(const m of e){const v=m.codePointAt(0);if(v===void 0)break;if(n[v]=!0,f&&u&&v<=65535){const S=pf[m];S&&(n[S.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const l=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Ay(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,n,l,f){const u=this.layers[0],m=u.layout,v=this.projection.name==="globe",S=m.get("text-font"),P=m.get("text-field"),x=m.get("icon-image"),[M,I]=m.get("icon-size-scale-range"),T=At(n.scaleFactor||1,M,I),A=(P.value.kind!=="constant"||P.value.value instanceof Sr&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),D=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,O=m.get("symbol-sort-key");if(this.features=[],!A&&!D)return;const F=n.iconDependencies,H=n.glyphDependencies,q=n.availableImages,U=new yn(this.zoom);for(const{feature:$,id:Z,index:K,sourceLayerIndex:ae}of e){const oe=u._featureFilter.needGeometry,se=G($,oe);if(!u._featureFilter.filter(U,se,l))continue;if(oe||(se.geometry=B($,l,f)),v&&$.type!==1&&l.z<=5){const we=se.geometry,Ce=.98078528056,ze=(Oe,Pe)=>{const Xe=An(Oe.x,Oe.y,l,1),lt=An(Pe.x,Pe.y,l,1);return me.vec3.dot(Xe,lt)<Ce};for(let Oe=0;Oe<we.length;Oe++)we[Oe]=z(we[Oe],ze)}let ye,ce;if(A){const we=u.getValueAndResolveTokens("text-field",se,l,q),Ce=Sr.factory(we);ZA(Ce)&&(this.hasRTLText=!0),(!this.hasRTLText||zd()==="unavailable"||this.hasRTLText&&Wr.isParsed())&&(ye=xA(Ce,u,se))}if(D){const we=u.getValueAndResolveTokens("icon-image",se,l,q);ce=we instanceof hr?we:hr.build(we)}if(!ye&&!ce)continue;const ve=this.sortFeaturesByKey?O.evaluate(se,{},l):void 0,Se={id:Z,text:ye,icon:ce,index:K,sourceLayerIndex:ae,geometry:se.geometry,properties:$.properties,type:$A[$.type],sortKey:ve};if(this.features.push(Se),ce){const we=qm(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],l,this.zoom,Se)*T*this.pixelRatio,Ce=ce.getPrimary().scaleSelf(we);if(F[Ce.id]=F[Ce.id]||[],F[Ce.id].push(Ce),ce.nameSecondary){const ze=ce.getSecondary().scaleSelf(we);F[ze.id]=F[ze.id]||[],F[ze.id].push(ze)}}if(ye){const we=S.evaluate(se,{},l).join(","),Ce=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fs.vertical)>=0;for(const ze of ye.sections)if(ze.image){const Oe=ze.image.getPrimary().scaleSelf(this.pixelRatio);F[Oe.id]=F[Oe.id]||[],F[Oe.id].push(Oe)}else{const Oe=Xu(ye.toString()),Pe=ze.fontStack||we,Xe=H[Pe]=H[Pe]||{};this.calculateGlyphDependencies(ze.text,Xe,Ce,this.allowVerticalPlacement,Oe)}}}m.get("symbol-placement")==="line"&&(this.features=function($){const Z={},K={},ae=[];let oe=0;function se(Se){ae.push($[Se]),oe++}function ye(Se,we,Ce){const ze=K[Se];return delete K[Se],K[we]=ze,ae[ze].geometry[0].pop(),ae[ze].geometry[0]=ae[ze].geometry[0].concat(Ce[0]),ze}function ce(Se,we,Ce){const ze=Z[we];return delete Z[we],Z[Se]=ze,ae[ze].geometry[0].shift(),ae[ze].geometry[0]=Ce[0].concat(ae[ze].geometry[0]),ze}function ve(Se,we,Ce){const ze=Ce?we[0][we[0].length-1]:we[0][0];return`${Se}:${ze.x}:${ze.y}`}for(let Se=0;Se<$.length;Se++){const we=$[Se],Ce=we.geometry,ze=we.text?we.text.toString():null;if(!ze){se(Se);continue}const Oe=ve(ze,Ce),Pe=ve(ze,Ce,!0);if(Oe in K&&Pe in Z&&K[Oe]!==Z[Pe]){const Xe=ce(Oe,Pe,Ce),lt=ye(Oe,Pe,ae[Xe].geometry);delete Z[Oe],delete K[Pe],K[ve(ze,ae[lt].geometry,!0)]=lt,ae[Xe].geometry=null}else Oe in K?ye(Oe,Pe,Ce):Pe in Z?ce(Oe,Pe,Ce):(se(Se),Z[Oe]=oe-1,K[Pe]=oe-1)}return ae.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($,Z)=>$.sortKey-Z.sortKey)}update(e,n,l,f,u,m,v){this.text.programConfigurations.updatePaintArrays(e,n,u,l,f,m,v),this.icon.programConfigurations.updatePaintArrays(e,n,u,l,f,m,v)}updateZOffset(){const e=(u,m,v)=>{l+=m,l>u.length&&u.resize(l);for(let S=-m;S<0;S++)u.emplace(S+l,v)},n=(u,m,v)=>{f+=m,f>u.length&&u.resize(f);for(let S=-m;S<0;S++)u.emplace(S+f,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,f=0;for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:S,numIconVertices:P}=m,x=m.zOffset,M=P>0;if((v>0||S>0)&&(e(this.text.zOffsetVertexArray,v,x),e(this.text.zOffsetVertexArray,S,x)),M){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:T}=m;I>=0&&n(this.icon.zOffsetVertexArray,P,x),T>=0&&n(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=c1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:f,y:u}of n)this.lineVertexArray.emplaceBack(f,u);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,f,u,m,v,S,P,x,M,I,T,A,D,O){const F=e.indexArray,H=e.layoutVertexArray,q=e.globeExtVertexArray,U=e.segments.prepareSegment(4*n.length,H,F,this.canOverlap?m.sortKey:void 0),$=this.glyphOffsetArray.length,Z=U.vertexLength,K=this.allowVerticalPlacement&&v===Fs.vertical?Math.PI/2:0,ae=m.text&&m.text.sections;for(let se=0;se<n.length;se++){const{tl:ye,tr:ce,bl:ve,br:Se,texPrimary:we,texSecondary:Ce,pixelOffsetTL:ze,pixelOffsetBR:Oe,minFontScaleX:Pe,minFontScaleY:Xe,glyphOffset:lt,isSDF:Je,sectionIndex:mt}=n[se],pt=U.vertexLength,Tt=lt[1];if(i_(H,P.x,P.y,ye.x,Tt+ye.y,we.x,we.y,l,Je,ze.x,ze.y,Pe,Xe),i_(H,P.x,P.y,ce.x,Tt+ce.y,we.x+we.w,we.y,l,Je,Oe.x,ze.y,Pe,Xe),i_(H,P.x,P.y,ve.x,Tt+ve.y,we.x,we.y+we.h,l,Je,ze.x,Oe.y,Pe,Xe),i_(H,P.x,P.y,Se.x,Tt+Se.y,we.x+we.w,we.y+we.h,l,Je,Oe.x,Oe.y,Pe,Xe),S){const{x:it,y:Vt,z:_t}=S.anchor,[Ft,Kt,fi]=S.up;r_(q,it,Vt,_t,Ft,Kt,fi),r_(q,it,Vt,_t,Ft,Kt,fi),r_(q,it,Vt,_t,Ft,Kt,fi),r_(q,it,Vt,_t,Ft,Kt,fi),s_(e.dynamicLayoutVertexArray,it,Vt,_t,K)}else s_(e.dynamicLayoutVertexArray,P.x,P.y,P.z,K);if(O){const it=Ce||we;n_(e.iconTransitioningVertexArray,it.x,it.y),n_(e.iconTransitioningVertexArray,it.x+it.w,it.y),n_(e.iconTransitioningVertexArray,it.x,it.y+it.h),n_(e.iconTransitioningVertexArray,it.x+it.w,it.y+it.h)}F.emplaceBack(pt,pt+1,pt+2),F.emplaceBack(pt+1,pt+2,pt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(lt[0]),se!==n.length-1&&mt===n[se+1].sectionIndex||e.programConfigurations.populatePaintArrays(H.length,m,m.index,{},T,A,D,ae&&ae[mt])}const oe=S?S.anchor:P;e.placedSymbolArray.emplaceBack(oe.x,oe.y,oe.z,P.x,P.y,$,this.glyphOffsetArray.length-$,Z,x,M,P.segment,l?l[0]:0,l?l[1]:0,f[0],f[1],v,0,!1,0,I,0)}_commitLayoutVertex(e,n,l,f,u,m,v){e.emplaceBack(n,l,f,u,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,n,l,f,u,m,v){const S=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),P=S.vertexLength,x=v.tileAnchorX,M=v.tileAnchorY;for(let T=0;T<4;T++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,n,e.padding,v.zOffset),this._commitLayoutVertex(l.layoutVertexArray,f,u,m,x,M,new Ae(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,f,u,m,x,M,new Ae(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,f,u,m,x,M,new Ae(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,f,u,m,x,M,new Ae(e.x1,e.y2)),S.vertexLength+=4;const I=l.indexArray;I.emplaceBack(P,P+1),I.emplaceBack(P+1,P+2),I.emplaceBack(P+2,P+3),I.emplaceBack(P+3,P),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,l,f,u,m){for(let v=f;v<u;v++){const S=l.get(v),P=this.getSymbolInstanceTextSize(e,m,n,v);this._addCollisionDebugVertices(S,P,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,n,l,f,u,m){for(let v=f;v<u;v++){const S=l.get(v),P=this.getSymbolInstanceIconSize(e,n,m.placedIconSymbolIndex);this._addCollisionDebugVertices(S,P,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,n,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $y(Ic,Db.members,qo),this.iconCollisionBox=new $y(Ic,Db.members,qo);const f=bh(this.iconSizeData,e),u=bh(this.textSizeData,e,l);for(let m=0;m<this.symbolInstances.length;m++){const v=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(u,e,n,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(u,e,n,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(f,e,n,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(f,e,n,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,n,l,f){const u=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:f),m=$m(this.textSizeData,e,u)/Ir;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,n,l){const f=this.icon.placedSymbolArray.get(l),u=$m(this.iconSizeData,e,f);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,n,l,f){e.emplaceBack(n,-l,-l,f),e.emplaceBack(n,l,-l,f),e.emplaceBack(n,l,l,f),e.emplaceBack(n,-l,l,f)}_updateTextDebugCollisionBoxes(e,n,l,f,u,m,v){for(let S=f;S<u;S++){const P=l.get(S),x=this.getSymbolInstanceTextSize(e,m,n,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,P.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,n,l,f,u,m,v){for(let S=f;S<u;S++){const P=l.get(S),x=this.getSymbolInstanceIconSize(e,n,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,P.padding,m.zOffset)}}updateCollisionDebugBuffers(e,n,l,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=bh(this.iconSizeData,e,f),m=bh(this.textSizeData,e,l);for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(m,e,n,S.textBoxStartIndex,S.textBoxEndIndex,S,l),this._updateTextDebugCollisionBoxes(m,e,n,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,l),this._updateIconDebugCollisionBoxes(u,e,n,S.iconBoxStartIndex,S.iconBoxEndIndex,S,f),this._updateIconDebugCollisionBoxes(u,e,n,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,l,f,u,m,v,S,P){const x={};if(n<l){const{x1:M,y1:I,x2:T,y2:A,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:U,featureIndex:$}=e.get(n);x.textBox={x1:M,y1:I,x2:T,y2:A,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:U},x.textFeatureIndex=$}if(f<u){const{x1:M,y1:I,x2:T,y2:A,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:U,featureIndex:$}=e.get(f);x.verticalTextBox={x1:M,y1:I,x2:T,y2:A,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:U},x.verticalTextFeatureIndex=$}if(m<v){const{x1:M,y1:I,x2:T,y2:A,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:U,featureIndex:$}=e.get(m);x.iconBox={x1:M,y1:I,x2:T,y2:A,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:U},x.iconFeatureIndex=$}if(S<P){const{x1:M,y1:I,x2:T,y2:A,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:U,featureIndex:$}=e.get(S);x.verticalIconBox={x1:M,y1:I,x2:T,y2:A,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:U},x.verticalIconFeatureIndex=$}return x}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),f=l.vertexStartIndex+4*l.numGlyphs;for(let u=l.vertexStartIndex;u<f;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),f=[],u=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const S=this.symbolInstances.get(v);f.push(0|Math.round(n*S.tileAnchorX+l*S.tileAnchorY)),u.push(S.featureIndex)}return m.sort((v,S)=>f[v]-f[S]||u[S]-u[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:P}=l;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),u>=0&&u!==f&&this.addIndicesForPlacedSymbol(this.text,u),m>=0&&m!==u&&m!==f&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let u1,h1,Wy;Ot(o_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),o_.addDynamicAttributes=s_;class d1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ja,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot(d1,"FormatSectionOverride",{omit:["defaultValue"]});const Zy=()=>Wy||(Wy={layout:u1||(u1=new Mn({"symbol-placement":new dt(je.layout_symbol["symbol-placement"]),"symbol-spacing":new dt(je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dt(je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Dt(je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dt(je.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new dt(je.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new dt(je.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new dt(je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new dt(je.layout_symbol["icon-ignore-placement"]),"icon-optional":new dt(je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dt(je.layout_symbol["icon-rotation-alignment"]),"icon-size":new Dt(je.layout_symbol["icon-size"]),"icon-size-scale-range":new dt(je.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Dt(je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dt(je.layout_symbol["icon-text-fit-padding"]),"icon-image":new Dt(je.layout_symbol["icon-image"]),"icon-rotate":new Dt(je.layout_symbol["icon-rotate"]),"icon-padding":new dt(je.layout_symbol["icon-padding"]),"icon-keep-upright":new dt(je.layout_symbol["icon-keep-upright"]),"icon-offset":new Dt(je.layout_symbol["icon-offset"]),"icon-anchor":new Dt(je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dt(je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dt(je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dt(je.layout_symbol["text-rotation-alignment"]),"text-field":new Dt(je.layout_symbol["text-field"]),"text-font":new Dt(je.layout_symbol["text-font"]),"text-size":new Dt(je.layout_symbol["text-size"]),"text-size-scale-range":new dt(je.layout_symbol["text-size-scale-range"]),"text-max-width":new Dt(je.layout_symbol["text-max-width"]),"text-line-height":new Dt(je.layout_symbol["text-line-height"]),"text-letter-spacing":new Dt(je.layout_symbol["text-letter-spacing"]),"text-justify":new Dt(je.layout_symbol["text-justify"]),"text-radial-offset":new Dt(je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dt(je.layout_symbol["text-variable-anchor"]),"text-anchor":new Dt(je.layout_symbol["text-anchor"]),"text-max-angle":new dt(je.layout_symbol["text-max-angle"]),"text-writing-mode":new dt(je.layout_symbol["text-writing-mode"]),"text-rotate":new Dt(je.layout_symbol["text-rotate"]),"text-padding":new dt(je.layout_symbol["text-padding"]),"text-keep-upright":new dt(je.layout_symbol["text-keep-upright"]),"text-transform":new Dt(je.layout_symbol["text-transform"]),"text-offset":new Dt(je.layout_symbol["text-offset"]),"text-allow-overlap":new dt(je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new dt(je.layout_symbol["text-ignore-placement"]),"text-optional":new dt(je.layout_symbol["text-optional"]),visibility:new dt(je.layout_symbol.visibility)})),paint:h1||(h1=new Mn({"icon-opacity":new Dt(je.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Dt(je.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Dt(je.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Dt(je.paint_symbol["text-emissive-strength"]),"icon-color":new Dt(je.paint_symbol["icon-color"]),"icon-halo-color":new Dt(je.paint_symbol["icon-halo-color"]),"icon-halo-width":new Dt(je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Dt(je.paint_symbol["icon-halo-blur"]),"icon-translate":new dt(je.paint_symbol["icon-translate"]),"icon-translate-anchor":new dt(je.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Dt(je.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Dt(je.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Dt(je.paint_symbol["text-occlusion-opacity"]),"text-color":new Dt(je.paint_symbol["text-color"],{runtimeType:jr,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Dt(je.paint_symbol["text-halo-color"]),"text-halo-width":new Dt(je.paint_symbol["text-halo-width"]),"text-halo-blur":new Dt(je.paint_symbol["text-halo-blur"]),"text-translate":new dt(je.paint_symbol["text-translate"]),"text-translate-anchor":new dt(je.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new dt(je.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new dt(je.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new dt(je.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new dt(je.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Dt(je.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},Wy);class a_ extends Nr{constructor(e,n,l,f){super(e,Zy(),n,l,f),this._colorAdjustmentMatrix=me.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const f=[];for(const u of l)f.indexOf(u)<0&&f.push(u);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,l,f){return this._saturation===e&&this._contrast===n&&this._brightnessMin===l&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(u,m,v,S){u=ie(u),m=ee(m);const P=me.mat4.create(),x=u/3,M=1-2*x,I=[M,x,x,0,x,M,x,0,x,x,M,0,0,0,0,1],T=.5-.5*m,A=S-v;return me.mat4.multiply(P,[A,0,0,0,0,A,0,0,0,0,A,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,T,T,T,1]),me.mat4.multiply(P,P,I),P}(e,n,l,f),this._saturation=e,this._contrast=n,this._brightnessMin=l,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,l,f){const u=this.layout.get(e).evaluate(n,{},l,f),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Id(m.value)||!u?u:function(v,S){return S.replace(/{([^{}]+)}/g,(P,x)=>x in v?String(v[x]):"")}(n.properties,u)}createBucket(e){return new o_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Zy().paint.overridableProperties){if(!a_.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new d1(n),f=new Hu(l,n.property.specification,this.scope,this.options);let u=null;u=n.value.kind==="constant"||n.value.kind==="source"?new qu("source",f):new dl("composite",f,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new ml(n.property,u,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&a_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),f=Zy().paint.properties[n];let u=!1;const m=v=>{for(const S of v)if(f.overrides&&f.overrides.hasOverride(S))return void(u=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Sr)m(l.value.value.sections);else if(l.value.kind==="source"){const v=P=>{u||(P instanceof ys&&xn(P.value)===oo?m(P.value.sections):P instanceof ao?m(P.sections):P.eachChild(v))},S=l.value;S._styleExpression&&v(S._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,l){return{config:new Ea(this,{zoom:n,lut:l}),overrideFog:!1}}}let f1,p1,m1,_1;var Xy=Ni([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Yy(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Ky(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Jy{constructor(e,n,l,f){this.context=e,this.format=l,this.useMipmap=f&&f.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:f&&f.premultiply})}update(e,n){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,f=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:u}=this,{gl:m}=u,{x:v,y:S}=n&&n.position?n.position:{x:0,y:0},P=Math.max(v+l,this.size?this.size[0]:0),x=Math.max(S+f,this.size?this.size[1]:0);!this.size||this.size[0]===P&&this.size[1]===x||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!n||n.premultiply!==!1));const M=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&P>0&&x>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(P,x)))+1:1;m.texStorage2D(m.TEXTURE_2D,I,this.format,P,x),this.size=[P,x]}if(this.size)if(M)m.texSubImage2D(m.TEXTURE_2D,0,v,S,Yy(this.format),Ky(this.format),e);else{const I=e.data;I&&m.texSubImage2D(m.TEXTURE_2D,0,v,S,l,f,Yy(this.format),Ky(this.format),I)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,n,l=!1){const{context:f}=this,{gl:u}=f;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,l,f){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),n!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),this.wrapS=l),f!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,f),this.wrapT=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class l_{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:l}=this,{gl:f}=l;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,n),this.wrapS=n)}}function c_(o,e,n,l,f,u,m,v){const S=[o,e,1,n,l,1,f,u,1],P=[m,v,1],x=me.mat3.adjoint([],S),[M,I,T]=me.vec3.transformMat3(P,P,x);return me.mat3.multiply(S,S,[M,0,0,0,I,0,0,0,T])}function g1(o,e,n,l,f,u,m,v){const S=function(P,x,M,I,T,A,D,O){const F=c_(0,0,1,0,1,1,0,1),H=c_(P,x,M,I,T,A,D,O),q=me.mat3.adjoint([],F);return me.mat3.multiply(H,H,q)}(o,e,n,l,f,u,m,v);return[S[2]/S[8]/vt,S[5]/S[8]/vt]}function u_(o){return[o[0],Math.min(Math.max(o[1],-85.051129),Yr)]}class y1 extends Ka{constructor(e,n,l,f){super(),this.id=e,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new ko("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=pu(this.map._requestManager.transformRequest(this.url,ua.Image),(l,f)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new Oo(l)):f&&(this.image=f instanceof HTMLImageElement?Ct.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new l_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ko("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof l_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],l=e[0][1];for(const u of e)u[1]>l&&(l=u[1]),u[1]<n&&(n=u[1]);const f=(l+n)/2;if(f>Yr?this.onNorthPole=!0:f<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=e.map(_.fromLngLat);this.tileID=function(m){let v=1/0,S=1/0,P=-1/0,x=-1/0;for(const D of m)v=Math.min(v,D.x),S=Math.min(S,D.y),P=Math.max(P,D.x),x=Math.max(x,D.y);const M=Math.max(P-v,x-S),I=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),T=Math.pow(2,I);let A=Math.floor((v+P)/2*T);return A>1&&(A-=1),new wt(I,A,Math.floor((S+x)/2*T))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ko("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const F in this.tiles){const H=this.tiles[F];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=yf(new wt(0,0,0),this.map.transform.projection),l=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(F){const H=F[1].x-F[0].x,q=F[1].y-F[0].y,U=F[2].x-F[1].x,$=F[2].y-F[1].y,Z=F[3].x-F[2].x,K=F[3].y-F[2].y,ae=F[0].x-F[3].x,oe=F[0].y-F[3].y,se=H*$-U*q,ye=U*K-Z*$,ce=Z*oe-ae*K,ve=ae*q-H*oe;return se>0&&ye>0&&ce>0&&ve>0||se<0&&ye<0&&ce<0&&ve<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const f=yf(this.tileID,this.map.transform.projection),[u,m,v,S]=this.coordinates.map(F=>{const H=f.projection.project(F[0],F[1]);return r1(f,H)._round()});this.perspectiveTransform=g1(u.x,u.y,m.x,m.y,v.x,v.y,S.x,S.y);const P=this._boundsArray=new wl;P.emplaceBack(u.x,u.y,0,0),P.emplaceBack(m.x,m.y,vt,0),P.emplaceBack(S.x,S.y,0,vt),P.emplaceBack(v.x,v.y,vt,vt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(P,Xy.members),this.boundsSegments=En.simpleSegment(0,0,4,2);const x=[],M=[u_((I=this.coordinates)[0]),u_(I[1]),u_(I[2]),u_(I[3])];var I;const[T,A,D,O]=function(F){let H=F[0][0],q=H,U=F[0][1],$=U;for(let Z=1;Z<F.length;Z++)F[Z][0]<H?H=F[Z][0]:F[Z][0]>q&&(q=F[Z][0]),F[Z][1]<U?U=F[Z][1]:F[Z][1]>$&&($=F[Z][1]);return[H,U,q-H,$-U]}(M);{const F=new wl,[H,q,U,$]=function(ze){let Oe=ze[0].x,Pe=Oe,Xe=ze[0].y,lt=Xe;for(let Je=1;Je<ze.length;Je++)ze[Je].x<Oe?Oe=ze[Je].x:ze[Je].x>Pe&&(Pe=ze[Je].x),ze[Je].y<Xe?Xe=ze[Je].y:ze[Je].y>lt&&(lt=ze[Je].y);return[Oe,Xe,Pe-Oe,lt-Xe]}(l),Z=ze=>[(ze.x-H)/U,(ze.y-q)/$],[K,ae,oe,se]=l.map(Z),ye=function(ze,Oe,Pe,Xe,lt,Je,mt,pt){const Tt=c_(0,0,1,0,1,1,0,1),it=c_(ze,Oe,Pe,Xe,lt,Je,mt,pt),Vt=me.mat3.adjoint([],it);return me.mat3.multiply(Tt,Tt,Vt)}(K[0],K[1],ae[0],ae[1],oe[0],oe[1],se[0],se[1]);this.elevatedGlobePerspectiveTransform=g1(K[0],K[1],ae[0],ae[1],oe[0],oe[1],se[0],se[1]);const ce=(ze,Oe)=>{x.push(ze.lng);const Pe=Math.round((ze.lng-T)/D*vt),Xe=Math.round((ze.lat-A)/O*vt),lt=Z(Oe),Je=me.vec3.transformMat3([],[lt[0],lt[1],1],ye),mt=Math.round(Je[0]/Je[2]*vt),pt=Math.round(Je[1]/Je[2]*vt);F.emplaceBack(Pe,Xe,mt,pt)},ve=l[3].x-l[0].x,Se=l[3].y-l[0].y,we=l[2].x-l[1].x,Ce=l[2].y-l[1].y;for(let ze=0;ze<65;ze++){const Oe=ze/64,Pe=[l[0].x+Oe*ve,l[0].y+Oe*Se],Xe=[l[1].x+Oe*we,l[1].y+Oe*Ce],lt=Xe[0]-Pe[0],Je=Xe[1]-Pe[1];for(let mt=0;mt<65;mt++){const pt=mt/64,Tt={x:Pe[0]+lt*pt,y:Pe[1]+Je*pt,z:0};ce(n.projection.unproject(Tt.x,Tt.y),Tt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(F,Xy.members)}{this.maxLongitudeTriangleSize=0;let F=[],H=new vr;const q=(U,$,Z)=>{H.emplaceBack(U,$,Z);const K=x[U],ae=x[$],oe=x[Z],se=Math.min(Math.min(K,ae),oe),ye=Math.max(Math.max(K,ae),oe)-se;ye>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ye),F.push(se+ye/2)};for(let U=0;U<64;U++)for(let $=0;$<64;$++){const Z=65*U+$,K=Z+1,ae=Z+65,oe=ae+1;q(Z,ae,K),q(K,ae,oe)}[F,H]=function(U,$){const Z=Array.from({length:U.length},(oe,se)=>se);Z.sort((oe,se)=>U[oe]-U[se]);const K=[],ae=new vr;for(let oe=0;oe<Z.length;oe++){const se=Z[oe];K.push(U[se]);const ye=3*se,ce=ye+1;ae.emplaceBack($.uint16[ye],$.uint16[ce],$.uint16[ce+1])}return[K,ae]}(F,H),this.elevatedGlobeTrianglesCenterLongitudes=F,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(H)}this.elevatedGlobeSegments=En.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,D/vt,0,O/vt,0,0,A,T,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,l=n.gl;!this._dirty||this.texture instanceof l_||(this.texture?this.texture.update(this.image):(this.texture=new Jy(n,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let f=(u=e+180)+360*Math.round((l[0]-u)/360);var u;const m=new En,v=(M,I)=>{m.segments.push({vertexOffset:0,primitiveOffset:M,vertexLength:n.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-f)<=S){const M=We(l,0,l.length,f+S);return M===l.length||v(M,ic(l,M+1,l.length,f+360-S)-M),m}f<l[0]&&(f+=360);const P=ic(l,0,l.length,f-S);if(P===l.length)return v(0,l.length),m;v(0,P-0);const x=We(l,P+1,l.length,f+S);return x!==l.length&&v(x,l.length-x),m}}const XA=(Math.pow(256,2)-1)/16907520;class x1 extends Nr{constructor(e,n,l,f){super(e,{layout:m1||(m1=new Mn({visibility:new dt(je.layout_raster.visibility)})),paint:_1||(_1=new Mn({"raster-opacity":new dt(je.paint_raster["raster-opacity"]),"raster-color":new gl(je.paint_raster["raster-color"]),"raster-color-mix":new dt(je.paint_raster["raster-color-mix"]),"raster-color-range":new dt(je.paint_raster["raster-color-range"]),"raster-hue-rotate":new dt(je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dt(je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dt(je.paint_raster["raster-brightness-max"]),"raster-saturation":new dt(je.paint_raster["raster-saturation"]),"raster-contrast":new dt(je.paint_raster["raster-contrast"]),"raster-resampling":new dt(je.paint_raster["raster-resampling"]),"raster-fade-duration":new dt(je.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new dt(je.paint_raster["raster-emissive-strength"]),"raster-array-band":new dt(je.paint_raster["raster-array-band"]),"raster-elevation":new dt(je.paint_raster["raster-elevation"]),"raster-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},n,l,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof y1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[l,f]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(f)||l===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=rf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,f])}}let v1,b1,w1,T1,S1;class M1 extends Nr{constructor(e,n,l,f){super(e,{layout:v1||(v1=new Mn({visibility:new dt(je["layout_raster-particle"].visibility)})),paint:b1||(b1=new Mn({"raster-particle-array-band":new dt(je["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new dt(je["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new gl(je["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new dt(je["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new dt(je["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new dt(je["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new dt(je["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new dt(je["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},n,l,f),this._updateColorRamp(),this.lastInvalidatedAt=Ct.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=rf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ct.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class YA extends Nr{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Qy(o,e,n){const l=[0,0,1],f=me.quat.identity([]);return me.quat.rotateY(f,f,n?-xt(o)+Math.PI:xt(o)),me.quat.rotateX(f,f,-xt(e)),me.vec3.transformQuat(l,l,f),me.vec3.normalize(l,l)}function E1(o,e){const n=h_(o.projection,o.zoom,o.width,o.height),l=function(u,m,v,S,P){const x=new Bi(v.lng-180*Dl,v.lat),M=new Bi(v.lng+180*Dl,v.lat),I=u.project(x.lng,x.lat),T=u.project(M.lng,M.lat),A=-Math.atan2(T.y-I.y,T.x-I.x),D=_.fromLngLat(v);D.y=At(D.y,-1+Dl,1-Dl);const O=D.toLngLat(),F=u.project(O.lng,O.lat),H=_.fromLngLat(O);H.x+=Dl;const q=H.toLngLat(),U=u.project(q.lng,q.lat),$=I1(U.x-F.x,U.y-F.y,A),Z=_.fromLngLat(O);Z.y+=Dl;const K=Z.toLngLat(),ae=u.project(K.lng,K.lat),oe=I1(ae.x-F.x,ae.y-F.y,A),se=Math.abs($.x)/Math.abs(oe.y),ye=me.mat4.identity([]);me.mat4.rotateZ(ye,ye,-A*(1-(P?0:S)));const ce=me.mat4.identity([]);return me.mat4.scale(ce,ce,[1,1-(1-se)*S,1]),ce[4]=-oe.x/oe.y*S,me.mat4.rotateZ(ce,ce,A),me.mat4.multiply(ce,ye,ce),ce}(o.projection,0,o.center,n,e),f=A1(o);return me.mat4.scale(l,l,[f,f,1]),l}function A1(o){const e=o.projection,n=h_(o.projection,o.zoom,o.width,o.height),l=ex(e,o.center),f=ex(e,Bi.convert(e.center));return Math.pow(2,l*n+(1-n)*f)}function h_(o,e,n,l,f=1/0){const u=o.range;if(!u)return 0;const m=Math.min(f,Math.max(n,l)),v=Math.log(m/1024)/Math.LN2;return Mi(u[0]+v,u[1]+v,e)}const Dl=1/4e4;function ex(o,e){const n=At(e.lat,-85.051129,Yr),l=new Bi(e.lng-180*Dl,n),f=new Bi(e.lng+180*Dl,n),u=o.project(l.lng,n),m=o.project(f.lng,n),v=_.fromLngLat(l),S=_.fromLngLat(f),P=m.x-u.x,x=m.y-u.y,M=S.x-v.x,I=S.y-v.y,T=Math.sqrt((M*M+I*I)/(P*P+x*x));return Math.log(T)/Math.LN2}function I1(o,e,n){const l=Math.cos(n),f=Math.sin(n);return{x:o*l-e*f,y:o*f+e*l}}function C1(o,e,n){me.mat4.identity(o),me.mat4.rotateZ(o,o,xt(e[2])),me.mat4.rotateX(o,o,xt(e[0])),me.mat4.rotateY(o,o,xt(e[1])),me.mat4.scale(o,o,n),me.mat4.multiply(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function d_(o,e,n,l,f,u,m,v){const S=[n[0]-e[0],n[1]-e[1],0],P=[l[0]-e[0],l[1]-e[1],0];if(me.vec3.length(S)<1e-12||me.vec3.length(P)<1e-12)return me.quat.identity(o);const x=me.vec3.cross([],S,P);me.vec3.normalize(x,x),me.vec3.subtract(P,l,e),S[2]=(u-f)*v,P[2]=(m-f)*v;const M=S;return me.vec3.cross(M,S,P),me.vec3.normalize(M,M),me.quat.rotationTo(o,x,M)}function tx(o,e,n=!1){const l=Ar(e.zoom),f=function(u,m,v){const S=m.worldSize,P=[u[12],u[13],u[14]],x=mr(P[1]/S),M=Xr(P[0]/S),I=me.mat4.identity([]),T=zr(1,x)*S,A=zr(1,0)*S*t(x,m.zoom),D=1/Vr(S);let O=A*D;if(v){const U=h_(m.projection,m.zoom,m.width,m.height,1024);O=D*m.projection.pixelSpaceConversion(m.center.lat,S,U)}const F=Ca(x,M);me.vec3.add(F,F,me.vec3.scale([],me.vec3.normalize([],F),T*O*P[2]));const H=function(U){const $=[U[0],U[1],U[2]];let Z=[0,1,0];const K=me.vec3.cross([],Z,$);return me.vec3.cross(Z,$,K),me.vec3.squaredLength(Z)===0&&(Z=[0,1,0],me.vec3.cross(K,$,Z)),me.vec3.normalize(K,K),me.vec3.normalize(Z,Z),me.vec3.normalize($,$),[K[0],K[1],K[2],0,Z[0],Z[1],Z[2],0,$[0],$[1],$[2],0,U[0],U[1],U[2],1]}(F);me.mat4.scale(I,I,[O,O,O*T]),me.mat4.translate(I,I,[-P[0],-P[1],-P[2]]);const q=me.mat4.multiply([],m.globeMatrix,H);return me.mat4.multiply(q,q,I),me.mat4.multiply(q,q,u),q}(o,e,n);if(l>0){const u=function(m,v){const S=v.worldSize,P=zr(1,0)*S*t(v.center.lat,v.zoom)/Vr(S),x=zr(1,v.center.lat)*S,M=me.mat4.identity([]);return me.mat4.rotateY(M,M,xt(v.center.lng)),me.mat4.rotateX(M,M,xt(v.center.lat)),me.mat4.translate(M,M,[0,0,Mr]),me.mat4.scale(M,M,[P,P,P*x]),me.mat4.translate(M,M,[v.point.x-.5*S,v.point.y-.5*S,0]),me.mat4.multiply(M,M,m),me.mat4.multiply(M,v.globeMatrix,M)}(o,e);return function(m,v,S){const P=(A,D,O)=>{const F=me.vec3.length(A),H=me.vec3.length(D),q=Nn(A,D,O);return me.vec3.scale(q,q,1/me.vec3.length(q)*ii(F,H,O))},x=P([m[0],m[1],m[2]],[v[0],v[1],v[2]],S),M=P([m[4],m[5],m[6]],[v[4],v[5],v[6]],S),I=P([m[8],m[9],m[10]],[v[8],v[9],v[10]],S),T=Nn([m[12],m[13],m[14]],[v[12],v[13],v[14]],S);return[x[0],x[1],x[2],0,M[0],M[1],M[2],0,I[0],I[1],I[2],0,T[0],T[1],T[2],1]}(f,u,l)}return f}function P1(o,e,n,l){const f=ei.projectAabbCorners(l,n);let u=Number.MAX_VALUE,m=-1;for(let P=0;P<f.length;++P){const x=f[P];x[0]=(.5*x[0]+.5)*e.width,x[1]=(.5-.5*x[1])*e.height,x[2]<u&&(m=P,u=x[2])}const v=P=>new Ae(f[P][0],f[P][1]);let S;switch(m){case 0:case 6:S=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:S=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:S=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:S=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(Q(o,S))return u}const KA=Ni([{name:"a_pos_3f",components:3,type:"Float32"}]),JA=Ni([{name:"a_color_3f",components:3,type:"Float32"}]),QA=Ni([{name:"a_color_4f",components:4,type:"Float32"}]),eI=Ni([{name:"a_uv_2f",components:2,type:"Float32"}]),tI=Ni([{name:"a_normal_3f",components:3,type:"Float32"}]),iI=Ni([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),nI=Ni([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),D1={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class f_{constructor(e,n,l,f){this.message=(e?`${e}: `:"")+l,f&&(this.identifier=f),n!=null&&n.__line__&&(this.line=n.__line__)}}function z1(o,e){const n=o.indexOf("://")===-1;try{return new URL(o,n&&e?"http://example.com":void 0),!0}catch{return!1}}class R1{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class L1{constructor(){this.instancedDataArray=new ah,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ix{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,l,f){this.tileToMeter=d(l);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:v,index:S,sourceLayerIndex:P}of e){const x=v??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),M=G(m,u);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),M,l))continue;const I={id:x,sourceLayerIndex:P,index:S,geometry:u?M.geometry:B(m,l,f),properties:m.properties,type:m.type,patterns:{}},T=this.addFeature(I,I.geometry,M);T&&n.featureIndex.insert(m,I.geometry,S,P,this.index,this.instancesPerModel[T].instancedDataArray.length,vt/32)}this.lookup=null}update(e,n,l,f){for(const u in this.instancesPerModel){const m=this.instancesPerModel[u];for(const v in e)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],e[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const l=this.instancesPerModel[n];for(const f of l.features){const u=this.layers[0],m=f.feature,v=this.canonical,S=u.paint.get("model-rotation").evaluate(m,{},v),P=u.paint.get("model-scale").evaluate(m,{},v),x=u.paint.get("model-translation").evaluate(m,{},v);me.vec3.exactEquals(f.rotation,S)&&me.vec3.exactEquals(f.scale,P)&&me.vec3.exactEquals(f.translation,x)||(this.evaluate(f,f.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,n,l,f){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const u=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Ay(this.activeReplacements,u))return!1;this.activeReplacements=u;let m=!1;for(const v in this.instancesPerModel){const S=this.instancesPerModel[v],P=S.instancedDataArray;for(const x of S.features){const M=x.instancedDataOffset,I=x.instancedDataCount;for(let T=0;T<I;T++){const A=16*(T+M);let D=P.float32[A+0];const O=D>vt;D=O?D-vt:D;const F=Math.floor(D),H=P.float32[A+1];let q=!1;for(const U of this.activeReplacements)if(!Xv(U,l,D1.Model,f)&&!(U.min.x>F||F>U.max.x||U.min.y>H||H>U.max.y)&&(q=tb(eb(F,H,e.canonical,U.footprintTileId.canonical),U.footprint),q))break;P.float32[A]=q?D+vt:D,m=m||q!==O}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const l=this.instancesPerModel[n];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,iI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const n in this.instancesPerModel){const l=this.instancesPerModel[n];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,l){const f=this.layers[0],u=f.layout.get("model-id").evaluate(l,{},this.canonical);if(!u)return Ti(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),u;z1(u,!1)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new L1);const m=this.instancesPerModel[u],v=m.instancedDataArray,S=new R1(l,v.length);for(const P of n)for(const x of P){if(x.x<0||x.x>=vt||x.y<0||x.y>=vt)continue;const M=(this.lookupDim-1)/vt,I=this.lookupDim*(x.y*M|0)+x.x*M|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const T=v.length;v.resize(T+1),m.instancesEvaluatedElevation.push(0),v.float32[16*T]=x.x,v.float32[16*T+1]=x.y}return S.instancedDataCount=m.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(S),this.evaluate(S,{},m,!1)),u}getModelUris(){return this.modelUris}evaluate(e,n,l,f){const u=this.layers[0],m=e.feature,v=this.canonical,S=e.rotation=u.paint.get("model-rotation").evaluate(m,n,v),P=e.scale=u.paint.get("model-scale").evaluate(m,n,v),x=e.translation=u.paint.get("model-translation").evaluate(m,n,v),M=u.paint.get("model-color").evaluate(m,n,v);M.a=u.paint.get("model-color-mix-intensity").evaluate(m,n,v);const I=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,P[0]),Math.max(P[1],P[2])),C1(I,S,P);const T=Math.round(100*M.a)+M.b/1.05;for(let A=0;A<e.instancedDataCount;++A){const D=e.instancedDataOffset+A,O=16*D,F=l.instancedDataArray.float32;let H=0;f&&(H=F[O+6]-l.instancesEvaluatedElevation[D]);const q=0|F[O+1];F[O]=(0|F[O])+M.r/1.05,F[O+1]=q+M.g/1.05,F[O+2]=T,F[O+3]=1/(v.z>10?this.tileToMeter:d(v,q)),F[O+4]=x[0],F[O+5]=x[1],F[O+6]=x[2]+H,F[O+7]=I[0],F[O+8]=I[1],F[O+9]=I[2],F[O+10]=I[4],F[O+11]=I[5],F[O+12]=I[6],F[O+13]=I[8],F[O+14]=I[9],F[O+15]=I[10],l.instancesEvaluatedElevation[D]=x[2]}}}let k1,O1;Ot(ix,"ModelBucket",{omit:["layers"]}),Ot(L1,"PerModelAttributes"),Ot(R1,"ModelFeature");const Nc=64,Eh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function F1(o,e,n,l,f,u,m,v,S,P=!1){const x=n.zoom,M=n.project(l),I=t(l.lat,x),T=1/I;me.mat4.identity(o),me.mat4.translate(o,o,[M.x+m[0]*T,M.y+m[1]*T,m[2]]);let A=1,D=1;const O=n.worldSize;if(P){if(n.projection.name==="mercator"){let U=0;n.elevation&&(U=n.elevation.getAtPointOrZero(new _(M.x/O,M.y/O),0));const $=me.vec4.transformMat4([],[M.x,M.y,U,1],n.projMatrix)[3]/n.cameraToCenterDistance;A=$,D=$*t(n.center.lat,x)}else if(n.projection.name==="globe"){const U=tx(o,n),$=me.mat4.multiply([],n.projMatrix,U),Z=[0,0,0,1];me.vec4.transformMat4(Z,Z,$);const K=Z[3]/n.cameraToCenterDistance,ae=Ar(x),oe=n.projection.pixelsPerMeter(l.lat,O)*t(l.lat,x),se=n.projection.pixelsPerMeter(n.center.lat,O)*t(n.center.lat,x);A=K/ii(oe,h(n.center.lat),ae),D=K*I/oe,A*=se,D*=se}}else A=T;me.mat4.scale(o,o,[A,A,D]);const F=[...o],H=e.orientation,q=[];if(C1(q,[H[0]+f[0],H[1]+f[1],H[2]+f[2]],u),me.mat4.multiply(o,F,q),v&&n.elevation){let U=0;const $=[];if(S&&n.elevation){U=function(ae,oe,se,ye,ce){const ve=oe.elevation;if(!ve)return 0;const Se=ei.projectAabbCorners(se,ye),we=zr(1,ce.lat)*oe.worldSize,Ce=function(Vt,_t){const Ft=[0,0,1],Kt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const fi of Kt){const _i=Vt[fi.corners[0]],wi=Vt[fi.corners[1]],gi=Vt[fi.corners[2]],Ei=[wi[0]-_i[0],wi[1]-_i[1],_t*(wi[2]-_i[2])],sn=me.vec3.cross(Ei,Ei,[gi[0]-_i[0],gi[1]-_i[1],_t*(gi[2]-_i[2])]);me.vec3.normalize(sn,sn),fi.dotProductWithUp=me.vec3.dot(sn,Ft)}return Kt.sort((fi,_i)=>fi.dotProductWithUp-_i.dotProductWithUp),Kt[0].corners}(Se,we),ze=Se[Ce[0]],Oe=Se[Ce[1]],Pe=Se[Ce[2]],Xe=Se[Ce[3]],lt=ve.getAtPointOrZero(new _(ze[0]/oe.worldSize,ze[1]/oe.worldSize),0),Je=ve.getAtPointOrZero(new _(Oe[0]/oe.worldSize,Oe[1]/oe.worldSize),0),mt=ve.getAtPointOrZero(new _(Pe[0]/oe.worldSize,Pe[1]/oe.worldSize),0),pt=ve.getAtPointOrZero(new _(Xe[0]/oe.worldSize,Xe[1]/oe.worldSize),0),Tt=(lt+pt)/2,it=(Je+mt)/2;return Tt>it?Je<mt?d_(ae,Oe,Xe,ze,Je,pt,lt,we):d_(ae,Pe,ze,Xe,mt,lt,pt,we):lt<pt?d_(ae,ze,Oe,Pe,lt,Je,mt,we):d_(ae,Xe,Pe,Oe,pt,mt,Je,we),Math.max(Tt,it)}($,n,e.aabb,o,l);const Z=me.mat4.fromQuat([],$),K=me.mat4.multiply([],Z,q);me.mat4.multiply(o,F,K)}else U=n.elevation.getAtPointOrZero(new _(M.x/O,M.y/O),0);U!==0&&(o[14]+=U)}}function Tf(o,e,n=!1){o.uploaded||(o.gfxTexture=new Jy(e,o.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function rI(o,e,n){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,KA.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,tI.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,eI.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?JA:QA).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,nI.members,!0)),o.segments=En.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const l=o.material;l.pbrMetallicRoughness.baseColorTexture&&Tf(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&Tf(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&Tf(l.normalTexture,e),l.occlusionTexture&&Tf(l.occlusionTexture,e,n),l.emissionTexture&&Tf(l.emissionTexture,e)}function nx(o,e,n){if(o.meshes)for(const l of o.meshes)rI(l,e,n);if(o.children)for(const l of o.children)nx(l,e,n)}function p_(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)p_(e)}function rx(o){if(o.meshes)for(const n of o.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const n of o.children)rx(n)}class Ah{constructor(e,n,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=l}static create(e,n,l){const f=l||e.findDEMTileFor(n);if(!f||!f.dem)return;const u=f.dem,m=f.tileID,v=1<<n.canonical.z-m.canonical.z;return new Ah(f,u.dim/vt/v,[(n.canonical.x/v-m.canonical.x)*u.dim,(n.canonical.y/v-m.canonical.y)*u.dim])}tileCoordToPixel(e,n){const l=n*this._scale+this._offset[1],f=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(l);return new Ae(f,u)}getElevationAt(e,n,l,f){const u=e*this._scale+this._offset[0],m=n*this._scale+this._offset[1],v=Math.floor(u),S=Math.floor(m),P=this._dem;return f=!!f,l?ii(ii(P.get(v,S,f),P.get(v,S+1,f),m-S),ii(P.get(v+1,S,f),P.get(v+1,S+1,f),m-S),u-v):P.get(v,S,f)}getElevationAtPixel(e,n,l){return this._dem.get(e,n,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*zr(1,e)*this._dem.stride}}const sx=new Float32Array(262144),Vc=new Uint8Array(262144);function B1(o){let e=0;if(o.meshes)for(const n of o.meshes)e=Math.max(e,n.aabb.max[2]);if(o.children)for(const n of o.children)e=Math.max(e,B1(n));return e}function N1(o,e,n){if(o.meshes)for(const l of o.meshes){if(l.aabb.min[0]===1/0)continue;const f=ei.applyTransform(l.aabb,o.matrix);n.insert(e,f.min[0],f.min[1],f.max[0],f.max[1])}if(o.children)for(const l of o.children)N1(l,e,n)}const V1=["","wall","door","roof","window","lamp","logo"];class U1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:B1(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new ei([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new ei([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=ei.applyTransformFast(l.aabb,this.node.matrix),n.encapsulate(l.transformedAabb)),e++;this.aabb=n}return this.aabb}}class m_{constructor(e,n,l,f,u,m,v){this.id=l,this.layers=e,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=Eh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=Eh.HasMapboxMeshFeatures),u&&(this.modelTraits|=Eh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const S of n)this.nodesInfo.push(new U1(S)),N1(S,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,n){for(const l of this.getNodesInfo()){const f=l.node;f.footprint&&n.push({footprint:f.footprint,id:e})}}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const l=n?this.stateDependentLayers:this.layers;if(!bt(e,this.states))for(const f of l)this.evaluate(f,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const l of n){const f=l.node;this.uploaded?this.updatePbrBuffer(f):nx(f,e,!0)}for(const l of n)p_(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),n=!0);return n}needsReEvaluation(e,n,l){const f=e.transform.projectionOptions,u=e.style.getBrightness(),m=this.brightness!==u;if(!this.uploaded||this.dirty||f.name!==this.projection.name||Sf(l.paint.get("model-color").value,m)||Sf(l.paint.get("model-color-mix-intensity").value,m)||Sf(l.paint.get("model-roughness").value,m)||Sf(l.paint.get("model-emissive-strength").value,m)||Sf(l.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=f,this.brightness=u;const v=this.getNodesInfo();for(const S of v)S.state=null;return!0}return!1}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),f=this.id.canonical;for(const u of l){const m=u.feature;u.evaluatedScale=n.paint.get("model-scale").evaluate(m,{},f)}}evaluate(e,n){const l=this.getNodesInfo();for(const f of l){if(!f.node.meshes)continue;const u=f.feature,m=n&&n[u.id];if(bt(m,f.state))continue;f.state=structuredClone(m);const v=f.node.meshes&&f.node.meshes[0].featureData,S=f.evaluatedColor[2],P=f.evaluatedRMEA[2],x=this.id.canonical;if(f.hasTranslucentParts=!1,v){for(let M=0;M<V1.length;M++){const I=V1[M];I.length&&(u.properties.part=I);const T=e.paint.get("model-color").evaluate(u,m,x).toRenderColor(null),A=e.paint.get("model-color-mix-intensity").evaluate(u,m,x);f.evaluatedColor[M]=[T.r,T.g,T.b,A],f.evaluatedRMEA[M][0]=e.paint.get("model-roughness").evaluate(u,m,x),f.evaluatedRMEA[M][2]=e.paint.get("model-emissive-strength").evaluate(u,m,x),f.evaluatedRMEA[M][3]=T.a,f.emissionHeightBasedParams[M]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,m,x),!f.hasTranslucentParts&&T.a<1&&(f.hasTranslucentParts=!0)}delete u.properties.part,oI(f,S!==f.evaluatedColor[2]||P!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,m,x);f.evaluatedScale=e.paint.get("model-scale").evaluate(u,m,x),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,l,f){const u=e.findDEMTileFor(l);if(u&&(u.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const m=Ah.create(e,l,u);if(!m)return;this.modelTraits&Eh.HasMapboxMeshFeatures&&this.updateDEM(e,m,l,f);for(const v of this.getNodesInfo()){const S=v.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const P=S.footprint.vertices;let x=m.getElevationAt(P[0].x,P[0].y,!0,!0);for(let M=1;M<P.length;M++)x=Math.min(x,m.getElevationAt(P[M].x,P[M].y,!0,!0));S.elevation=x}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,l,f){let u=n._dem._modifiedForSources[f];if(u===void 0&&(n._dem._modifiedForSources[f]=[],u=n._dem._modifiedForSources[f]),u.includes(l.canonical))return;const m=n._dem.dim;u.push(l.canonical);let v=!1;for(const S of this.getNodesInfo()){const P=S.node;if(!P.footprint||!P.footprint.grid)continue;const x=P.footprint.grid,M=n.tileCoordToPixel(x.min.x,x.min.y),I=n.tileCoordToPixel(x.max.x,x.max.y),T=Math.min(Math.min(m-I.y,M.x),Math.min(M.y,m-I.x));if(T<0)continue;const A=At(T,2,5);let D=Math.max(0,M.x-A),O=Math.max(0,M.y-A),F=Math.min(I.x+A,m-1),H=Math.min(I.y+A,m-1);for(let Z=O;Z<=H;++Z)for(let K=D;K<=F;++K)Vc[Z*m+K]=255;let q=0,U=0;for(let Z=0;Z<x.cellsY;++Z)for(let K=0;K<x.cellsX;++K){if(!x.cells[Z*x.cellsX+K])continue;const ae=n.tileCoordToPixel(x.min.x+K/x.xScale,x.min.y+Z/x.yScale),oe=n.tileCoordToPixel(x.min.x+(K+1)/x.xScale,x.min.y+(Z+1)/x.yScale);for(let se=ae.y;se<=Math.min(oe.y+1,m-1);++se)for(let ye=ae.x;ye<=Math.min(oe.x+1,m-1);++ye)Vc[se*m+ye]===255&&(Vc[se*m+ye]=0,q+=n.getElevationAtPixel(ye,se),U++)}const $=q/U;D=Math.max(1,M.x-A),O=Math.max(1,M.y-A),F=Math.min(I.x+A,m-2),H=Math.min(I.y+A,m-2),v=!0;for(let Z=O;Z<=H;++Z)for(let K=D;K<=F;++K)Vc[Z*m+K]===0&&(sx[Z*m+K]=n._dem.set(K,Z,$));for(let Z=1;Z<A;++Z){D=Math.max(1,M.x-Z),O=Math.max(1,M.y-Z),F=Math.min(I.x+Z,m-2),H=Math.min(I.y+Z,m-2);for(let K=O;K<=H;++K)for(let ae=D;ae<=F;++ae){const oe=K*m+ae;if(Vc[oe]===255){let se=0,ye=0,ce=-1,ve=-1;for(let Se=-1;Se<=1;++Se)for(let we=-1;we<=1;++we){const Ce=(K+Se)*m+ae+we;if(Vc[Ce]>=Z)continue;const ze=sx[Ce],Oe=Math.abs(ze);Oe>ye&&(se=ze,ye=Oe,ce=we,ve=Se)}if(ye>.1){const Se=1-(Z+.5*Math.abs(ce*ve))/A;let we=n._dem.get(ae,K)+se*Se;const Ce=n._dem.get(ae+ce,K+ve),ze=n._dem.get(ae-ce,K-ve,!0);(we-Ce)*(we-ze)>0&&(we=(Ce+ze)/2),sx[oe]=n._dem.set(ae,K,we),Vc[oe]=Z}}}}}v&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Ct.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)p_(n.node),rx(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const l=n.getReplacementRegionsForTile(e.toUnwrapped()),f=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){const m=f[u].node;f[u].hiddenByReplacement=!!m.footprint&&!l.find(v=>v.footprint===m.footprint)}}getHeightAtTileCoord(e,n){const l=this.getNodesInfo(),f=[],u=[0,0,0],m=me.mat4.identity([]);for(let v=0;v<this.nodesInfo.length;v++){const S=l[v],P=S.node.meshes[0],x=P.transformedAabb;if(e<x.min[0]||n<x.min[1]||e>x.max[0]||n>x.max[1])continue;if(S.node.hidden===!0)return{height:1/0,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};me.mat4.invert(m,S.node.matrix),u[0]=e,u[1]=n,me.vec3.transformMat4(u,u,m);const M=(u[0]-P.aabb.min[0])/(P.aabb.max[0]-P.aabb.min[0])*Nc|0,I=Math.min(63,(u[1]-P.aabb.min[1])/(P.aabb.max[1]-P.aabb.min[1])*Nc|0)*Nc+Math.min(63,M),T=P.heightmap[I];if(!(T<0&&S.node.footprint))return S.hiddenByReplacement?void 0:{height:T,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};if(S.node.footprint.grid.query(new Ae(e,n),new Ae(e,n),f),f.length>0)return{height:void 0,maxHeight:S.feature.properties.height,hidden:S.hiddenByReplacement,verticalScale:S.evaluatedScale[2]}}}}function Sf(o,e){return!o.isLightConstant&&e}function sI(o,e,n,l,f,u,m,v){let S=(61440&e|(61440&e)>>4)>>8,P=(3840&e|(3840&e)>>4)>>4,x=240&e|(240&e)>>4;n[3]>0&&(S=ii(S,255*n[0],n[3]),P=ii(P,255*n[1],n[3]),x=ii(x,255*n[2],n[3]));const M=S<<8|P,I=x<<8|Math.floor(255*l[3]),T=function(Z){const K=At(Z,0,2);return Math.min(Math.round(.5*K*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],A=At(f[0],0,1),D=At(f[1],0,1),O=At(f[2],0,1),F=At(f[3],0,1);let H,q,U,$;if(A!==D&&m!==u&&D!==A){const Z=m-u;q=1/(Z*(D-A)),U=-(u+Z*A)/(Z*(D-A));const K=At(f[4],-1,1);$=Math.pow(10,K),H=255*O<<8|255*F}else H=65535,q=0,U=1,$=1;if(o.emplaceBack(M,I,T,H,q,U,$),v){const Z=v.length;v.clear();for(let K=0;K<Z;K++)v.emplaceBack(M,I,T,H,q,U,$)}}function oI(o,e,n){const l=o.node;let f=0;const u=n&Eh.HasMeshoptCompression;for(const m of l.meshes){if(l.lights&&l.lightMeshIndex===f||!m.featureData)continue;m.featureArray=new lh,m.featureArray.reserve(m.featureData.length);let v=e;for(const S of m.featureData){const P=u?65535&S:S>>16&65535,x=u?S>>16&65535:65535&S,M=(15&x)<8?15&x:0,I=o.evaluatedRMEA[M],T=o.evaluatedColor[M],A=o.emissionHeightBasedParams[M];let D;if(v&&M===2&&l.lights&&(D=new lh,D.resize(10*l.lights.length)),sI(m.featureArray,P,T,I,A,m.aabb.min[2],m.aabb.max[2],D),D&&v){v=!1;const O=l.meshes[l.lightMeshIndex];O.featureArray=D,O.featureArray._trim()}}m.featureArray._trim(),f++}}function j1(o,e,n,l){const f=1<<o.z;e.lat=mr((l/vt+o.y)/f),e.lng=Xr((n/vt+o.x)/f)}Ot(m_,"Tiled3dModelBucket",{omit:["layers"]}),Ot(U1,"Tiled3dModelFeature");const aI={circle:class extends Nr{constructor(o,e,n,l){super(o,{layout:nt||(nt=new Mn({"circle-sort-key":new Dt(je.layout_circle["circle-sort-key"]),visibility:new dt(je.layout_circle.visibility)})),paint:$e||($e=new Mn({"circle-radius":new Dt(je.paint_circle["circle-radius"]),"circle-color":new Dt(je.paint_circle["circle-color"]),"circle-blur":new Dt(je.paint_circle["circle-blur"]),"circle-opacity":new Dt(je.paint_circle["circle-opacity"]),"circle-translate":new dt(je.paint_circle["circle-translate"]),"circle-translate-anchor":new dt(je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dt(je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dt(je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Dt(je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Dt(je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Dt(je.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new dt(je.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}createBucket(o){return new J(o)}queryRadius(o){const e=o;return et("circle-radius",this,e)+et("circle-stroke-width",this,e)+ot(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,n,l,f,u,m,v){const S=Ne(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,o.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return xv(o,l,u,m,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,P)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,n){const l=yh(this);return{config:new Ea(this,{zoom:e,lut:n}),defines:l,overrideFog:!1}}},heatmap:class extends Nr{createBucket(o){return new bv(o)}constructor(o,e,n,l){super(o,{layout:wv||(wv=new Mn({visibility:new dt(je.layout_heatmap.visibility)})),paint:Tv||(Tv=new Mn({"heatmap-radius":new Dt(je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Dt(je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dt(je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gl(je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dt(je.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return et("heatmap-radius",this,o)}queryIntersectsFeature(o,e,n,l,f,u,m,v){const S=this.paint.get("heatmap-radius").evaluate(e,n);return xv(o,l,u,m,v,!0,!0,new Ae(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,n){return o==="heatmap"?{config:new Ea(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Nr{constructor(o,e,n,l){super(o,{layout:Sv||(Sv=new Mn({visibility:new dt(je.layout_hillshade.visibility)})),paint:Mv||(Mv=new Mn({"hillshade-illumination-direction":new dt(je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new dt(je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dt(je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dt(je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dt(je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dt(je.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new dt(je.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,n){return{overrideFog:!1}}},fill:class extends Nr{constructor(o,e,n,l){super(o,{layout:Lv||(Lv=new Mn({"fill-sort-key":new Dt(je.layout_fill["fill-sort-key"]),visibility:new dt(je.layout_fill.visibility),"fill-elevation-reference":new dt(je.layout_fill["fill-elevation-reference"])})),paint:kv||(kv=new Mn({"fill-antialias":new dt(je.paint_fill["fill-antialias"]),"fill-opacity":new Dt(je.paint_fill["fill-opacity"]),"fill-color":new Dt(je.paint_fill["fill-color"]),"fill-outline-color":new Dt(je.paint_fill["fill-outline-color"]),"fill-translate":new dt(je.paint_fill["fill-translate"]),"fill-translate-anchor":new dt(je.paint_fill["fill-translate-anchor"]),"fill-pattern":new Dt(je.paint_fill["fill-pattern"]),"fill-emissive-strength":new dt(je.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Dt(je.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(o,e,n){return{config:new Ea(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new by(o)}queryRadius(){return ot(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,n,l,f,u){return!o.queryGeometry.isAboveHorizon&&ue(ft(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,o.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Nr{constructor(o,e,n,l){super(o,{layout:_b||(_b=new Mn({visibility:new dt(je["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new dt(je["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:gb||(gb=new Mn({"fill-extrusion-opacity":new dt(je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Dt(je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dt(je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dt(je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Dt(je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Dt(je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Dt(je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new dt(je["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new dt(je["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new dt(je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new dt(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new dt(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new dt(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new dt(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new dt(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new dt(je["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new dt(je["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Dt(je["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Dt(je["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new dt(je["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new dt(je["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new dt(je["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new dt(je["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Dt(je["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Dt(je["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new dt(je["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Hm(o)}queryRadius(){return ot(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,n,l,f,u,m,v,S){const P=Ne(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,o.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(e,n),M=this.paint.get("fill-extrusion-base").evaluate(e,n),I=[0,0],T=v&&u.elevation,A=u.elevation?u.elevation.exaggeration():1,D=o.tile.getBucket(this);if(T&&D instanceof Hm){const U=D.centroidVertexArray,$=S+1;$<U.length&&(I[0]=U.geta_centroid_pos0($),I[1]=U.geta_centroid_pos1($))}if(I[0]===0&&I[1]===1)return!1;u.projection.name==="globe"&&(l=mb([l],[new Ae(0,0),new Ae(vt,vt)],o.tileID.canonical).map(U=>U.polygon).flat());const O=T?v:null,[F,H]=function(U,$,Z,K,ae,oe,se,ye,ce,ve,Se){return U.projection.name==="globe"?function(we,Ce,ze,Oe,Pe,Xe,lt,Je,mt,pt,Tt){const it=[],Vt=[],_t=we.projection.upVectorScale(Tt,we.center.lat,we.worldSize).metersToTile,Ft=[0,0,0,1],Kt=[0,0,0,1],fi=(wi,gi,Ei,sn)=>{wi[0]=gi,wi[1]=Ei,wi[2]=sn,wi[3]=1},_i=pb();ze>0&&(ze+=_i),Oe+=_i;for(const wi of Ce){const gi=[],Ei=[];for(const sn of wi){const Ki=sn.x+Pe.x,li=sn.y+Pe.y,Ji=we.projection.projectTilePoint(Ki,li,Tt),$i=we.projection.upVector(Tt,sn.x,sn.y);let on=ze,Zn=Oe;if(lt){const Xn=xb(Ki,li,ze,Oe,lt,Je,mt,pt);on+=Xn.base,Zn+=Xn.top}ze!==0?fi(Ft,Ji.x+$i[0]*_t*on,Ji.y+$i[1]*_t*on,Ji.z+$i[2]*_t*on):fi(Ft,Ji.x,Ji.y,Ji.z),fi(Kt,Ji.x+$i[0]*_t*Zn,Ji.y+$i[1]*_t*Zn,Ji.z+$i[2]*_t*Zn),me.vec3.transformMat4(Ft,Ft,Xe),me.vec3.transformMat4(Kt,Kt,Xe),gi.push(new Fc(Ft[0],Ft[1],Ft[2])),Ei.push(new Fc(Kt[0],Kt[1],Kt[2]))}it.push(gi),Vt.push(Ei)}return[it,Vt]}(U,$,Z,K,ae,oe,se,ye,ce,ve,Se):se?function(we,Ce,ze,Oe,Pe,Xe,lt,Je,mt){const pt=[],Tt=[],it=[0,0,0,1];for(const Vt of we){const _t=[],Ft=[];for(const Kt of Vt){const fi=Kt.x+Oe.x,_i=Kt.y+Oe.y,wi=xb(fi,_i,Ce,ze,Xe,lt,Je,mt);it[0]=fi,it[1]=_i,it[2]=wi.base,it[3]=1,me.vec4.transformMat4(it,it,Pe),it[3]=Math.max(it[3],1e-5);const gi=new Fc(it[0]/it[3],it[1]/it[3],it[2]/it[3]);it[0]=fi,it[1]=_i,it[2]=wi.top,it[3]=1,me.vec4.transformMat4(it,it,Pe),it[3]=Math.max(it[3],1e-5);const Ei=new Fc(it[0]/it[3],it[1]/it[3],it[2]/it[3]);_t.push(gi),Ft.push(Ei)}pt.push(_t),Tt.push(Ft)}return[pt,Tt]}($,Z,K,ae,oe,se,ye,ce,ve):function(we,Ce,ze,Oe,Pe){const Xe=[],lt=[],Je=Pe[8]*Ce,mt=Pe[9]*Ce,pt=Pe[10]*Ce,Tt=Pe[11]*Ce,it=Pe[8]*ze,Vt=Pe[9]*ze,_t=Pe[10]*ze,Ft=Pe[11]*ze;for(const Kt of we){const fi=[],_i=[];for(const wi of Kt){const gi=wi.x+Oe.x,Ei=wi.y+Oe.y,sn=Pe[0]*gi+Pe[4]*Ei+Pe[12],Ki=Pe[1]*gi+Pe[5]*Ei+Pe[13],li=Pe[2]*gi+Pe[6]*Ei+Pe[14],Ji=Pe[3]*gi+Pe[7]*Ei+Pe[15],$i=sn+Je,on=Ki+mt,Zn=li+pt,Xn=Math.max(Ji+Tt,1e-5),On=sn+it,Jr=Ki+Vt,vn=li+_t,wn=Math.max(Ji+Ft,1e-5);fi.push(new Fc($i/Xn,on/Xn,Zn/Xn)),_i.push(new Fc(On/wn,Jr/wn,vn/wn))}Xe.push(fi),lt.push(_i)}return[Xe,lt]}($,Z,K,ae,oe)}(u,l,M,x,P,m,O,I,A,u.center.lat,o.tileID.canonical),q=o.queryGeometry;return function(U,$,Z){let K=1/0;ue(Z,$)&&(K=yb(Z,$[0]));for(let ae=0;ae<$.length;ae++){const oe=$[ae],se=U[ae];for(let ye=0;ye<oe.length-1;ye++){const ce=oe[ye],ve=[ce,oe[ye+1],se[ye+1],se[ye],ce];Q(Z,ve)&&(K=Math.min(K,yb(Z,ve)))}}return K!==1/0&&K}(F,H,q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends Nr{constructor(o,e,n,l){const f=Cb();super(o,f,e,n,l),f.layout&&(this.layout=new _l(f.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof mc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(ff)return ff;const n=Cb();return ff=new cA(n.paint.properties["line-width"].specification),ff.useIntegerZoom=!0,ff})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Dy(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,n){const l=Ab(this);return{config:new Ea(this,{zoom:e,lut:n}),defines:l,overrideFog:!1}}queryRadius(o){const e=o,n=Pb(et("line-width",this,e),et("line-gap-width",this,e)),l=et("line-offset",this,e);return n/2+Math.abs(l)+ot(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,n,l,f,u){if(o.queryGeometry.isAboveHorizon)return!1;const m=ft(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,o.pixelToTileUnitsFactor),v=o.pixelToTileUnitsFactor/2*Pb(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),S=this.paint.get("line-offset").evaluate(e,n);return S&&(l=function(P,x){const M=[],I=new Ae(0,0);for(let T=0;T<P.length;T++){const A=P[T],D=[];for(let O=0;O<A.length;O++){const F=A[O],H=A[O+1],q=O===0?I:F.sub(A[O-1])._unit()._perp(),U=O===A.length-1?I:H.sub(F)._unit()._perp(),$=q._add(U)._unit();$._mult(1/($.x*U.x+$.y*U.y)),D.push($._mult(x)._add(F))}M.push(D)}return M}(l,S*o.pixelToTileUnitsFactor)),function(P,x,M){for(let I=0;I<x.length;I++){const T=x[I];if(P.length>=3){for(let A=0;A<T.length;A++)if(Ie(P,T[A]))return!0}if(le(P,T,M))return!0}return!1}(m,l,v)}isTileClipped(){return!0}isDraped(o){const e=this.layout.get("line-z-offset"),n=e.isConstant()&&!e.constantOr(0),l=this.layout.get("line-elevation-reference");return!(l==="sea"||l==="ground")&&(n||l!=="none")}},symbol:a_,background:class extends Nr{constructor(o,e,n,l){super(o,{layout:f1||(f1=new Mn({visibility:new dt(je.layout_background.visibility)})),paint:p1||(p1=new Mn({"background-pitch-alignment":new dt(je.paint_background["background-pitch-alignment"]),"background-color":new dt(je.paint_background["background-color"]),"background-pattern":new dt(je.paint_background["background-pattern"]),"background-opacity":new dt(je.paint_background["background-opacity"]),"background-emissive-strength":new dt(je.paint_background["background-emissive-strength"]),"background-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,n){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:x1,"raster-particle":M1,sky:class extends Nr{constructor(o,e,n,l){super(o,{layout:w1||(w1=new Mn({visibility:new dt(je.layout_sky.visibility)})),paint:T1||(T1=new Mn({"sky-type":new dt(je.paint_sky["sky-type"]),"sky-atmosphere-sun":new dt(je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new dt(je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new dt(je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new dt(je.paint_sky["sky-gradient-radius"]),"sky-gradient":new gl(je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new dt(je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new dt(je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new dt(je.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=rf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),f=!l,u=o.style.light,m=u.properties.get("position");return f&&u.properties.get("anchor")==="viewport"&&Ti("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?Qy(m.azimuthal,90-m.polar,e):Qy(l[0],90-l[1],e)}const n=this.paint.get("sky-gradient-center");return Qy(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Nr{constructor(o,e,n,l){super(o,{paint:S1||(S1=new Mn({}))},e,null)}},model:class extends Nr{constructor(o,e,n,l){super(o,{layout:k1||(k1=new Mn({visibility:new dt(je.layout_model.visibility),"model-id":new Dt(je.layout_model["model-id"])})),paint:O1||(O1=new Mn({"model-opacity":new Dt(je.paint_model["model-opacity"]),"model-rotation":new Dt(je.paint_model["model-rotation"]),"model-scale":new Dt(je.paint_model["model-scale"]),"model-translation":new Dt(je.paint_model["model-translation"]),"model-color":new Dt(je.paint_model["model-color"]),"model-color-mix-intensity":new Dt(je.paint_model["model-color-mix-intensity"]),"model-type":new dt(je.paint_model["model-type"]),"model-cast-shadows":new dt(je.paint_model["model-cast-shadows"]),"model-receive-shadows":new dt(je.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new dt(je.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Dt(je.paint_model["model-emissive-strength"]),"model-roughness":new Dt(je.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Dt(je.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new dt(je.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new dt(je.paint_model["model-front-cutoff"]),"model-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new ix(o)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof m_?vt-1:0}queryIntersectsFeature(o,e,n,l,f,u){if(!this.modelManager)return!1;const m=this.modelManager,v=o.tile.getBucket(this);if(!(v&&v instanceof ix))return!1;for(const S in v.instancesPerModel){const P=v.instancesPerModel[S],x=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(P.idToFeaturesIndex.hasOwnProperty(x)){const M=P.features[P.idToFeaturesIndex[x]],I=m.getModel(S,this.scope);if(!I)return!1;let T=me.mat4.create();const A=new Bi(0,0),D=v.canonical;let O=Number.MAX_VALUE;for(let F=0;F<M.instancedDataCount;++F){const H=16*(M.instancedDataOffset+F),q=P.instancedDataArray.float32,U=[q[H+4],q[H+5],q[H+6]];j1(D,A,q[H],0|q[H+1]),F1(T,I,u,A,M.rotation,M.scale,U,!1,!1,!1),u.projection.name==="globe"&&(T=tx(T,u));const $=me.mat4.multiply([],u.projMatrix,T),Z=o.queryGeometry,K=P1(Z.isPointQuery()?Z.screenBounds:Z.screenGeometry,u,$,I.aabb);K!=null&&(O=Math.min(K,O))}return O!==Number.MAX_VALUE&&O}}return!1}_handleOverridablePaintPropertyUpdate(o,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof dl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Nr{constructor(o,e,n,l){super(o,{layout:Ov||(Ov=new Mn({"clip-layer-types":new dt(je.layout_clip["clip-layer-types"]),"clip-layer-scope":new dt(je.layout_clip["clip-layer-scope"])})),paint:Fv||(Fv=new Mn({}))},e,n,l)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new Bv(o)}isTileClipped(){return!0}is3D(){return!0}}};class lI{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class cI{constructor(){this.tasks={},this.taskQueue=[],wr(["process"],this),this.invoker=new lI(this.process),this.nextId=0}add(e,n){const l=this.nextId++,f=function({type:u,isSymbolTile:m,zoom:v}){return v=v||0,u==="message"?0:u!=="maybePrepare"||m?u!=="parseTile"||m?u==="parseTile"&&m?300-v:u==="maybePrepare"&&m?400-v:500:200-v:100-v}(n);if(f===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:n,priority:f,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let f=0;f<this.taskQueue.length;f++){const u=this.tasks[this.taskQueue[f]];u.priority<n&&(n=u.priority,e=f)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class G1{constructor(e,n,l){this.target=e,this.parent=n,this.mapId=l,this.callbacks={},this.cancelCallbacks={},wr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new cI}send(e,n,l,f,u=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=m,this.callbacks[v]=l);const S=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!l,targetMapId:f,mustQueue:u,sourceMapId:this.mapId,data:wa(n,S)},S),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(e){const n=e.data,l=n.id;if(l&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const f=this.cancelCallbacks[l];delete this.cancelCallbacks[l],f&&f.cancel()}else if(n.mustQueue||la()){const f=this.callbacks[l],u=this.scheduler.add(()=>this.processTask(l,n),f&&f.metadata||{type:"message"});u&&(this.cancelCallbacks[l]=u)}else this.processTask(l,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(n.error?l(Ta(n.error)):l(null,Ta(n.data)))}else{const l=new Set,f=n.hasCallback?(m,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?wa(m):null,data:wa(v,l)},l)}:()=>{},u=Ta(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,u,f);else if(this.parent.getWorkerSource){const m=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,m[0],u.source,u.scope)[m[1]](u,f)}else f(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Mf={workerUrl:"",workerClass:null,workerParams:void 0};const ox="mapboxgl_preloaded_worker_pool";class Uc{constructor(){this.active={}}acquire(e,n=Uc.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;)this.workers.push(Mf.workerClass!=null?new Mf.workerClass:new self.Worker(Mf.workerUrl,Mf.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ox]}numActive(){return Object.keys(this.active).length}}Uc.workerCount=2;class Ih{constructor(e,n,l="Worker",f=Uc.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=lr();const u=this.workerPool.acquire(this.id,f);for(let m=0;m<u.length;m++){const v=new Ih.Actor(u[m],n,this.id);v.name=`${l} ${m}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,l){un(this.actors,(f,u)=>{f.send(e,n,u)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Ef,ax;function __(){return Ef||(Ef=new Uc),Ef}Ih.Actor=G1;const lx=new Fi(0,0,0);var g_=(o=>(o[o.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",o[o.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",o[o.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",o))(g_||{}),y_=(o=>(o[o.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",o[o.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",o[o.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",o[o.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",o))(y_||{}),Af=(o=>(o[o.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",o[o.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",o[o.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",o[o.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",o[o.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",o))(Af||{}),H1=(o=>(o[o.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",o[o.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",o[o.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",o))(H1||{}),Ch=(o=>(o[o.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",o[o.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",o[o.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",o[o.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",o[o.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",o[o.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",o))(Ch||{}),q1=(o=>(o[o.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",o[o.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",o[o.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",o))(q1||{});function uI(o,e,n){o===1&&e.icons.push(function(l,f){return function(u){if(u.usvg_tree.height||(u.usvg_tree.height=u.usvg_tree.width),!u.metadata)return u;const{metadata:m}=u;if(m.content_area){const{content_area:v}=m;v.top==null&&(v.top=v.left),v.width==null&&(v.width=u.usvg_tree.width),v.height==null&&(v.height=v.width)}return m.stretch_x&&m.stretch_x.length&&$1(m,"x"),m.stretch_y&&m.stretch_y.length&&$1(m,"y"),u}(l.readFields(hI,{name:void 0},f))}(n,n.readVarint()+n.pos))}function $1(o,e){const n=[],l=o[`stretch_${e}`];let f=null;for(let u=0;u<l.length;u++)f===null?f=n.length===0?l[0]:n[n.length-1][1]+l[u]:(n.push([f,f+l[u]]),f=null);o[`stretch_${e}_areas`]=n}function hI(o,e,n){o===1?e.name=n.readString():o===2?e.metadata=function(l,f){return l.readFields(dI,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},f)}(n,n.readVarint()+n.pos):o===3&&(e.usvg_tree=function(l,f){return l.readFields(mI,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},f)}(n,n.readVarint()+n.pos),e.data="usvg_tree")}function dI(o,e,n){o===1?e.stretch_x=n.readPackedVarint():o===2?e.stretch_y=n.readPackedVarint():o===3?e.content_area=function(l,f){return l.readFields(fI,{left:0},f)}(n,n.readVarint()+n.pos):o===4&&e.variables.push(function(l,f){return l.readFields(pI,{name:void 0},f)}(n,n.readVarint()+n.pos))}function fI(o,e,n){o===1?e.left=n.readVarint():o===2?e.width=n.readVarint():o===3?e.top=n.readVarint():o===4&&(e.height=n.readVarint())}function pI(o,e,n){o===1?e.name=n.readString():o===2&&(e.rgb_color=b_(n.readVarint()),e.value="rgb_color")}function mI(o,e,n){o===1?e.width=e.height=n.readVarint():o===2?e.height=n.readVarint():o===3?e.children.push(x_(n,n.readVarint()+n.pos)):o===4?e.linear_gradients.push(function(l,f){return l.readFields(wI,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},f)}(n,n.readVarint()+n.pos)):o===5?e.radial_gradients.push(function(l,f){return l.readFields(SI,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},f)}(n,n.readVarint()+n.pos)):o===7?e.clip_paths.push(function(l,f){return l.readFields(MI,{children:[]},f)}(n,n.readVarint()+n.pos)):o===8&&e.masks.push(function(l,f){const u=l.readFields(EI,{left:0,width:20,mask_type:1,children:[]},f);return u.height==null&&(u.height=u.width),u.top==null&&(u.top=u.left),u}(n,n.readVarint()+n.pos))}function x_(o,e){return o.readFields(_I,{},e)}function _I(o,e,n){o===1?(e.group=function(l,f){return l.readFields(gI,{opacity:255,children:[]},f)}(n,n.readVarint()+n.pos),e.node="group"):o===2&&(e.path=function(l,f){return l.readFields(xI,{paint_order:1,commands:[],step:1,diffs:[],rule:1},f)}(n,n.readVarint()+n.pos),e.node="path")}function gI(o,e,n){o===1?e.transform=v_(n,n.readVarint()+n.pos):o===2?e.opacity=n.readVarint():o===5?e.clip_path_idx=n.readVarint():o===6?e.mask_idx=n.readVarint():o===7&&e.children.push(x_(n,n.readVarint()+n.pos))}function v_(o,e){return o.readFields(yI,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function yI(o,e,n){o===1?e.sx=n.readFloat():o===2?e.ky=n.readFloat():o===3?e.kx=n.readFloat():o===4?e.sy=n.readFloat():o===5?e.tx=n.readFloat():o===6&&(e.ty=n.readFloat())}function xI(o,e,n){o===1?e.fill=function(l,f){return l.readFields(vI,{rgb_color:lx,paint:"rgb_color",opacity:255},f)}(n,n.readVarint()+n.pos):o===2?e.stroke=function(l,f){return l.readFields(bI,{rgb_color:lx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},f)}(n,n.readVarint()+n.pos):o===3?e.paint_order=n.readVarint():o===5?n.readPackedVarint(e.commands):o===6?e.step=n.readFloat():o===7?n.readPackedSVarint(e.diffs):o===8&&(e.rule=n.readVarint())}function vI(o,e,n){o===1?(e.rgb_color=b_(n.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=n.readVarint())}function b_(o){return new Fi((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function bI(o,e,n){o===1?(e.rgb_color=b_(n.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):o===5?n.readPackedFloat(e.dasharray):o===6?e.dashoffset=n.readFloat():o===7?e.miterlimit=n.readFloat():o===8?e.opacity=n.readVarint():o===9?e.width=n.readFloat():o===10?e.linecap=n.readVarint():o===11&&(e.linejoin=n.readVarint())}function wI(o,e,n){o===1?e.transform=v_(n,n.readVarint()+n.pos):o===2?e.spread_method=n.readVarint():o===3?e.stops.push(W1(n,n.readVarint()+n.pos)):o===4?e.x1=n.readFloat():o===5?e.y1=n.readFloat():o===6?e.x2=n.readFloat():o===7&&(e.y2=n.readFloat())}function W1(o,e){return o.readFields(TI,{offset:0,opacity:255,rgb_color:lx},e)}function TI(o,e,n){o===1?e.offset=n.readFloat():o===2?e.opacity=n.readVarint():o===3&&(e.rgb_color=b_(n.readVarint()))}function SI(o,e,n){o===1?e.transform=v_(n,n.readVarint()+n.pos):o===2?e.spread_method=n.readVarint():o===3?e.stops.push(W1(n,n.readVarint()+n.pos)):o===4?e.cx=n.readFloat():o===5?e.cy=n.readFloat():o===6?e.r=n.readFloat():o===7?e.fx=n.readFloat():o===8?e.fy=n.readFloat():o===9&&(e.fr=n.readFloat())}function MI(o,e,n){o===1?e.transform=v_(n,n.readVarint()+n.pos):o===2?e.clip_path_idx=n.readVarint():o===3&&e.children.push(x_(n,n.readVarint()+n.pos))}function EI(o,e,n){o===1?e.left=e.top=n.readFloat():o===2?e.width=e.height=n.readFloat():o===3?e.top=n.readFloat():o===4?e.height=n.readFloat():o===5?e.mask_type=n.readVarint():o===6?e.mask_idx=n.readVarint():o===7&&e.children.push(x_(n,n.readVarint()+n.pos))}class AI{static calculate(e,n){const l=new Map,f=new Map;if(Object.keys(e).length===0)return l;n.forEach(u=>{f.set(u.name,u.rgb_color||new Fi(0,0,0))});for(const[u,m]of Object.entries(e))f.has(u)?l.set(f.get(u).toStringPremultipliedAlpha(),m):console.warn(`Ignoring unknown image variable "${u}"`);return l}}function Ph(o,e=255,n){const l=e/255,f=o.toStringPremultipliedAlpha(),u=n.has(f)?n.get(f).clone():o.clone();return u.a=l,u.toString()}function cx(o,e){if(!ht()){const n=document.createElement("canvas");return n.width=o,n.height=e,n}return new OffscreenCanvas(o,e)}function II(o,e){const n=AI.calculate(e.params,o.metadata?o.metadata.variables:[]),l=o.usvg_tree,f=l.width,u=l.height,m=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(f*m.a)),S=Math.max(1,Math.round(u*m.d)),P=new DOMMatrix([v/f,0,0,S/u,0,0]),x=cx(v,S).getContext("2d");return ux(x,P,l,l,n),x.getImageData(0,0,v,S)}function ux(o,e,n,l,f){for(const u of l.children)Z1(o,e,n,u,f)}function Z1(o,e,n,l,f){l.group?(o.save(),function(u,m,v,S,P){const x=S.mask_idx!=null?v.masks[S.mask_idx]:null,M=S.clip_path_idx!=null?v.clip_paths[S.clip_path_idx]:null;if(S.transform&&(m=If(S.transform).preMultiplySelf(m)),!function(A,D,O){return A.opacity!==255||D||O}(S,M!=null,x!=null))return void ux(u,m,v,S,P);const I=cx(u.canvas.width,u.canvas.height),T=I.getContext("2d");M&&Q1(T,m,v,M),ux(T,m,v,S,P),x&&ew(T,m,v,x,P),u.globalAlpha=S.opacity/255,u.drawImage(I,0,0)}(o,e,n,l.group,f),o.restore()):l.path&&(o.save(),function(u,m,v,S,P){const x=tw(S);u.setTransform(m),S.paint_order===H1.PAINT_ORDER_FILL_AND_STROKE?(X1(u,v,S,x,P),Y1(u,v,S,x,P)):(Y1(u,v,S,x,P),X1(u,v,S,x,P))}(o,e,n,l.path,f),o.restore())}function X1(o,e,n,l,f){const u=n.fill;if(!u)return;const m=u.opacity/255;switch(u.paint){case"rgb_color":o.fillStyle=Ph(u.rgb_color,u.opacity,f);break;case"linear_gradient_idx":o.fillStyle=K1(o,e.linear_gradients[u.linear_gradient_idx],m,f);break;case"radial_gradient_idx":o.fillStyle=J1(o,e.radial_gradients[u.radial_gradient_idx],m,f)}let v;switch(n.rule){case g_.PATH_RULE_NON_ZERO:v="nonzero";break;case g_.PATH_RULE_EVEN_ODD:v="evenodd"}o.fill(l,v)}function Y1(o,e,n,l,f){const u=n.stroke;if(!u)return;o.lineWidth=u.width,o.miterLimit=u.miterlimit,o.setLineDash(u.dasharray),o.lineDashOffset=u.dashoffset;const m=u.opacity/255;switch(u.paint){case"rgb_color":o.strokeStyle=Ph(u.rgb_color,u.opacity,f);break;case"linear_gradient_idx":o.strokeStyle=K1(o,e.linear_gradients[u.linear_gradient_idx],m,f);break;case"radial_gradient_idx":o.strokeStyle=J1(o,e.radial_gradients[u.radial_gradient_idx],m,f)}switch(u.linejoin){case Af.LINE_JOIN_MITER_CLIP:case Af.LINE_JOIN_MITER:o.lineJoin="miter";break;case Af.LINE_JOIN_ROUND:o.lineJoin="round";break;case Af.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(u.linecap){case y_.LINE_CAP_BUTT:o.lineCap="butt";break;case y_.LINE_CAP_ROUND:o.lineCap="round";break;case y_.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(l)}function K1(o,e,n,l){if(e.stops.length===1){const I=e.stops[0];return Ph(I.rgb_color,I.opacity*n,l)}const f=If(e.transform),{x1:u,y1:m,x2:v,y2:S}=e,P=f.transformPoint(new DOMPoint(u,m)),x=f.transformPoint(new DOMPoint(v,S)),M=o.createLinearGradient(P.x,P.y,x.x,x.y);for(const I of e.stops)M.addColorStop(I.offset,Ph(I.rgb_color,I.opacity*n,l));return M}function J1(o,e,n,l){if(e.stops.length===1){const I=e.stops[0];return Ph(I.rgb_color,I.opacity*n,l)}const f=If(e.transform),{fx:u,fy:m,cx:v,cy:S}=e,P=f.transformPoint(new DOMPoint(u,m)),x=f.transformPoint(new DOMPoint(v,S)),M=o.createRadialGradient(P.x,P.y,0,x.x,x.y,e.r*((f.a+f.d)/2));for(const I of e.stops)M.addColorStop(I.offset,Ph(I.rgb_color,I.opacity*n,l));return M}function Q1(o,e,n,l){const f=If(l.transform).preMultiplySelf(e),u=l.clip_path_idx!=null?n.clip_paths[l.clip_path_idx]:null;u&&Q1(o,f,n,u);const m=new Path2D;let v;function S(P,x){if(P.path){const M=P.path;m.addPath(tw(M),x),M.rule===g_.PATH_RULE_EVEN_ODD&&(v="evenodd")}else if(P.group){const M=P.group.transform?If(P.group.transform).preMultiplySelf(x):x;for(const I of P.group.children)S(I,M)}}for(const P of l.children)S(P,f);o.clip(m,v)}function ew(o,e,n,l,f){if(l.children.length===0)return;const u=l.mask_idx!=null?n.masks[l.mask_idx]:null;u&&ew(o,e,n,u,f);const m=o.canvas.width,v=o.canvas.height,S=cx(m,v),P=S.getContext("2d"),x=l.width,M=l.height,I=l.left,T=l.top,A=new Path2D,D=new Path2D;D.rect(I,T,x,M),A.addPath(D,e),P.clip(A);for(const H of l.children)Z1(P,e,n,H,f);const O=P.getImageData(0,0,m,v),F=O.data;if(l.mask_type===q1.MASK_TYPE_LUMINANCE)for(let H=0;H<F.length;H+=4)F[H+3]=F[H+3]/255*(.2126*F[H]+.7152*F[H+1]+.0722*F[H+2]);P.putImageData(O,0,0),o.globalCompositeOperation="destination-in",o.drawImage(S,0,0)}function If(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function tw(o){const e=new Path2D,n=o.step;let l=o.diffs[0]*n,f=o.diffs[1]*n;e.moveTo(l,f);for(let u=0,m=2;u<o.commands.length;u++)switch(o.commands[u]){case Ch.PATH_COMMAND_MOVE:l+=o.diffs[m++]*n,f+=o.diffs[m++]*n,e.moveTo(l,f);break;case Ch.PATH_COMMAND_LINE:l+=o.diffs[m++]*n,f+=o.diffs[m++]*n,e.lineTo(l,f);break;case Ch.PATH_COMMAND_QUAD:{const v=l+o.diffs[m++]*n,S=f+o.diffs[m++]*n;l=v+o.diffs[m++]*n,f=S+o.diffs[m++]*n,e.quadraticCurveTo(v,S,l,f);break}case Ch.PATH_COMMAND_CUBIC:{const v=l+o.diffs[m++]*n,S=f+o.diffs[m++]*n,P=v+o.diffs[m++]*n,x=S+o.diffs[m++]*n;l=P+o.diffs[m++]*n,f=x+o.diffs[m++]*n,e.bezierCurveTo(v,S,P,x,l,f);break}case Ch.PATH_COMMAND_CLOSE:e.closePath()}return e}class hx{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}class dx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Rr(e,e.data)}getFromCache(e,n,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new hx(150)),this.cacheMap.get(l).get(Br(e.serialize(),n))}setInCache(e,n,l,f){this.cacheDependenciesMap.has(f)||this.cacheDependenciesMap.set(f,new Map),this.cacheMap.has(f)||this.cacheMap.set(f,new hx(150));const u=this.cacheDependenciesMap.get(f);u.get(Br(e.id,l))||u.set(Br(e.id,l),new Set);const m=this.cacheMap.get(f),v=e.serialize();u.get(Br(e.id,l)).add(v),m.put(Br(e.serialize(),l),n)}removeImagesFromCacheByIds(e,n,l=""){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const f=this.cacheMap.get(l),u=this.cacheDependenciesMap.get(l);for(const m of e)if(u.has(Br(m,n))){for(const v of u.get(Br(m,n)))f.delete(v);u.delete(Br(m,n))}}rasterize(e,n,l,f,u=II){const m=this.getFromCache(e,l,f);if(m)return m.clone();const v=u(n.icon,e.options),S=dx._getImage(v);return this.setInCache(e,S,l,f),S.clone()}}class iw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const l=this.toIdx(e,n);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function nw(o,e,n,l){let f=0,u=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(l[m])<1e-15){if(n[m]<o[m]||n[m]>e[m])return null}else{const v=1/l[m];let S=(o[m]-n[m])*v,P=(e[m]-n[m])*v;if(S>P){const x=S;S=P,P=x}if(S>f&&(f=S),P<u&&(u=P),f>u)return null}return f}function rw(o,e,n,l,f,u,m,v,S,P,x){const M=l-o,I=f-e,T=u-n,A=m-o,D=v-e,O=S-n,F=x[1]*O-x[2]*D,H=x[2]*A-x[0]*O,q=x[0]*D-x[1]*A,U=M*F+I*H+T*q;if(Math.abs(U)<1e-15)return null;const $=1/U,Z=P[0]-o,K=P[1]-e,ae=P[2]-n,oe=(Z*F+K*H+ae*q)*$;if(oe<0||oe>1)return null;const se=K*T-ae*I,ye=ae*M-Z*T,ce=Z*I-K*M,ve=(x[0]*se+x[1]*ye+x[2]*ce)*$;return ve<0||oe+ve>1?null:(A*se+D*ye+O*ce)*$}function sw(o,e,n){return(o-e)/(n-e)}function ow(o,e,n,l,f,u,m,v,S){const P=1<<n,x=u-l,M=m-f,I=(o+1)/P*x+l,T=(e+0)/P*M+f,A=(e+1)/P*M+f;v[0]=(o+0)/P*x+l,v[1]=T,S[0]=I,S[1]=A}class aw{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(u){const m=Math.ceil(Math.log2(u.dim/8)),v=[];let S=Math.ceil(Math.pow(2,m));const P=1/S,x=(T,A,D,O,F)=>{const H=O?1:0,q=(T+1)*D-H,U=A*D,$=(A+1)*D-H;F[0]=T*D,F[1]=U,F[2]=q,F[3]=$};let M=new iw(S);const I=[];for(let T=0;T<S*S;T++){x(T%S,Math.floor(T/S),P,!1,I);const A=zl(I[0],I[1],u),D=zl(I[2],I[1],u),O=zl(I[2],I[3],u),F=zl(I[0],I[3],u);M.minimums.push(Math.min(A,D,O,F)),M.maximums.push(Math.max(A,D,O,F)),M.leaves.push(1)}for(v.push(M),S/=2;S>=1;S/=2){const T=v[v.length-1];M=new iw(S);for(let A=0;A<S*S;A++){x(A%S,Math.floor(A/S),2,!0,I);const D=T.getElevation(I[0],I[1]),O=T.getElevation(I[2],I[1]),F=T.getElevation(I[2],I[3]),H=T.getElevation(I[0],I[3]),q=T.isLeaf(I[0],I[1]),U=T.isLeaf(I[2],I[1]),$=T.isLeaf(I[2],I[3]),Z=T.isLeaf(I[0],I[3]),K=Math.min(D.min,O.min,F.min,H.min),ae=Math.max(D.max,O.max,F.max,H.max),oe=q&&U&&$&&Z;M.maximums.push(ae),M.minimums.push(K),M.leaves.push(ae-K<=5&&oe?1:0)}v.push(M)}return v}(this.dem),l=n.length-1,f=n[l];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(n,0,0,l,0)}raycastRoot(e,n,l,f,u,m,v=1){return nw([e,n,-100],[l,f,this.maximums[0]*v],u,m)}raycast(e,n,l,f,u,m,v=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,n,l,f,u,m,v);if(S==null)return null;const P=[],x=[],M=[],I=[],T=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;T.length>0;){const{idx:A,t:D,nodex:O,nodey:F,depth:H}=T.pop();if(this.leaves[A]){ow(O,F,H,e,n,l,f,M,I);const U=1<<H,$=(O+0)/U,Z=(O+1)/U,K=(F+0)/U,ae=(F+1)/U,oe=zl($,K,this.dem)*v,se=zl(Z,K,this.dem)*v,ye=zl(Z,ae,this.dem)*v,ce=zl($,ae,this.dem)*v,ve=rw(M[0],M[1],oe,I[0],M[1],se,I[0],I[1],ye,u,m),Se=rw(I[0],I[1],ye,M[0],I[1],ce,M[0],M[1],oe,u,m),we=Math.min(ve!==null?ve:Number.MAX_VALUE,Se!==null?Se:Number.MAX_VALUE);if(we!==Number.MAX_VALUE)return we;{const Ce=me.vec3.scaleAndAdd([],u,m,D);if(lw(oe,se,ce,ye,sw(Ce[0],M[0],I[0]),sw(Ce[1],M[1],I[1]))>=Ce[2])return D}continue}let q=0;for(let U=0;U<this._siblingOffset.length;U++){ow((O<<1)+this._siblingOffset[U][0],(F<<1)+this._siblingOffset[U][1],H+1,e,n,l,f,M,I),M[2]=-100,I[2]=this.maximums[this.childOffsets[A]+U]*v;const $=nw(M,I,u,m);if($!=null){const Z=$;P[U]=Z;let K=!1;for(let ae=0;ae<q&&!K;ae++)Z>=P[x[ae]]&&(x.splice(ae,0,U),K=!0);K||(x[q]=U),q++}}for(let U=0;U<q;U++){const $=x[U];T.push({idx:this.childOffsets[A]+$,t:P[$],nodex:(O<<1)+this._siblingOffset[$][0],nodey:(F<<1)+this._siblingOffset[$][1],depth:H+1})}}return null}_addNode(e,n,l){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,l,f,u){if(e[f].isLeaf(n,l)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const m=f-1,v=e[m];let S=0,P=0;for(let x=0;x<this._siblingOffset.length;x++){const M=2*n+this._siblingOffset[x][0],I=2*l+this._siblingOffset[x][1],T=v.getElevation(M,I),A=v.isLeaf(M,I),D=this._addNode(T.min,T.max,A);A&&(S|=1<<x),P||(P=D)}for(let x=0;x<this._siblingOffset.length;x++)S&1<<x||this._construct(e,2*n+this._siblingOffset[x][0],2*l+this._siblingOffset[x][1],m,P+x)}}function lw(o,e,n,l,f,u){return ii(ii(o,n,u),ii(e,l,u),f)}function zl(o,e,n){const l=n.dim,f=At(o*l-.5,0,l-1),u=At(e*l-.5,0,l-1),m=Math.floor(f),v=Math.floor(u),S=Math.min(m+1,l-1),P=Math.min(v+1,l-1);return lw(n.get(m,v),n.get(S,v),n.get(m,P),n.get(S,P),f-m,u-v)}const CI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function PI(o,e,n){return(256*o*256+256*e+n)/10-1e4}function DI(o,e,n){return 256*o+e+n/256-32768}class w_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,l,f=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Ti(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const u=this.dim=n.height-2,m=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let S=0;S<u;S++)m[this._idx(-1,S)]=m[this._idx(0,S)],m[this._idx(u,S)]=m[this._idx(u-1,S)],m[this._idx(S,-1)]=m[this._idx(S,0)],m[this._idx(S,u)]=m[this._idx(S,u-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(u,-1)]=m[this._idx(u-1,0)],m[this._idx(-1,u)]=m[this._idx(0,u-1)],m[this._idx(u,u)]=m[this._idx(u-1,u-1)]}const v=l==="terrarium"?DI:PI;for(let S=0;S<m.length;++S){const P=4*S;this.floatView[S]=v(this.pixels[P],this.pixels[P+1],this.pixels[P+2])}this._timestamp=Ct.now()}_buildQuadTree(){this._tree=new aw(this)}get(e,n,l=!1){l&&(e=At(e,-1,this.dim),n=At(n,-1,this.dim));const f=this._idx(e,n);return this.floatView[f]}set(e,n,l){const f=this._idx(e,n),u=this.floatView[f];return this.floatView[f]=l,l-u}static getUnpackVector(e){return CI[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const l=[0,0,0,0],f=w_.getUnpackVector(n);let u=Math.floor((e+f[3])/f[2]);return l[2]=u%256,u=Math.floor(u/256),l[1]=u%256,u=Math.floor(u/256),l[0]=u,l}getPixels(){return new Iv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=n*this.dim,u=n*this.dim+this.dim,m=l*this.dim,v=l*this.dim+this.dim;switch(n){case-1:f=u-1;break;case 1:u=f+1}switch(l){case-1:m=v-1;break;case 1:v=m+1}const S=-n*this.dim,P=-l*this.dim;for(let x=m;x<v;x++)for(let M=f;M<u;M++){const I=4*this._idx(M,x),T=4*this._idx(M+S,x+P);this.pixels[I+0]=e.pixels[T+0],this.pixels[I+1]=e.pixels[T+1],this.pixels[I+2]=e.pixels[T+2],this.pixels[I+3]=e.pixels[T+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function zI(o,e,n){o===1?e.headerLength=n.readFixed32():o===2?e.x=n.readVarint():o===3?e.y=n.readVarint():o===4?e.z=n.readVarint():o===5&&e.layers.push(function(l,f){return l.readFields(FI,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)}(n,n.readVarint()+n.pos))}function RI(o,e,n){o===1?(e.delta_filter=function(l,f){return l.readFields(LI,{blockSize:0},f)}(n,n.readVarint()+n.pos),e.filter="delta_filter"):o===2?(n.readVarint(),e.filter="zigzag_filter"):o===3?(n.readVarint(),e.filter="bitshuffle_filter"):o===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function LI(o,e,n){o===1&&(e.blockSize=n.readVarint())}function kI(o,e,n){o===1?(n.readVarint(),e.codec="gzip_data"):o===2?(n.readVarint(),e.codec="jpeg_image"):o===3?(n.readVarint(),e.codec="webp_image"):o===4&&(n.readVarint(),e.codec="png_image")}function OI(o,e,n){let l=0,f=0;o===1?e.firstByte=n.readFixed64():o===2?e.lastByte=n.readFixed64():o===3?e.filters.push(function(u,m){return u.readFields(RI,{},m)}(n,n.readVarint()+n.pos)):o===4?e.codec=function(u,m){return u.readFields(kI,{},m)}(n,n.readVarint()+n.pos):o===5?f=n.readFloat():o===6?l=n.readFloat():o===7?e.bands.push(n.readString()):o===8?e.offset=n.readDouble():o===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=f),e.scale===0&&(e.scale=l)}function FI(o,e,n){o===1?e.version=n.readVarint():o===2?e.name=n.readString():o===3?e.units=n.readString():o===4?e.tileSize=n.readVarint():o===5?e.buffer=n.readVarint():o===6?e.pixelFormat=n.readVarint():o===7&&e.dataIndex.push(function(l,f){return l.readFields(OI,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)}(n,n.readVarint()+n.pos))}function BI(o,e,n){if(o===2)(function(l,f,u){l.readFields(NI,u,f)})(n,n.readVarint()+n.pos,e);else if(o===3)throw new Error("Not implemented")}function NI(o,e,n){if(o===1){let l=0;const f=n.readVarint()+n.pos;for(;n.pos<f;)e[l++]=n.readVarint()}}function VI(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let l=2;l>=1;l--){const f=l===1?1:0,u=l===2?1:0;for(let m=0;m<e[0];m++){const v=e[1]*m;for(let S=f;S<e[1];S++){const P=e[2]*(S+v);for(let x=u;x<e[2];x++){const M=e[3]*(x+P);for(let I=0;I<e[3];I++){const T=M+I;o[T]+=o[T-n]}}}}n*=e[l]}return o}function UI(o){for(let e=0,n=o.length;e<n;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function jI(o,e){switch(e){case"uint32":return o;case"uint16":for(let n=0;n<o.length;n+=2){const l=o[n],f=o[n+1];o[n]=(240&l)>>4|(61440&l)>>8|(240&f)<<4|61440&f,o[n+1]=15&l|(3840&l)>>4|(15&f)<<8|(3840&f)<<4}return o;case"uint8":for(let n=0;n<o.length;n+=4){const l=o[n],f=o[n+1],u=o[n+2],m=o[n+3];o[n+0]=(192&l)>>6|(192&f)>>4|(192&u)>>2|192&m,o[n+1]=(48&l)>>4|(48&f)>>2|48&u|(48&m)<<2,o[n+2]=(12&l)>>2|12&f|(12&u)<<2|(12&m)<<4,o[n+3]=3&l|(3&f)<<2|(3&u)<<4|(3&m)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ot(w_,"DEMData"),Ot(aw,"DemMinMaxQuadTree",{omit:["dem"]});var Bs=Uint8Array,Cf=Uint16Array,GI=Int32Array,cw=new Bs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),uw=new Bs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),HI=new Bs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hw=function(o,e){for(var n=new Cf(31),l=0;l<31;++l)n[l]=e+=1<<o[l-1];var f=new GI(n[30]);for(l=1;l<30;++l)for(var u=n[l];u<n[l+1];++u)f[u]=u-n[l]<<5|l;return{b:n,r:f}},dw=hw(cw,2),fw=dw.b,qI=dw.r;fw[28]=258,qI[258]=28;for(var $I=hw(uw,0).b,pw=new Cf(32768),Wn=0;Wn<32768;++Wn){var Dh=(43690&Wn)>>1|(21845&Wn)<<1;pw[Wn]=((65280&(Dh=(61680&(Dh=(52428&Dh)>>2|(13107&Dh)<<2))>>4|(3855&Dh)<<4))>>8|(255&Dh)<<8)>>1}var Pf=function(o,e,n){for(var l=o.length,f=0,u=new Cf(e);f<l;++f)o[f]&&++u[o[f]-1];var m,v=new Cf(e);for(f=1;f<e;++f)v[f]=v[f-1]+u[f-1]<<1;m=new Cf(1<<e);var S=15-e;for(f=0;f<l;++f)if(o[f])for(var P=f<<4|o[f],x=e-o[f],M=v[o[f]-1]++<<x,I=M|(1<<x)-1;M<=I;++M)m[pw[M]>>S]=P;return m},Df=new Bs(288);for(Wn=0;Wn<144;++Wn)Df[Wn]=8;for(Wn=144;Wn<256;++Wn)Df[Wn]=9;for(Wn=256;Wn<280;++Wn)Df[Wn]=7;for(Wn=280;Wn<288;++Wn)Df[Wn]=8;var mw=new Bs(32);for(Wn=0;Wn<32;++Wn)mw[Wn]=5;var WI=Pf(Df,9),ZI=Pf(mw,5),fx=function(o){for(var e=o[0],n=1;n<o.length;++n)o[n]>e&&(e=o[n]);return e},So=function(o,e,n){var l=e/8|0;return(o[l]|o[l+1]<<8)>>(7&e)&n},px=function(o,e){var n=e/8|0;return(o[n]|o[n+1]<<8|o[n+2]<<16)>>(7&e)},XI=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Mo=function(o,e,n){var l=new Error(e||XI[o]);if(l.code=o,Error.captureStackTrace&&Error.captureStackTrace(l,Mo),!n)throw l;return l},YI=new Bs(0),KI=typeof TextDecoder<"u"&&new TextDecoder;try{KI.decode(YI,{stream:!0})}catch{}const JI={gzip_data:"gzip"};class to extends Error{constructor(e){super(e),this.name="MRTError"}}const QI={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},_w={uint32:1,uint16:2,uint8:4},eC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let mx;class _x{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new to(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),l=new DataView(e);if(n[0]!==13)throw new to("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),l=this.getHeaderLength(e);if(n.length<l)throw new to(`Expected header with length >= ${l} but got buffer of length ${n.length}`);const f=function(u,m){return u.readFields(zI,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new mx(n.subarray(0,l)));if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new to(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(const u of f.layers)this.layers[u.name]=new tC(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],l=this.getLayer(e.layerName);for(let f of e.blockIndices){const u=l.dataIndex[f],m=u.firstByte-e.firstByte,v=u.lastByte-e.firstByte;if(l._blocksInProgress.has(f))continue;const S={layerName:l.name,firstByte:m,lastByte:v,pixelFormat:l.pixelFormat,blockIndex:f,blockShape:[u.bands.length].concat(l.bandShape),buffer:l.buffer,codec:u.codec.codec,filters:u.filters.map(P=>P.filter)};l._blocksInProgress.add(f),n.push(S)}return new gw(n,()=>{n.forEach(f=>l._blocksInProgress.delete(f.blockIndex))},(f,u)=>{if(n.forEach(m=>l._blocksInProgress.delete(m.blockIndex)),f)throw f;u.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class tC{constructor({version:e,name:n,units:l,tileSize:f,pixelFormat:u,buffer:m,dataIndex:v},S){if(this.version=e,this.version!==1)throw new to(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=l,this.tileSize=f,this.buffer=m,this.pixelFormat=QI[u],this.dataIndex=v,this.bandShape=[f+2*m,f+2*m,_w[this.pixelFormat]],this._decodedBlocks=new hx(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return _w[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[l,f]of this.dataIndex.entries()){for(const[u,m]of f.bands.entries())if(m===e)return{bandIndex:n+u,blockIndex:l,blockBandIndex:u};n+=f.bands.length}break;case"number":for(const[l,f]of this.dataIndex.entries()){if(e>=n&&e<n+f.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-n};n+=f.bands.length}break;default:throw new to(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new to(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,l=-1/0;const f=[],u=new Set;for(const m of e){const{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new to(`Invalid band: ${JSON.stringify(m)}`);const S=this.dataIndex[v];f.includes(v)||f.push(v),u.add(v),n=Math.min(n,S.firstByte),l=Math.max(l,S.lastByte)}if(u.size>this.cacheSize)throw new to(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:l,blockIndices:f}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:l}=this.getBlockForBand(e),f=this._decodedBlocks.get(n.toString());if(!f)throw new to(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[n],m=this.bandShape.reduce((P,x)=>P*x,1),v=l*m,S=f.subarray(v,v+m);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}_x.setPbf=function(o){mx=o};class gw{constructor(e,n,l){this.tasks=e,this._onCancel=n,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}_x.performDecoding=function(o,e){const n=new Uint8Array(o);return Promise.all(e.tasks.map(l=>{const{layerName:f,firstByte:u,lastByte:m,pixelFormat:v,blockShape:S,blockIndex:P,filters:x,codec:M}=l,I=n.subarray(u,m+1),T=new Uint32Array(S[0]*S[1]*S[2]);let A;if(M!=="gzip_data")throw new to(`Unhandled codec: ${M}`);return A=function(D,O){if(!globalThis.DecompressionStream&&O==="gzip_data")return Promise.resolve(((U=function(K){K[0]==31&&K[1]==139&&K[2]==8||Mo(6,"invalid gzip data");var ae=K[3],oe=10;4&ae&&(oe+=2+(K[10]|K[11]<<8));for(var se=(ae>>3&1)+(ae>>4&1);se>0;se-=!K[oe++]);return oe+(2&ae)}(q=D))+8>q.length&&Mo(6,"invalid gzip data"),function(K,ae,oe,se){var ye=K.length;if(!ye||ae.f&&!ae.l)return oe||new Bs(0);var ce=!oe,ve=ce||ae.i!=2,Se=ae.i;ce&&(oe=new Bs(3*ye));var we,Ce,ze=function(za){var kl=oe.length;if(za>kl){var Ol=new Bs(Math.max(2*kl,za));Ol.set(oe),oe=Ol}},Oe=ae.f||0,Pe=ae.p||0,Xe=ae.b||0,lt=ae.l,Je=ae.d,mt=ae.m,pt=ae.n,Tt=8*ye;do{if(!lt){Oe=So(K,Pe,1);var it=So(K,Pe+1,3);if(Pe+=3,!it){var Vt=K[(li=4+((Pe+7)/8|0))-4]|K[li-3]<<8,_t=li+Vt;if(_t>ye){Se&&Mo(0);break}ve&&ze(Xe+Vt),oe.set(K.subarray(li,_t),Xe),ae.b=Xe+=Vt,ae.p=Pe=8*_t,ae.f=Oe;continue}if(it==1)lt=WI,Je=ZI,mt=9,pt=5;else if(it==2){var Ft=So(K,Pe,31)+257,Kt=So(K,Pe+10,15)+4,fi=Ft+So(K,Pe+5,31)+1;Pe+=14;for(var _i=new Bs(fi),wi=new Bs(19),gi=0;gi<Kt;++gi)wi[HI[gi]]=So(K,Pe+3*gi,7);Pe+=3*Kt;var Ei=fx(wi),sn=(1<<Ei)-1,Ki=Pf(wi,Ei);for(gi=0;gi<fi;){var li,Ji=Ki[So(K,Pe,sn)];if(Pe+=15&Ji,(li=Ji>>4)<16)_i[gi++]=li;else{var $i=0,on=0;for(li==16?(on=3+So(K,Pe,3),Pe+=2,$i=_i[gi-1]):li==17?(on=3+So(K,Pe,7),Pe+=3):li==18&&(on=11+So(K,Pe,127),Pe+=7);on--;)_i[gi++]=$i}}var Zn=_i.subarray(0,Ft),Xn=_i.subarray(Ft);mt=fx(Zn),pt=fx(Xn),lt=Pf(Zn,mt),Je=Pf(Xn,pt)}else Mo(1);if(Pe>Tt){Se&&Mo(0);break}}ve&&ze(Xe+131072);for(var On=(1<<mt)-1,Jr=(1<<pt)-1,vn=Pe;;vn=Pe){var wn=($i=lt[px(K,Pe)&On])>>4;if((Pe+=15&$i)>Tt){Se&&Mo(0);break}if($i||Mo(2),wn<256)oe[Xe++]=wn;else{if(wn==256){vn=Pe,lt=null;break}var Ur=wn-254;wn>264&&(Ur=So(K,Pe,(1<<(or=cw[gi=wn-257]))-1)+fw[gi],Pe+=or);var Yn=Je[px(K,Pe)&Jr],us=Yn>>4;if(Yn||Mo(3),Pe+=15&Yn,Xn=$I[us],us>3){var or=uw[us];Xn+=px(K,Pe)&(1<<or)-1,Pe+=or}if(Pe>Tt){Se&&Mo(0);break}ve&&ze(Xe+131072);var Jo=Xe+Ur;if(Xe<Xn){var Rl=0-Xn,Ll=Math.min(Xn,Jo);for(Rl+Xe<0&&Mo(3);Xe<Ll;++Xe)oe[Xe]=(void 0)[Rl+Xe]}for(;Xe<Jo;++Xe)oe[Xe]=oe[Xe-Xn]}}ae.l=lt,ae.p=vn,ae.b=Xe,ae.f=Oe,lt&&(Oe=1,ae.m=mt,ae.d=Je,ae.n=pt)}while(!Oe);return Xe!=oe.length&&ce?(we=oe,((Ce=Xe)==null||Ce>we.length)&&(Ce=we.length),new Bs(we.subarray(0,Ce))):oe.subarray(0,Xe)}(q.subarray(U,-8),{i:2},new Bs(((F=q)[(H=F.length)-4]|F[H-3]<<8|F[H-2]<<16|F[H-1]<<24)>>>0))));var F,H,q,U;const $=JI[O];if(!$)throw new Error(`Unhandled codec: ${O}`);const Z=new globalThis.DecompressionStream($);return new Response(new Blob([D]).stream().pipeThrough(Z)).arrayBuffer().then(K=>new Uint8Array(K))}(I,M).then(D=>(function(O,F){O.readFields(BI,F)}(new mx(D),T),new eC[v](T.buffer))),A.then(D=>{for(let O=x.length-1;O>=0;O--)switch(x[O]){case"delta_filter":VI(D,S);break;case"zigzag_filter":UI(D);break;case"bitshuffle_filter":jI(D,v);break;default:throw new to(`Unhandled filter "${x[O]}"`)}return{layerName:f,blockIndex:P,data:D}}).catch(D=>{throw D})}))},Ot(gw,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let zf,gx,Eo,zh,yx,Rh=null;function yw(){return la()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:gx||he.DRACO_URL}function xw(){if(la()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(zh)return zh;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return zh=WebAssembly.validate(o)?he.MESHOPT_SIMD_URL:he.MESHOPT_URL,zh}const T_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},iC={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Rf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function vw(o,e,n){const l=n.json.bufferViews.length,f=n.buffers.length;e.bufferView=l,n.json.bufferViews[l]={buffer:f,byteLength:o.byteLength},n.buffers[f]=o}const xx="KHR_draco_mesh_compression";function nC(o,e){const n=o.extensions&&o.extensions[xx];if(!n)return;const l=new Eo.Decoder,f=Sw(e,n.bufferView),u=new Eo.Mesh;if(!l.DecodeArrayToMesh(f,f.byteLength,u))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[o.indices],v=T_[m.componentType],S=m.count*v.BYTES_PER_ELEMENT,P=Eo._malloc(S);v===Uint16Array?l.GetTrianglesUInt16Array(u,S,P):l.GetTrianglesUInt32Array(u,S,P),vw(Eo.memory.buffer.slice(P,P+S),m,e),Eo._free(P);for(const x of Object.keys(n.attributes)){const M=l.GetAttributeByUniqueId(u,n.attributes[x]),I=e.json.accessors[o.attributes[x]],T=iC[I.componentType],A=I.count*Rf[I.type]*T_[I.componentType].BYTES_PER_ELEMENT,D=Eo._malloc(A);l.GetAttributeDataArrayForAllPoints(u,M,Eo[T],A,D),vw(Eo.memory.buffer.slice(D,D+A),I,e),Eo._free(D)}l.destroy(),u.destroy(),delete o.extensions[xx]}const S_="EXT_meshopt_compression";function rC(o,e){if(!o.extensions||!o.extensions[S_])return;const n=o.extensions[S_],l=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),f=new Uint8Array(n.count*n.byteStride);yx.decodeGltfBuffer(f,n.count,n.byteStride,l,n.mode,n.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=f.buffer,delete o.extensions[S_]}const bw=1179937895,ww=new TextDecoder("utf8");function Tw(o,e){return new URL(o,e).href}function sC(o,e,n,l){return fetch(Tw(o.uri,l)).then(f=>f.arrayBuffer()).then(f=>{e.buffers[n]=f})}function Sw(o,e){const n=o.json.bufferViews[e];return new Uint8Array(o.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function oC(o,e,n,l){if(o.uri){const f=Tw(o.uri,l);return fetch(f).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[n]=u})}if(o.bufferView!==void 0){const f=Sw(e,o.bufferView),u=new Blob([f],{type:o.mimeType});return createImageBitmap(u).then(m=>{e.images[n]=m})}}function Mw(o,e=0,n){const l={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===bw){const x=new Uint32Array(o,e);let M=2;const I=(x[M++]>>2)-3,T=x[M++]>>2;if(M++,l.json=JSON.parse(ww.decode(x.subarray(M,M+T))),M+=T,M<I){const A=x[M++];M++;const D=e+(M<<2);l.buffers[0]=o.slice(D,D+A)}}else l.json=JSON.parse(ww.decode(new Uint8Array(o,e)));const{buffers:f,images:u,meshes:m,extensionsUsed:v,bufferViews:S}=l.json;let P=Promise.resolve();if(f){const x=[];for(let M=0;M<f.length;M++){const I=f[M];I.uri?x.push(sC(I,l,M,n)):l.buffers[M]||(l.buffers[M]=null)}P=Promise.all(x)}return P.then(()=>{const x=[],M=v&&v.includes(xx),I=v&&v.includes(S_);if(M&&x.push(function(){if(!Eo)return zf??(zf=function(T){let A,D=null;function O(){A=new Uint8Array(D.buffer)}function F(){throw new Error("Unexpected Draco error.")}const H={a:{a:F,d:function(q,U,$){return A.copyWithin(q,U,U+$)},c:function(q){const U=A.length,$=Math.max(q>>>0,Math.ceil(1.2*U)),Z=Math.ceil(($-U)/65536);try{return D.grow(Z),O(),!0}catch{return!1}},b:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(T,H):T.then(q=>q.arrayBuffer()).then(q=>WebAssembly.instantiate(q,H))).then(q=>{const{Rb:U,Qb:$,P:Z,T:K,X:ae,Ja:oe,La:se,Qa:ye,Va:ce,Wa:ve,eb:Se,jb:we,f:Ce,e:ze,yb:Oe,zb:Pe,Ab:Xe,Bb:lt,Db:Je,Gb:mt}=q.instance.exports;D=ze;const pt=(()=>{let Tt=0,it=0,Vt=0,_t=0;return Ft=>{Vt&&(U(_t),U(Tt),it+=Vt,Vt=Tt=0),Tt||(it+=128,Tt=$(it));const Kt=Ft.length+7&-8;let fi=Tt;Kt>=it&&(Vt=Kt,fi=_t=$(Kt));for(let _i=0;_i<Ft.length;_i++)A[fi+_i]=Ft[_i];return fi}})();return O(),Ce(),{memory:ze,_free:U,_malloc:$,Mesh:class{constructor(){this.ptr=Z()}destroy(){K(this.ptr)}},Decoder:class{constructor(){this.ptr=oe()}destroy(){we(this.ptr)}DecodeArrayToMesh(Tt,it,Vt){const _t=pt(Tt),Ft=se(this.ptr,_t,it,Vt.ptr);return!!ae(Ft)}GetAttributeByUniqueId(Tt,it){return{ptr:ye(this.ptr,Tt.ptr,it)}}GetTrianglesUInt16Array(Tt,it,Vt){ce(this.ptr,Tt.ptr,it,Vt)}GetTrianglesUInt32Array(Tt,it,Vt){ve(this.ptr,Tt.ptr,it,Vt)}GetAttributeDataArrayForAllPoints(Tt,it,Vt,_t,Ft){Se(this.ptr,Tt.ptr,it.ptr,Vt,_t,Ft)}},DT_INT8:Oe(),DT_UINT8:Pe(),DT_INT16:Xe(),DT_UINT16:lt(),DT_UINT32:Je(),DT_FLOAT32:mt()}})}(fetch(yw())),zf.then(T=>{Eo=T,zf=void 0}))}()),I&&x.push(function(){if(yx)return;const T=function(A){let D;const O=WebAssembly.instantiateStreaming(A,{}).then(q=>{D=q.instance,D.exports.__wasm_call_ctors()}),F={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},H={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:O,supported:!0,decodeGltfBuffer(q,U,$,Z,K,ae){(function(oe,se,ye,ce,ve,Se,we){const Ce=oe.exports.sbrk,ze=ce+3&-4,Oe=Ce(ze*ve),Pe=Ce(Se.length),Xe=new Uint8Array(oe.exports.memory.buffer);Xe.set(Se,Pe);const lt=se(Oe,ce,ve,Pe,Se.length);if(lt===0&&we&&we(Oe,ze,ve),ye.set(Xe.subarray(Oe,Oe+ce*ve)),Ce(Oe-Ce(0)),lt!==0)throw new Error(`Malformed buffer data: ${lt}`)})(D,D.exports[H[K]],q,U,$,Z,D.exports[F[ae]])}}}(fetch(xw()));return T.ready.then(()=>{yx=T})}()),u)for(let T=0;T<u.length;T++)x.push(oC(u[T],l,T,n));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(M&&m)for(const{primitives:T}of m)for(const A of T)nC(A,l);if(I&&m&&S)for(const T of S)rC(T,l);return l})})}function jc(o,e){const n=o.json.bufferViews[e.bufferView],l=T_[e.componentType];return new l(o.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Rf[e.type]*l.BYTES_PER_ELEMENT?n.byteStride/l.BYTES_PER_ELEMENT:Rf[e.type]))}function vx(o,e,n,l){const f=T_[e.componentType],u=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),m=o.json.bufferViews[e.bufferView],v=m.byteStride?m.byteStride/f.BYTES_PER_ELEMENT:Rf[e.type],S=n.float32,P=S.length/n.capacity;for(let x=0,M=0;x<e.count*v;x+=v,M+=P)for(let I=0;I<P;I++)S[M+I]=l[x+I]*u;n._trim()}function aC(o,e,n){const l=o.indices,f=o.attributes,u={};u.indexArray=new vr;const m=e.json.accessors[l],v=m.count/3;u.indexArray.reserve(v);const S=jc(e,m);for(let I=0;I<v;I++)u.indexArray.emplaceBack(S[3*I],S[3*I+1],S[3*I+2]);u.indexArray._trim(),u.vertexArray=new Go;const P=e.json.accessors[f.POSITION];u.vertexArray.reserve(P.count);const x=jc(e,P);for(let I=0;I<P.count;I++)u.vertexArray.emplaceBack(x[3*I],x[3*I+1],x[3*I+2]);if(u.vertexArray._trim(),u.aabb=new ei(P.min,P.max),u.centroid=function(I,T){const A=[0,0,0],D=I.length;if(D>0){for(let O=0;O<D;O++){const F=3*I[O];A[0]+=T[F],A[1]+=T[F+1],A[2]+=T[F+2]}A[0]/=D,A[1]/=D,A[2]/=D}return A}(S,x),f.COLOR_0!==void 0){const I=e.json.accessors[f.COLOR_0],T=Rf[I.type],A=jc(e,I);u.colorArray=T===3?new Go:new _o,u.colorArray.resize(I.count),vx(e,I,u.colorArray,A)}if(f.NORMAL!==void 0){u.normalArray=new Go;const I=e.json.accessors[f.NORMAL];u.normalArray.resize(I.count);const T=jc(e,I);vx(e,I,u.normalArray,T)}if(f.TEXCOORD_0!==void 0&&n.length>0){u.texcoordArray=new go;const I=e.json.accessors[f.TEXCOORD_0];u.texcoordArray.resize(I.count);const T=jc(e,I);vx(e,I,u.texcoordArray,T)}if(f._FEATURE_ID_RGBA4444!==void 0){const I=e.json.accessors[f._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=jc(e,I))}f._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(jc(e,e.json.accessors[f._FEATURE_RGBA4444]).buffer));const M=o.material;return u.material=function(I,T){const{emissiveFactor:A=[0,0,0],alphaMode:D="OPAQUE",alphaCutoff:O=.5,normalTexture:F,occlusionTexture:H,emissiveTexture:q,doubleSided:U}=I,{baseColorFactor:$=[1,1,1,1],metallicFactor:Z=1,roughnessFactor:K=1,baseColorTexture:ae,metallicRoughnessTexture:oe}=I.pbrMetallicRoughness||{},se=H?T[H.index]:void 0;if(H&&H.extensions&&H.extensions.KHR_texture_transform&&se){const ye=H.extensions.KHR_texture_transform;se.offsetScale=[ye.offset[0],ye.offset[1],ye.scale[0],ye.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Fi(...$),metallicFactor:Z,roughnessFactor:K,baseColorTexture:ae?T[ae.index]:void 0,metallicRoughnessTexture:oe?T[oe.index]:void 0},doubleSided:U,emissiveFactor:A,alphaMode:D,alphaCutoff:O,normalTexture:F?T[F.index]:void 0,occlusionTexture:se,emissionTexture:q?T[q.index]:void 0,defined:I.defined===void 0}}(M!==void 0?e.json.materials[M]:{defined:!1},n),u}function Ew(o,e,n){const{matrix:l,rotation:f,translation:u,scale:m,mesh:v,extras:S,children:P}=o,x={};if(x.matrix=l||me.mat4.fromRotationTranslationScale([],f||[0,0,0,1],u||[0,0,0],m||[1,1,1]),v!==void 0){x.meshes=n[v];const M=x.anchor=[0,0];for(const I of x.meshes){const{min:T,max:A}=I.aabb;M[0]+=T[0]+A[0],M[1]+=T[1]+A[1]}M[0]=Math.floor(M[0]/x.meshes.length/2),M[1]=Math.floor(M[1]/x.meshes.length/2)}if(S&&(S.id&&(x.id=S.id),S.lights&&(x.lights=function(M){if(!M.length)return[];const I=function(F){const H=atob(F),q=new Uint8Array(H.length);for(let U=0;U<H.length;U++)q[U]=H.codePointAt(U);return q}(M),T=[],A=I.length/24,D=new Uint16Array(I.buffer),O=new Float32Array(I.buffer);for(let F=0;F<A;F++){const H=D[2*F*6]/30,q=D[2*F*6+1]/30,U=D[2*F*6+10]/100,$=O[6*F+1],Z=O[6*F+2],K=O[6*F+3],ae=O[6*F+4],oe=K-$,se=ae-Z,ye=Math.hypot(oe,se);T.push({pos:[$+.5*oe,Z+.5*se,q],normal:[se/ye,-oe/ye,0],width:ye,height:H,depth:U,points:[$,Z,K,ae]})}return T}(S.lights))),P){const M=[];for(const I of P)M.push(Ew(e.json.nodes[I],e,n));x.children=M}return x}function lC(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new wy(o.vertices,o.indices,8,256),[n,l]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:n,max:l}}function cC(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const l=[];for(const m of n){if(!Array.isArray(m)||m.length!==2)continue;const v=m[0],S=m[1];typeof v=="number"&&typeof S=="number"&&l.push(new Ae(v,S))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let f=0;for(let m=0;m<l.length;m++){const v=l[m],S=l[(m+1)%l.length],P=l[(m+2)%l.length];f+=(v.x-S.x)*(P.y-S.y)-(P.x-S.x)*(v.y-S.y)}f>0&&l.reverse();const u=sf(l.flatMap(m=>[m.x,m.y]),[]);return u.length===0?null:{vertices:l,indices:u}}function uC(o,e){const n=[],l=[];let f=0;const u=[];for(const m of o){f=n.length;const v=m.vertexArray.float32,S=m.indexArray.uint16;for(let P=0;P<m.vertexArray.length;P++)u[0]=v[3*P+0],u[1]=v[3*P+1],u[2]=v[3*P+2],me.vec3.transformMat4(u,u,e),n.push(new Ae(u[0],u[1]));for(let P=0;P<3*m.indexArray.length;P++)l.push(S[P]+f)}if(l.length%3!=0)return null;for(let m=0;m<l.length;m+=3){const v=n[l[m+0]],S=n[l[m+1]],P=n[l[m+2]];(v.x-S.x)*(P.y-S.y)-(P.x-S.x)*(v.y-S.y)>0&&([l[m+1],l[m+2]]=[l[m+2],l[m+1]])}return{vertices:n,indices:l}}function Aw(o){const e=function(S,P){const x=[],M=WebGL2RenderingContext;if(S.json.textures)for(const I of S.json.textures){const T={magFilter:M.LINEAR,minFilter:M.NEAREST,wrapS:M.REPEAT,wrapT:M.REPEAT};I.sampler!==void 0&&Object.assign(T,S.json.samplers[I.sampler]),x.push({image:P[I.source],sampler:T,uploaded:!1})}return x}(o,o.images),n=function(S,P){const x=[];for(const M of S.json.meshes){const I=[];for(const T of M.primitives)I.push(aC(T,S,P));x.push(I)}return x}(o,e),{scenes:l,scene:f,nodes:u}=o.json,m=l?l[f||0].nodes:u,v=[];for(const S of m)v.push(Ew(u[S],o,n));return function(S,P,x){const M={},I=new Set;for(let T=0;T<S.length;T++){const A=x[P[T]];if(!A.extras)continue;const D=A.extras["mapbox:footprint:version"],O=A.extras["mapbox:footprint:id"];(D||O)&&I.add(T),D==="1.0.0"&&O&&(M[O]=T)}for(let T=0;T<S.length;T++){if(I.has(T))continue;const A=S[T],D=x[P[T]];if(!D.extras)continue;let O=null;A.id in M&&(O=uC(S[M[A.id]].meshes,A.matrix)),O||(O=cC(D)),O&&(A.footprint=lC(O))}if(I.size>0){const T=Array.from(I.values()).sort((A,D)=>A-D);for(let A=T.length-1;A>=0;A--)S.splice(T[A],1)}}(v,m,o.json.nodes),v}function hC(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,n=o.aabb.min[0]-1,l=o.aabb.min[1]-1,f=Nc/(o.aabb.max[0]-n+2),u=Nc/(o.aabb.max[1]-l+2);for(let m=0;m<e.length;m+=3){const v=e[m+2],S=(e[m+0]-n)*f|0,P=(e[m+1]-l)*u|0;v>o.heightmap[P*Nc+S]&&(o.heightmap[P*Nc+S]=v)}}function dC(o,e){const n={};n.indexArray=new vr,n.indexArray.reserve(4*o.length),n.vertexArray=new Go,n.vertexArray.reserve(10*o.length),n.colorArray=new _o,n.vertexArray.reserve(10*o.length);let l=0;for(const m of o){const v=Math.min(10,Math.max(4,1.3*m.height))*e,S=[-m.normal[1],m.normal[0],0],P=Math.min(.29,.1*m.width/m.depth),x=m.width-2*m.depth*e*(P+.01),M=me.vec3.scaleAndAdd([],m.pos,S,x/2),I=me.vec3.scaleAndAdd([],m.pos,S,-x/2),T=[M[0],M[1],M[2]+m.height],A=[I[0],I[1],I[2]+m.height],D=me.vec3.scaleAndAdd([],m.normal,S,P);me.vec3.scale(D,D,v);const O=me.vec3.scaleAndAdd([],m.normal,S,-P);me.vec3.scale(O,O,v),me.vec3.add(D,M,D),me.vec3.add(O,I,O),M[2]+=.1,I[2]+=.1,n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(O[0],O[1],O[2]),n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(O[0],O[1],O[2]);const F=x/v/2;n.colorArray.emplaceBack(-F-P,-1,F,.8),n.colorArray.emplaceBack(F+P,-1,F,.8),n.colorArray.emplaceBack(-F,0,F,1.3),n.colorArray.emplaceBack(F,0,F,1.3),n.colorArray.emplaceBack(F+P,-.8,F,.7),n.colorArray.emplaceBack(F+P,-.8,F,.7),n.colorArray.emplaceBack(0,0,F,1.3),n.colorArray.emplaceBack(0,0,F,1.3),n.colorArray.emplaceBack(F+P,-1.2,F,.8),n.colorArray.emplaceBack(F+P,-1.2,F,.8),n.indexArray.emplaceBack(6+l,4+l,8+l),n.indexArray.emplaceBack(7+l,9+l,5+l),n.indexArray.emplaceBack(0+l,1+l,2+l),n.indexArray.emplaceBack(1+l,3+l,2+l),l+=10}const f={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Fi.white,f.pbrMetallicRoughness=u,n.material=f,n.aabb=new ei([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}class Iw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const fC=["id","tile","layer","source","sourceLayer","state"];class Lh{constructor(e,n,l,f,u){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=l,this._y=f,this.properties=e.properties,this.id=u}clone(){const e=new Lh(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state={...this.state}),this.layer&&(e.layer={...this.layer}),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of fC)this[n]!==void 0&&(e[n]=this[n]);return e}}class Cw{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new va(vt,16,0),this.featureIndexArray=new Am,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,l,f,u,m=0,v=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,f,u,m);const P=this.grid;for(let x=0;x<n.length;x++){const M=n[x],I=[1/0,1/0,-1/0,-1/0];for(let T=0;T<M.length;T++){const A=M[T];I[0]=Math.min(I[0],A.x),I[1]=Math.min(I[1],A.y),I[2]=Math.max(I[2],A.x),I[3]=Math.max(I[3],A.y)}v!==0&&(I[0]-=v,I[1]-=v,I[2]+=v,I[3]+=v),I[0]<vt&&I[1]<vt&&I[2]>=0&&I[3]>=0&&P.insert(S,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new vh.VectorTile(new Wm(this.rawTileData)).layers,this.sourceLayerCoder=new Iw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:l,transform:f,tileTransform:u,pixelPosMatrix:m,availableImages:v}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const S=l.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(T,A,D,O)=>He(l.bufferedTilespaceGeometry,T,A,D,O));P.sort(pC);let x=null;f.elevation&&P.length>0&&(x=Ah.create(f.elevation,this.tileID));const M={};let I;for(let T=0;T<P.length;T++){const A=P[T];if(A===I)continue;I=A;const D=this.featureIndexArray.get(A);let O=null;this.is3DTile?this.loadMatchingModelFeature(M,D,e,l,f):this.loadMatchingFeature(M,D,e,v,(F,H,q,U=0)=>(O||(O=B(F,this.tileID.canonical,u)),H.queryIntersectsFeature(l,F,q,O,this.z,f,m,x,U)))}return M}loadMatchingFeature(e,n,l,f,u){const{featureIndex:m,bucketIndex:v,sourceLayerIndex:S,layoutVertexArrayOffset:P}=n,x=this.bucketLayerIDs[v],M=l.layers,I=Object.keys(M);if(I.length&&!function(F,H){for(let q=0;q<F.length;q++)if(H.indexOf(F[q])>=0)return!0;return!1}(I,x))return;const T=l.sourceCache,A=this.sourceLayerCoder.decode(S),D=this.vtLayers[A].feature(m),O=this.getId(D,A);for(let F=0;F<x.length;F++){const H=x[F];if(!M[H])continue;const{styleLayer:q,targets:U}=M[H];let $={};O!==void 0&&($=T.getFeatureState(q.sourceLayer,O));const Z=!u||u(D,q,$,P);if(!Z)continue;const K=new Lh(D,this.z,this.x,this.y,O);K.tile=this.tileID.canonical,K.state=$;let ae=this.serializedLayersCache.get(H);ae||(ae=q.serialize(),ae.id=H,this.serializedLayersCache.set(H,ae)),K.source=ae.source,K.sourceLayer=ae["source-layer"],K.layer=Li({},ae),K.layer.paint=Pw(ae.paint,q.paint,D,$,f),K.layer.layout=Pw(ae.layout,q.layout,D,$,f);let oe=!1;for(const se of U){this.updateFeatureProperties(K,se);const{filter:ye}=se;if(ye){if(D.properties=K.properties,ye.needGeometry){const ce=G(D,!0);if(!ye.filter(new yn(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!ye.filter(new yn(this.tileID.overscaledZ),D))continue}oe=!0,se.targetId&&this.addFeatureVariant(K,se)}oe&&this.appendToResult(e,H,m,K,Z)}}loadMatchingModelFeature(e,n,l,f,u){const m=this.bucketLayerIDs[0][0],v=l.layers;if(!v[m])return;const{styleLayer:S,targets:P}=v[m];if(S.type!=="model")return;const x=f.tile,M=n.featureIndex,I=x.getBucket(S);if(!(I&&I instanceof m_))return;const T=function(ae,oe,se,ye){const ce=ae.getNodesInfo()[oe];if(ce.hiddenByReplacement||!ce.node.meshes)return;let ve=Number.MAX_VALUE;const Se=ce.node,we=se.tile,Ce=ye.calculatePosMatrix(we.tileID.toUnwrapped(),ye.worldSize),ze=ce.evaluatedScale;let Oe=0;ye.elevation&&Se.elevation&&(Oe=Se.elevation*ye.elevation.exaggeration()),me.mat4.translate(Ce,Ce,[(Se.anchor?Se.anchor[0]:0)*(ze[0]-1),(Se.anchor?Se.anchor[1]:0)*(ze[1]-1),Oe]),me.mat4.scale(Ce,Ce,ze);const Pe=se.queryGeometry,Xe=Pe.isPointQuery()?Pe.screenBounds:Pe.screenGeometry,lt=function(mt){const pt=me.mat4.multiply([],Ce,mt.matrix);me.mat4.multiply(pt,ye.expandedFarZProjMatrix,pt);for(let Tt=0;Tt<mt.meshes.length;++Tt){const it=mt.meshes[Tt];if(Tt===mt.lightMeshIndex)continue;const Vt=P1(Xe,ye,pt,it.aabb);Vt!=null&&(ve=Math.min(Vt,ve))}if(mt.children)for(const Tt of mt.children)lt(Tt)};if(lt(Se),ve===Number.MAX_VALUE)return;const Je=new Bi(0,0);return j1(we.tileID.canonical,Je,ce.node.anchor[0],ce.node.anchor[1]),{intersectionZ:ve,position:Je,feature:ce.feature}}(I,M,f,u);if(!T)return;const{z:A,x:D,y:O}=x.tileID.canonical,{feature:F,intersectionZ:H,position:q}=T;let U={};F.id!==void 0&&(U=l.sourceCache.getFeatureState(S.sourceLayer,F.id));const $=new Lh({},A,D,O,F.id);$.tile=this.tileID.canonical,$.state=U,$.properties=F.properties,$.geometry={type:"Point",coordinates:[q.lng,q.lat]};let Z=this.serializedLayersCache.get(m);Z||(Z=S.serialize(),Z.id=m,this.serializedLayersCache.set(m,Z)),$.source=Z.source,$.sourceLayer=Z["source-layer"],$.layer=Li({},Z);let K=!1;for(const ae of P){this.updateFeatureProperties($,ae);const{filter:oe}=ae;if(oe){if(F.properties=$.properties,oe.needGeometry){if(!oe.filter(new yn(this.tileID.overscaledZ),F,this.tileID.canonical))continue}else if(!oe.filter(new yn(this.tileID.overscaledZ),F))continue}K=!0,ae.targetId&&this.addFeatureVariant($,ae)}K&&this.appendToResult(e,m,M,$,H)}updateFeatureProperties(e,n,l){if(n.properties){const f={};for(const u in n.properties){const m=n.properties[u].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);m!=null&&(f[u]=m)}e.properties=f}}addFeatureVariant(e,n,l){const f={target:n.target,namespace:n.namespace};n.properties&&(f.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(f)}appendToResult(e,n,l,f,u){let m=e[n];m===void 0&&(m=e[n]=[]),m.push({featureIndex:l,feature:f,intersectionZ:u})}lookupSymbolFeatures(e,n,l,f,u){const m={};this.loadVTLayers();for(const v of e)this.loadMatchingFeature(m,{bucketIndex:n,sourceLayerIndex:l,featureIndex:v,layoutVertexArrayOffset:0},f,u);return m}loadFeature(e){const{featureIndex:n,sourceLayerIndex:l}=e;this.loadVTLayers();const f=this.sourceLayerCoder.decode(l),u=this.vtFeatures[f];if(u[n])return u[n];const m=this.vtLayers[f].feature(n);return u[n]=m,m}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){let l=e.id;if(this.promoteId){const f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];f!=null&&(l=e.properties[f]),typeof l=="boolean"&&(l=Number(l))}return l}}function Pw(o,e,n,l,f){return Ws(o,(u,m)=>{const v=e instanceof _l?e.get(m):null;return v&&v.evaluate?v.evaluate(n,l,f):v})}function pC(o,e){return e-o}Ot(Cw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Dw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=l>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const u=Dw[15&l];if(!u)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new bx(v,m,u,e)}constructor(e,n=64,l=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=Dw.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${l}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return wx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:m,nodeSize:v}=this,S=[0,u.length-1,0],P=[];for(;S.length;){const x=S.pop()||0,M=S.pop()||0,I=S.pop()||0;if(M-I<=v){for(let O=I;O<=M;O++){const F=m[2*O],H=m[2*O+1];F>=e&&F<=l&&H>=n&&H<=f&&P.push(u[O])}continue}const T=I+M>>1,A=m[2*T],D=m[2*T+1];A>=e&&A<=l&&D>=n&&D<=f&&P.push(u[T]),(x===0?e<=A:n<=D)&&(S.push(I),S.push(T-1),S.push(1-x)),(x===0?l>=A:f>=D)&&(S.push(T+1),S.push(M),S.push(1-x))}return P}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:u,nodeSize:m}=this,v=[0,f.length-1,0],S=[],P=l*l;for(;v.length;){const x=v.pop()||0,M=v.pop()||0,I=v.pop()||0;if(M-I<=m){for(let O=I;O<=M;O++)Rw(u[2*O],u[2*O+1],e,n)<=P&&S.push(f[O]);continue}const T=I+M>>1,A=u[2*T],D=u[2*T+1];Rw(A,D,e,n)<=P&&S.push(f[T]),(x===0?e-l<=A:n-l<=D)&&(v.push(I),v.push(T-1),v.push(1-x)),(x===0?e+l>=A:n+l>=D)&&(v.push(T+1),v.push(M),v.push(1-x))}return S}}function wx(o,e,n,l,f,u){if(f-l<=n)return;const m=l+f>>1;zw(o,e,m,l,f,u),wx(o,e,n,l,m-1,1-u),wx(o,e,n,m+1,f,1-u)}function zw(o,e,n,l,f,u){for(;f>l;){if(f-l>600){const P=f-l+1,x=n-l+1,M=Math.log(P),I=.5*Math.exp(2*M/3),T=.5*Math.sqrt(M*I*(P-I)/P)*(x-P/2<0?-1:1);zw(o,e,n,Math.max(l,Math.floor(n-x*I/P+T)),Math.min(f,Math.floor(n+(P-x)*I/P+T)),u)}const m=e[2*n+u];let v=l,S=f;for(Lf(o,e,l,n),e[2*f+u]>m&&Lf(o,e,l,f);v<S;){for(Lf(o,e,v,S),v++,S--;e[2*v+u]<m;)v++;for(;e[2*S+u]>m;)S--}e[2*l+u]===m?Lf(o,e,l,S):(S++,Lf(o,e,S,f)),S<=n&&(l=S+1),n<=S&&(f=S-1)}}function Lf(o,e,n,l){Tx(o,n,l),Tx(e,2*n,2*l),Tx(e,2*n+1,2*l+1)}function Tx(o,e,n){const l=o[e];o[e]=o[n],o[n]=l}function Rw(o,e,n,l){const f=o-n,u=e-l;return f*f+u*u}i.$=Rd,i.A=hr,i.B=2,i.C=Wb,i.D=Ih,i.E=Ka,i.F=Vy,i.G=class extends f_{},i.H=_a,i.I=dx,i.J=xu,i.K=mm,i.L=ju,i.M=hl,i.N=im,i.O=Id,i.P=Ae,i.Q=th,i.R=ua,i.S=om,i.T=Jy,i.U=bc,i.V=f_,i.W=ya,i.X=po,i.Y=al,i.Z=Gr,i._=yu,i.a=function(o){return he.API_CDN_URL_REGEX.test(o)},i.a$=Lh,i.a0=Gu,i.a1=tm,i.a2=function(o){const e=o.value;let n=[];if(!e)return n;const l=_a(e);return l!=="string"?(n=n.concat([new f_(o.key,e,`string expected, "${l}" found`)]),n):(z1(e,!0)||(n=n.concat([new f_(o.key,e,`invalid url "${e}"`)])),n)},i.a3=je,i.a4=Sa,i.a5=Mn,i.a6=dt,i.a7=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return Fr(o.expression.evaluate(e))}interpolate(o,e,n){return{x:ii(o.x,e.x,n),y:ii(o.y,e.y,n),z:ii(o.z,e.z,n),azimuthal:ii(o.azimuthal,e.azimuthal,n),polar:ii(o.polar,e.polar,n)}}},i.a8=yn,i.a9=dl,i.aA=xo,i.aB=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,n,l){const f=this.entries[o]=this.entries[o]||{callbacks:[]};if(f.result){const[u,m]=f.result;return this.scheduler?this.scheduler.add(()=>{l(u,m)},e):l(u,m),()=>{}}return f.callbacks.push(l),f.cancel||(f.cancel=n((u,m)=>{f.result=[u,m];for(const v of f.callbacks)this.scheduler?this.scheduler.add(()=>{v(u,m)},e):v(u,m);setTimeout(()=>delete this.entries[o],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(u=>u!==l),f.callbacks.length||(f.cancel(),delete this.entries[o]))}}},i.aC=Br,i.aD=function(o,e,n){const l=JSON.stringify(o.request);return o.data&&(this.deduped.entries[l]={result:[null,o.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},f=>{const u=ha(o.request,(m,v,S,P)=>{m?f(m):v&&f(null,{vectorTile:n?void 0:new vh.VectorTile(new Wm(v)),rawData:v,cacheControl:S,expires:P})});return()=>{u.cancel(),f()}},e)},i.aE=function(o){$n++,$n>ci&&(o.getActor().send("enforceCacheSizeLimit",ui),$n=0)},i.aF=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},i.aG=gt,i.aH=x1,i.aI=M1,i.aJ=y1,i.aK=function(o,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let l=0;l<o.length;l++){const f=document.createElement("source");td(o[l])||(n.crossOrigin="Anonymous"),f.src=o[l],n.appendChild(f)}return{cancel:()=>{}}},i.aL=l_,i.aM=function(o){return fetch(o).then(e=>e.arrayBuffer()).then(e=>Mw(e,0,o))},i.aN=Aw,i.aO=class{constructor(o,e,n,l){this.id=o,this.position=e!=null?new Bi(e[0],e[1]):new Bi(0,0),this.orientation=n??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new ei([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(me.mat4.multiply(o.matrix,e,o.matrix),o.meshes)for(const n of o.meshes){const l=ei.applyTransformFast(n.aabb,o.matrix);this.aabb.encapsulate(l)}if(o.children)for(const n of o.children)this._applyTransformations(n,o.matrix)}computeBoundsAndApplyParent(){const o=me.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,n,l,f,u,m=!1){F1(this.matrix,this,o.transform,this.position,e,n,l,f,u,m)}upload(o){if(!this.uploaded){for(const e of this.nodes)nx(e,o);for(const e of this.nodes)p_(e);this.uploaded=!0}}destroy(){for(const o of this.nodes)rx(o)}},i.aP=wr,i.aQ=yf,i.aR=Xr,i.aS=mr,i.aT=wl,i.aU=vr,i.aV=lr,i.aW=Tm,i.aX=o_,i.aY=function(){Wr.isLoading()||Wr.isLoaded()||zd()!=="deferred"||dm()},i.aZ=_m,i.a_=G,i.aa=_,i.ab=me,i.ac=Mi,i.ad=_l,i.ae=Ar,i.af=ii,i.ag=vt,i.ah=rd,i.ai=xt,i.aj=Fi,i.ak=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return function([n,l]){const f=Fr([1,n,l]);return{x:f.x,y:f.y,z:f.z}}(o.expression.evaluate(e))}interpolate(o,e,n){return{x:ii(o.x,e.x,n),y:ii(o.y,e.y,n),z:ii(o.z,e.z,n)}}},i.al=function(o,e,n=0,l=!0){const f=new Ae(n,n),u=o.sub(f),m=e.add(f),v=[u,new Ae(m.x,u.y),m,new Ae(u.x,m.y)];return l&&v.push(u.clone()),v},i.am=function(o,e){const n=[];for(let l=0;l<o.length;l++){const f=Ui(l-1,-1,o.length-1),u=Ui(l+1,-1,o.length-1),m=o[l],v=o[u],S=o[f].sub(m).unit(),P=v.sub(m).unit(),x=P.angleWithSep(S.x,S.y),M=S.add(P).unit().mult(-1*e/Math.sin(x/2));n.push(m.add(M))}return n},i.an=r1,i.ao=He,i.ap=function(o,e,n=0){return me.vec3.fromValues(((e.x-n)*o.scale-o.x)*vt,(e.y*o.scale-o.y)*vt,tf(e.z,e.y))},i.aq=yi,i.ar=Tb,i.as=function(o){let e=1/0,n=1/0,l=-1/0,f=-1/0;for(const u of o)e=Math.min(e,u.x),n=Math.min(n,u.y),l=Math.max(l,u.x),f=Math.max(f,u.y);return{min:new Ae(e,n),max:new Ae(l,f)}},i.at=Yo,i.au=Ie,i.av=w,i.aw=At,i.ax=Mr,i.ay=function(o,e){const n={};for(let l=0;l<e.length;l++){const f=e[l];f in o&&(n[f]=o[f])}return n},i.az=Xo,i.b=function(o){return he.API_FONTS_REGEX.test(o)},i.b$=h_,i.b0=ec,i.b1=Dy,i.b2=by,i.b3=B,i.b4=mo,i.b5=qd,i.b6=Pi,i.b7=En,i.b8=sf,i.b9=Xy,i.bA=tb,i.bB=Gy,i.bC=e1,i.bD=Ny,i.bE=bx,i.bF=Ui,i.bG=Xa,i.bH=zr,i.bI=function(o,e,n){o[4*e+0]=n[0],o[4*e+1]=n[1],o[4*e+2]=n[2],o[4*e+3]=n[3]},i.bJ=Rc,i.bK=Qs,i.bL=dh,i.bM=kn,i.bN=Ma,i.bO=Bi,i.bP=c1,i.bQ=Et,i.bR=zi,i.bS=A1,i.bT=wt,i.bU=fn,i.bV=function(o,e,n,l,f,u,m,v,S){if(S.name==="globe")return fn(o,e,new wt(n,l,f),!1);const P=yf({z:n,x:l,y:f},S);return new ei([(u+P.x/P.scale)*e,e*(P.y/P.scale),m],[(u+P.x2/P.scale)*e,e*(P.y2/P.scale),v])},i.bW=function(o,e,n){let l=0;for(let f=0;f<2;++f)o[f]>0&&(l+=(o[f]-0)*(o[f]-0)),e[f]<0&&(l+=(0-e[f])*(0-e[f]));return l},i.bX=Yr,i.bY=Kd,i.bZ=function(o){const e=me.mat4.identity(new Float64Array(16));me.mat4.multiply(e,o.pixelMatrix,o.globeMatrix);const n=[0,ws,0],l=[0,Ts,0];return me.vec3.transformMat4(n,n,e),me.vec3.transformMat4(l,l,e),[n[0]>0&&n[0]<=o.width&&n[1]>0&&n[1]<=o.height&&!bo(o,new Bi(o.center.lat,90)),l[0]>0&&l[0]<=o.width&&l[1]>0&&l[1]<=o.height&&!bo(o,new Bi(o.center.lat,-90))]},i.b_=function(o,e){const{scale:n}=o.tileTransform,l=n*vt/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return me.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},i.ba=function(o,e){const n=Ar(e.zoom);if(n===0)return nr(o);const l=rn(o),f=Ri(l),u=Yo(l.getWest())*e.worldSize,m=Yo(l.getEast())*e.worldSize,v=xo(l.getNorth())*e.worldSize,S=xo(l.getSouth())*e.worldSize,P=[u,v,0],x=[m,v,0],M=[u,S,0],I=[m,S,0],T=me.mat4.invert([],e.globeMatrix);return me.vec3.transformMat4(P,P,T),me.vec3.transformMat4(x,x,T),me.vec3.transformMat4(M,M,T),me.vec3.transformMat4(I,I,T),f[0]=Nn(f[0],M,n),f[1]=Nn(f[1],I,n),f[2]=Nn(f[2],x,n),f[3]=Nn(f[3],P,n),ei.fromPoints(f)},i.bb=br,i.bc=An,i.bd=Nn,i.be=bl,i.bf=ai,i.bg=_x,i.bh=Wm,i.bi=ha,i.bj=function(o){const e=[];for(const n in o)e.push(o[n]);return e},i.bk=function(o,e){const n=[];for(const l in o)l in e||n.push(l);return n},i.bl=un,i.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bn=bt,i.bo=function(o,e){const{x:n,y:l}=o.point,f=eo(n,l,o.worldSize/o._pixelsPerMercatorPixel,0,0);return me.mat4.multiply(f,f,ls(nr(e)))},i.bp=bh,i.bq=Fs,i.br=$m,i.bs=function(o,e,n,l,f){const u=5*e+2;o.float32[u+0]=n,o.float32[u+1]=l,o.float32[u+2]=f},i.bt=s_,i.bu=$b,i.bv=Q,i.bw=Ir,i.bx=Xv,i.by=D1,i.bz=eb,i.c=Me,i.c$=(o,e,n,l,f,u,m,v)=>{const S=o.transform,P=S.pitch<15?Sb(.07,.7,At((14-S.zoom)/5,0,1)):.07,x=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Eb(o,e,n,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:f,u_width_scale:u,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:Mb(e,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(x?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:d(e.tileID.canonical,0)}},i.c0=E1,i.c1=function(o){const e=E1(o,!0);return me.mat2.invert([],[e[0],e[1],e[4],e[5]])},i.c2=gn,i.c3=function(o){const{x:e,y:n}=o.point,{lng:l,lat:f}=o._center;return eo(e,n,o.worldSize,l,f)},i.c4=Nt,i.c5=Rt,i.c6=Yd,i.c7=function(o){const e=Math.round((o+45+360)%360/90)%4;return jt[e]},i.c8=45,i.c9=Lc,i.cA=class extends Ls{constructor(o){super(o),this.current=dy}set(o,e,n){if(this.fetchUniformLocation(o,e)){for(let l=0;l<9;l++)if(n[l]!==this.current[l]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},i.cB=Bt,i.cC=function(o,e,n){const l=Ar(n.zoom),f=o.style.map._antialias,u=e.options.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return l===0&&!f&&!u},i.cD=function(o){const e=o.pixelsPerMeter,n=e/zr(1,o.center.lat),l=me.mat4.identity(new Float64Array(16));return me.mat4.translate(l,l,[o.point.x,o.point.y,0]),me.mat4.scale(l,l,[n,n,e]),Float32Array.from(l)},i.cE=rn,i.cF=function(o){const e=Yr-5;o=At(o,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin(xt(o))),3);return Math.round(n*(Jd.length-1))},i.cG=function(o,e,n,l){const f=e.getNorth(),u=e.getSouth(),m=e.getWest(),v=e.getEast(),S=1<<o.z,P=v-m,x=f-u,M=P/Aa,I=-x/Jd[n],T=[0,M,0,I,0,0,f,m,0];if(o.z>0){const A=180/l;me.mat3.multiply(T,T,[A/P+1,0,0,0,A/x+1,0,-.5*A/M,.5*A/I,1])}return T[2]=S,T[5]=o.x,T[8]=o.y,T},i.cH=nr,i.cI=function(o,e,n){const l=me.mat4.identity(new Float64Array(16)),f=(e/(1<<o)-.5)*Math.PI*2;return me.mat4.rotateY(l,n.globeMatrix,f),Float32Array.from(l)},i.cJ=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const n=e.getSource().maxzoom,l=1<<n,f=Math.floor(o.x),u=Math.floor((o.x-f)*l),m=Math.floor(o.y*l),v=this.findDEMTileFor(new gt(n,f,n,u,m));return!(!v||!v.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||o.y<0||o.y>1)return e;const f=l.getSource().maxzoom,u=1<<f,m=Math.floor(o.x),v=o.x-m,S=new gt(f,m,f,Math.floor(v*u),Math.floor(o.y*u)),P=this.findDEMTileFor(S);if(!P||!P.dem)return e;const x=P.dem,M=1<<P.tileID.canonical.z,I=(v*M-P.tileID.canonical.x)*x.dim,T=(o.y*M-P.tileID.canonical.y)*x.dim,A=Math.floor(I),D=Math.floor(T);return(n?this.exaggeration():1)*ii(ii(x.get(A,D),x.get(A,D+1),T-D),ii(x.get(A+1,D),x.get(A+1,D+1),T-D),I-A)}getAtTileOffset(o,e,n){const l=1<<o.canonical.z;return this.getAtPointOrZero(new _(o.wrap+(o.canonical.x+e/vt)/l,(o.canonical.y+n/vt)/l))}getAtTileOffsetFunc(o,e,n,l){return f=>{const u=this.getAtTileOffset(o,f.x,f.y),m=l.upVector(o.canonical,f.x,f.y),v=l.upVectorScale(o.canonical,e,n).metersToTile;return me.vec3.scale(m,m,u*v),m}}getForTilePoints(o,e,n,l){if(this.isUsingMockSource())return!1;const f=Ah.create(this,o,l);return!!f&&(e.forEach(u=>{u[2]=this.exaggeration()*f.getElevationAt(u[0],u[1],n)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const n=e.dem.tree,l=e.tileID,f=1<<o.canonical.z-l.canonical.z;let u=o.canonical.x/f-l.canonical.x,m=o.canonical.y/f-l.canonical.y,v=0;for(let S=0;S<o.canonical.z-l.canonical.z&&!n.leaves[v];S++){u*=2,m*=2;const P=2*Math.floor(m)+Math.floor(u);v=n.childOffsets[v]+P,u%=1,m%=1}return{min:this.exaggeration()*n.minimums[v],max:this.exaggeration()*n.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,n=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const f of o){const u=this.getMinMaxForTile(f.tileID);u&&(n=Math.min(n,u.min),l=Math.max(l,u.max),e=!0)}return e?{min:n,max:l}:null}},i.cK=Iv,i.cL=Vi,i.cM=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},i.cN=vo,i.cO=ie,i.cP=ee,i.cQ=256,i.cR=function(o,e){const n=[0,0,0],l=br(nr(e.canonical));return me.vec3.transformMat4(n,n,l),me.vec3.transformMat4(n,n,o),n},i.cS=o=>({u_camera_to_center_distance:new kn(o),u_extrude_scale:new mh(o),u_device_pixel_ratio:new kn(o),u_matrix:new Rc(o),u_inv_rot_matrix:new Rc(o),u_merc_center:new Qs(o),u_tile_id:new dh(o),u_zoom_transition:new kn(o),u_up_dir:new dh(o),u_emissive_strength:new kn(o)}),i.cT=o=>({u_matrix:new Rc(o),u_pixels_to_tile_units:new mh(o),u_device_pixel_ratio:new kn(o),u_width_scale:new kn(o),u_floor_width_scale:new kn(o),u_units_to_pixels:new Qs(o),u_dash_image:new Ma(o),u_gradient_image:new Ma(o),u_image_height:new kn(o),u_texsize:new Qs(o),u_tile_units_to_pixels:new kn(o),u_alpha_discard_threshold:new kn(o),u_trim_offset:new Qs(o),u_trim_fade_range:new Qs(o),u_trim_color:new fh(o),u_emissive_strength:new kn(o),u_zbias_factor:new kn(o),u_tile_to_meter:new kn(o)}),i.cU=o=>({u_matrix:new Rc(o),u_texsize:new Qs(o),u_pixels_to_tile_units:new mh(o),u_device_pixel_ratio:new kn(o),u_width_scale:new kn(o),u_floor_width_scale:new kn(o),u_image:new Ma(o),u_units_to_pixels:new Qs(o),u_tile_units_to_pixels:new kn(o),u_alpha_discard_threshold:new kn(o),u_trim_offset:new Qs(o),u_trim_fade_range:new Qs(o),u_trim_color:new fh(o),u_emissive_strength:new kn(o),u_zbias_factor:new kn(o),u_tile_to_meter:new kn(o)}),i.cV=Vd,i.cW=gA,i.cX=yA,i.cY=yh,i.cZ=(o,e,n,l,f,u)=>{const m=o.transform,v=m.projection.name==="globe";let S;if(u.paint.get("circle-pitch-alignment")==="map")if(v){const x=vo(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;S=Float32Array.from([x,0,0,x])}else S=m.calculatePixelsToTileUnitsMatrix(n);else S=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(m.projection),u_matrix:o.translatePosMatrix(e.projMatrix,n,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ct.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:nf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(v){P.u_inv_rot_matrix=l,P.u_merc_center=f,P.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],P.u_zoom_transition=Ar(m.zoom);const x=f[0]*vt,M=f[1]*vt;P.u_up_dir=m.projection.upVector(new wt(0,0,0),x,M)}return P},i.c_=Ab,i.ca=fh,i.cb=function(o,e,n){const l=Math.sqrt(o*o+e*e+n*n),f=l>0?Math.acos(n/l)*St:0;let u=o!==0||e!==0?Math.atan2(-e,-o)*St+90:0;return u<0&&(u+=360),[l,u,f]},i.cc=d,i.cd=ei,i.ce=Fr,i.cf=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},i.cg=function(o,e){return o.readFields(uI,{icons:[]},e)},i.ch=function(o){return o({pluginStatus:$r,pluginURL:zs}),eh.on("pluginStateChange",o),o},i.ci=__,i.cj=Th,i.ck=Uy,i.cl=Ya,i.cm=Dd,i.cn=ri,i.co=rc,i.cp=qn,i.cq=function(o){const e=o.indexOf(Mc);return e>=0?o.slice(0,e):o},i.cr=function(o){return o.indexOf(Mc)>=0},i.cs=function(o){const e=o.indexOf(Mc);return e>=0?o.slice(e+1):""},i.ct=function(o){const e=[],n=o.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},i.cu=function(o,e,n,l){return o.type==="custom"?new YA(o,e):new aI[o.type](o,e,n,l)},i.cv=cr,i.cw=class extends Lh{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state={...o.state}),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},i.cx=eh,i.cy=ro,i.cz=ph,i.d=function(o){return he.API_TILEJSON_REGEX.test(o)},i.d$=Ws,i.d0=(o,e,n,l,f,u,m,v,S)=>{const P=o.transform,x=P.calculatePixelsToTileUnitsMatrix(e),M=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",I=P.pitch<15?Sb(.07,.7,At((14-P.zoom)/5,0,1)):.07;return{u_matrix:Eb(o,e,n,l),u_pixels_to_tile_units:x,u_device_pixel_ratio:u,u_width_scale:m,u_floor_width_scale:v,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:Ib(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Mb(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(M?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:d(e.tileID.canonical,0)}},i.d1=Pr,i.d2=rf,i.d3=pb,i.d4=oi,i.d5=Hm,i.d6=Il,i.d7=450,i.d8=7,i.d9=XA,i.dA=Jt,i.dB=s,i.dC=Ca,i.dD=function([o,e,n]){const l=Math.hypot(o,e,n),f=Math.atan2(o,n),u=.5*Math.PI-Math.acos(-e/l);return new Bi(Nt(f),Nt(u))},i.dE=ex,i.dF=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!function(n){if(tc==null){const l=n.navigator?n.navigator.userAgent:null;tc=!!n.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return tc}(o)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dG=function(o,e){ui=o,ci=e},i.dH=bo,i.dI=cs,i.dJ=function(o){const e=[0,0,0],n=me.mat4.identity(new Float64Array(16));return me.mat4.multiply(n,o.pixelMatrix,o.globeMatrix),me.vec3.transformMat4(e,e,n),new Ae(e[0],e[1])},i.dK=function(o,e,n=!1){if($r===Js||$r===Cd||$r===Pd)throw new Error("setRTLTextPlugin cannot be called multiple times.");zs=Ct.resolveURL(o),$r=Js,Qu=e,fl(),n||dm()},i.dL=zd,i.dM=function(){__().acquire(ox)},i.dN=function(){const o=Ef;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(ox),Ef=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dO=Uc,i.dP=function(o){const e=qi();if(!e)return;const n=e.delete(di);o&&n.catch(o).then(()=>o())},i.dQ=Mf,i.dR=yw,i.dS=function(o){gx=Ct.resolveURL(o),Rh||(Rh=new Ih(__(),new Ka)),Rh.broadcast("setDracoUrl",gx)},i.dT=xw,i.dU=function(o){zh=Ct.resolveURL(o),Rh||(Rh=new Ih(__(),new Ka)),Rh.broadcast("setMeshoptUrl",zh)},i.dV=Ot,i.dW=Al,i.dX=To,i.dY=Iw,i.dZ=Cw,i.d_=vb,i.da=Ni,i.db=ch,i.dc=256,i.dd=ls,i.de=Go,i.df=$o,i.dg=jd,i.dh=function(o,e,n,l,f){return At((o-e)/(n-e)*(f-l)+l,l,f)},i.di=Qp,i.dj=t,i.dk=class{constructor(o,e,n,l){this.context=o,this.format=l,this.size=n,this.texture=o.gl.createTexture();const[f,u,m]=this.size,{gl:v}=o;v.bindTexture(v.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),v.texImage3D(v.TEXTURE_3D,0,this.format,f,u,m,0,Yy(this.format),Ky(this.format),e.data)}bind(o,e){const{context:n}=this,{gl:l}=n;l.bindTexture(l.TEXTURE_3D,this.texture),o!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,o),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},i.dl=tx,i.dm=[1,1,1],i.dn=Ah,i.dp=Eh,i.dq=qo,i.dr=go,i.ds=El,i.dt=Hd,i.du=Gd,i.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ae(1/0,1/0),max:new Ae(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const n=Kv(new Ae(0,0),new Ae(vt,vt),o),l=[];if(e&&!Ey(n,this._globalClipBounds))return l;for(const f of this._activeRegions){if(f.hiddenByOverlap||!Ey(n,f))continue;const u=HE(f.min,f.max,o);l.push({min:u.min,max:u.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return l}setSources(o){this._setSources(o.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const l of e.cache.getVisibleCoordinates()){const f=e.cache.getTile(l).buckets[e.layer];f&&f.updateFootprints(l.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const n=o.getOrder(),l=o.getClipMask(),f=o.getClipScope();for(const u of e){if(!u.footprint)continue;const m=Kv(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:n,clipMask:l,clipScope:f})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||jm(e.min,n.min)||jm(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||function(l,f){const u=(m,v)=>m+v;return l.length-f.length||l.reduce(u,"").localeCompare(f.reduce(u,""))}(e.clipScope,n.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const n=this._activeRegions[e],l=this._prevRegions[e];o=n.priority!==l.priority||!Yv(n,l)||n.order!==l.order||n.clipMask!==l.clipMask||!bt(n.clipScope,l.clipScope),++e}}if(o){++this._updateTime;for(const n of this._activeRegions)n.order!==Um&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const l=this._activeRegions;if(n>=l.length)return n;const f=l[n].priority;for(;n<l.length&&l[n].priority===f;)++n;return n};if(this._sourceIds.length>1){let n=0,l=e(n);for(;n!==l;){let f=n;const u=n;for(;f!==l;){const m=this._activeRegions[f];m.hiddenByOverlap=!1;for(let v=0;v<u;v++){const S=this._activeRegions[v];if(!S.hiddenByOverlap&&m.order===Um&&Ey(m,S)&&(m.hiddenByOverlap=Qv(m.footprint,m.tileId,S.footprint,S.tileId),m.hiddenByOverlap))break}++f}n=l,l=e(n)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},i.dw=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const n=new mo,l=new vr,f=[],u=o+1+2,m=e[0]+1,v=e[0]+1+(1+e.length),S=(P,x,M)=>{let I=P===u-1?P-2:P===0?P:P-1;return I+=M?24575:0,[I,x]};for(let P=0;P<u;++P)n.emplaceBack(...S(P,0,!0));for(let P=0;P<m;++P)for(let x=0;x<u;++x)n.emplaceBack(...S(x,P,(x===0||x===u-1)&&!0));for(let P=0;P<e.length;++P){const x=e[P];for(let M=0;M<u;++M)n.emplaceBack(...S(M,x,!0))}for(let P=0;P<e.length;++P){const x=l.length,M=e[P]+1+2,I=new vr;for(let D=0;D<M-1;D++){const O=D===M-2,F=O?u*(v-e.length+P-D):u;for(let H=0;H<u-1;H++){const q=D*u+H;D===0||O||H===0||H===u-2?(I.emplaceBack(q+1,q,q+F),I.emplaceBack(q+F,q+F+1,q+1)):(l.emplaceBack(q+1,q,q+F),l.emplaceBack(q+F,q+F+1,q+1))}}const T=En.simpleSegment(0,x,n.length,l.length-x);for(let D=0;D<I.uint16.length;D+=3)l.emplaceBack(I.uint16[D],I.uint16[D+1],I.uint16[D+2]);const A=En.simpleSegment(0,x,n.length,l.length-x);f.push({withoutSkirts:T,withSkirts:A})}return{vertices:n,indices:l,segments:f}}_createGrid(o){const e=this._fillGridMeshWithLods(Aa,Jd);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,Pi.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new vr;for(let m=0;m<=Aa;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const n=new $o,l=new $o,f=new $o,u=new $o;this._poleSegments=[];for(let m=0,v=0;m<Yd;m++){const S=360/(1<<m);n.emplaceBack(0,-Mr,0,.5,0),l.emplaceBack(0,-Mr,0,.5,1),f.emplaceBack(0,-Mr,0,.5,.5),u.emplaceBack(0,-Mr,0,.5,.5);for(let P=0;P<=Aa;P++){let x=P/Aa,M=0;const I=ii(0,S,x),[T,A,D]=Ia(Pa,kc,I,Mr);n.emplaceBack(T,A,D,x,M),l.emplaceBack(T,A,D,x,1-M);const O=xt(I);x=.5+.5*Math.sin(O),M=.5+.5*Math.cos(O),f.emplaceBack(T,A,D,x,M),u.emplaceBack(T,A,D,x,1-M)}this._poleSegments.push(En.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(n,Wt,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(l,Wt,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(f,Wt,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(u,Wt,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},i.dx=Um,i.dy=vi,i.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.e=he,i.e0=Ys,i.e1=Zb,i.e2=function(o,e,n,l,f,u,m,v,S,P,x=1,M,I){o.createArrays(),o.tilePixelRatio=vt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const T=o.layers[0].layout,A=o.layers[0]._unevaluatedLayout._values,D={};D.scaleFactor=x,D.textSizeScaleRange=T.get("text-size-scale-range"),D.iconSizeScaleRange=T.get("icon-size-scale-range");const[O,F]=D.textSizeScaleRange,[H,q]=D.iconSizeScaleRange;if(D.textScaleFactor=At(D.scaleFactor,O,F),D.iconScaleFactor=At(D.scaleFactor,H,q),o.textSizeData.kind==="composite"){const{minZoom:K,maxZoom:ae}=o.textSizeData;D.compositeTextSizes=[A["text-size"].possiblyEvaluate(new yn(K),v),A["text-size"].possiblyEvaluate(new yn(ae),v)]}if(o.iconSizeData.kind==="composite"){const{minZoom:K,maxZoom:ae}=o.iconSizeData;D.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new yn(K),v),A["icon-size"].possiblyEvaluate(new yn(ae),v)]}D.layoutTextSize=A["text-size"].possiblyEvaluate(new yn(S+1),v),D.layoutIconSize=A["icon-size"].possiblyEvaluate(new yn(S+1),v),D.textMaxSize=A["text-size"].possiblyEvaluate(new yn(18),v);const U=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",$=T.get("text-size");let Z=!1;for(const K of o.features)if(K.icon&&K.icon.nameSecondary){Z=!0;break}for(const K of o.features){const ae=T.get("text-font").evaluate(K,{},v).join(","),oe=$.evaluate(K,{},v)*D.textScaleFactor,se=D.layoutTextSize.evaluate(K,{},v)*D.textScaleFactor,ye=(D.layoutIconSize.evaluate(K,{},v),{horizontal:{},vertical:void 0}),ce=K.text;let ve,Se=[0,0];if(ce){const Oe=ce.toString(),Pe=T.get("text-letter-spacing").evaluate(K,{},v)*Ir,Xe=T.get("text-line-height").evaluate(K,{},v)*Ir,lt=cm(Oe)?Pe:0,Je=T.get("text-anchor").evaluate(K,{},v),mt=T.get("text-variable-anchor");if(!mt){const _t=T.get("text-radial-offset").evaluate(K,{},v);Se=_t?e1(Je,[_t*Ir,jy]):T.get("text-offset").evaluate(K,{},v).map(Ft=>Ft*Ir)}let pt=U?"center":T.get("text-justify").evaluate(K,{},v);const Tt=T.get("symbol-placement")==="point",it=Tt?T.get("text-max-width").evaluate(K,{},v)*Ir:1/0,Vt=_t=>{o.allowVerticalPlacement&&Xu(Oe)&&(ye.vertical=By(ce,e,n,f,ae,it,Xe,Je,_t,lt,Se,Fs.vertical,!0,se,oe))};if(!U&&mt){const _t=pt==="auto"?mt.map(Kt=>Gy(Kt)):[pt];let Ft=!1;for(let Kt=0;Kt<_t.length;Kt++){const fi=_t[Kt];if(!ye.horizontal[fi])if(Ft)ye.horizontal[fi]=ye.horizontal[0];else{const _i=By(ce,e,n,f,ae,it,Xe,"center",fi,lt,Se,Fs.horizontal,!1,se,oe);_i&&(ye.horizontal[fi]=_i,Ft=_i.positionedLines.length===1)}}Vt("left")}else{if(pt==="auto"&&(pt=Gy(Je)),Tt||T.get("text-writing-mode").indexOf("horizontal")>=0||!Xu(Oe)){const _t=By(ce,e,n,f,ae,it,Xe,Je,pt,lt,Se,Fs.horizontal,!1,se,oe);_t&&(ye.horizontal[pt]=_t)}Vt(Tt?"left":pt)}}let we=!1,Ce=!1;if(K.icon&&K.icon.namePrimary){const Oe=qm(o.iconSizeData,A["icon-size"],v,o.zoom,K)*D.iconScaleFactor*M,Pe=K.icon.getPrimary().scaleSelf(Oe).serialize(),Xe=l[Pe];Xe&&(ve=CA(f[Pe],K.icon.nameSecondary?f[K.icon.getSecondary().scaleSelf(Oe).serialize()]:void 0,T.get("icon-offset").evaluate(K,{},v),T.get("icon-anchor").evaluate(K,{},v)),we=Xe.sdf,Ce=Xe.usvg,o.sdfIcons===void 0?o.sdfIcons=Xe.sdf:o.sdfIcons!==Xe.sdf&&Ti("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Xe.pixelRatio!==o.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}const ze=i1(ye.horizontal)||ye.vertical;o.iconsInText||(o.iconsInText=!!ze&&ze.iconsInText),(ze||ve)&&OA(o,K,ye,ve,l,D,se,0,Se,we,Ce,m,v,P,I,Z)}u&&o.generateCollisionDebugBuffers(S,o.collisionBoxArray,D.textScaleFactor)},i.e3=vh,i.e4=w_,i.e5=Ue,i.e6=qv,i.e7=Lb,i.e8=R,i.e9=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==bw){const n=new Uint32Array(o,0,7),[,,l,f,u,m]=n;e=n.byteLength+f+u+m+u,(l!==o.byteLength||e>=o.byteLength)&&Ti("Invalid b3dm header information.")}return Mw(o,e)},i.ea=function(o,e){const n=Aw(o);for(const l of n){for(const f of l.meshes)hC(f);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(dC(l.lights,e)))}return n},i.eb=m_,i.ec=G1,i.ed=Wr,i.ee=function(o){Xi(),ji!=null&&ji.then(e=>{e.keys().then(n=>{for(let l=0;l<n.length-o;l++)e.delete(n[l])})})},i.f=function(o){return o.indexOf("mapbox:")===0},i.g=function(o,e){return ro(Li(o,{method:"GET"}),e)},i.h=Te,i.i=function(o){return he.API_STYLE_REGEX.test(o)&&!Me(o)},i.j=function(o){return decodeURIComponent(atob(o).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(+("0x"+n))))},i.l=Li,i.m=Dr,i.n=function(o,e){return ro(Li(o,{type:"json"}),e)},i.o=pu,i.p=function(o,e){return ro(Li(o,{method:"POST"}),e)},i.q=Ct,i.r=Rr,i.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=ht,i.u=function(){return function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()},i.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},i.w=Ti,i.x=function(){return ax||(ax=new Uc),ax},i.y=Oo,i.z=ko}),b(["./shared"],function(i){function R(We){const ee=We?We.url.toString():void 0;return ee?performance.getEntriesByName(ee):[]}function V(We){if(typeof We=="number"||typeof We=="boolean"||typeof We=="string"||We==null)return JSON.stringify(We);if(Array.isArray(We)){let ie="[";for(const he of We)ie+=`${V(he)},`;return`${ie}]`}let ee="{";for(const ie of Object.keys(We).sort())ee+=`${ie}:${V(We[ie])},`;return`${ee}}`}function j(We){let ee="";for(const ie of i.bm)ee+=`/${V(We[ie])}`;return ee}class W{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,ie){this._layerConfigs={},this._layers={},this.update(ee,[],ie)}update(ee,ie,he){this._options=he;for(const Me of ee)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=i.cu(Me,this.scope,null,this._options)).compileFilter(he),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(const Me of ie)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const Te=function(Me,De){const Ge={};for(let qe=0;qe<Me.length;qe++){const Ze=Me[qe];let Qe=De&&De[Ze.id];!Qe&&(Qe=j(Ze),Ze.type==="line"&&Ze.paint)&&function Ct(zt){return typeof zt=="string"&&zt==="line-progress"||(Array.isArray(zt)?zt.some(Ct):!(!zt||typeof zt!="object")&&Object.values(zt).some(Ct))}(Ze.paint["line-width"])&&(Qe+=`/${V(Ze.paint["line-width"])}`),De&&(De[Ze.id]=Qe);let ht=Ge[Qe];ht||(ht=Ge[Qe]=[]),ht.push(Ze)}const Le=[];for(const qe in Ge)Le.push(Ge[qe]);return Le}(i.bj(this._layerConfigs),this.keyCache);for(const Me of Te){const De=Me.map(ht=>this._layers[ht.id]),Ge=De[0];if(Ge.visibility==="none")continue;const Le=Ge.source||"";let qe=this.familiesBySource[Le];qe||(qe=this.familiesBySource[Le]={});const Ze=Ge.sourceLayer||"_geojsonTileLayer";let Qe=qe[Ze];Qe||(Qe=qe[Ze]=[]),Qe.push(De)}}}const te=1*i.dX;class ne{constructor(ee){const ie={},he=[];for(const Ge in ee){const Le=ee[Ge],qe=ie[Ge]={};for(const Ze in Le.glyphs){const Qe=Le.glyphs[+Ze];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const ht=Qe.metrics.localGlyph?te:1,Ct={x:0,y:0,w:Qe.bitmap.width+2*ht,h:Qe.bitmap.height+2*ht};he.push(Ct),qe[Ze]=Ct}}const{w:Te,h:Me}=i.C(he),De=new i.dW({width:Te||1,height:Me||1});for(const Ge in ee){const Le=ee[Ge];for(const qe in Le.glyphs){const Ze=Le.glyphs[+qe];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const Qe=ie[Ge][qe],ht=Ze.metrics.localGlyph?te:1;i.dW.copy(Ze.bitmap,De,{x:0,y:0},{x:Qe.x+ht,y:Qe.y+ht},Ze.bitmap)}}this.image=De,this.positions=ie}}i.dV(ne,"GlyphAtlas");class ge{constructor(ee){this.tileID=new i.aG(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.lut=ee.lut,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.scope=ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.request&&ee.request.collectResourceTiming,this.promoteId=ee.promoteId,this.isSymbolTile=ee.isSymbolTile,this.tileTransform=i.aQ(ee.tileID.canonical,ee.projection),this.projection=ee.projection,this.worldview=ee.worldview,this.localizableLayerIds=ee.localizableLayerIds,this.brightness=ee.brightness,this.extraShadowCaster=!!ee.extraShadowCaster,this.tessellationStep=ee.tessellationStep,this.scaleFactor=ee.scaleFactor}parse(ee,ie,he,Te,Me){this.status="parsing",this.data=ee,this.collisionBoxArray=new i.aW;const De=new i.dY(Object.keys(ee.layers).sort()),Ge=new i.dZ(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const Le={},qe=new i.d_(256,256),Ze={featureIndex:Ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:qe,availableImages:he,brightness:this.brightness,scaleFactor:this.scaleFactor},Qe=ie.familiesBySource[this.source];for(const ci in Qe){const Zi=ee.layers[ci];if(!Zi)continue;let ji=!1,Si=!1,qi=!1;for(const Dr of Qe[ci])Dr[0].type==="symbol"?ji=!0:Si=!0,Dr[0].is3D()&&Dr[0].type!=="model"&&(qi=!0);if(this.extraShadowCaster&&!qi||this.isSymbolTile===!0&&!ji||this.isSymbolTile===!1&&!Si)continue;Zi.version===1&&i.w(`Vector tile source "${this.source}" layer "${ci}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xi=De.encode(ci),$n=[];for(let Dr=0,ur=0;Dr<Zi.length;Dr++){const pr=Zi.feature(Dr),ca=Ge.getId(pr,ci);if(this.localizableLayerIds&&this.localizableLayerIds.has(ci)){const Xs=pr.properties?pr.properties.worldview:null;if(this.worldview&&typeof Xs=="string")if(Xs==="all")pr.properties.$localized=!0;else{if(!Xs.split(",").includes(this.worldview))continue;pr.properties.$localized=!0,pr.properties.worldview=this.worldview}}$n.push({feature:pr,id:ca,index:ur,sourceLayerIndex:Xi}),ur++}for(const Dr of Qe[ci]){const ur=Dr[0];(!this.extraShadowCaster||ur.is3D()&&ur.type!=="model")&&(this.isSymbolTile!==void 0&&ur.type==="symbol"!==this.isSymbolTile||ur.minzoom&&this.zoom<Math.floor(ur.minzoom)||ur.maxzoom&&this.zoom>=ur.maxzoom||ur.visibility!=="none"&&(xe(Dr,this.zoom,Ze.brightness,he),(Le[ur.id]=ur.createBucket({index:Ge.bucketLayerIDs.length,layers:Dr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate($n,Ze,this.tileID.canonical,this.tileTransform),Ge.bucketLayerIDs.push(Dr.map(pr=>i.aC(pr.id,pr.scope)))))}}let ht,Ct,zt,ri;qe.trim();const di={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ui=()=>{if(ht)return this.status="done",Me(ht);if(this.extraShadowCaster)this.status="done",Me(null,{buckets:i.bj(Le).filter(ci=>!ci.isEmpty()),featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ze.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ct&&zt&&ri){const ci=new ne(Ct),Zi=new i.e1(zt,ri,this.lut);for(const ji in Le){const Si=Le[ji];Si instanceof i.aX?(xe(Si.layers,this.zoom,Ze.brightness,he),i.e2(Si,Ct,ci.positions,zt,Zi.iconPositions,this.showCollisionBoxes,he,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Si.hasPattern&&(Si instanceof i.b1||Si instanceof i.b2||Si instanceof i.d5)&&(xe(Si.layers,this.zoom,Ze.brightness,he),Si.addFeatures(Ze,this.tileID.canonical,Zi.patternPositions,he,this.tileTransform,this.brightness))}this.status="done",Me(null,{buckets:i.bj(Le).filter(ji=>!ji.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ci.image,lineAtlas:qe,imageAtlas:Zi,brightness:Ze.brightness})}};if(!this.extraShadowCaster){const ci=i.d$(Ze.glyphDependencies,Si=>Object.keys(Si).map(Number));Object.keys(ci).length?Te.send("getGlyphs",{uid:this.uid,stacks:ci,scope:this.scope},(Si,qi)=>{ht||(ht=Si,Ct=qi,ui())},void 0,!1,di):Ct={};const Zi=Object.keys(Ze.iconDependencies);Zi.length?Te.send("getImages",{icons:Zi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Si,qi)=>{if(ht)return;ht=Si;const Xi={};Object.values(qi).some($n=>$n.usvg)?this.rasterize(Te,Xi,qi,Ze.iconDependencies,()=>{zt=Xi,ui()}):(this.fillImageMap(Xi,Ze.iconDependencies,qi),zt=Xi,ui())},void 0,!1,di):zt={};const ji=Object.keys(Ze.patternDependencies);ji.length?Te.send("getImages",{icons:ji,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Si,qi)=>{if(!ht){ht=Si;const Xi={};Object.values(qi).some($n=>$n.usvg)?this.rasterize(Te,Xi,qi,Ze.patternDependencies,()=>{ri=Xi,ui()}):(this.fillImageMap(Xi,Ze.patternDependencies,qi),ri=Xi,ui())}},void 0,!1,di):ri={}}ui()}fillImageMap(ee,ie,he){for(const Te in he){const Me=ie[Te]||[];for(const De of Me)he[De.id].usvg||(ee[De.serialize()]=he[De.id])}}getImageTaskQueue(ee,ie,he){const Te={};for(const Me in ie){const De=he[Me]||[];for(const Ge of De){const Le=Ge.serialize();ie[Ge.id].usvg?Te[Le]||(Te[Le]=Ge):ee[Le]=ie[Ge.id]}}return Te}rasterize(ee,ie,he,Te,Me){const De=this.getImageTaskQueue(ie,he,Te);this.rasterizeTask=ee.send("rasterizeImages",{scope:this.scope,imageTasks:De},(Ge,Le)=>{if(!Ge)for(const qe in Le){const{id:Ze}=i.e0.deserializeFromString(qe);ie[qe]=Object.assign({},he[Ze],{data:Le[qe]})}Me()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function xe(We,ee,ie,he){const Te=new i.a8(ee,{brightness:ie});for(const Me of We)Me.recalculate(Te,he)}class Fe extends i.E{constructor(ee,ie,he,Te,Me,De){super(),this.actor=ee,this.layerIndex=ie,this.availableImages=he,this.loadVectorData=Me||i.aD,this.loading={},this.loaded={},this.deduped=new i.aB(ee.scheduler),this.isSpriteLoaded=Te,this.scheduler=ee.scheduler,this.brightness=De}loadTile(ee,ie){const he=ee.uid,Te=ee&&ee.request,Me=Te&&Te.collectResourceTiming,De=this.loading[he]=new ge(ee);De.abort=this.loadVectorData(ee,(Ge,Le)=>{const qe=!this.loading[he];if(delete this.loading[he],De.cancelRasterize(),qe||Ge||!Le)return De.status="done",qe||(this.loaded[he]=De),ie(Ge);const Ze=Le.rawData,Qe={};Le.expires&&(Qe.expires=Le.expires),Le.cacheControl&&(Qe.cacheControl=Le.cacheControl),De.vectorTile=Le.vectorTile||new i.e3.VectorTile(new i.bh(Ze));const ht=()=>{De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ct,zt)=>{if(Ct||!zt)return ie(Ct);const ri={};if(Me){const di=R(Te);di.length>0&&(ri.resourceTiming=JSON.parse(JSON.stringify(di)))}ie(null,i.l({rawTileData:Ze.slice(0)},zt,Qe,ri))})};this.isSpriteLoaded?ht():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ht,{type:"parseTile",isSymbolTile:ee.isSymbolTile,zoom:ee.tileZoom}):ht()}),this.loaded=this.loaded||{},this.loaded[he]=De})}reloadTile(ee,ie){const he=this.loaded,Te=ee.uid;if(he&&he[Te]){const Me=he[Te];Me.scaleFactor=ee.scaleFactor,Me.showCollisionBoxes=ee.showCollisionBoxes,Me.projection=ee.projection,Me.brightness=ee.brightness,Me.tileTransform=i.aQ(ee.tileID.canonical,ee.projection),Me.extraShadowCaster=ee.extraShadowCaster,Me.lut=ee.lut;const De=(Ge,Le)=>{const qe=Me.reloadCallback;qe&&(delete Me.reloadCallback,Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,qe)),ie(Ge,Le)};Me.status==="parsing"?Me.reloadCallback=De:Me.status==="done"&&(Me.vectorTile?Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,De):De())}else ie(null,void 0)}abortTile(ee,ie){const he=ee.uid,Te=this.loading[he];Te&&(Te.abort&&Te.abort(),delete this.loading[he]),ie()}removeTile(ee,ie){const he=this.loaded,Te=ee.uid;he&&he[Te]&&delete he[Te],ie()}}class Be{loadTile(ee,ie){const{uid:he,encoding:Te,rawImageData:Me,padding:De}=ee,Ge=ImageBitmap&&Me instanceof ImageBitmap?this.getImageData(Me,De):Me;ie(null,new i.e4(he,Ge,Te,De<1))}getImageData(ee,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);const he=this.offscreenCanvasContext.getImageData(-ie,-ie,ee.width+2*ie,ee.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}i.bg.setPbf(i.bh);class Ke{decodeRasterArray({task:ee,buffer:ie},he){i.bg.performDecoding(ie,ee).then(Te=>{he(null,Te)},Te=>{he(Te)})}}const at=i.e3.VectorTileFeature.prototype.toGeoJSON;class Ye{constructor(ee){this._feature=ee,this.extent=i.ag,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const ie of this._feature.geometry)ee.push([new i.P(ie[0],ie[1])]);return ee}{const ee=[];for(const ie of this._feature.geometry){const he=[];for(const Te of ie)he.push(new i.P(Te[0],Te[1]));ee.push(he)}return ee}}toGeoJSON(ee,ie,he){return at.call(this,ee,ie,he)}}class ct{constructor(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.ag,this.length=ee.length,this._features=ee}feature(ee){return new Ye(this._features[ee])}}const Lt=64/4096,rt=128;class Ut{constructor(){this.features=new Map}clear(){this.features.clear()}load(ee=[],ie){for(const he of ee){const Te=he.id;if(Te==null)continue;let Me=this.features.get(Te);Me&&this.updateCache(Me,ie),he.geometry?(Me=It(he),this.updateCache(Me,ie),this.features.set(Te,Me)):this.features.delete(Te),this.updateCache(Me,ie)}}updateCache(ee,ie){for(const{canonical:he,uid:Te}of Object.values(ie)){const{z:Me,x:De,y:Ge}=he;si(ee,Math.pow(2,Me),De,Ge)&&delete ie[Te]}}getTile(ee,ie,he){const Te=Math.pow(2,ee),Me=[];for(const De of this.features.values())si(De,Te,ie,he)&&Me.push(Fn(De,Te,ie,he));return{features:Me}}getFeatures(){return[...this.features.values()]}}function si({minX:We,minY:ee,maxX:ie,maxY:he},Te,Me,De){return We<(Me+1+Lt)/Te&&ee<(De+1+Lt)/Te&&ie>(Me-Lt)/Te&&he>(De-Lt)/Te}function It(We){const{id:ee,geometry:ie,properties:he}=We;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Te,coordinates:Me}=ie,De={id:ee,type:1,geometry:[],tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ge=De.geometry;if(Te==="Point")Pt(Me,Ge,De);else if(Te==="MultiPoint")for(const Le of Me)Pt(Le,Ge,De);else if(Te==="LineString")De.type=2,Ii(Me,Ge,De);else if(Te==="MultiLineString")De.type=2,tn(Me,Ge,De);else if(Te==="Polygon")De.type=3,tn(Me,Ge,De,!0);else{if(Te!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");De.type=3;for(const Le of Me)tn(Le,Ge,De,!0)}return De}function Pt([We,ee],ie,he){const Te=i.at(We);let Me=i.aA(ee);Me=Me<0?0:Me>1?1:Me,ie.push(Te,Me),he.minX=Math.min(he.minX,Te),he.minY=Math.min(he.minY,Me),he.maxX=Math.max(he.maxX,Te),he.maxY=Math.max(he.maxY,Me)}function Ii(We,ee,ie,he=!1,Te=!1){const Me=[];for(const De of We)Pt(De,Me,ie);ee.push(Me),he&&function(De,Ge){let Le=0;for(let qe=0,Ze=De.length,Qe=Ze-2;qe<Ze;Qe=qe,qe+=2)Le+=(De[qe]-De[Qe])*(De[qe+1]+De[Qe+1]);if(Le>0===Ge)for(let qe=0,Ze=De.length;qe<Ze/2;qe+=2){const Qe=De[qe],ht=De[qe+1];De[qe]=De[Ze-2-qe],De[qe+1]=De[Ze-1-qe],De[Ze-2-qe]=Qe,De[Ze-1-qe]=ht}}(Me,Te)}function tn(We,ee,ie,he=!1){for(let Te=0;Te<We.length;Te++)Ii(We[Te],ee,ie,he,Te===0)}function Fn(We,ee,ie,he){const{id:Te,type:Me,geometry:De,tags:Ge}=We,Le=[];if(Me===1)(function(qe,Ze,Qe,ht,Ct){for(let zt=0;zt<qe.length;zt+=2){const ri=Math.round(i.ag*(qe[zt+0]*Ze-Qe)),di=Math.round(i.ag*(qe[zt+1]*Ze-ht));Ct.push([ri,di])}})(De,ee,ie,he,Le);else for(const qe of De)Gt(qe,ee,ie,he,Le);return{id:Te,type:Me,geometry:Le,tags:Ge}}function Gt(We,ee,ie,he,Te){const De=i.ag+rt;let Ge;for(let Le=0;Le<We.length-2;Le+=2){let qe=Math.round(i.ag*(We[Le+0]*ee-ie)),Ze=Math.round(i.ag*(We[Le+1]*ee-he)),Qe=Math.round(i.ag*(We[Le+2]*ee-ie)),ht=Math.round(i.ag*(We[Le+3]*ee-he));const Ct=Qe-qe,zt=ht-Ze;qe<-128&&Qe<-128||(qe<-128?(Ze+=Math.round(zt*((-128-qe)/Ct)),qe=-128):Qe<-128&&(ht=Ze+Math.round(zt*((-128-qe)/Ct)),Qe=-128),Ze<-128&&ht<-128||(Ze<-128?(qe+=Math.round(Ct*((-128-Ze)/zt)),Ze=-128):ht<-128&&(Qe=qe+Math.round(Ct*((-128-Ze)/zt)),ht=-128),qe>=De&&Qe>=De||(qe>=De?(Ze+=Math.round(zt*((De-qe)/Ct)),qe=De):Qe>=De&&(ht=Ze+Math.round(zt*((De-qe)/Ct)),Qe=De),Ze>=De&&ht>=De||(Ze>=De?(qe+=Math.round(Ct*((De-Ze)/zt)),Ze=De):ht>=De&&(Qe=qe+Math.round(Ct*((De-Ze)/zt)),ht=De),Ge&&qe===Ge[Ge.length-1][0]&&Ze===Ge[Ge.length-1][1]||(Ge=[[qe,Ze]],Te.push(Ge)),Ge.push([Qe,ht])))))}}var mi,pi,Di,qt={exports:{}},Hn=function(){if(Di)return qt.exports;Di=1;var We=i.e7(),ee=function(){if(pi)return mi;pi=1;var Ze=i.e5(),Qe=i.e6().VectorTileFeature;function ht(zt,ri){this.options=ri||{},this.features=zt,this.length=zt.length}function Ct(zt,ri){this.id=typeof zt.id=="number"?zt.id:void 0,this.type=zt.type,this.rawGeometry=zt.type===1?[zt.geometry]:zt.geometry,this.properties=zt.tags,this.extent=ri||4096}return mi=ht,ht.prototype.feature=function(zt){return new Ct(this.features[zt],this.options.extent)},Ct.prototype.loadGeometry=function(){var zt=this.rawGeometry;this.geometry=[];for(var ri=0;ri<zt.length;ri++){for(var di=zt[ri],ui=[],ci=0;ci<di.length;ci++)ui.push(new Ze(di[ci][0],di[ci][1]));this.geometry.push(ui)}return this.geometry},Ct.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var zt=this.geometry,ri=1/0,di=-1/0,ui=1/0,ci=-1/0,Zi=0;Zi<zt.length;Zi++)for(var ji=zt[Zi],Si=0;Si<ji.length;Si++){var qi=ji[Si];ri=Math.min(ri,qi.x),di=Math.max(di,qi.x),ui=Math.min(ui,qi.y),ci=Math.max(ci,qi.y)}return[ri,ui,di,ci]},Ct.prototype.toGeoJSON=Qe.prototype.toGeoJSON,mi}();function ie(Ze){var Qe=new We;return function(ht,Ct){for(var zt in ht.layers)Ct.writeMessage(3,he,ht.layers[zt])}(Ze,Qe),Qe.finish()}function he(Ze,Qe){var ht;Qe.writeVarintField(15,Ze.version||1),Qe.writeStringField(1,Ze.name||""),Qe.writeVarintField(5,Ze.extent||4096);var Ct={keys:[],values:[],keycache:{},valuecache:{}};for(ht=0;ht<Ze.length;ht++)Ct.feature=Ze.feature(ht),Qe.writeMessage(2,Te,Ct);var zt=Ct.keys;for(ht=0;ht<zt.length;ht++)Qe.writeStringField(3,zt[ht]);var ri=Ct.values;for(ht=0;ht<ri.length;ht++)Qe.writeMessage(4,qe,ri[ht])}function Te(Ze,Qe){var ht=Ze.feature;ht.id!==void 0&&Qe.writeVarintField(1,ht.id),Qe.writeMessage(2,Me,Ze),Qe.writeVarintField(3,ht.type),Qe.writeMessage(4,Le,ht)}function Me(Ze,Qe){var ht=Ze.feature,Ct=Ze.keys,zt=Ze.values,ri=Ze.keycache,di=Ze.valuecache;for(var ui in ht.properties){var ci=ht.properties[ui],Zi=ri[ui];if(ci!==null){Zi===void 0&&(Ct.push(ui),ri[ui]=Zi=Ct.length-1),Qe.writeVarint(Zi);var ji=typeof ci;ji!=="string"&&ji!=="boolean"&&ji!=="number"&&(ci=JSON.stringify(ci));var Si=ji+":"+ci,qi=di[Si];qi===void 0&&(zt.push(ci),di[Si]=qi=zt.length-1),Qe.writeVarint(qi)}}}function De(Ze,Qe){return(Qe<<3)+(7&Ze)}function Ge(Ze){return Ze<<1^Ze>>31}function Le(Ze,Qe){for(var ht=Ze.loadGeometry(),Ct=Ze.type,zt=0,ri=0,di=ht.length,ui=0;ui<di;ui++){var ci=ht[ui],Zi=1;Ct===1&&(Zi=ci.length),Qe.writeVarint(De(1,Zi));for(var ji=Ct===3?ci.length-1:ci.length,Si=0;Si<ji;Si++){Si===1&&Ct!==1&&Qe.writeVarint(De(2,ji-1));var qi=ci[Si].x-zt,Xi=ci[Si].y-ri;Qe.writeVarint(Ge(qi)),Qe.writeVarint(Ge(Xi)),zt+=qi,ri+=Xi}Ct===3&&Qe.writeVarint(De(7,1))}}function qe(Ze,Qe){var ht=typeof Ze;ht==="string"?Qe.writeStringField(1,Ze):ht==="boolean"?Qe.writeBooleanField(7,Ze):ht==="number"&&(Ze%1!=0?Qe.writeDoubleField(3,Ze):Ze<0?Qe.writeSVarintField(6,Ze):Qe.writeVarintField(5,Ze))}return qt.exports=ie,qt.exports.fromVectorTileJs=ie,qt.exports.fromGeojsonVt=function(Ze,Qe){Qe=Qe||{};var ht={};for(var Ct in Ze)ht[Ct]=new ee(Ze[Ct].features,Qe),ht[Ct].name=Ct,ht[Ct].version=Qe.version,ht[Ct].extent=Qe.extent;return ie({layers:ht})},qt.exports.GeoJSONWrapper=ee,qt.exports}(),ir=i.e8(Hn);const Sn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:We=>We},Qt=Math.fround||(ar=new Float32Array(1),We=>(ar[0]=+We,ar[0]));var ar;const Qn=3,mn=5,Mt=6;class ti{constructor(ee){this.options=Object.assign(Object.create(Sn),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:ie,minZoom:he,maxZoom:Te}=this.options;ie&&console.time("total time");const Me=`prepare ${ee.length} points`;ie&&console.time(Me),this.points=ee;const De=[];for(let Le=0;Le<ee.length;Le++){const qe=ee[Le];if(!qe.geometry)continue;const[Ze,Qe]=qe.geometry.coordinates,ht=Qt(nn(Ze)),Ct=Qt(ke(Qe));De.push(ht,Ct,1/0,Le,-1,1),this.options.reduce&&De.push(0)}let Ge=this.trees[Te+1]=this._createTree(De);ie&&console.timeEnd(Me);for(let Le=Te;Le>=he;Le--){const qe=+Date.now();Ge=this.trees[Le]=this._createTree(this._cluster(Ge,Le)),ie&&console.log("z%d: %d clusters in %dms",Le,Ge.numItems,+Date.now()-qe)}return ie&&console.timeEnd("total time"),this}getClusters(ee,ie){let he=((ee[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,ee[1]));let Me=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)he=-180,Me=180;else if(he>Me){const Qe=this.getClusters([he,Te,180,De],ie),ht=this.getClusters([-180,Te,Me,De],ie);return Qe.concat(ht)}const Ge=this.trees[this._limitZoom(ie)],Le=Ge.range(nn(he),ke(De),nn(Me),ke(Te)),qe=Ge.data,Ze=[];for(const Qe of Le){const ht=this.stride*Qe;Ze.push(qe[ht+mn]>1?Xt(qe,ht,this.clusterProps):this.points[qe[ht+Qn]])}return Ze}getChildren(ee){const ie=this._getOriginId(ee),he=this._getOriginZoom(ee),Te="No cluster with the specified id.",Me=this.trees[he];if(!Me)throw new Error(Te);const De=Me.data;if(ie*this.stride>=De.length)throw new Error(Te);const Ge=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Le=Me.within(De[ie*this.stride],De[ie*this.stride+1],Ge),qe=[];for(const Ze of Le){const Qe=Ze*this.stride;De[Qe+4]===ee&&qe.push(De[Qe+mn]>1?Xt(De,Qe,this.clusterProps):this.points[De[Qe+Qn]])}if(qe.length===0)throw new Error(Te);return qe}getLeaves(ee,ie,he){const Te=[];return this._appendLeaves(Te,ee,ie=ie||10,he=he||0,0),Te}getTile(ee,ie,he){const Te=this.trees[this._limitZoom(ee)],Me=Math.pow(2,ee),{extent:De,radius:Ge}=this.options,Le=Ge/De,qe=(he-Le)/Me,Ze=(he+1+Le)/Me,Qe={features:[]};return this._addTileFeatures(Te.range((ie-Le)/Me,qe,(ie+1+Le)/Me,Ze),Te.data,ie,he,Me,Qe),ie===0&&this._addTileFeatures(Te.range(1-Le/Me,qe,1,Ze),Te.data,Me,he,Me,Qe),ie===Me-1&&this._addTileFeatures(Te.range(0,qe,Le/Me,Ze),Te.data,-1,he,Me,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(ee){let ie=this._getOriginZoom(ee)-1;for(;ie<=this.options.maxZoom;){const he=this.getChildren(ee);if(ie++,he.length!==1)break;ee=he[0].properties.cluster_id}return ie}_appendLeaves(ee,ie,he,Te,Me){const De=this.getChildren(ie);for(const Ge of De){const Le=Ge.properties;if(Le&&Le.cluster?Me+Le.point_count<=Te?Me+=Le.point_count:Me=this._appendLeaves(ee,Le.cluster_id,he,Te,Me):Me<Te?Me++:ee.push(Ge),ee.length===he)break}return Me}_createTree(ee){const ie=new i.bE(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<ee.length;he+=this.stride)ie.add(ee[he],ee[he+1]);return ie.finish(),ie.data=ee,ie}_addTileFeatures(ee,ie,he,Te,Me,De){for(const Ge of ee){const Le=Ge*this.stride,qe=ie[Le+mn]>1;let Ze,Qe,ht;if(qe)Ze=me(ie,Le,this.clusterProps),Qe=ie[Le],ht=ie[Le+1];else{const ri=this.points[ie[Le+Qn]];Ze=ri.properties;const[di,ui]=ri.geometry.coordinates;Qe=nn(di),ht=ke(ui)}const Ct={type:1,geometry:[[Math.round(this.options.extent*(Qe*Me-he)),Math.round(this.options.extent*(ht*Me-Te))]],tags:Ze};let zt;zt=qe||this.options.generateId?ie[Le+Qn]:this.points[ie[Le+Qn]].id,zt!==void 0&&(Ct.id=zt),De.features.push(Ct)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,ie){const{radius:he,extent:Te,reduce:Me,minPoints:De}=this.options,Ge=he/(Te*Math.pow(2,ie)),Le=ee.data,qe=[],Ze=this.stride;for(let Qe=0;Qe<Le.length;Qe+=Ze){if(Le[Qe+2]<=ie)continue;Le[Qe+2]=ie;const ht=Le[Qe],Ct=Le[Qe+1],zt=ee.within(Le[Qe],Le[Qe+1],Ge),ri=Le[Qe+mn];let di=ri;for(const ui of zt){const ci=ui*Ze;Le[ci+2]>ie&&(di+=Le[ci+mn])}if(di>ri&&di>=De){let ui,ci=ht*ri,Zi=Ct*ri,ji=-1;const Si=(Qe/Ze<<5)+(ie+1)+this.points.length;for(const qi of zt){const Xi=qi*Ze;if(Le[Xi+2]<=ie)continue;Le[Xi+2]=ie;const $n=Le[Xi+mn];ci+=Le[Xi]*$n,Zi+=Le[Xi+1]*$n,Le[Xi+4]=Si,Me&&(ui||(ui=this._map(Le,Qe,!0),ji=this.clusterProps.length,this.clusterProps.push(ui)),Me(ui,this._map(Le,Xi)))}Le[Qe+4]=Si,qe.push(ci/di,Zi/di,1/0,Si,-1,di),Me&&qe.push(ji)}else{for(let ui=0;ui<Ze;ui++)qe.push(Le[Qe+ui]);if(di>1)for(const ui of zt){const ci=ui*Ze;if(!(Le[ci+2]<=ie)){Le[ci+2]=ie;for(let Zi=0;Zi<Ze;Zi++)qe.push(Le[ci+Zi])}}}}return qe}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,ie,he){if(ee[ie+mn]>1){const De=this.clusterProps[ee[ie+Mt]];return he?Object.assign({},De):De}const Te=this.points[ee[ie+Qn]].properties,Me=this.options.map(Te);return he&&Me===Te?Object.assign({},Me):Me}}function Xt(We,ee,ie){return{type:"Feature",id:We[ee+Qn],properties:me(We,ee,ie),geometry:{type:"Point",coordinates:[(he=We[ee],360*(he-.5)),Ue(We[ee+1])]}};var he}function me(We,ee,ie){const he=We[ee+mn],Te=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,Me=We[ee+Mt],De=Me===-1?{}:Object.assign({},ie[Me]);return Object.assign(De,{cluster:!0,cluster_id:We[ee+Qn],point_count:he,point_count_abbreviated:Te})}function nn(We){return We/360+.5}function ke(We){const ee=Math.sin(We*Math.PI/180),ie=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ie<0?0:ie>1?1:ie}function Ue(We){const ee=(180-360*We)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function Ae(We,ee,ie,he){let Te=he;const Me=ee+(ie-ee>>1);let De,Ge=ie-ee;const Le=We[ee],qe=We[ee+1],Ze=We[ie],Qe=We[ie+1];for(let ht=ee+3;ht<ie;ht+=3){const Ct=bt(We[ht],We[ht+1],Le,qe,Ze,Qe);if(Ct>Te)De=ht,Te=Ct;else if(Ct===Te){const zt=Math.abs(ht-Me);zt<Ge&&(De=ht,Ge=zt)}}Te>he&&(De-ee>3&&Ae(We,ee,De,he),We[De+2]=Te,ie-De>3&&Ae(We,De,ie,he))}function bt(We,ee,ie,he,Te,Me){let De=Te-ie,Ge=Me-he;if(De!==0||Ge!==0){const Le=((We-ie)*De+(ee-he)*Ge)/(De*De+Ge*Ge);Le>1?(ie=Te,he=Me):Le>0&&(ie+=De*Le,he+=Ge*Le)}return De=We-ie,Ge=ee-he,De*De+Ge*Ge}function yt(We,ee,ie,he){const Te={id:We??null,type:ee,geometry:ie,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")St(Te,ie);else if(ee==="Polygon")St(Te,ie[0]);else if(ee==="MultiLineString")for(const Me of ie)St(Te,Me);else if(ee==="MultiPolygon")for(const Me of ie)St(Te,Me[0]);return Te}function St(We,ee){for(let ie=0;ie<ee.length;ie+=3)We.minX=Math.min(We.minX,ee[ie]),We.minY=Math.min(We.minY,ee[ie+1]),We.maxX=Math.max(We.maxX,ee[ie]),We.maxY=Math.max(We.maxY,ee[ie+1])}function xt(We,ee,ie,he){if(!ee.geometry)return;const Te=ee.geometry.coordinates;if(Te&&Te.length===0)return;const Me=ee.geometry.type,De=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let Ge=[],Le=ee.id;if(ie.promoteId?Le=ee.properties[ie.promoteId]:ie.generateId&&(Le=he||0),Me==="Point")Nt(Te,Ge);else if(Me==="MultiPoint")for(const qe of Te)Nt(qe,Ge);else if(Me==="LineString")jt(Te,Ge,De,!1);else if(Me==="MultiLineString"){if(ie.lineMetrics){for(const qe of Te)Ge=[],jt(qe,Ge,De,!1),We.push(yt(Le,"LineString",Ge,ee.properties));return}Bt(Te,Ge,De,!1)}else if(Me==="Polygon")Bt(Te,Ge,De,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const qe of ee.geometry.geometries)xt(We,{id:Le,geometry:qe,properties:ee.properties},ie,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const qe of Te){const Ze=[];Bt(qe,Ze,De,!0),Ge.push(Ze)}}We.push(yt(Le,Me,Ge,ee.properties))}function Nt(We,ee){ee.push(vi(We[0]),Jt(We[1]),0)}function jt(We,ee,ie,he){let Te,Me,De=0;for(let Le=0;Le<We.length;Le++){const qe=vi(We[Le][0]),Ze=Jt(We[Le][1]);ee.push(qe,Ze,0),Le>0&&(De+=he?(Te*Ze-qe*Me)/2:Math.sqrt(Math.pow(qe-Te,2)+Math.pow(Ze-Me,2))),Te=qe,Me=Ze}const Ge=ee.length-3;ee[2]=1,Ae(ee,0,Ge,ie),ee[Ge+2]=1,ee.size=Math.abs(De),ee.start=0,ee.end=ee.size}function Bt(We,ee,ie,he){for(let Te=0;Te<We.length;Te++){const Me=[];jt(We[Te],Me,ie,he),ee.push(Me)}}function vi(We){return We/360+.5}function Jt(We){const ee=Math.sin(We*Math.PI/180),ie=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ie<0?0:ie>1?1:ie}function At(We,ee,ie,he,Te,Me,De,Ge){if(he/=ee,Me>=(ie/=ee)&&De<he)return We;if(De<ie||Me>=he)return null;const Le=[];for(const qe of We){const Ze=qe.geometry;let Qe=qe.type;const ht=Te===0?qe.minX:qe.minY,Ct=Te===0?qe.maxX:qe.maxY;if(ht>=ie&&Ct<he){Le.push(qe);continue}if(Ct<ie||ht>=he)continue;let zt=[];if(Qe==="Point"||Qe==="MultiPoint")Mi(Ze,zt,ie,he,Te);else if(Qe==="LineString")Ui(Ze,zt,ie,he,Te,!1,Ge.lineMetrics);else if(Qe==="MultiLineString")Li(Ze,zt,ie,he,Te,!1);else if(Qe==="Polygon")Li(Ze,zt,ie,he,Te,!0);else if(Qe==="MultiPolygon")for(const ri of Ze){const di=[];Li(ri,di,ie,he,Te,!0),di.length&&zt.push(di)}if(zt.length){if(Ge.lineMetrics&&Qe==="LineString"){for(const ri of zt)Le.push(yt(qe.id,Qe,ri,qe.tags));continue}Qe!=="LineString"&&Qe!=="MultiLineString"||(zt.length===1?(Qe="LineString",zt=zt[0]):Qe="MultiLineString"),Qe!=="Point"&&Qe!=="MultiPoint"||(Qe=zt.length===3?"Point":"MultiPoint"),Le.push(yt(qe.id,Qe,zt,qe.tags))}}return Le.length?Le:null}function Mi(We,ee,ie,he,Te){for(let Me=0;Me<We.length;Me+=3){const De=We[Me+Te];De>=ie&&De<=he&&zn(ee,We[Me],We[Me+1],We[Me+2])}}function Ui(We,ee,ie,he,Te,Me,De){let Ge=un(We);const Le=Te===0?lr:Pr;let qe,Ze,Qe=We.start;for(let di=0;di<We.length-3;di+=3){const ui=We[di],ci=We[di+1],Zi=We[di+2],ji=We[di+3],Si=We[di+4],qi=Te===0?ui:ci,Xi=Te===0?ji:Si;let $n=!1;De&&(qe=Math.sqrt(Math.pow(ui-ji,2)+Math.pow(ci-Si,2))),qi<ie?Xi>ie&&(Ze=Le(Ge,ui,ci,ji,Si,ie),De&&(Ge.start=Qe+qe*Ze)):qi>he?Xi<he&&(Ze=Le(Ge,ui,ci,ji,Si,he),De&&(Ge.start=Qe+qe*Ze)):zn(Ge,ui,ci,Zi),Xi<ie&&qi>=ie&&(Ze=Le(Ge,ui,ci,ji,Si,ie),$n=!0),Xi>he&&qi<=he&&(Ze=Le(Ge,ui,ci,ji,Si,he),$n=!0),!Me&&$n&&(De&&(Ge.end=Qe+qe*Ze),ee.push(Ge),Ge=un(We)),De&&(Qe+=qe)}let ht=We.length-3;const Ct=We[ht],zt=We[ht+1],ri=Te===0?Ct:zt;ri>=ie&&ri<=he&&zn(Ge,Ct,zt,We[ht+2]),ht=Ge.length-3,Me&&ht>=3&&(Ge[ht]!==Ge[0]||Ge[ht+1]!==Ge[1])&&zn(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&ee.push(Ge)}function un(We){const ee=[];return ee.size=We.size,ee.start=We.start,ee.end=We.end,ee}function Li(We,ee,ie,he,Te,Me){for(const De of We)Ui(De,ee,ie,he,Te,Me,!1)}function zn(We,ee,ie,he){We.push(ee,ie,he)}function lr(We,ee,ie,he,Te,Me){const De=(Me-ee)/(he-ee);return zn(We,Me,ie+(Te-ie)*De,1),De}function Pr(We,ee,ie,he,Te,Me){const De=(Me-ie)/(Te-ie);return zn(We,ee+(he-ee)*De,Me,1),De}function wr(We,ee){const ie=[];for(let he=0;he<We.length;he++){const Te=We[he],Me=Te.type;let De;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")De=Or(Te.geometry,ee);else if(Me==="MultiLineString"||Me==="Polygon"){De=[];for(const Ge of Te.geometry)De.push(Or(Ge,ee))}else if(Me==="MultiPolygon"){De=[];for(const Ge of Te.geometry){const Le=[];for(const qe of Ge)Le.push(Or(qe,ee));De.push(Le)}}ie.push(yt(Te.id,Me,De,Te.tags))}return ie}function Or(We,ee){const ie=[];ie.size=We.size,We.start!==void 0&&(ie.start=We.start,ie.end=We.end);for(let he=0;he<We.length;he+=3)ie.push(We[he]+ee,We[he+1],We[he+2]);return ie}function Ws(We,ee){if(We.transformed)return We;const ie=1<<We.z,he=We.x,Te=We.y;for(const Me of We.features){const De=Me.geometry,Ge=Me.type;if(Me.geometry=[],Ge===1)for(let Le=0;Le<De.length;Le+=2)Me.geometry.push(cr(De[Le],De[Le+1],ee,ie,he,Te));else for(let Le=0;Le<De.length;Le++){const qe=[];for(let Ze=0;Ze<De[Le].length;Ze+=2)qe.push(cr(De[Le][Ze],De[Le][Ze+1],ee,ie,he,Te));Me.geometry.push(qe)}}return We.transformed=!0,We}function cr(We,ee,ie,he,Te,Me){return[Math.round(ie*(We*he-Te)),Math.round(ie*(ee*he-Me))]}function qn(We,ee,ie,he,Te){const Me=ee===Te.maxZoom?0:Te.tolerance/((1<<ee)*Te.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:We.length,source:null,x:ie,y:he,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of We)Lo(De,Ge,Me,Te);return De}function Lo(We,ee,ie,he){const Te=ee.geometry,Me=ee.type,De=[];if(We.minX=Math.min(We.minX,ee.minX),We.minY=Math.min(We.minY,ee.minY),We.maxX=Math.max(We.maxX,ee.maxX),We.maxY=Math.max(We.maxY,ee.maxY),Me==="Point"||Me==="MultiPoint")for(let Ge=0;Ge<Te.length;Ge+=3)De.push(Te[Ge],Te[Ge+1]),We.numPoints++,We.numSimplified++;else if(Me==="LineString")Ti(De,Te,We,ie,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let Ge=0;Ge<Te.length;Ge++)Ti(De,Te[Ge],We,ie,Me==="Polygon",Ge===0);else if(Me==="MultiPolygon")for(let Ge=0;Ge<Te.length;Ge++){const Le=Te[Ge];for(let qe=0;qe<Le.length;qe++)Ti(De,Le[qe],We,ie,!0,qe===0)}if(De.length){let Ge=ee.tags||null;if(Me==="LineString"&&he.lineMetrics){Ge={};for(const qe in ee.tags)Ge[qe]=ee.tags[qe];Ge.mapbox_clip_start=Te.start/Te.size,Ge.mapbox_clip_end=Te.end/Te.size}const Le={geometry:De,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Ge};ee.id!==null&&(Le.id=ee.id),We.features.push(Le)}}function Ti(We,ee,ie,he,Te,Me){const De=he*he;if(he>0&&ee.size<(Te?De:he))return void(ie.numPoints+=ee.length/3);const Ge=[];for(let Le=0;Le<ee.length;Le+=3)(he===0||ee[Le+2]>De)&&(ie.numSimplified++,Ge.push(ee[Le],ee[Le+1])),ie.numPoints++;Te&&function(Le,qe){let Ze=0;for(let Qe=0,ht=Le.length,Ct=ht-2;Qe<ht;Ct=Qe,Qe+=2)Ze+=(Le[Qe]-Le[Ct])*(Le[Qe+1]+Le[Ct+1]);if(Ze>0===qe)for(let Qe=0,ht=Le.length;Qe<ht/2;Qe+=2){const Ct=Le[Qe],zt=Le[Qe+1];Le[Qe]=Le[ht-2-Qe],Le[Qe+1]=Le[ht-1-Qe],Le[ht-2-Qe]=Ct,Le[ht-1-Qe]=zt}}(Ge,Me),We.push(Ge)}const Zs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class uu{constructor(ee,ie){const he=(ie=this.options=function(Me,De){for(const Ge in De)Me[Ge]=De[Ge];return Me}(Object.create(Zs),ie)).debug;if(he&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Te=function(Me,De){const Ge=[];if(Me.type==="FeatureCollection")for(let Le=0;Le<Me.features.length;Le++)xt(Ge,Me.features[Le],De,Le);else xt(Ge,Me.type==="Feature"?Me:{geometry:Me},De);return Ge}(ee,ie);this.tiles={},this.tileCoords=[],he&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=function(Me,De){const Ge=De.buffer/De.extent;let Le=Me;const qe=At(Me,1,-1-Ge,Ge,0,-1,2,De),Ze=At(Me,1,1-Ge,2+Ge,0,-1,2,De);return(qe||Ze)&&(Le=At(Me,1,-Ge,1+Ge,0,-1,2,De)||[],qe&&(Le=wr(qe,1).concat(Le)),Ze&&(Le=Le.concat(wr(Ze,-1)))),Le}(Te,ie),Te.length&&this.splitTile(Te,0,0,0),he&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,ie,he,Te,Me,De,Ge){const Le=[ee,ie,he,Te],qe=this.options,Ze=qe.debug;for(;Le.length;){Te=Le.pop(),he=Le.pop(),ie=Le.pop(),ee=Le.pop();const Qe=1<<ie,ht=Fr(ie,he,Te);let Ct=this.tiles[ht];if(!Ct&&(Ze>1&&console.time("creation"),Ct=this.tiles[ht]=qn(ee,ie,he,Te,qe),this.tileCoords.push({z:ie,x:he,y:Te}),Ze)){Ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,he,Te,Ct.numFeatures,Ct.numPoints,Ct.numSimplified),console.timeEnd("creation"));const $n=`z${ie}`;this.stats[$n]=(this.stats[$n]||0)+1,this.total++}if(Ct.source=ee,Me==null){if(ie===qe.indexMaxZoom||Ct.numPoints<=qe.indexMaxPoints)continue}else{if(ie===qe.maxZoom||ie===Me)continue;if(Me!=null){const $n=Me-ie;if(he!==De>>$n||Te!==Ge>>$n)continue}}if(Ct.source=null,ee.length===0)continue;Ze>1&&console.time("clipping");const zt=.5*qe.buffer/qe.extent,ri=.5-zt,di=.5+zt,ui=1+zt;let ci=null,Zi=null,ji=null,Si=null,qi=At(ee,Qe,he-zt,he+di,0,Ct.minX,Ct.maxX,qe),Xi=At(ee,Qe,he+ri,he+ui,0,Ct.minX,Ct.maxX,qe);ee=null,qi&&(ci=At(qi,Qe,Te-zt,Te+di,1,Ct.minY,Ct.maxY,qe),Zi=At(qi,Qe,Te+ri,Te+ui,1,Ct.minY,Ct.maxY,qe),qi=null),Xi&&(ji=At(Xi,Qe,Te-zt,Te+di,1,Ct.minY,Ct.maxY,qe),Si=At(Xi,Qe,Te+ri,Te+ui,1,Ct.minY,Ct.maxY,qe),Xi=null),Ze>1&&console.timeEnd("clipping"),Le.push(ci||[],ie+1,2*he,2*Te),Le.push(Zi||[],ie+1,2*he,2*Te+1),Le.push(ji||[],ie+1,2*he+1,2*Te),Le.push(Si||[],ie+1,2*he+1,2*Te+1)}}getTile(ee,ie,he){ee=+ee,ie=+ie,he=+he;const Te=this.options,{extent:Me,debug:De}=Te;if(ee<0||ee>24)return null;const Ge=1<<ee,Le=Fr(ee,ie=ie+Ge&Ge-1,he);if(this.tiles[Le])return Ws(this.tiles[Le],Me);De>1&&console.log("drilling down to z%d-%d-%d",ee,ie,he);let qe,Ze=ee,Qe=ie,ht=he;for(;!qe&&Ze>0;)Ze--,Qe>>=1,ht>>=1,qe=this.tiles[Fr(Ze,Qe,ht)];return qe&&qe.source?(De>1&&(console.log("found parent tile z%d-%d-%d",Ze,Qe,ht),console.time("drilling down")),this.splitTile(qe.source,Ze,Qe,ht,ee,ie,he),De>1&&console.timeEnd("drilling down"),this.tiles[Le]?Ws(this.tiles[Le],Me):null):null}}function Fr(We,ee,ie){return 32*((1<<We)*ie+ee)+We}function la(We,ee){const ie=We.tileID.canonical;if(!this._geoJSONIndex)return void ee(null,null);const he=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!he)return void ee(null,null);const Te=new ct(he.features);let Me=ir(Te);Me.byteOffset===0&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),ee(null,{vectorTile:Te,rawData:Me.buffer})}class ec extends Fe{constructor(ee,ie,he,Te,Me,De){super(ee,ie,he,Te,la,De),Me&&(this.loadGeoJSON=Me),this._dynamicIndex=new Ut}loadData(ee,ie){const he=ee&&ee.request,Te=he&&he.collectResourceTiming;this.loadGeoJSON(ee,(Me,De)=>{if(Me||!De)return ie(Me);if(typeof De!="object")return ie(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{try{if(ee.filter){const Le=i.U(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(qe=>`${qe.key}: ${qe.message}`).join(", "));De.features=De.features.filter(qe=>Le.value.evaluate({zoom:0},qe))}ee.dynamic?(De.type==="Feature"&&(De={type:"FeatureCollection",features:[De]}),ee.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(De.features,this.loaded),ee.cluster&&(De.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ee.cluster?new ti(function({superclusterOptions:Le,clusterProperties:qe}){if(!qe||!Le)return Le;const Ze={},Qe={},ht={accumulated:null,zoom:0},Ct={properties:null},zt=Object.keys(qe);for(const ri of zt){const[di,ui]=qe[ri],ci=i.U(ui),Zi=i.U(typeof di=="string"?[di,["accumulated"],["get",ri]]:di);Ze[ri]=ci.value,Qe[ri]=Zi.value}return Le.map=ri=>{Ct.properties=ri;const di={};for(const ui of zt)di[ui]=Ze[ui].evaluate(ht,Ct);return di},Le.reduce=(ri,di)=>{Ct.properties=di;for(const ui of zt)ht.accumulated=ri[ui],ri[ui]=Qe[ui].evaluate(ht,Ct)},Le}(ee)).load(De.features):ee.dynamic?this._dynamicIndex:function(Le,qe){return new uu(Le,qe)}(De,ee.geojsonVtOptions)}catch(Le){return ie(Le)}const Ge={};if(Te){const Le=R(he);Le&&(Ge.resourceTiming={},Ge.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Le)))}ie(null,Ge)}})}reloadTile(ee,ie){const he=this.loaded;return he&&he[ee.uid]?ee.partial?ie(null,void 0):super.reloadTile(ee,ie):this.loadTile(ee,ie)}loadGeoJSON(ee,ie){if(ee.request)i.n(ee.request,ie);else{if(typeof ee.data!="string")return ie(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(ee.data))}catch{return ie(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ee,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(he){ie(he)}}getClusterChildren(ee,ie){try{ie(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(he){ie(he)}}getClusterLeaves(ee,ie){try{ie(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(he){ie(he)}}}class tc{constructor(ee,ie){this.tileID=new i.aG(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=ie}parse(ee,ie,he,Te){this.status="parsing";const Me=new i.aG(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),De=[],Ge=ie.familiesBySource[he.source],Le=new i.dZ(Me,he.promoteId);return Le.bucketLayerIDs=[],Le.is3DTile=!0,i.e9(ee).then(qe=>{if(!qe)return Te(new Error("Could not parse tile"));const Ze=i.ea(qe,1/i.cc(he.tileID.canonical)),Qe=qe.json.extensionsUsed&&qe.json.extensionsUsed.includes("MAPBOX_mesh_features")||qe.json.asset.extras&&qe.json.asset.extras.MAPBOX_mesh_features,ht=qe.json.extensionsUsed&&qe.json.extensionsUsed.includes("EXT_meshopt_compression"),Ct=new i.a8(this.zoom,{brightness:this.brightness});for(const zt in Ge)for(const ri of Ge[zt]){const di=ri[0];Le.bucketLayerIDs.push(ri.map(ci=>i.aC(ci.id,ci.scope))),di.recalculate(Ct,[]);const ui=new i.eb(ri,Ze,Me,Qe,ht,this.brightness,Le);Qe||(ui.needsUpload=!0),De.push(ui),ui.evaluate(di)}this.status="done",Te(null,{buckets:De,featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(qe=>Te(new Error(qe.message)))}}class Xa{constructor(ee,ie,he,Te,Me,De){this.actor=ee,this.layerIndex=ie,this.availableImages=he,this.brightness=De,this.loading={},this.loaded={}}loadTile(ee,ie){const he=ee.uid,Te=this.loading[he]=new tc(ee,this.brightness);i.bi(ee.request,(Me,De)=>{const Ge=!this.loading[he];return delete this.loading[he],Ge||Me?(Te.status="done",Ge||(this.loaded[he]=Te),ie(Me)):De&&De.byteLength!==0?void Te.parse(De,this.layerIndex,ee,(Le,qe)=>{Te.status="done",this.loaded=this.loaded||{},this.loaded[he]=Te,Le||!qe?ie(Le):ie(null,qe)}):(Te.status="done",this.loaded[he]=Te,ie())})}reloadTile(ee,ie){const he=this.loaded,Te=ee.uid;if(he&&he[Te]){const Me=he[Te];Me.projection=ee.projection,Me.brightness=ee.brightness;const De=(Ge,Le)=>{Me.reloadCallback&&(delete Me.reloadCallback,this.loadTile(ee,ie)),ie(Ge,Le)};Me.status==="parsing"?Me.reloadCallback=De:Me.status==="done"&&this.loadTile(ee,ie)}}abortTile(ee,ie){const he=ee.uid;this.loading[he]&&delete this.loading[he],ie()}removeTile(ee,ie){const he=this.loaded,Te=ee.uid;he&&he[Te]&&delete he[Te],ie()}}class ic{constructor(ee){this.self=ee,this.actor=new i.ec(ee,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new i.I,this.projections={},this.defaultProjection=i.bP({name:"mercator"}),this.workerSourceTypes={vector:Fe,geojson:ec,"batched-model":Xa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,he)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=he},this.self.registerRTLTextPlugin=ie=>{if(i.ed.isParsed())throw new Error("RTL text plugin already registered.");i.ed.applyArabicShaping=ie.applyArabicShaping,i.ed.processBidirectionalText=ie.processBidirectionalText,i.ed.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(ee,ie,he){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee],delete this.rasterArrayWorkerSource,he()}checkIfReady(ee,ie,he){he()}setReferrer(ee,ie){this.referrer=ie}spriteLoaded(ee,{scope:ie,isLoaded:he}){if(this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),this.isSpriteLoaded[ee][ie]=he,this.workerSources[ee]&&this.workerSources[ee][ie])for(const Te in this.workerSources[ee][ie]){const Me=this.workerSources[ee][ie][Te];for(const De in Me){const Ge=Me[De];Ge instanceof Fe&&(Ge.isSpriteLoaded=he,Ge.fire(new i.z("isSpriteLoaded")))}}}setImages(ee,{scope:ie,images:he},Te){if(this.availableImages[ee]||(this.availableImages[ee]={}),this.availableImages[ee][ie]=he,this.workerSources[ee]&&this.workerSources[ee][ie]){for(const Me in this.workerSources[ee][ie]){const De=this.workerSources[ee][ie][Me];for(const Ge in De)De[Ge].availableImages=he}Te()}else Te()}setProjection(ee,ie){this.projections[ee]=i.bP(ie)}setBrightness(ee,ie,he){this.brightness=ie,he()}setLayers(ee,ie,he){this.getLayerIndex(ee,ie.scope).replace(ie.layers,ie.options),he()}updateLayers(ee,ie,he){this.getLayerIndex(ee,ie.scope).update(ie.layers,ie.removedIds,ie.options),he()}loadTile(ee,ie,he){ie.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,ie.type,ie.source,ie.scope).loadTile(ie,he)}loadDEMTile(ee,ie,he){this.getDEMWorkerSource(ee,ie.source,ie.scope).loadTile(ie,he)}decodeRasterArray(ee,ie,he){this.getRasterArrayWorkerSource().decodeRasterArray(ie,he)}reloadTile(ee,ie,he){ie.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,ie.type,ie.source,ie.scope).reloadTile(ie,he)}abortTile(ee,ie,he){this.getWorkerSource(ee,ie.type,ie.source,ie.scope).abortTile(ie,he)}removeTile(ee,ie,he){this.getWorkerSource(ee,ie.type,ie.source,ie.scope).removeTile(ie,he)}removeSource(ee,ie,he){if(!(this.workerSources[ee]&&this.workerSources[ee][ie.scope]&&this.workerSources[ee][ie.scope][ie.type]&&this.workerSources[ee][ie.scope][ie.type][ie.source]))return;const Te=this.workerSources[ee][ie.scope][ie.type][ie.source];delete this.workerSources[ee][ie.scope][ie.type][ie.source],Te.removeSource!==void 0?Te.removeSource(ie,he):he()}loadWorkerSource(ee,ie,he){try{this.self.importScripts(ie.url),he()}catch(Te){he(Te.toString())}}syncRTLPluginState(ee,ie,he){try{i.ed.setState(ie);const Te=i.ed.getPluginURL();if(i.ed.isLoaded()&&!i.ed.isParsed()&&Te!=null){this.self.importScripts(Te);const Me=i.ed.isParsed();he(Me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Te}`),Me)}}catch(Te){he(Te.toString())}}setDracoUrl(ee,ie){this.dracoUrl=ie}getAvailableImages(ee,ie){this.availableImages[ee]||(this.availableImages[ee]={});let he=this.availableImages[ee][ie];return he||(he=[]),he}getLayerIndex(ee,ie){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let he=this.layerIndexes[ee][ie];return he||(he=this.layerIndexes[ee][ie]=new W,he.scope=ie),he}getWorkerSource(ee,ie,he,Te){return this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][Te]||(this.workerSources[ee][Te]={}),this.workerSources[ee][Te][ie]||(this.workerSources[ee][Te][ie]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),this.workerSources[ee][Te][ie][he]||(this.workerSources[ee][Te][ie][he]=new this.workerSourceTypes[ie]({send:(Me,De,Ge,Le,qe,Ze)=>{this.actor.send(Me,De,Ge,ee,qe,Ze)},scheduler:this.actor.scheduler},this.getLayerIndex(ee,Te),this.getAvailableImages(ee,Te),this.isSpriteLoaded[ee][Te],void 0,this.brightness)),this.workerSources[ee][Te][ie][he]}rasterizeImages(ee,ie,he){const{imageTasks:Te,scope:Me}=ie,De={};for(const Ge in Te){const{image:Le,imageIdWithOptions:qe}=Te[Ge];De[Ge]=this.imageRasterizer.rasterize(qe,Le,Me,ee)}he(void 0,De)}removeRasterizedImages(ee,ie,he){const{imageIds:Te,scope:Me}=ie;this.imageRasterizer.removeImagesFromCacheByIds(Te,Me,ee),he()}getDEMWorkerSource(ee,ie,he){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][he]||(this.demWorkerSources[ee][he]={}),this.demWorkerSources[ee][he][ie]||(this.demWorkerSources[ee][he][ie]=new Be),this.demWorkerSources[ee][he][ie]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ke),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ee,ie){i.ee(ie)}getWorkerPerformanceMetrics(ee,ie,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ic(self)),ic}),b(["./shared"],function(i){var R="3.9.2";const V={create:"create",load:"load",fullLoad:"fullLoad"},j={mark(h){performance.mark(h)},measure(h,t,s){performance.measure(h,t,s)}};function W(h){const t=h.name.split("?")[0];return i.a(t)&&t.includes("mapbox-gl.js")?"javascript":i.a(t)&&t.includes("mapbox-gl.css")?"css":i.b(t)?"fontRange":i.c(t)?"sprite":i.i(t)?"style":i.d(t)?"tilejson":"other"}var te,ne={},ge=function(){if(te)return ne;function h(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,w,C=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(C);try{w=new Worker(z),y=!0}catch{y=!1}return w&&w.terminate(),URL.revokeObjectURL(z),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var w=y.getContext("2d");if(!w)return!1;var C=w.getImageData(0,0,1,1);return C&&C.width===y.width}()?(s[_=d&&d.failIfMajorPerformanceCaveat]===void 0&&(s[_]=function(y){var w,C=function(z){var L=document.createElement("canvas"),k=Object.create(h.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=z,L.getContext("webgl2",k)}(y);if(!C)return!1;try{w=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!w||C.isContextLost())&&(C.shaderSource(w,"void main() {}"),C.compileShader(w),C.getShaderParameter(w,C.COMPILE_STATUS)===!0)}(_)),s[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}te=1,ne.supported=h,ne.notSupportedReason=t;var s={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ne}();function xe(h,t,s){const d=document.createElement(h);return t!=null&&(d.className=t),s&&s.appendChild(d),d}function Fe(h,t,s){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(t))d.setAttributeNS(null,_,String(t[_]));return s&&s.appendChild(d),d}const Be=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ke=Be&&Be.userSelect!==void 0?"userSelect":"WebkitUserSelect";let at;function Ye(){Be&&Ke&&(at=Be[Ke],Be[Ke]="none")}function ct(){Be&&Ke&&(Be[Ke]=at)}function Lt(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",Lt,!0)}function rt(){window.addEventListener("click",Lt,!0),window.setTimeout(()=>{window.removeEventListener("click",Lt,!0)},0)}function Ut(h,t){const s=h.getBoundingClientRect();return Pt(h,s,t)}function si(h,t){const s=h.getBoundingClientRect(),d=[];for(let _=0;_<t.length;_++)d.push(Pt(h,s,t[_]));return d}function It(h){return window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Pt(h,t,s){const d=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new i.P((s.clientX-t.left)*d,(s.clientY-t.top)*d)}const Ii="01",tn="NO_ACCESS_TOKEN";class Fn{constructor(t,s,d){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=function(){let s="";for(let d=0;d<10;d++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ii,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!i.f(t))return t;const d=mi(t);return d.params.push(`sdk=js-${R}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!i.f(t))return t;const d=mi(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeModelURL(t,s){if(!i.f(t))return t;const d=mi(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeSourceURL(t,s,d,_){if(!i.f(t))return t;const y=mi(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),d&&y.params.push(`language=${d}`),_&&y.params.push(`worldview=${_}`),this._makeAPIURL(y,this._customAccessToken||s)}normalizeIconsetURL(t,s){const d=mi(t);return i.f(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||s)):pi(d)}normalizeSpriteURL(t,s,d,_){const y=mi(t);return i.f(t)?(y.path=`/styles/v1${y.path}/sprite${s}${d}`,this._makeAPIURL(y,this._customAccessToken||_)):(y.path+=`${s}${d}`,pi(y))}normalizeTileURL(t,s,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!i.f(t))return t;const _=mi(t);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||d&&_.authority!=="raster"&&d===512?"@2x":""}${i.m.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${i.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${i.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${i.e.TILE_URL_VERSION}${_.path}`);const y=this._customAccessToken||function(w){for(const C of w){const z=C.match(/^access_token=(.*)$/);if(z)return z[1]}return null}(_.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,y)}canonicalizeTileURL(t,s){const d=mi(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let _="mapbox://";d.path.match(/^\/raster\/v1\//)?_+=`raster/${d.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${d.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${d.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let y=d.params;return s&&(y=y.filter(w=>!w.match(/^access_token=/))),y.length&&(_+=`?${y.join("&")}`),_}canonicalizeTileset(t,s){const d=!!s&&i.f(s),_=[];for(const y of t.tiles||[])i.h(y)?_.push(this.canonicalizeTileURL(y,d)):_.push(y);return _}_makeAPIURL(t,s){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=mi(i.e.API_URL);if(t.protocol=_.protocol,t.authority=_.authority,t.protocol==="http"){const y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(_.path!=="/"&&(t.path=`${_.path}${t.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return pi(t);if(s=s||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(y=>y.indexOf("access_token")===-1),t.params.push(`access_token=${s||""}`),pi(t)}}const Gt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function mi(h){const t=h.match(Gt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function pi(h){const t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}const Di="mapbox.eventData";function qt(h){if(!h)return null;const t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(i.j(t[1]))}catch{return null}}class Hn{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=qt(i.e.ACCESS_TOKEN);let d="";return d=s&&s.u?i.k(s.u):i.e.ACCESS_TOKEN||"",t?`${Di}.${t}:${d}`:`${Di}:${d}`}fetchEventData(){const t=i.s("localStorage"),s=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{const _=localStorage.getItem(s);_&&(this.eventData=JSON.parse(_));const y=localStorage.getItem(d);y&&(this.anonId=y)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const t=i.s("localStorage"),s=this.getStorageKey(),d=this.getStorageKey("uuid"),_=this.anonId;if(t&&_)try{localStorage.setItem(d,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,d,_){if(!i.e.EVENTS_URL)return;const y=mi(i.e.EVENTS_URL);y.params.push(`access_token=${_||i.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(t).toISOString()},C=s?i.l(w,s):w,z={url:pi(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=i.p(z,L=>{this.pendingRequest=null,d(L),this.saveEventData(),this.processRequests(_)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const ir=new class extends Hn{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(s=>i.f(s)||i.h(s))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=qt(i.e.ACCESS_TOKEN),s=t?t.u:i.e.ACCESS_TOKEN;let d=s!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),d=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),w=new Date(_),C=(_-this.eventData.lastSuccess)/864e5;d=d||C>=1||C<-1||y.getDate()!==w.getDate()}else d=!0;d?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:Ii,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=_,this.eventData.tokenU=s)},h):this.processRequests()}},Sn=ir.postTurnstileEvent.bind(ir),Qt=new class extends Hn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,s,d){this.skuToken=t,this.errorCb=d,i.e.EVENTS_URL&&(s||i.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},s):this.errorCb(new Error(tn)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:Ii,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},h))}remove(){this.errorCb=null}},ar=Qt.postMapLoadEvent.bind(Qt),Qn=new class extends Hn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=i.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){const t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){const{map:s,style:d,importedStyles:_}=t;if(!i.e.EVENTS_URL||!h&&!i.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(s),w={mapInstanceId:y,eventId:this.getEventId(y),style:d};_.length&&(w.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:w},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,()=>{},h)}},mn=Qn.postStyleLoadEvent.bind(Qn),Mt=new class extends Hn{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){i.e.EVENTS_URL&&(h||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),d=function(_){const y=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),C=function(G){const Y={};if(G){for(const X in G)if(X!=="other")for(const J of G[X]){const Q=`${X}ResolveRangeMin`,re=`${X}ResolveRangeMax`,ue=`${X}RequestCount`,le=`${X}RequestCachedCount`;Y[Q]=Math.min(Y[Q]||1/0,J.startTime),Y[re]=Math.max(Y[re]||-1/0,J.responseEnd);const _e=fe=>{Y[fe]===void 0&&(Y[fe]=0),++Y[fe]};J.transferSize!==void 0&&J.transferSize===0&&_e(le),_e(ue)}}return Y}(function(G,Y){const X={};if(G)for(const J of G){const Q=Y(J);X[Q]===void 0&&(X[Q]=[]),X[Q].push(J)}return X}(y,W)),z=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=L?L.effectiveType:void 0,N={counters:[],metadata:[],attributes:[]},B=(G,Y,X)=>{X!=null&&G.push({name:Y,value:X.toString()})};for(const G in C)B(N.counters,G,C[G]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(B(N.counters,"interactionRangeMin",_.interactionRange[0]),B(N.counters,"interactionRangeMax",_.interactionRange[1])),w)for(const G of Object.keys(V)){const Y=V[G],X=w.find(J=>J.name===Y);X&&B(N.counters,Y,X.startTime)}return B(N.counters,"visibilityHidden",_.visibilityHidden),B(N.attributes,"style",function(G){if(G)for(const Y of G){const X=Y.name.split("?")[0];if(i.i(X)){const J=X.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}}(y)),B(N.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),B(N.attributes,"fogEnabled",_.fogEnabled?"true":"false"),B(N.attributes,"projection",_.projection),B(N.attributes,"zoom",_.zoom),B(N.metadata,"devicePixelRatio",z),B(N.metadata,"connectionEffectiveType",k),B(N.metadata,"navigatorUserAgent",navigator.userAgent),B(N.metadata,"screenWidth",window.screen.width),B(N.metadata,"screenHeight",window.screen.height),B(N.metadata,"windowWidth",window.innerWidth),B(N.metadata,"windowHeight",window.innerHeight),B(N.metadata,"mapWidth",_.width/z),B(N.metadata,"mapHeight",_.height/z),B(N.metadata,"webglRenderer",_.renderer),B(N.metadata,"webglVendor",_.vendor),B(N.metadata,"sdkVersion",R),B(N.metadata,"sdkIdentifier","mapbox-gl-js"),N}(s);for(const _ of d.metadata);for(const _ of d.counters);for(const _ of d.attributes);this.postEvent(t,d,()=>{},h)}},ti=Mt.postPerformanceEvent.bind(Mt),Xt=new class extends Hn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,s,d){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const _=mi(i.e.API_URL+i.e.SESSION_PATH);_.params.push(`sku=${t||""}`),_.params.push(`access_token=${d||i.e.ACCESS_TOKEN||""}`);const y={url:pi(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(y,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(d)})}getSessionAPI(h,t,s,d){this.skuToken=t,this.errorCb=d,i.e.SESSION_PATH&&i.e.API_URL&&(s||i.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},s):this.errorCb(new Error(tn)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},h)}remove(){this.errorCb=null}},me=Xt.getSessionAPI.bind(Xt),nn=new Set;function ke(h,t){t?nn.add(h):nn.delete(h)}class Ue{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ae(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class bt extends i.E{constructor(t){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.I),this._imageRasterizer}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new i.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,s){if(this.loaded[s]!==t&&(this.loaded[s]=t,t)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,s,_);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return this.images[s][t]}addImage(t,s,d){this._validate(t,d)&&(this.images[s][t]=d)}_validate(t,s){let d=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new i.y(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new i.y(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(s.content,s)||(this.fire(new i.y(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,s){if(!t)return!0;let d=0;for(const _ of t){if(_[0]<d||_[1]<_[0]||s<_[1])return!1;d=_[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,d){d.version=this.images[s][t].version+1,this.images[s][t]=d,this.updatedImages[s][t]=!0,this.removeFromImageRasterizerCache(t,s)}removeFromImageRasterizerCache(t,s){this.spriteFormat!=="raster"&&(i.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([t],s))}removeImage(t,s){const d=this.images[s][t];delete this.images[s][t],delete this.patterns[s][t],this.removeFromImageRasterizerCache(t,s),d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,s,d){let _=!0;const y=!!this.loaded[s];if(!y)for(const w of t)this.images[s][w]||(_=!1);y||_?this._notify(t,s,d):this.requestors.push({ids:t,scope:s,callback:d})}rasterizeImages({scope:t,imageTasks:s},d){const _={};for(const y in s){const w=s[y],C=this.getImage(w.id,t);C&&(_[y]={image:C,imageIdWithOptions:w})}i.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:_,scope:t},d):this.rasterizeImagesInMainThread({imageTasks:_,scope:t},d)}rasterizeImagesInMainThread(t,s){const{imageTasks:d,scope:_}=t,y={};for(const w in d){const{image:C,imageIdWithOptions:z}=d[w];y[w]=this.imageRasterizer.rasterize(z,C,_,"")}s(void 0,y)}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,s,d){const _={};for(const y of t){this.images[s][y]||this.fire(new i.z("styleimagemissing",{id:y}));const w=this.images[s][y];w?_[y]={data:w.usvg?null:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,usvg:w.usvg,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:i.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(t){const{width:s,height:d}=this.atlasImage[t];return{width:s,height:d}}getPattern(t,s,d){const _=this.patterns[s][t],y=this.getImage(t,s);if(!y)return null;if(_&&_.position.version===y.version)return _.position;if(_)_.position.version=y.version;else{y.usvg&&!y.data&&(y.data=this.imageRasterizer.rasterize(i.A.from(t).getPrimary(),y,s,""));const w={w:y.data.width+2*i.B,h:y.data.height+2*i.B,x:0,y:0},C=new i.F(w,y,i.B);this.patterns[s][t]={bin:w,position:C}}return this._updatePatternAtlas(s,d),this.patterns[s][t].position}bind(t,s){const d=t.gl;let _=this.atlasTexture[s];_?this.dirty&&(_.update(this.atlasImage[s]),this.dirty=!1):(_=new i.T(t,this.atlasImage[s],d.RGBA8),this.atlasTexture[s]=_),_.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const d=[];for(const C in this.patterns[t])d.push(this.patterns[t][C].bin);const{w:_,h:y}=i.C(d),w=this.atlasImage[t];w.resize({width:_||1,height:y||1});for(const C in this.patterns[t]){const{bin:z,position:L}=this.patterns[t][C];let k=L.padding;const N=z.x+k,B=z.y+k,G=this.images[t][C].data,Y=G.width,X=G.height;k=k>1?k-1:k,i.r.copy(G,w,{x:0,y:0},{x:N,y:B},{width:Y,height:X},s),i.r.copy(G,w,{x:0,y:X-k},{x:N,y:B-k},{width:Y,height:k},s),i.r.copy(G,w,{x:0,y:0},{x:N,y:B+X},{width:Y,height:k},s),i.r.copy(G,w,{x:Y-k,y:0},{x:N-k,y:B},{width:k,height:X},s),i.r.copy(G,w,{x:0,y:0},{x:N+Y,y:B},{width:k,height:X},s),i.r.copy(G,w,{x:Y-k,y:X-k},{x:N-k,y:B-k},{width:k,height:k},s),i.r.copy(G,w,{x:0,y:X-k},{x:N+Y,y:B-k},{width:k,height:k},s),i.r.copy(G,w,{x:0,y:0},{x:N+Y,y:B+X},{width:k,height:k},s),i.r.copy(G,w,{x:Y-k,y:0},{x:N-k,y:B+X},{width:k,height:k},s)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,s){for(const d of t){if(this.callbackDispatchedThisFrame[s][d])continue;this.callbackDispatchedThisFrame[s][d]=!0;const _=this.images[s][d];Ae(_)&&this.updateImage(d,s,_)}}}function yt(h){const t=h.key,s=h.value,d=h.valueSpec||{},_=h.objectElementValidators||{},y=h.style,w=h.styleSpec;let C=[];const z=i.H(s);if(z!=="object")return[new i.V(t,s,`object expected, ${z} found`)];for(const L in s){const k=L.split(".")[0];let N;_[k]?N=_[k]:d[k]?N=Ti:_["*"]?N=_["*"]:d["*"]&&(N=Ti),N?C=C.concat(N({key:(t&&`${t}.`)+L,value:s[L],valueSpec:d[k]||d["*"],style:y,styleSpec:w,object:s,objectKey:L},s)):C.push(new i.G(t,s[L],`unknown property "${L}"`))}for(const L in d)_[L]||d[L].required&&d[L].default===void 0&&s[L]===void 0&&C.push(new i.V(t,s,`missing required property "${L}"`));return C}function St(h){const t=h.value,s=h.valueSpec,d=h.style,_=h.styleSpec,y=h.key,w=h.arrayElementValidator||Ti;if(i.H(t)!=="array")return[new i.V(y,t,`array expected, ${i.H(t)} found`)];if(s.length&&t.length!==s.length)return[new i.V(y,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new i.V(y,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let C={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};_.$version<7&&(C.function=s.function),i.H(s.value)==="object"&&(C=s.value);let z=[];for(let L=0;L<t.length;L++)z=z.concat(w({array:t,arrayIndex:L,value:t[L],valueSpec:C,style:d,styleSpec:_,key:`${y}[${L}]`},!0));return z}function xt(h){const t=h.key,s=h.value,d=h.valueSpec;let _=i.H(s);if(_==="number"&&s!=s&&(_="NaN"),_!=="number")return[new i.V(t,s,`number expected, ${_} found`)];if("minimum"in d){let y=d.minimum;if(i.H(d.minimum)==="array"&&(y=d.minimum[h.arrayIndex]),s<y)return[new i.V(t,s,`${s} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if(i.H(d.maximum)==="array"&&(y=d.maximum[h.arrayIndex]),s>y)return[new i.V(t,s,`${s} is greater than the maximum value ${y}`)]}return[]}function Nt(h){const t=h.valueSpec,s=i.K(h.value.type);let d,_,y,w={};const C=s!=="categorical"&&h.value.property===void 0,z=!C,L=i.H(h.value.stops)==="array"&&i.H(h.value.stops[0])==="array"&&i.H(h.value.stops[0][0])==="object",k=yt({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(G){if(s==="identity")return[new i.V(G.key,G.value,'identity function may not have a "stops" property')];let Y=[];const X=G.value;return Y=Y.concat(St({key:G.key,value:X,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:N})),i.H(X)==="array"&&X.length===0&&Y.push(new i.V(G.key,X,"array must have at least one stop")),Y},default:function(G){return Ti({key:G.key,value:G.value,valueSpec:t,style:G.style,styleSpec:G.styleSpec})}}});return s==="identity"&&C&&k.push(new i.V(h.key,h.value,'missing required property "property"')),s==="identity"||h.value.stops||k.push(new i.V(h.key,h.value,'missing required property "stops"')),s==="exponential"&&h.valueSpec.expression&&!i.L(h.valueSpec)&&k.push(new i.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(z&&!i.M(h.valueSpec)?k.push(new i.V(h.key,h.value,"property functions not supported")):C&&!i.N(h.valueSpec)&&k.push(new i.V(h.key,h.value,"zoom functions not supported"))),s!=="categorical"&&!L||h.value.property!==void 0||k.push(new i.V(h.key,h.value,'"property" property is required')),k;function N(G){let Y=[];const X=G.value,J=G.key;if(i.H(X)!=="array")return[new i.V(J,X,`array expected, ${i.H(X)} found`)];if(X.length!==2)return[new i.V(J,X,`array length 2 expected, length ${X.length} found`)];if(L){if(i.H(X[0])!=="object")return[new i.V(J,X,`object expected, ${i.H(X[0])} found`)];if(X[0].zoom===void 0)return[new i.V(J,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new i.V(J,X,"object stop key must have value")];const Q=i.K(X[0].zoom);if(typeof Q!="number")return[new i.V(J,X[0].zoom,"stop zoom values must be numbers")];if(y&&y>Q)return[new i.V(J,X[0].zoom,"stop zoom values must appear in ascending order")];Q!==y&&(y=Q,_=void 0,w={}),Y=Y.concat(yt({key:`${J}[0]`,value:X[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:xt,value:B}}))}else Y=Y.concat(B({key:`${J}[0]`,value:X[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},X));return i.O(i.Q(X[1]))?Y.concat([new i.V(`${J}[1]`,X[1],"expressions are not allowed in function stops.")]):Y.concat(Ti({key:`${J}[1]`,value:X[1],valueSpec:t,style:G.style,styleSpec:G.styleSpec}))}function B(G,Y){const X=i.H(G.value),J=i.K(G.value),Q=G.value!==null?G.value:Y;if(d){if(X!==d)return[new i.V(G.key,Q,`${X} stop domain type must match previous stop domain type ${d}`)]}else d=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof J!="number"&&typeof J!="string"&&typeof J!="boolean")return[new i.V(G.key,Q,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&s!=="categorical"){let re=`number expected, ${X} found`;return i.M(t)&&s===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(G.key,Q,re)]}return s!=="categorical"||X!=="number"||typeof J=="number"&&isFinite(J)&&Math.floor(J)===J?s!=="categorical"&&X==="number"&&typeof J=="number"&&typeof _=="number"&&_!==void 0&&J<_?[new i.V(G.key,Q,"stop domain values must appear in ascending order")]:(_=J,s==="categorical"&&J in w?[new i.V(G.key,Q,"stop domain values must be unique")]:(w[J]=!0,[])):[new i.V(G.key,Q,`integer expected, found ${String(J)}`)]}}function jt(h){const t=(h.expressionContext==="property"?i.S:i.U)(i.Q(h.value),h.valueSpec);if(t.result==="error")return t.value.map(d=>new i.V(`${h.key}${d.key}`,h.value,d.message));const s=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!s.outputDefined())return[new i.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!i.W(s))return[new i.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return Bt(s,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!i.X(s,["zoom","feature-state"]))return[new i.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!i.Y(s))return[new i.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bt(h,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const _ of t.valueSpec.expression.parameters)s.delete(_);if(s.size===0)return[];const d=[];return h instanceof i.Z&&s.has(h.name)?[new i.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild(_=>{d.push(...Bt(_,t))}),d)}function vi(h){const t=h.key,s=h.value,d=h.valueSpec,_=[];return Array.isArray(d.values)?d.values.indexOf(i.K(s))===-1&&_.push(new i.V(t,s,`expected one of [${d.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(d.values).indexOf(i.K(s))===-1&&_.push(new i.V(t,s,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(s)} found`)),_}function Jt(h){return i.$(i.Q(h.value))?jt(i.J({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):At(h)}function At(h){const t=h.value,s=h.key;if(i.H(t)!=="array")return[new i.V(s,t,`array expected, ${i.H(t)} found`)];const d=h.styleSpec;let _,y=[];if(t.length<1)return[new i.V(s,t,"filter array must have at least 1 element")];switch(y=y.concat(vi({key:`${s}[0]`,value:t[0],valueSpec:d.filter_operator,style:h.style,styleSpec:h.styleSpec})),i.K(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&i.K(t[1])==="$type"&&y.push(new i.V(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new i.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(_=i.H(t[1]),_!=="string"&&y.push(new i.V(`${s}[1]`,t[1],`string expected, ${_} found`)));for(let w=2;w<t.length;w++)_=i.H(t[w]),i.K(t[1])==="$type"?y=y.concat(vi({key:`${s}[${w}]`,value:t[w],valueSpec:d.geometry_type,style:h.style,styleSpec:h.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&y.push(new i.V(`${s}[${w}]`,t[w],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let w=1;w<t.length;w++)y=y.concat(At({key:`${s}[${w}]`,value:t[w],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":_=i.H(t[1]),t.length!==2?y.push(new i.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):_!=="string"&&y.push(new i.V(`${s}[1]`,t[1],`string expected, ${_} found`))}return y}function Mi(h,t){const s=h.key,d=h.style,_=h.layer,y=h.styleSpec,w=h.value,C=h.objectKey,z=y[`${t}_${h.layerType}`];if(!z)return[];const L=C.match(/^(.*)-use-theme$/);if(t==="paint"&&L&&z[L[1]])return Ti({key:s,value:w,valueSpec:{type:"string"},style:d,styleSpec:y});const k=C.match(/^(.*)-transition$/);if(t==="paint"&&k&&z[k[1]]&&z[k[1]].transition)return Ti({key:s,value:w,valueSpec:y.transition,style:d,styleSpec:y});const N=h.valueSpec||z[C];if(!N)return[new i.G(s,w,`unknown property "${C}"`)];let B;if(i.H(w)==="string"&&i.M(N)&&!N.tokens&&(B=/^{([^}]+)}$/.exec(w))){const Y=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new i.V(s,w,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${Y}.`)]}const G=[];if(h.layerType==="symbol")C!=="text-field"||!d||d.glyphs||d.imports||G.push(new i.V(s,w,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&i.a0(i.Q(w))&&i.K(w.type)==="identity"&&G.push(new i.V(s,w,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&i.M(N)&&(i.a1(N)||i.N(N))){const Y=i.S(i.Q(w),N),X=Y.value.expression||Y.value._styleExpression.expression;X&&!i.X(X,["measure-light"])&&(C==="model-emissive-strength"&&i.Y(X)&&i.W(X)||G.push(new i.V(s,w,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(Ti({key:h.key,value:w,valueSpec:N,style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:C}))}function Ui(h){return Mi(h,"paint")}function un(h){return Mi(h,"layout")}function Li(h){let t=[];const s=h.value,d=h.key,_=h.style,y=h.styleSpec;s.type||s.ref||t.push(new i.V(d,s,'either "type" or "ref" is required'));let w=i.K(s.type);const C=i.K(s.ref);if(s.id){const z=i.K(s.id);for(let L=0;L<h.arrayIndex;L++){const k=_.layers[L];i.K(k.id)===z&&t.push(new i.V(d,s.id,`duplicate layer id "${s.id}", previously used at line ${k.id.__line__}`))}}if("ref"in s){let z;["type","source","source-layer","filter","layout"].forEach(L=>{L in s&&t.push(new i.V(d,s[L],`"${L}" is prohibited for ref layers`))}),_.layers.forEach(L=>{i.K(L.id)===C&&(z=L)}),z?z.ref?t.push(new i.V(d,s.ref,"ref cannot reference another ref layer")):w=i.K(z.type):typeof C=="string"&&t.push(new i.V(d,s.ref,`ref layer "${C}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(s.source){const z=_.sources&&_.sources[s.source],L=z&&i.K(z.type);z?L==="vector"&&w==="raster"?t.push(new i.V(d,s.source,`layer "${s.id}" requires a raster source`)):L==="raster"&&w!=="raster"?t.push(new i.V(d,s.source,`layer "${s.id}" requires a vector source`)):L!=="vector"||s["source-layer"]?L==="raster-dem"&&w!=="hillshade"?t.push(new i.V(d,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||L==="geojson"&&z.lineMetrics?w==="raster-particle"&&L!=="raster-array"&&t.push(new i.V(d,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new i.V(d,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new i.V(d,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new i.V(d,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new i.V(d,s.source,`source "${s.source}" not found`))}else t.push(new i.V(d,s,'missing required property "source"'));return t=t.concat(yt({key:d,value:s,valueSpec:y.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ti({key:`${d}.type`,value:s.type,valueSpec:y.layer.type,style:h.style,styleSpec:h.styleSpec,object:s,objectKey:"type"}),filter:z=>Jt(i.J({layerType:w},z)),layout:z=>yt({layer:s,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":L=>un(i.J({layerType:w},L))}}),paint:z=>yt({layer:s,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":L=>Ui(i.J({layerType:w,layer:s},L))}})}})),t}function zn(h){const t=h.value,s=h.key,d=i.H(t);return d!=="string"?[new i.V(s,t,`string expected, ${d} found`)]:[]}const lr={promoteId:function({key:h,value:t}){if(i.H(t)==="string")return zn({key:h,value:t});{const s=[];for(const d in t)s.push(...zn({key:`${h}.${d}`,value:t[d]}));return s}}};function Pr(h){const t=h.value,s=h.key,d=h.styleSpec,_=h.style;if(!t.type)return[new i.V(s,t,'"type" is required')];const y=i.K(t.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(t.url||t.tiles||w.push(new i.G(s,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(yt({key:s,value:t,valueSpec:d[`source_${y.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:lr})),w;case"geojson":if(w=yt({key:s,value:t,valueSpec:d.source_geojson,style:_,styleSpec:d,objectElementValidators:lr}),t.cluster)for(const C in t.clusterProperties){const[z,L]=t.clusterProperties[C],k=typeof z=="string"?[z,["accumulated"],["get",C]]:z;w.push(...jt({key:`${s}.${C}.map`,value:L,expressionContext:"cluster-map"})),w.push(...jt({key:`${s}.${C}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return w;case"video":return yt({key:s,value:t,valueSpec:d.source_video,style:_,styleSpec:d});case"image":return yt({key:s,value:t,valueSpec:d.source_image,style:_,styleSpec:d});case"canvas":return[new i.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vi({key:`${s}.type`,value:t.type,valueSpec:{values:wr(d)},style:_,styleSpec:d})}}function wr(h){return h.source.reduce((t,s)=>{const d=h[s];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t},[])}function Or(h){const t=h.value,s=h.styleSpec,d=s.light,_=h.style;let y=[];const w=i.H(t);if(t===void 0)return y;if(w!=="object")return y=y.concat([new i.V("light",t,`object expected, ${w} found`)]),y;for(const C in t){const z=C.match(/^(.*)-transition$/),L=C.match(/^(.*)-use-theme$/);y=y.concat(L&&d[L[1]]?Ti({key:C,value:t[C],valueSpec:{type:"string"},style:_,styleSpec:s}):z&&d[z[1]]&&d[z[1]].transition?Ti({key:C,value:t[C],valueSpec:s.transition,style:_,styleSpec:s}):d[C]?Ti({key:C,value:t[C],valueSpec:d[C],style:_,styleSpec:s}):[new i.V(C,t[C],`unknown property "${C}"`)])}return y}function Ws(h){const t=h.value;let s=[];if(!t)return s;const d=i.H(t);if(d!=="object")return s=s.concat([new i.V("light-3d",t,`object expected, ${d} found`)]),s;const _=h.styleSpec,y=_["light-3d"],w=h.key,C=h.style,z=h.style.lights;for(const N of["type","id"])if(!(N in t))return s=s.concat([new i.V("light-3d",t,`missing property ${N} on light`)]),s;if(t.type&&z)for(let N=0;N<h.arrayIndex;N++){const B=i.K(t.type),G=z[N];i.K(G.type)===B&&s.push(new i.V(w,t.id,`duplicate light type "${t.type}", previously defined at line ${G.id.__line__}`))}const L=`properties_light_${t.type}`;if(!(L in _))return s=s.concat([new i.V("light-3d",t,`Invalid light type ${t.type}`)]),s;const k=_[L];for(const N in t)if(N==="properties"){const B=t[N],G=i.H(B);if(G!=="object")return s=s.concat([new i.V("properties",B,`object expected, ${G} found`)]),s;for(const Y in B)s=s.concat(k[Y]?Ti({key:Y,value:B[Y],valueSpec:k[Y],style:C,styleSpec:_}):[new i.G(h.key,B[Y],`unknown property "${Y}"`)])}else{const B=N.match(/^(.*)-transition$/),G=N.match(/^(.*)-use-theme$/);s=s.concat(G&&y[G[1]]?Ti({key:N,value:t[N],valueSpec:{type:"string"},style:C,styleSpec:_}):B&&y[B[1]]&&y[B[1]].transition?Ti({key:N,value:t[N],valueSpec:_.transition,style:C,styleSpec:_}):y[N]?Ti({key:N,value:t[N],valueSpec:y[N],style:C,styleSpec:_}):[new i.G(N,t[N],`unknown property "${N}"`)])}return s}function cr(h){const t=h.value,s=h.key,d=h.style,_=h.styleSpec,y=_.terrain;let w=[];const C=i.H(t);if(t===void 0||C==="null")return w;if(C!=="object")return w=w.concat([new i.V("terrain",t,`object expected, ${C} found`)]),w;for(const z in t){const L=z.match(/^(.*)-transition$/),k=z.match(/^(.*)-use-theme$/);w=w.concat(k&&y[k[1]]?Ti({key:z,value:t[z],valueSpec:{type:"string"},style:d,styleSpec:_}):L&&y[L[1]]&&y[L[1]].transition?Ti({key:z,value:t[z],valueSpec:_.transition,style:d,styleSpec:_}):y[z]?Ti({key:z,value:t[z],valueSpec:y[z],style:d,styleSpec:_}):[new i.G(z,t[z],`unknown property "${z}"`)])}if(t.source){const z=d.sources&&d.sources[t.source],L=z&&i.K(z.type);z?L!=="raster-dem"&&w.push(new i.V(s,t.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):w.push(new i.V(s,t.source,`source "${t.source}" not found`))}else w.push(new i.V(s,t,'terrain is missing required property "source"'));return w}function qn(h){const t=h.value,s=h.style,d=h.styleSpec,_=d.fog;let y=[];const w=i.H(t);if(t===void 0)return y;if(w!=="object")return y=y.concat([new i.V("fog",t,`object expected, ${w} found`)]),y;for(const C in t){const z=C.match(/^(.*)-transition$/),L=C.match(/^(.*)-use-theme$/);y=y.concat(L&&_[L[1]]?Ti({key:C,value:t[C],valueSpec:{type:"string"},style:s,styleSpec:d}):z&&_[z[1]]&&_[z[1]].transition?Ti({key:C,value:t[C],valueSpec:d.transition,style:s,styleSpec:d}):_[C]?Ti({key:C,value:t[C],valueSpec:_[C],style:s,styleSpec:d}):[new i.G(C,t[C],`unknown property "${C}"`)])}return y}const Lo={"*":()=>[],array:St,boolean:function(h){const t=h.value,s=h.key,d=i.H(t);return d!=="boolean"?[new i.V(s,t,`boolean expected, ${d} found`)]:[]},number:xt,color:function(h){const t=h.key,s=h.value,d=i.H(s);return d!=="string"?[new i.V(t,s,`color expected, ${d} found`)]:i._.parseCSSColor(s)===null?[new i.V(t,s,`color expected, "${s}" found`)]:[]},enum:vi,filter:Jt,function:Nt,layer:Li,object:yt,source:Pr,model:i.a2,light:Or,"light-3d":Ws,terrain:cr,fog:qn,string:zn,formatted:function(h){return zn(h).length===0?[]:jt(h)},resolvedImage:function(h){return zn(h).length===0?[]:jt(h)},projection:function(h){const t=h.value,s=h.styleSpec,d=s.projection,_=h.style;let y=[];const w=i.H(t);if(w==="object")for(const C in t)y=y.concat(Ti({key:C,value:t[C],valueSpec:d[C],style:_,styleSpec:s}));else w!=="string"&&(y=y.concat([new i.V("projection",t,`object or string expected, ${w} found`)]));return y},import:function(h){const{value:t,styleSpec:s}=h,{data:d,..._}=t;Object.defineProperty(_,"__line__",{value:t.__line__,enumerable:!1});let y=yt(i.J({},h,{value:_,valueSpec:s.import}));return i.K(_.id)===""&&y.push(new i.V(`${h.key}.id`,_,"import id can't be an empty string")),d&&(y=y.concat(uu(d,s,{key:`${h.key}.data`}))),y}};function Ti(h,t=!1){const s=h.value,d=h.valueSpec,_=h.styleSpec;if(d.expression&&i.a0(i.K(s)))return Nt(h);if(d.expression&&i.O(i.Q(s)))return jt(h);if(d.type&&Lo[d.type]){const y=Lo[d.type](h);return t===!0&&y.length>0&&i.H(h.value)==="array"?jt(h):y}return yt(i.J({},h,{valueSpec:d.type?_[d.type]:d}))}function Zs(h){const t=h.value,s=h.key,d=zn(h);return d.length||(t.indexOf("{fontstack}")===-1&&d.push(new i.V(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&d.push(new i.V(s,t,'"glyphs" url must include a "{range}" token'))),d}function uu(h,t=i.a3,s={}){return Ti({key:s.key||"",value:h,valueSpec:t.$root,styleSpec:t,style:h,objectElementValidators:{glyphs:Zs,"*":()=>[]}})}function Fr(h,t=i.a3){return Ge(uu(h,t))}const la=h=>Ge(Pr(h)),ec=h=>Ge(Or(h)),tc=h=>Ge(Ws(h)),Xa=h=>Ge(cr(h)),ic=h=>Ge(qn(h)),We=h=>Ge(function(t){const s=t.value,d=t.style,_=t.styleSpec,y=_.snow;let w=[];const C=i.H(s);if(s===void 0)return w;if(C!=="object")return w=w.concat([new i.V("snow",s,`object expected, ${C} found`)]),w;for(const z in s){const L=z.match(/^(.*)-transition$/);w=w.concat(L&&y[L[1]]&&y[L[1]].transition?Ti({key:z,value:s[z],valueSpec:_.transition,style:d,styleSpec:_}):y[z]?Ti({key:z,value:s[z],valueSpec:y[z],style:d,styleSpec:_}):[new i.G(z,s[z],`unknown property "${z}"`)])}return w}(h)),ee=h=>Ge(function(t){const s=t.value,d=t.style,_=t.styleSpec,y=_.rain;let w=[];const C=i.H(s);if(s===void 0)return w;if(C!=="object")return w=w.concat([new i.V("rain",s,`object expected, ${C} found`)]),w;for(const z in s){const L=z.match(/^(.*)-transition$/);w=w.concat(L&&y[L[1]]&&y[L[1]].transition?Ti({key:z,value:s[z],valueSpec:_.transition,style:d,styleSpec:_}):y[z]?Ti({key:z,value:s[z],valueSpec:y[z],style:d,styleSpec:_}):[new i.G(z,s[z],`unknown property "${z}"`)])}return w}(h)),ie=h=>Ge(Li(h)),he=h=>Ge(Jt(h)),Te=h=>Ge(Ui(h)),Me=h=>Ge(un(h)),De=h=>Ge(i.a2(h));function Ge(h){return h.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function Le(h,t){let s=!1;if(t&&t.length)for(const d of t)d instanceof i.G?i.w(d.message):(h.fire(new i.y(new Error(d.message))),s=!0);return s}let qe;class Ze extends i.E{constructor(t,s="flat"){super(),this._transitionable=new i.a4(qe||(qe=new i.a5({anchor:new i.a6(i.a3.light.anchor),position:new i.a7(i.a3.light.position),color:new i.a6(i.a3.light.color),intensity:new i.a6(i.a3.light.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,d={}){this._validate(ec,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,d){return(!d||d.validate!==!1)&&Le(this,t.call(Fr,i.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a3})))}}let Qe=class extends i.E{constructor(h,t,s,d){super(),this.scope=s,this._transitionable=new i.a4(new i.a5({source:new i.a6(i.a3.terrain.source),exaggeration:new i.a6(i.a3.terrain.exaggeration)}),s,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new i.a8(h)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const t=h.value.expression;if(!t)return null;let s=-1,d=-1,_=1;for(const y of t.zoomStops)_=t.evaluate(new i.a8(y)),_>.01?(s=y,d=-1):d=y;return _<.01&&s>0&&d>s?[s,d]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof i.a9}};const ht=45,Ct=65,zt=.05;function ri(h,t,s,d){const _=i.ac(ht,Ct,s),[y,w]=di(h,d);let C=1-Math.min(1,Math.exp((t-y)/(w-y)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*_*h.alpha}function di(h,t){const s=.5/Math.tan(.5*t);return[h.range[0]+s,h.range[1]+s]}function ui(h,t,s,d,_){const y=i.ab.vec3.transformMat4([],[t,s,d],_.mercatorFogMatrix);return ri(h,i.ab.vec3.length(y),_.pitch,_._fov)}function ci(h,t,s,d,_,y,w){const C=[[s,d,0],[_,d,0],[_,y,0],[s,y,0]];let z=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const k of C){const N=i.ab.vec3.transformMat4([],k,t),B=i.ab.vec3.length(N);z=Math.min(z,B),L=Math.max(L,B)}return[ri(h,z,w.pitch,w._fov),ri(h,L,w.pitch,w._fov)]}class Zi extends i.E{constructor(t,s,d,_){super();const y=new i.a5({range:new i.a6(i.a3.fog.range),color:new i.a6(i.a3.fog.color),"color-use-theme":new i.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a6(i.a3.fog["high-color"]),"high-color-use-theme":new i.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a6(i.a3.fog["space-color"]),"space-color-use-theme":new i.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a6(i.a3.fog["horizon-blend"]),"star-intensity":new i.a6(i.a3.fog["star-intensity"]),"vertical-range":new i.a6(i.a3.fog["vertical-range"])});this._transitionable=new i.a4(y,d,new Map(_)),this.set(t,_),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new i.ad(y),this.scope=d}get state(){const t=this._transform,s=t.projection.name==="globe",d=i.ae(t.zoom),_=this.properties.get("range"),y=[.5,3];return{range:s?[i.af(y[0],_[0],d),i.af(y[1],_[1],d)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,d={}){if(this._validate(ic,t,d))return;const _=i.l({},t);for(const y of Object.keys(i.a3.fog))_[y]===void 0&&(_[y]=i.a3.fog[y].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ac(ht,Ct,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(d,_,y){const w=i.aa.fromLngLat(_),C=y.elevation?y.elevation.getAtPointOrZero(w):0;return ui(d,w.x,w.y,C,y)}(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return ci(this.state,s,0,0,i.ag,i.ag,this._transform)}getOpacityForBounds(t,s,d,_,y){return this._transform.projection.supportsFog?ci(this.state,t,s,d,_,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?di(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const d of s){const _=t.points[d];let y;if(_[2]>=0)y=_;else{const w=t.points[d-4];y=i.ah(w,_,w[2]/(w[2]-_[2]))}if(ui(this.state,y[0],y[1],0,this._transform)>=zt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,d){return(!d||d.validate!==!1)&&Le(this,t.call(Fr,i.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a3})))}}let ji,Si,qi,Xi,$n=class extends i.E{constructor(h,t,s,d){super();const _=ji||(ji=new i.a5({density:new i.a6(i.a3.snow.density),intensity:new i.a6(i.a3.snow.intensity),color:new i.a6(i.a3.snow.color),opacity:new i.a6(i.a3.snow.opacity),vignette:new i.a6(i.a3.snow.vignette),"vignette-color":new i.a6(i.a3.snow["vignette-color"]),"center-thinning":new i.a6(i.a3.snow["center-thinning"]),direction:new i.a6(i.a3.snow.direction),"flake-size":new i.a6(i.a3.snow["flake-size"])}));this._transitionable=new i.a4(_,s,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ad(_),this.scope=s}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),d=i.ai(s[0]),_=-Math.max(i.ai(s[1]),.01),y=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],w=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.aj(t.r,t.g,t.b,t.a*h),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(h,t,s={}){if(this._validate(We,h,s))return;const d=i.l({},h);for(const _ of Object.keys(i.a3.snow))d[_]===void 0&&(d[_]=i.a3.snow[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,s){return(!s||s.validate!==!1)&&Le(this,h.call(Fr,i.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a3})))}},Dr=class extends i.E{constructor(h,t,s,d){super();const _=Si||(Si=new i.a5({density:new i.a6(i.a3.rain.density),intensity:new i.a6(i.a3.rain.intensity),color:new i.a6(i.a3.rain.color),opacity:new i.a6(i.a3.rain.opacity),vignette:new i.a6(i.a3.rain.vignette),"vignette-color":new i.a6(i.a3.rain["vignette-color"]),"center-thinning":new i.a6(i.a3.rain["center-thinning"]),direction:new i.a6(i.a3.rain.direction),"droplet-size":new i.a6(i.a3.rain["droplet-size"]),"distortion-strength":new i.a6(i.a3.rain["distortion-strength"])}));this._transitionable=new i.a4(_,s,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ad(_),this.scope=s}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),d=i.ai(s[0]),_=-Math.max(i.ai(s[1]),.01),y=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.aj(t.r,t.g,t.b,t.a*h),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(h,t,s={}){if(this._validate(ee,h,s))return;const d=i.l({},h);for(const _ of Object.keys(i.a3.rain))d[_]===void 0&&(d[_]=i.a3.rain[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,s){return(!s||s.validate!==!1)&&Le(this,h.call(Fr,i.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a3})))}};class ur extends i.E{constructor(t,s,d,_){super(),this.scope=d,this._options=t,this.properties=new i.ad(s),this._transitionable=new i.a4(s,d,new Map(_)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class pr{constructor(t,s,d,_){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(t,s){let d,_;if(t instanceof i.P||typeof t[0]=="number"){const y=i.P.convert(t);d=[y],_=s.isPointAboveHorizon(y)}else{const y=i.P.convert(t[0]),w=i.P.convert(t[1]);d=[y,w],_=i.al(y,w).every(C=>s.isPointAboveHorizon(C))}return new pr(d,s.getCameraPoint(),_,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return i.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],_=i.al(s,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<d.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?_[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(_[3]=this.cameraPoint)),i.am(_,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],_=i.al(s,d,t),y=this.cameraPoint.clone();switch(3*((y.y>s.y)+(y.y>d.y))+((y.x>s.x)+(y.x>d.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(t,s,d,_=0){const y=t.queryPadding/s._pixelsPerMercatorPixel+1,w=d?this._bufferedCameraMercator(y,s):this._bufferedScreenMercator(y,s);let C=t.tileID.wrap+(w.unwrapped?_:0);const z=w.polygon.map(J=>i.an(t.tileTransform,J,C));if(!i.ao(z,0,0,i.ag,i.ag))return;C=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const L=this.screenGeometryMercator.polygon.map(J=>i.ap(t.tileTransform,J,C)),k=L.map(J=>new i.P(J[0],J[1])),N=s.getFreeCameraOptions().position||new i.aa(0,0,0),B=i.ap(t.tileTransform,N,C),G=L.map(J=>{const Q=i.ab.vec3.sub(J,J,B);return i.ab.vec3.normalize(Q,Q),new i.aq(B,Q)}),Y=i.ar(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:G,bufferedTilespaceGeometry:z,bufferedTilespaceBounds:(X=i.as(z),X.min.x=i.aw(X.min.x,0,i.ag),X.min.y=i.aw(X.min.y,0,i.ag),X.max.x=i.aw(X.max.x,0,i.ag),X.max.y=i.aw(X.max.y,0,i.ag),X),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Y};var X}_bufferedScreenMercator(t,s){const d=ed(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let _;return _=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map(y=>s.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[d]=_,_}}_bufferedCameraMercator(t,s){const d=ed(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let _;return _=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map(y=>s.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[d]=_,_}}_projectAndResample(t,s){const d=function(y,w){const C=i.ab.mat4.multiply([],w.pixelMatrix,w.globeMatrix),z=[0,-i.ax,0,1],L=[0,i.ax,0,1],k=[0,0,0,1];i.ab.vec4.transformMat4(z,z,C),i.ab.vec4.transformMat4(L,L,C),i.ab.vec4.transformMat4(k,k,C);const N=new i.P(z[0]/z[3],z[1]/z[3]),B=new i.P(L[0]/L[3],L[1]/L[3]),G=i.au(y,N)&&z[3]<k[3],Y=i.au(y,B)&&L[3]<k[3];if(!G&&!Y)return null;const X=function(pe,de,be){for(let Ie=1;Ie<pe.length;Ie++){const He=Xs(de.pointCoordinate3D(pe[Ie-1]).x),Ve=Xs(de.pointCoordinate3D(pe[Ie]).x);if(be<0){if(He<Ve)return{idx:Ie,t:-He/(Ve-1-He)}}else if(Ve<He)return{idx:Ie,t:(1-He)/(Ve+1-He)}}return null}(y,w,G?-1:1);if(!X)return null;const{idx:J,t:Q}=X;let re=J>1?ca(y.slice(0,J),w):[],ue=J<y.length?ca(y.slice(J),w):[];re=re.map(pe=>new i.P(Xs(pe.x),pe.y)),ue=ue.map(pe=>new i.P(Xs(pe.x),pe.y));const le=[...re];le.length===0&&le.push(ue[ue.length-1]);const _e=i.af(le[le.length-1].y,(ue.length===0?re[0]:ue[0]).y,Q);let fe;return fe=G?[new i.P(0,_e),new i.P(0,0),new i.P(1,0),new i.P(1,_e)]:[new i.P(1,_e),new i.P(1,1),new i.P(0,1),new i.P(0,_e)],le.push(...fe),ue.length===0?le.push(re[0]):le.push(...ue),{polygon:le.map(pe=>new i.aa(pe.x,pe.y)),unwrapped:!1}}(t,s);if(d)return d;const _=function(y,w){let C=!1,z=-1/0,L=0;for(let N=0;N<y.length-1;N++)y[N].x>z&&(z=y[N].x,L=N);for(let N=0;N<y.length-1;N++){const B=(L+N)%(y.length-1),G=y[B],Y=y[B+1];Math.abs(G.x-Y.x)>.5&&(G.x<Y.x?(G.x+=1,B===0&&(y[y.length-1].x+=1)):(Y.x+=1,B+1===y.length-1&&(y[0].x+=1)),C=!0)}const k=i.at(w.center.lng);return C&&k<Math.abs(k-1)&&y.forEach(N=>{N.x-=1}),{polygon:y,unwrapped:C}}(ca(t,s).map(y=>new i.P(Xs(y.x),y.y)),s);return{polygon:_.polygon.map(y=>new i.aa(y.x,y.y)),unwrapped:_.unwrapped}}}function ca(h,t){return i.av(h,s=>{const d=t.pointCoordinate3D(s);s.x=d.x,s.y=d.y},1/256)}function Xs(h){return h<0?1+h%1:h%1}function ed(h){return 100*h|0}function hu(h,t,s,d,_){const y=function(C,z){if(C)return _(C);if(z){if(h.url&&z.tiles&&h.tiles&&delete h.tiles,z.variants){if(!Array.isArray(z.variants))return _(new Error("variants must be an array"));for(const k of z.variants){if(k==null||typeof k!="object"||k.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return _(new Error("capabilities must be an array"));if(k.capabilities.length===1&&k.capabilities[0]==="meshopt"){z=i.l(z,k);break}}}const L=i.ay(i.l({},z,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=t.canonicalizeTileset(L,h.url),_(null,L)}},w=function(C,z,L){if(!C)return null;if(!z&&!L)return C;L=L||C.worldview_default;const k=Object.values(C.language||{});if(k.length===0)return null;const N=Object.values(C.worldview||{});if(N.length===0)return null;const B=k.every(Y=>Y===z),G=N.every(Y=>Y===L);return B&&G?C:z in(C.language_options||{})||L in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(h.data,s,d);return w?i.q.frame(()=>y(null,w)):h.url?i.n(t.transformRequest(t.normalizeSourceURL(h.url,null,s,d),i.R.Source),y):i.q.frame(()=>{const{data:C,...z}=h;y(null,z)})}class ua{constructor(t,s,d){this.bounds=i.az.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),d=Math.floor(i.at(this.bounds.getWest())*s),_=Math.floor(i.aA(this.bounds.getNorth())*s),y=Math.ceil(i.at(this.bounds.getEast())*s),w=Math.ceil(i.aA(this.bounds.getSouth())*s);return t.x>=d&&t.x<y&&t.y>=_&&t.y<w}}class du extends i.E{constructor(t,s,d,_){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.ay(s,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new i.aB}load(t){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=hu(this._options,this.map._requestManager,s,d,(_,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new i.y(_));else if(y){if(i.l(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of y.vector_layers)this.vectorLayerIds.push(w.id),y.worldview&&y.worldview[w.source]&&this.localizableLayerIds.add(w.id)}y.bounds&&(this.tileBounds=new ua(y.bounds,this.minzoom,this.maxzoom)),Sn(y.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(_)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(t,s){const d=t.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(d),y=this.map._requestManager.transformRequest(_,i.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,C=w?{image:w.image.clone()}:null,z={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&i.f(d)&&(z.worldview=this.map.getWorldview()||this.worldviewDefault,z.localizableLayerIds=this.localizableLayerIds),z.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",z,L.bind(this));else if(t.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",z,L.bind(this),void 0,!0);else{const k=i.aD.call({deduped:this._deduped},z,(N,B)=>{N||!B?L.call(this,N):(z.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},t.actor&&t.actor.send("loadTile",z,L.bind(this),void 0,!0))},!0);t.request={cancel:k}}function L(k,N){return delete t.request,t.aborted?s(null):k&&k.status!==404?s(k):(N&&N.resourceTiming&&(t.resourceTiming=N.resourceTiming),this.map._refreshExpiredTiles&&N&&t.setExpiryData(N),t.loadVectorData(N,this.map.painter),i.aE(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ya extends i.E{constructor(t,s,d,_){super(),this.id=t,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},s),i.l(this,i.ay(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._tileJSONRequest=hu(this._options,this.map._requestManager,null,null,(s,d)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new i.y(s)):d&&(i.l(this,d),d.raster_layers&&(this.rasterLayers=d.raster_layers,this.rasterLayerIds=this.rasterLayers.map(_=>_.id)),d.bounds&&(this.tileBounds=new ua(d.bounds,this.minzoom,this.maxzoom)),Sn(d.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(s)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const d=i.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=i.o(this.map._requestManager.transformRequest(_,i.R.Tile),(y,w,C,z)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):y?(t.state="errored",s(y)):w?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:C,expires:z}),t.setTexture(w,this.map.painter),t.state="loaded",i.aE(this.dispatcher),void s(null)):s(null)))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof i.T?(t.destroy(!0),t.texture&&t.texture instanceof i.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ro extends Ya{constructor(t,s,d,_){super(t,s,d,_),this.type="raster-array",this.maxzoom=22,this._options=i.l({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);s&&s.enabled&&d&&s._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(d,i.R.Tile);t.requestParams=_,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(y,w,C,z)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(y)return y.code===20?void 0:(t.state="errored",s(y));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:C,expires:z}),t.state="empty",s(null)})}unloadTile(t,s){const d=t.texture;d&&d instanceof i.T?(t.destroy(!0),this.map.painter.saveTileTexture(d)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,s,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(s,d,(_,y)=>{if(_)return t.state="errored",this.fire(new i.y(_)),void this.triggerRepaint(t);y&&(t.setTexture(y,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:y})=>y===t),d=s&&s.fields,_=d&&d.bands&&d.bands;return _?_[0]:0}getTextureDescriptor(t,s,d){if(!t)return;const _=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let y=null;s instanceof i.aH?y=s.paint.get("raster-array-band"):s instanceof i.aI&&(y=s.paint.get("raster-particle-array-band"));const w=y||this.getInitialBand(_);if(w!=null)if(t.textureDescriptor){if(!t.updateNeeded(_,w)||d)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,_,w)}}const ha={vector:du,raster:Ya,"raster-dem":class extends Ya{constructor(h,t,s,d){super(h,t,s,d),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const s=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(_,y){_&&(h.state="errored",t(_)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=i.o(this.map._requestManager.transformRequest(s,i.R.Tile),(function(_,y,w,C){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(_)h.state="errored",t(_);else if(y){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:w,expires:C});const z=ImageBitmap&&y instanceof ImageBitmap&&i.t(),L=1-(y.width-i.aF(y.width))/2;L<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const k=z?y:i.q.getImageData(y,L),N={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:L};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",N,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const t=h.canonical,s=Math.pow(2,t.z),d=(t.x-1+s)%s,_=t.x===0?h.wrap-1:h.wrap,y=(t.x+1+s)%s,w=t.x+1===s?h.wrap+1:h.wrap,C={};return C[new i.aG(h.overscaledZ,_,t.z,d,t.y).key]={backfilled:!1},C[new i.aG(h.overscaledZ,w,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(C[new i.aG(h.overscaledZ,_,t.z,d,t.y-1).key]={backfilled:!1},C[new i.aG(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},C[new i.aG(h.overscaledZ,w,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<s&&(C[new i.aG(h.overscaledZ,_,t.z,d,t.y+1).key]={backfilled:!1},C[new i.aG(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},C[new i.aG(h.overscaledZ,w,t.z,y,t.y+1).key]={backfilled:!1}),C}},"raster-array":ro,geojson:class extends i.E{constructor(h,t,s,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(d),this._data=t.data,this._options=i.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const _=i.ag/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*_,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*_,extent:i.ag,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:i.ag,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*_,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of h.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,s,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:s},d),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=i.l({append:h},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(i.q.resolveURL(s),i.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new i.y(d));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new i.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,t){const s=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,_=d?{image:d.image.clone()}:null,y=this._partialReload,w={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:y};h.request=this.actor.send(s,w,(C,z)=>y&&!z?(h.state="loaded",t(null)):(delete h.request,h.destroy(),h.aborted?t(null):C?t(C):(h.loadVectorData(z,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aJ{constructor(h,t,s,d){super(h,t,s,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,i.R.Source).url);i.aK(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new i.y(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aJ,model:class extends i.E{constructor(h,t,s,d){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const h=[];for(const t in this._options.models){const s=this._options.models[t],d=i.aM(this.map._requestManager.transformRequest(s.uri,i.R.Model).url).then(_=>{if(!_)return;const y=i.aN(_),w=new i.aO(t,s.position,s.orientation,y);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(_=>{this.fire(new i.y(new Error(`Could not load model ${t} from ${s.uri}: ${_.message}`)))});h.push(d)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new i.y(new Error(`Could not load models: ${t.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,t){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(h,t,s,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}load(h){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=hu(this._options,this.map._requestManager,t,s,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new i.y(d))):_&&(i.l(this,_),_.bounds&&(this.tileBounds=new ua(_.bounds,this.minzoom,this.maxzoom)),Sn(_.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){const s=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(s,i.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){const y=Object.values(h.buckets);for(const w of y)w.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,_.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,_.bind(this),void 0,!0);function _(y,w){return h.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&w&&h.setExpiryData(w),h.loadModelData(w,this.map.painter),h.state="loaded",void t(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aJ{constructor(h,t,s,d){super(h,t,s,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new i.y(new i.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof i.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends i.E{constructor(h,t,s,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ua(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.ay(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:s,z:d}=h.canonical;return this._implementation.hasTile({x:t,y:s,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:s,y:d,z:_}=h.tileID.canonical,y=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:s,y:d,z:_},{signal:y.signal})).then((function(w){return delete h.request,h.aborted?(h.state="unloaded",t(null)):w===void 0?(h.state="errored",t(null)):w===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(w)?(this.loadTileData(h,w),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.code!==20&&(h.state="errored",t(w))}),h.request.cancel=()=>y.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof i.T?(h.destroy(!0),h.texture&&h.texture instanceof i.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:s,y:d,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:s,y:d,z:_})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=i.aC(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},td=function(h,t,s,d){const _=new ha[t.type](h,t,s,d);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return i.aP(["load","abort","unload","serialize","prepare"],_),_};function Rp(h,t,s,d,_=!1){const y=t.sourceCache.transform,w=t.sourceCache.tilesIn(h,t.has3DLayers,_);w.sort(pu);const C=[];for(const z of w){const L=z.tile.queryRenderedFeatures(t,z,s,d,y,_);Object.keys(L).length&&C.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:L})}return C.length===0?{}:function(z){const L={},k={};for(const N of z){const B=N.queryResults,G=N.wrappedTileID,Y=k[G]=k[G]||{};for(const X in B){const J=B[X],Q=Y[X]=Y[X]||{},re=L[X]=L[X]||[];for(const ue of J)Q[ue.featureIndex]||(Q[ue.featureIndex]=!0,re.push(ue))}}return L}(C)}function fu(h,t,s,d,_){const y={},w=d.queryRenderedSymbols(h),C=[];for(const z of Object.keys(w).map(Number))C.push(_[z]);C.sort(pu);for(const z of C){const L=z.featureIndex.lookupSymbolFeatures(w[z.bucketInstanceId],z.bucketIndex,z.sourceLayerIndex,t,s);for(const k in L){const N=y[k]=y[k]||[],B=L[k];B.sort((G,Y)=>{const X=z.featureSortOrder;if(X){const J=X.indexOf(G.featureIndex);return X.indexOf(Y.featureIndex)-J}return Y.featureIndex-G.featureIndex});for(const G of B)N.push(G)}}return y}function nc(h,t){const s=h.getRenderableIds().map(y=>h.getTileByID(y)),d=[],_={};for(let y=0;y<s.length;y++){const w=s[y],C=w.tileID.canonical.key;_[C]||(_[C]=!0,w.querySourceFeatures(d,t))}return d}function pu(h,t){const s=h.tileID,d=t.tileID;return s.overscaledZ-d.overscaledZ||s.canonical.y-d.canonical.y||s.wrap-d.wrap||s.canonical.x-d.canonical.x}function id(h,t){const s={};if(!t)return s;for(const d of h){const _=d.layerIds.map(y=>t.getLayer(y)).filter(Boolean);if(_.length!==0){d.layers=_,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(y=>_.filter(w=>w.id===y)[0]));for(const y of _)s[y.fqid]=d}}return s}const as=32,As=33,ms=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,s=0,d=0,_=0,y=0,w=0,C=0;for(1&t?_=y=w=as:s=d=C=as;(t>>=1)>1;){const L=s+_>>1,k=d+y>>1;1&t?(_=s,y=d,s=w,d=C):(s=_,d=y,_=w,y=C),w=L,C=k}const z=4*h;ms[z+0]=s,ms[z+1]=d,ms[z+2]=_,ms[z+3]=y}const Is=new Uint16Array(2178),so=new Uint8Array(1089),mu=new Uint16Array(1089);function rc(h){return h===0?-.03125:h===32?.03125:0}const ko={type:2,extent:i.ag,loadGeometry:()=>[[new i.P(0,0),new i.P(i.ag+1,0),new i.P(i.ag+1,i.ag+1),new i.P(0,i.ag+1),new i.P(0,0)]]};class Oo{constructor(t,s,d,_,y){this.tileID=t,this.uid=i.aV(),this.uses=0,this.tileSize=s,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(t){const s=t+this.timeAdded;s<i.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=id(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof i.aX){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof i.aX&&y.hasRTLText){this.hasRTLText=!0,i.aY();break}}this.queryPadding=0;for(const _ in this.buckets){const y=this.buckets[_],w=s.style.getOwnLayer(_);if(!w)continue;const C=w.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,C)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new i.aW}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets={...this.buckets,...id(t.buckets,s.style)},t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(t)}const s=t.gl,d=this.imageAtlas;if(d&&!d.uploaded){const _=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new i.T(t,d.image,s.RGBA8,{useMipmap:_}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(t,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(t,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=s.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}queryRenderedFeatures(t,s,d,_,y,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=function(z,L){const k=i.ab.mat4.fromScaling([],[.5*z.width,.5*-z.height,1]);return i.ab.mat4.translate(k,k,[1,-1,0]),i.ab.mat4.multiply(k,k,z.calculateProjMatrix(L.toUnwrapped())),Float32Array.from(k)}(y,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:C,transform:_,availableImages:d,tileTransform:this.tileTransform})}querySourceFeatures(t,s){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const _=d.loadVTLayers(),y=s?s.sourceLayer:"",w=_._geojsonTileLayer||_[y];if(!w)return;const C=i.aZ(s&&s.filter),{z,x:L,y:k}=this.tileID.canonical,N={z,x:L,y:k};for(let B=0;B<w.length;B++){const G=w.feature(B);if(C.needGeometry){const J=i.a_(G,!0);if(!C.filter(new i.a8(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!C.filter(new i.a8(this.tileID.overscaledZ),G))continue;const Y=d.getId(G,y),X=new i.a$(G,z,L,k,Y);X.tile=N,t.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const d=i.b0(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let _=!1;if(this.expirationTime>d)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{const y=this.expirationTime-s;y?this.expirationTime=d+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const d=this.latestFeatureIndex.loadVTLayers(),_=t.style.listImages(),y=t.style.getBrightness();for(const w in this.buckets){if(!t.style.hasLayer(w))continue;const C=this.buckets[w],z=C.layers[0],L=z.sourceLayer||"_geojsonTileLayer",k=d[L],N=t.style.getSourceCache(z.source,z.scope);let B={};N&&(B=N._state.getState(L,void 0));const G=this.imageAtlas&&this.imageAtlas.patternPositions||{},Y=Object.keys(B).length>0&&!s;(Y&&C.stateDependentLayers.length!==0||s)&&C.update(B,k,_,G,Y?C.stateDependentLayers:C.layers,s,y),(C instanceof i.b1||C instanceof i.b2)&&t._terrain&&t._terrain.enabled&&N&&C.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(N.id,this.tileID);const X=t&&t.style&&t.style.getOwnLayer(w);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=i.q.now()+t}setTexture(t,s){const d=s.context,_=d.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t):(this.texture=new i.T(d,t,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(t,s){const d={};for(const _ of s)d[_]=!0;this.dependencies[t]=d}hasDependency(t,s){for(const d of t){const _=this.dependencies[d];if(_){for(const y of s)if(_[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const d=i.b3(ko,this.tileID.canonical,this.tileTransform)[0],_=new i.b4,y=new i.b5;for(let w=0;w<d.length;w++){const{x:C,y:z}=d[w];_.emplaceBack(C,z),y.emplaceBack(w)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(_,i.b6.members),this._tileDebugSegments=i.b7.simpleSegment(0,0,_.length,y.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const d=i.b3(ko,this.tileID.canonical,this.tileTransform)[0];let _,y;if(this.isRaster){const w=function(C,z){const L=i.aQ(C,z),k=Math.pow(2,C.z);for(let J=0;J<As;J++)for(let Q=0;Q<As;Q++){const re=i.aR((C.x+(Q+rc(Q))/as)/k),ue=i.aS((C.y+(J+rc(J))/as)/k),le=z.project(re,ue),_e=J*As+Q;Is[2*_e+0]=Math.round((le.x*L.scale-L.x)*i.ag),Is[2*_e+1]=Math.round((le.y*L.scale-L.y)*i.ag)}so.fill(0),mu.fill(0);for(let J=2045;J>=0;J--){const Q=4*J,re=ms[Q+0],ue=ms[Q+1],le=ms[Q+2],_e=ms[Q+3],fe=re+le>>1,pe=ue+_e>>1,de=fe+pe-ue,be=pe+re-fe,Ie=ue*As+re,He=_e*As+le,Ve=pe*As+fe,Ee=Math.hypot((Is[2*Ie+0]+Is[2*He+0])/2-Is[2*Ve+0],(Is[2*Ie+1]+Is[2*He+1])/2-Is[2*Ve+1])>=16;so[Ve]=so[Ve]||(Ee?1:0),J<1022&&(so[Ve]=so[Ve]||so[(ue+be>>1)*As+(re+de>>1)]||so[(_e+be>>1)*As+(le+de>>1)])}const N=new i.aT,B=new i.aU;let G=0;function Y(J,Q){const re=Q*As+J;return mu[re]===0&&(N.emplaceBack(Is[2*re+0],Is[2*re+1],J*i.ag/as,Q*i.ag/as),mu[re]=++G),mu[re]-1}function X(J,Q,re,ue,le,_e){const fe=J+re>>1,pe=Q+ue>>1;if(Math.abs(J-le)+Math.abs(Q-_e)>1&&so[pe*As+fe])X(le,_e,J,Q,fe,pe),X(re,ue,le,_e,fe,pe);else{const de=Y(J,Q),be=Y(re,ue),Ie=Y(le,_e);B.emplaceBack(de,be,Ie)}}return X(0,0,as,as,as,0),X(as,as,0,0,0,as),{vertices:N,indices:B}}(this.tileID.canonical,s);_=w.vertices,y=w.indices}else{_=new i.aT,y=new i.aU;for(const{x:C,y:z}of d)_.emplaceBack(C,z,0,0);const w=i.b8(_.int16,void 0,4);for(let C=0;C<w.length;C+=3)y.emplaceBack(w[C],w[C+1],w[C+2])}this._tileBoundsBuffer=t.createVertexBuffer(_,i.b9.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=i.b7.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugBuffers(t,s){const d=s.projection;if(!d||d.name!=="globe"||s.freezeTileCoverage)return;const _=this.tileID.canonical,y=i.ba(_,s),w=i.bb(y),C=i.ae(s.zoom);let z;C>0&&(z=i.ab.mat4.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,_,s,w,z,C),this._makeGlobeTileDebugTextBuffer(t,_,s,w,z,C)}_globePoint(t,s,d,_,y,w,C){let z=i.bc(t,s,d);if(w){const L=1<<d.z,k=i.at(_.center.lng),N=i.aA(_.center.lat),B=(d.x+.5)/L-k;let G=0;B>.5?G=-1:B<-.5&&(G=1);let Y=(t/i.ag+d.x)/L+G,X=(s/i.ag+d.y)/L;Y=(Y-k)*_._pixelsPerMercatorPixel+k,X=(X-N)*_._pixelsPerMercatorPixel+N;const J=[Y*_.worldSize,X*_.worldSize,0];i.ab.vec3.transformMat4(J,J,w),z=i.bd(z,J,C)}return i.ab.vec3.transformMat4(z,z,y)}_makeGlobeTileDebugBorderBuffer(t,s,d,_,y,w){const C=new i.b4,z=new i.b5,L=new i.be,k=(B,G,Y,X,J)=>{const Q=(Y-B)/(J-1),re=(X-G)/(J-1),ue=C.length;for(let le=0;le<J;le++){const _e=B+le*Q,fe=G+le*re;C.emplaceBack(_e,fe);const pe=this._globePoint(_e,fe,s,d,_,y,w);L.emplaceBack(pe[0],pe[1],pe[2]),z.emplaceBack(ue+le)}},N=i.ag;k(0,0,N,0,16),k(N,0,N,N,16),k(N,N,0,N,16),k(0,N,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(z),this._tileDebugBuffer=t.createVertexBuffer(C,i.b6.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(L,i.bf.members),this._tileDebugSegments=i.b7.simpleSegment(0,0,C.length,z.length)}_makeGlobeTileDebugTextBuffer(t,s,d,_,y,w){const C=i.ag/4,z=new i.b4,L=new i.aU,k=new i.be,N=25;L.reserve(32),z.reserve(N),k.reserve(N);const B=(G,Y)=>N*G+Y;for(let G=0;G<N;G++){const Y=G*C;for(let X=0;X<N;X++){const J=X*C;z.emplaceBack(J,Y);const Q=this._globePoint(J,Y,s,d,_,y,w);k.emplaceBack(Q[0],Q[1],Q[2])}}for(let G=0;G<4;G++)for(let Y=0;Y<4;Y++){const X=B(G,Y),J=B(G,Y+1),Q=B(G+1,Y),re=B(G+1,Y+1);L.emplaceBack(X,J,Q),L.emplaceBack(Q,J,re)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(L),this._tileDebugTextBuffer=t.createVertexBuffer(z,i.b6.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(k,i.bf.members),this._tileDebugTextSegments=i.b7.simpleSegment(0,0,N,32)}destroy(t=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bg.setPbf(i.bh);class _u extends Oo{constructor(t,s,d,_,y){super(t,s,d,_,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,s){const d=s.context,_=d.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t,{premultiply:!1}):this.texture=new i.T(d,t,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,s){const d=this._mrt=new i.bg(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=i.bi(_,(y,w,C,z)=>{if(y)s(y);else try{const L=d.getHeaderLength(w);if(L>t)return void(this.request=this.fetchHeader(L,s));d.parseHeader(w),this._isHeaderLoaded=!0;let k=0;for(const N of Object.values(d.layers))k=Math.max(k,N.dataIndex[N.dataIndex.length-1].last_byte);w.byteLength>=k&&(this.entireBuffer=w),s(null,this.entireBuffer||w,C,z)}catch(L){s(L)}}),this.request}fetchBand(t,s,d){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void d(new Error("Tile header is not ready"));const y=this.actor;if(!y)return void d(new Error("Can't fetch tile band without an actor"));let w;const C=(N,B)=>{w.complete(N,B),N?d(N):(this.updateTextureDescriptor(t,s),d(null,this.textureDescriptor&&this.textureDescriptor.img))},z=(N,B)=>{if(N)return d(N);const G=y.send("decodeRasterArray",{buffer:B,task:w},C,void 0,!0);this._workQueue.push(()=>{G&&G.cancel(),w.cancel()})},L=_.getLayer(t);if(!L)return void d(new Error(`Unknown sourceLayer "${t}"`));if(L.hasDataForBand(s))return this.updateTextureDescriptor(t,s),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const k=L.getDataRange([s]);if(w=_.createDecodingTask(k),!w||w.tasks.length)if(this.flushQueues(),this.entireBuffer)z(null,this.entireBuffer.slice(k.firstByte,k.lastByte+1));else{const N=Object.assign({},this.requestParams,{headers:{Range:`bytes=${k.firstByte}-${k.lastByte}`}}),B=i.bi(N,z);this._fetchQueue.push(()=>{B.cancel(),w.cancel()})}else d(null)}updateNeeded(t,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,s){if(!this._mrt)return;const d=this._mrt.getLayer(t);if(!d||!d.hasBand(s)||!d.hasDataForBand(s))return;const{bytes:_,tileSize:y,buffer:w,offset:C,scale:z}=d.getBandView(s),L=y+2*w,k={data:_,width:L,height:L},N=this.texture;N&&N instanceof i.T&&N.update(k,{premultiply:!1}),this.textureDescriptor={layer:t,band:s,img:k,buffer:w,offset:C,tileSize:y,format:d.pixelFormat,mix:[z,256*z,65536*z,16777216*z]}}}class nd{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,d){const _=t.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const y={value:s,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},d)),this.data[_].push(y),this.order.push(_),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const d=t.wrapped().key,_=s===void 0?0:this.data[d].indexOf(s),y=this.data[d][_];return this.data[d].splice(_,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const d in this.data)for(const _ of this.data[d])t(_.value)||s.push(_);for(const d of s)this.remove(d.value.tileID,d)}}class Ka{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,d){const _=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][_]=this.stateChanges[t][_]||{},i.l(this.stateChanges[t][_],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==_&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][_]===null){this.deletedStates[t][_]={};for(const y in this.state[t][_])d[y]||(this.deletedStates[t][_][y]=null)}else for(const y in d)this.deletedStates[t]&&this.deletedStates[t][_]&&this.deletedStates[t][_][y]===null&&delete this.deletedStates[t][_][y]}removeFeatureState(t,s,d){if(this.deletedStates[t]===null)return;const _=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&s!==void 0)this.deletedStates[t][_]!==null&&(this.deletedStates[t][_]=this.deletedStates[t][_]||{},this.deletedStates[t][_][d]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][_])for(d in this.deletedStates[t][_]={},this.stateChanges[t][_])this.deletedStates[t][_][d]=null;else this.deletedStates[t][_]=null;else this.deletedStates[t]=null}getState(t,s){const d=this.state[t]||{},_=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(s!==void 0){const C=String(s),z=i.l({},d[C],_[C]);if(y){const L=y[s];if(L===null)return{};for(const k in L)delete z[k]}return z}const w=i.l({},d,_);if(y)for(const C in y)delete w[C];return w}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const d={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const y={};for(const w in this.stateChanges[_])this.state[_][w]||(this.state[_][w]={}),i.l(this.state[_][w],this.stateChanges[_][w]),y[w]=this.state[_][w];d[_]=y}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const y={};if(this.deletedStates[_]===null)for(const w in this.state[_])y[w]={},this.state[_][w]={};else for(const w in this.deletedStates[_]){if(this.deletedStates[_][w]===null)this.state[_][w]={};else if(this.state[_][w])for(const C of Object.keys(this.deletedStates[_][w]))delete this.state[_][w][C];y[w]=this.state[_][w]}d[_]=d[_]||{},i.l(d[_],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const _ in t)t[_].refreshFeatureState(s)}}class _s extends i.E{constructor(t,s,d){super(),this.id=t,this._onlySymbols=d,s.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new nd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ka,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const d=this._tiles[s];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return i.bj(this._tiles).map(t=>t.tileID).sort(gu).map(t=>t.key)}getRenderableIds(t,s){const d=[];for(const _ in this._tiles)this._isIdRenderable(+_,t,s)&&d.push(this._tiles[_]);return t?d.sort((_,y)=>{const w=_.tileID,C=y.tileID,z=new i.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),L=new i.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-C.overscaledZ||L.y-z.y||L.x-z.x}).map(_=>_.tileID.key):d.map(_=>_.tileID).sort(gu).map(_=>_.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=s),this._loadTile(d,this._tileLoaded.bind(this,d,t,s)))}_tileLoaded(t,s,d,_){if(_)if(t.state="errored",_.status!==404)this._source.fire(new i.y(_,{tile:t}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=i.q.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new i.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let _=0;_<s.length;_++){const y=s[_];if(t.neighboringTiles&&t.neighboringTiles[y]){const w=this.getTileByID(y);d(t,w),d(w,t)}}function d(_,y){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let w=y.tileID.canonical.x-_.tileID.canonical.x;const C=y.tileID.canonical.y-_.tileID.canonical.y,z=Math.pow(2,_.tileID.canonical.z),L=y.tileID.key;w===0&&C===0||Math.abs(C)>1||(Math.abs(w)>1&&(Math.abs(w+z)===1?w+=z:Math.abs(w-z)===1&&(w-=z)),y.dem&&_.dem&&(_.dem.backfillBorder(y.dem,w,C),_.neighboringTiles&&_.neighboringTiles[L]&&(_.neighboringTiles[L].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,d,_){for(const y in this._tiles){let w=this._tiles[y];if(_[y]||!w.hasData()||w.tileID.overscaledZ<=s||w.tileID.overscaledZ>d)continue;let C=w.tileID;for(;w&&w.tileID.overscaledZ>s+1;){const L=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[L.key],w&&w.hasData()&&(C=L)}let z=C;for(;z.overscaledZ>s;)if(z=z.scaledTo(z.overscaledZ-1),t[z.key]){_[C.key]=C;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=s?d:null}for(let d=t.overscaledZ-1;d>=s;d--){const _=t.scaledTo(d),y=this._getLoadedTile(_);if(y)return y}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const d=Math.ceil(t.width/s)+1,_=Math.ceil(t.height/s)+1,y=Math.floor(d*_*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(C)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const d={};for(const _ in this._tiles){const y=this._tiles[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+s),d[y.tileID.key]=y}this._tiles=d;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(t,s,d,_){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const y=this._source.type==="batched-model";let w,C=this._source.maxzoom;const z=this.map&&this.map.painter?this.map.painter._terrain:null;if(z&&z.sourceCache===this&&z.attenuationRange()){const N=z.attenuationRange()[0],B=Math.floor(N)-Math.log2(z.getDemUpscale());C>B&&(C=B)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(N=>new i.aG(N.canonical.z,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y));else if(this.tileCoverLift!==0){const N=t.clone();N.tileCoverLift=this.tileCoverLift,w=N.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.minzoom<=1&&t.projection.name==="globe"&&(w.push(new i.aG(1,0,1,0,0)),w.push(new i.aG(1,0,1,1,0)),w.push(new i.aG(1,0,1,0,1)),w.push(new i.aG(1,0,1,1,1)))}else if(w=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.hasTile){const N=this._source.hasTile.bind(this._source);w=w.filter(B=>N(B))}}else w=[];if(w.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!yu(this._source.type)){const N=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),B=Math.min(N,this._source.maxzoom);if(y){const G=t.extendTileCover(w,B);for(const Y of G)w.push(Y)}else{const G=t.extendTileCover(w,B,_);for(const Y of G)this._shadowCasterTiles[Y.key]=!0,w.push(Y)}}const L=this._updateRetainedTiles(w);if(yu(this._source.type)&&w.length!==0){const N={},B={},G=Object.keys(L);for(const X of G){const J=L[X],Q=this._tiles[X];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=i.q.now())continue;const re=this.findLoadedParent(J,Math.max(J.overscaledZ-_s.maxOverzooming,this._source.minzoom));re&&(this._addTile(re.tileID),N[re.tileID.key]=re.tileID),B[X]=J}const Y=w[w.length-1].overscaledZ;for(const X in this._tiles){const J=this._tiles[X];if(L[X]||!J.hasData())continue;let Q=J.tileID;for(;Q.overscaledZ>Y;){Q=Q.scaledTo(Q.overscaledZ-1);const re=this._tiles[Q.key];if(re&&re.hasData()&&B[Q.key]){L[X]=J.tileID;break}}}for(const X in N)L[X]||(this._coveredTiles[X]=!0,L[X]=N[X])}for(const N in L)this._tiles[N].clearFadeHold();const k=i.bk(this._tiles,L);for(const N of k){const B=this._tiles[N];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+N)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const d={},_=t.reduce((L,k)=>Math.min(L,k.overscaledZ),1/0),y=t[0].overscaledZ,w=Math.max(y-_s.maxOverzooming,this._source.minzoom),C=Math.max(y+_s.maxUnderzooming,this._source.minzoom),z={};for(const L of t){const k=this._addTile(L);s[L.key]=L,k.hasData()||_<this._source.maxzoom&&(z[L.key]=L)}this._retainLoadedChildren(z,_,C,s);for(const L of t){let k=this._tiles[L.key];if(k.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const B=L.children(this._source.maxzoom)[0],G=this.getTile(B);if(G&&G.hasData()){s[B.key]=B;continue}}else{const B=L.children(this._source.maxzoom);if(s[B[0].key]&&s[B[1].key]&&s[B[2].key]&&s[B[3].key])continue}let N=k.wasRequested();for(let B=L.overscaledZ-1;B>=w;--B){const G=L.scaledTo(B);if(d[G.key]||(d[G.key]=!0,k=this.getTile(G),!k&&N&&(k=this._addTile(G)),k&&(s[G.key]=G,N=k.wasRequested(),k.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let d,_=this._tiles[t].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){d=this._loadedParentTiles[_.key];break}s.push(_.key);const y=_.scaledTo(_.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;_=y}for(const y of s)this._loadedParentTiles[y]=d}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const d=!!s;if(!d){const _=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new _u(t,y,this.transform.tileZoom,_,this._isRaster):new Oo(t,y,this.transform.tileZoom,_,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s?(s.uses++,this._tiles[t.key]=s,d||this._source.fire(new i.z("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=s.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,d){const _=[],y=this.transform;if(!y)return _;const w=y.projection.name==="globe",C=i.at(y.center.lng);for(const z in this._tiles){const L=this._tiles[z];if(d&&L.clearQueryDebugViz(),L.holdingForFade())continue;let k;if(w){const N=L.tileID.canonical;if(N.z===0){const B=[Math.abs(i.aw(C,...Fi(N,-1))-C),Math.abs(i.aw(C,...Fi(N,1))-C)];k=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(i.aw(C,...Fi(N,-1))-C),Math.abs(i.aw(C,...Fi(N,0))-C),Math.abs(i.aw(C,...Fi(N,1))-C)];k=[B.indexOf(Math.min(...B))-1]}}else k=[0];for(const N of k){const B=t.containsTile(L,y,s,N);B&&_.push(B)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const d=this.getRenderableIds(t,s).map(y=>this._tiles[y].tileID),_=this.transform.projection.name==="globe";for(const y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=_?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return d}sortCoordinatesByDistance(t){const s=t.slice(),d=this.transform._camera.position,_=this.transform._camera.forward(),y={};for(const w of s){const C=1/(1<<w.canonical.z);y[w.key]=((w.canonical.x+.5)*C+w.wrap-d[0])*_[0]+((w.canonical.y+.5)*C-d[1])*_[1]-d[2]*_[2]}return s.sort((w,C)=>y[w.key]-y[C.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(yu(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(t,s,d){this._state.updateState(t=t||"_geojsonTileLayer",s,d)}removeFeatureState(t,s,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,d)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,d){const _=this._tiles[t];_&&_.setDependencies(s,d)}reloadTilesForDependencies(t,s){for(const d in this._tiles)this._tiles[d].hasDependency(t,s)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,s))}_preloadTiles(t,s){if(!this._sourceLoaded){const z=()=>{this._sourceLoaded&&(this._source.off("data",z),this._preloadTiles(t,s))};return void this._source.on("data",z)}const d=new Map,_=Array.isArray(t)?t:[t],y=this.map.painter.terrain,w=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const z of _){const L=z.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of L)d.set(k.key,k);this.usedForTerrain&&z.updateElevation(!1)}const C=Array.from(d.values());i.bl(C,(z,L)=>{const k=new Oo(z,this._source.tileSize*z.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(k,N=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),L(N,k)})},s)}}function gu(h,t){const s=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||d-s||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function yu(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Fi(h,t){const s=1<<h.z;return[h.x/s+t,(h.x+1)/s+t]}_s.maxOverzooming=10,_s.maxUnderzooming=3;class kg{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const d in this.style._mergedLayers){const _=this.style._mergedLayers[d];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:t,visibilityChanged:s});else if(_.type==="model"){const y=this.style.getLayerSource(_);y&&y.type==="batched-model"&&this.layers.push({layer:_,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const d=s.layer;let _=!1;d.type==="fill-extrusion"?_=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(_=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&s.visible,s.visible=_}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const _ of this.layers){const y=_.layer,w=this.style.getLayerSourceCache(y);let C=1;y.type==="fill-extrusion"&&(C=_.visible?y.paint.get("fill-extrusion-vertical-scale"):0);let z=w?w.getTile(s):null;if(!z&&w&&s.canonical.z>w.getSource().minzoom){let L=s.scaledTo(Math.min(w.getSource().maxzoom,s.overscaledZ-1));for(;L.overscaledZ>=w.getSource().minzoom&&(z=w.getTile(L),!z&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:z?z.getBucket(y):null,tileID:z?z.tileID:s,verticalScale:C})}t.hasAnyZOffset=!1;let d=!1;for(let _=0;_<t.symbolInstances.length;_++){const y=t.symbolInstances.get(_),w=y.zOffset,C=this._getHeightAtTileOffset(s,y.tileAnchorX,y.tileAnchorY);y.zOffset=C!==Number.NEGATIVE_INFINITY?C:w,d||w===y.zOffset||(d=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,d,_){let y=s,w=d;if(t.canonical.z!==_.canonical.z){const C=_.canonical,z=1/(1<<t.canonical.z-C.z);y=(s+t.canonical.x*i.ag)*z-C.x*i.ag|0,w=(d+t.canonical.y*i.ag)*z-C.y*i.ag|0}return{tileX:y,tileY:w}}_getHeightAtTileOffset(t,s,d){let _,y;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:z,verticalScale:L}=this.currentBuildingBuckets[w];if(!C)continue;const{tileX:k,tileY:N}=this._mapCoordToOverlappingTile(t,s,d,z),B=C.getHeightAtTileCoord(k,N);B&&B.height!==void 0&&(B.hidden?_=B.height:y=Math.max(B.height*L,y||0))}if(y!==void 0)return y;for(let w=0;w<this.layers.length;++w){const C=this.layers[w];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:z,tileID:L}=this.currentBuildingBuckets[w];if(!z)continue;const{tileX:k,tileY:N}=this._mapCoordToOverlappingTile(t,s,d,L),B=z.getHeightAtTileCoord(k,N);if(B&&!B.hidden)return B.height===void 0&&_!==void 0?Math.min(B.maxHeight,_)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ii(h,t){const s={};for(const d in h)d!=="ref"&&(s[d]=h[d]);return i.bm.forEach(d=>{d in t&&(s[d]=t[d])}),s}function rd(h){h=h.slice();const t=Object.create(null);for(let s=0;s<h.length;s++)t[h[s].id]=h[s];for(let s=0;s<h.length;s++)"ref"in h[s]&&(h[s]=ii(h[s],t[h[s].ref]));return h}const ki={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function xu(h,t,s){s.push({command:ki.addSource,args:[h,t[h]]})}function gs(h,t,s){t.push({command:ki.removeSource,args:[h]}),s[h]=!0}function sd(h,t,s,d){gs(h,s,d),xu(h,t,s)}function Ja(h,t,s){let d;for(d in h[s])if(h[s].hasOwnProperty(d)&&d!=="data"&&!i.bn(h[s][d],t[s][d]))return!1;for(d in t[s])if(t[s].hasOwnProperty(d)&&d!=="data"&&!i.bn(h[s][d],t[s][d]))return!1;return!0}function kt(h,t,s,d,_,y){let w;for(w in t=t||{},h=h||{})h.hasOwnProperty(w)&&(i.bn(h[w],t[w])||s.push({command:y,args:[d,w,t[w],_]}));for(w in t)t.hasOwnProperty(w)&&!h.hasOwnProperty(w)&&(i.bn(h[w],t[w])||s.push({command:y,args:[d,w,t[w],_]}))}function Gi(h){return h.id}function Oi(h,t){return h[t.id]=t,h}class jr{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=i.aw(t,0,1);let s=1,d=this._distances[s];const _=t*this.paddedLength+this.padding;for(;d<_&&s<this._distances.length;)d=this._distances[++s];const y=s-1,w=this._distances[y],C=d-w,z=C>0?(_-w)/C:0;return this.points[y].mult(1-z).add(this.points[s].mult(z))}}class da{constructor(t,s,d){const _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(s/d);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,d,_,y){this._forEachCell(s,d,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(t,s,d,_){this._forEachCell(s-_,d-_,s+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(d),this.circles.push(_)}_insertBoxCell(t,s,d,_,y,w){this.boxCells[y].push(w)}_insertCircleCell(t,s,d,_,y,w){this.circleCells[y].push(w)}_query(t,s,d,_,y,w){if(d<0||t>this.width||_<0||s>this.height)return!y&&[];const C=[];if(t<=0&&s<=0&&this.width<=d&&this.height<=_){if(y)return!0;for(let z=0;z<this.boxKeys.length;z++)C.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const L=this.circles[3*z],k=this.circles[3*z+1],N=this.circles[3*z+2];C.push({key:this.circleKeys[z],x1:L-N,y1:k-N,x2:L+N,y2:k+N})}return w?C.filter(w):C}return this._forEachCell(t,s,d,_,this._queryCell,C,{hitTest:y,seenUids:{box:{},circle:{}}},w),y?C.length>0:C}_queryCircle(t,s,d,_,y){const w=t-d,C=t+d,z=s-d,L=s+d;if(C<0||w>this.width||L<0||z>this.height)return!_&&[];const k=[];return this._forEachCell(w,z,C,L,this._queryCellCircle,k,{hitTest:_,circle:{x:t,y:s,radius:d},seenUids:{box:{},circle:{}}},y),_?k.length>0:k}query(t,s,d,_,y){return this._query(t,s,d,_,!1,y)}hitTest(t,s,d,_,y){return this._query(t,s,d,_,!0,y)}hitTestCircle(t,s,d,_){return this._queryCircle(t,s,d,!0,_)}_queryCell(t,s,d,_,y,w,C,z){const L=C.seenUids,k=this.boxCells[y];if(k!==null){const B=this.bboxes;for(const G of k)if(!L.box[G]){L.box[G]=!0;const Y=4*G;if(t<=B[Y+2]&&s<=B[Y+3]&&d>=B[Y+0]&&_>=B[Y+1]&&(!z||z(this.boxKeys[G]))){if(C.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[G],x1:B[Y],y1:B[Y+1],x2:B[Y+2],y2:B[Y+3]})}}}const N=this.circleCells[y];if(N!==null){const B=this.circles;for(const G of N)if(!L.circle[G]){L.circle[G]=!0;const Y=3*G;if(this._circleAndRectCollide(B[Y],B[Y+1],B[Y+2],t,s,d,_)&&(!z||z(this.circleKeys[G]))){if(C.hitTest)return w.push(!0),!0;{const X=B[Y],J=B[Y+1],Q=B[Y+2];w.push({key:this.circleKeys[G],x1:X-Q,y1:J-Q,x2:X+Q,y2:J+Q})}}}}}_queryCellCircle(t,s,d,_,y,w,C,z){const L=C.circle,k=C.seenUids,N=this.boxCells[y];if(N!==null){const G=this.bboxes;for(const Y of N)if(!k.box[Y]){k.box[Y]=!0;const X=4*Y;if(this._circleAndRectCollide(L.x,L.y,L.radius,G[X+0],G[X+1],G[X+2],G[X+3])&&(!z||z(this.boxKeys[Y])))return w.push(!0),!0}}const B=this.circleCells[y];if(B!==null){const G=this.circles;for(const Y of B)if(!k.circle[Y]){k.circle[Y]=!0;const X=3*Y;if(this._circlesCollide(G[X],G[X+1],G[X+2],L.x,L.y,L.radius)&&(!z||z(this.circleKeys[Y])))return w.push(!0),!0}}}_forEachCell(t,s,d,_,y,w,C,z){const L=this._convertToXCellCoord(t),k=this._convertToYCellCoord(s),N=this._convertToXCellCoord(d),B=this._convertToYCellCoord(_);for(let G=L;G<=N;G++)for(let Y=k;Y<=B;Y++)if(y.call(this,t,s,d,_,this.xCellCount*Y+G,w,C,z))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,d,_,y,w){const C=_-t,z=y-s,L=d+w;return L*L>C*C+z*z}_circleAndRectCollide(t,s,d,_,y,w,C){const z=(w-_)/2,L=Math.abs(t-(_+z));if(L>z+d)return!1;const k=(C-y)/2,N=Math.abs(s-(y+k));if(N>k+d)return!1;if(L<=z||N<=k)return!0;const B=L-z,G=N-k;return B*B+G*G<=d*d}}const Ci={unknown:0,flipRequired:1,flipNotRequired:2},vu=Math.tan(85*Math.PI/180);function oo(h,t,s,d,_,y,w){const C=i.ab.mat4.create();if(s)if(y.name==="globe"){const z=i.bo(_,t);i.ab.mat4.multiply(C,C,z)}else{const z=i.ab.mat2.invert([],w);C[0]=z[0],C[1]=z[1],C[4]=z[2],C[5]=z[3],d||i.ab.mat4.rotateZ(C,C,_.angle)}else i.ab.mat4.multiply(C,_.labelPlaneMatrix,h);return C}function fa(h,t,s,d,_,y,w){const C=oo(h,t,s,d,_,y,w);return y.name==="globe"&&s||(C[2]=C[6]=C[10]=C[14]=0),C}function Tr(h,t,s,d,_,y,w){if(s){if(y.name==="globe"){const C=oo(h,t,s,d,_,y,w);return i.ab.mat4.invert(C,C),i.ab.mat4.multiply(C,h,C),C}{const C=i.ab.mat4.clone(h),z=i.ab.mat4.identity([]);return z[0]=w[0],z[1]=w[1],z[4]=w[2],z[5]=w[3],i.ab.mat4.multiply(C,C,z),d||i.ab.mat4.rotateZ(C,C,-_.angle),C}}return _.glCoordMatrix}function hn(h,t,s,d){const _=[h,t,s,1];s?i.ab.vec4.transformMat4(_,_,d):ma(_,_,d);const y=_[3];return _[0]/=y,_[1]/=y,_[2]/=y,_}function Lp(h,t){return Math.min(.5+h/t*.5,1.5)}function sc(h,t){const s=h[0]/h[3],d=h[1]/h[3];return s>=-t[0]&&s<=t[0]&&d>=-t[1]&&d<=t[1]}function bu(h,t,s,d,_,y,w,C,z,L){const k=s.transform,N=d?h.textSizeData:h.iconSizeData,B=i.bp(N,s.transform.zoom),G=k.projection.name==="globe",Y=[256/s.width*2+1,256/s.height*2+1],X=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;X.clear();let J=null;G&&(J=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const Q=h.lineVertexArray,re=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,ue=s.transform.width/s.transform.height;let le,_e=!1;for(let fe=0;fe<re.length;fe++){const pe=re.get(fe),{numGlyphs:de,writingMode:be}=pe;if(be!==i.bq.vertical||_e||le===i.bq.horizontal||(_e=!0),le=be,(pe.hidden||be===i.bq.vertical)&&!_e){pa(de,X);continue}_e=!1;const Ie=new i.P(pe.tileAnchorX,pe.tileAnchorY);let{x:He,y:Ve,z:Ee}=k.projection.projectTilePoint(Ie.x,Ie.y,L.canonical);if(z){const[tt,wt,Et]=z(Ie);He+=tt,Ve+=wt,Ee+=Et}const Re=[He,Ve,Ee,1];if(i.ab.vec4.transformMat4(Re,Re,t),!sc(Re,Y)){pa(de,X);continue}const et=Re[3],ot=Lp(s.transform.getCameraToCenterDistance(k.projection),et),ft=i.br(N,B,pe),Ne=w?ft/ot:ft*ot,nt=hn(He,Ve,Ee,_);if(nt[3]<=0){pa(de,X);continue}let $e={};const ut=w?null:z,st=oc(pe,Ne,!1,C,t,_,y,h.glyphOffsetArray,Q,X,J,nt,Ie,$e,ue,ut,k.projection,L,w);_e=st.useVertical,ut&&st.needsFlipping&&($e={}),(st.notEnoughRoom||_e||st.needsFlipping&&oc(pe,Ne,!0,C,t,_,y,h.glyphOffsetArray,Q,X,J,nt,Ie,$e,ue,ut,k.projection,L,w).notEnoughRoom)&&pa(de,X)}d?(h.text.dynamicLayoutVertexBuffer.updateData(X),J&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(J)):(h.icon.dynamicLayoutVertexBuffer.updateData(X),J&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(J))}function Qa(h,t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X){const{lineStartIndex:J,glyphStartIndex:Q,segment:re}=C,ue=Q+C.numGlyphs,le=J+C.lineLength,_e=t.getoffsetX(Q),fe=t.getoffsetX(ue-1),pe=hr(h*_e,s,d,_,y,w,re,J,le,z,L,k,N,B,!0,G,Y,X);if(!pe)return null;const de=hr(h*fe,s,d,_,y,w,re,J,le,z,L,k,N,B,!0,G,Y,X);return de?{first:pe,last:de}:null}function wu(h,t,s,d){return h===i.bq.horizontal&&Math.abs(d)>Math.abs(s)?{useVertical:!0}:h===i.bq.vertical?d>0?{needsFlipping:!0}:null:t!==Ci.unknown&&function(_,y){return _===0||Math.abs(y/_)>vu}(s,d)?t===Ci.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function oc(h,t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X,J,Q,re){const ue=t/24,le=h.lineOffsetX*ue,_e=h.lineOffsetY*ue,{lineStartIndex:fe,glyphStartIndex:pe,numGlyphs:de,segment:be,writingMode:Ie,flipState:He}=h,Ve=fe+h.lineLength,Ee=Re=>{if(k){const[Ne,nt,$e]=Re.up,ut=L.length;i.bs(k,ut+0,Ne,nt,$e),i.bs(k,ut+1,Ne,nt,$e),i.bs(k,ut+2,Ne,nt,$e),i.bs(k,ut+3,Ne,nt,$e)}const[et,ot,ft]=Re.point;i.bt(L,et,ot,ft,Re.angle)};if(de>1){const Re=Qa(ue,C,le,_e,s,N,B,h,z,y,G,X,!1,J,Q,re);if(!Re)return{notEnoughRoom:!0};if(d&&!s){let[et,ot,ft]=Re.first.point,[Ne,nt,$e]=Re.last.point;[et,ot]=hn(et,ot,ft,w),[Ne,nt]=hn(Ne,nt,$e,w);const ut=wu(Ie,He,(Ne-et)*Y,nt-ot);if(h.flipState=ut&&ut.needsFlipping?Ci.flipRequired:Ci.flipNotRequired,ut)return ut}Ee(Re.first);for(let et=pe+1;et<pe+de-1;et++){const ot=hr(ue*C.getoffsetX(et),le,_e,s,N,B,be,fe,Ve,z,y,G,X,!1,!1,J,Q,re);if(!ot)return L.length-=4*(et-pe),{notEnoughRoom:!0};Ee(ot)}Ee(Re.last)}else{if(d&&!s){const et=hn(B.x,B.y,0,_),ot=fe+be+1,ft=new i.P(z.getx(ot),z.gety(ot)),Ne=hn(ft.x,ft.y,0,_),nt=Ne[3]>0?Ne:Ys(B,ft,et,1,_,void 0,J,Q.canonical),$e=wu(Ie,He,(nt[0]-et[0])*Y,nt[1]-et[1]);if(h.flipState=$e&&$e.needsFlipping?Ci.flipRequired:Ci.flipNotRequired,$e)return $e}const Re=hr(ue*C.getoffsetX(pe),le,_e,s,N,B,be,fe,Ve,z,y,G,X,!1,!1,J,Q,re);if(!Re)return{notEnoughRoom:!0};Ee(Re)}return{}}function Sr(h,t,s,d,_){const{x:y,y:w,z:C}=d.projectTilePoint(h.x,h.y,t);if(!_)return hn(y,w,C,s);const[z,L,k]=_(h);return hn(y+z,w+L,C+k,s)}function Ys(h,t,s,d,_,y,w,C){const z=Sr(h.sub(t)._unit()._add(h),C,_,w,y);return i.ab.vec3.sub(z,s,z),i.ab.vec3.normalize(z,z),i.ab.vec3.scaleAndAdd(z,s,z,d)}function hr(h,t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X,J,Q){const re=d?h-t:h+t;let ue=re>0?1:-1,le=0;d&&(ue*=-1,le=Math.PI),ue<0&&(le+=Math.PI);let _e=C+w+(ue>0?0:1)|0,fe=_,pe=_,de=0,be=0;const Ie=Math.abs(re),He=[],Ve=[];let Ee=y,Re=Ee;const et=()=>Ys(Re,Ee,pe,Ie-de+1,k,B,X,J.canonical);for(;de+be<=Ie;){if(_e+=ue,_e<C||_e>=z)return null;if(pe=fe,Re=Ee,He.push(pe),G&&Ve.push(Re),Ee=new i.P(L.getx(_e),L.gety(_e)),fe=N[_e],!fe){const wt=Sr(Ee,J.canonical,k,X,B);fe=wt[3]>0?N[_e]=wt:et()}de+=be,be=i.ab.vec3.distance(pe,fe)}Y&&B&&(N[_e]&&(fe=et(),be=i.ab.vec3.distance(pe,fe)),N[_e]=fe);const ot=(Ie-de)/be,ft=Ee.sub(Re)._mult(ot)._add(Re),Ne=i.ab.vec3.sub([],fe,pe),nt=i.ab.vec3.scaleAndAdd([],pe,Ne,ot);let $e=[0,0,1],ut=Ne[0],st=Ne[1];if(Q&&($e=X.upVector(J.canonical,ft.x,ft.y),$e[0]!==0||$e[1]!==0||$e[2]!==1)){const wt=[$e[2],0,-$e[0]],Et=i.ab.vec3.cross([],$e,wt);i.ab.vec3.normalize(wt,wt),i.ab.vec3.normalize(Et,Et),ut=i.ab.vec3.dot(Ne,wt),st=i.ab.vec3.dot(Ne,Et)}if(s){const wt=i.ab.vec3.cross([],$e,Ne);i.ab.vec3.normalize(wt,wt),i.ab.vec3.scaleAndAdd(nt,nt,wt,s*ue)}const tt=le+Math.atan2(st,ut);return He.push(nt),G&&Ve.push(ft),{point:nt,angle:tt,path:He,tilePath:Ve,up:$e}}function pa(h,t){const s=t.length,d=s+4*h;t.resize(d),t.float32.fill(-1/0,4*s,4*d)}function ma(h,t,s){const d=t[0],_=t[1];return h[0]=s[0]*d+s[4]*_+s[12],h[1]=s[1]*d+s[5]*_+s[13],h[3]=s[3]*d+s[7]*_+s[15],h}const xn=100;class Cs{constructor(t,s,d=new da(t.width+200,t.height+200,25),_=new da(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+xn,this.screenBottomBoundary=t.height+xn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,d,_,y,w,C,z){let L=d.projectedAnchorX,k=d.projectedAnchorY,N=d.projectedAnchorZ;const B=d.elevation,G=d.tileID,Y=t.getProjection();if(B&&G){const[fe,pe,de]=Y.upVector(G.canonical,d.tileAnchorX,d.tileAnchorY),be=Y.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=fe*B*be,k+=pe*B*be,N+=de*B*be}const X=this.projectAndGetPerspectiveRatio(C,L,k,N,d.tileID,Y.name==="globe"||!!B||this.transform.pitch>0,Y),J=w*X.perspectiveRatio,Q=(d.x1*s+_.x-d.padding)*J+X.point.x,re=(d.y1*s+_.y-d.padding)*J+X.point.y,ue=(d.x2*s+_.x+d.padding)*J+X.point.x,le=(d.y2*s+_.y+d.padding)*J+X.point.y,_e=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(Q,re,ue,le)||!y&&this.grid.hitTest(Q,re,ue,le,z)||_e?{box:[],offscreen:!1,occluded:X.occluded}:{box:[Q,re,ue,le],offscreen:this.isOffscreen(Q,re,ue,le),occluded:!1}}placeCollisionCircles(t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X){const J=[],Q=this.transform.elevation,re=t.getProjection(),ue=Q?Q.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,re):null,le=new i.P(d.tileAnchorX,d.tileAnchorY);let{x:_e,y:fe,z:pe}=re.projectTilePoint(le.x,le.y,X.canonical);if(ue){const[ft,Ne,nt]=ue(le);_e+=ft,fe+=Ne,pe+=nt}const de=re.name==="globe",be=this.projectAndGetPerspectiveRatio(C,_e,fe,pe,X,de||!!Q||this.transform.pitch>0,re),{perspectiveRatio:Ie}=be,He=(N?w/Ie:w*Ie)/i.bw,Ve=hn(_e,fe,pe,z),Ee=be.signedDistanceFromCamera>0?Qa(He,y,d.lineOffsetX*He,d.lineOffsetY*He,!1,Ve,le,d,_,z,{},Q&&!N?ue:null,N&&!!Q,re,X,N):null;let Re=!1,et=!1,ot=!0;if(Ee&&!be.occluded){const ft=.5*G*Ie+Y,Ne=new i.P(-100,-100),nt=new i.P(this.screenRightBoundary,this.screenBottomBoundary),$e=new jr,{first:ut,last:st}=Ee,tt=ut.path.length;let wt=[];for(let Rt=tt-1;Rt>=1;Rt--)wt.push(ut.path[Rt]);for(let Rt=1;Rt<st.path.length;Rt++)wt.push(st.path[Rt]);const Et=2.5*ft;L&&(wt=wt.map(([Rt,oi,Zt],Wt)=>(ue&&!de&&(Zt=ue(Wt<tt-1?ut.tilePath[tt-1-Wt]:st.tilePath[Wt-tt+2])[2]),hn(Rt,oi,Zt,L))),wt.some(Rt=>Rt[3]<=0)&&(wt=[]));let gt=[];if(wt.length>0){let Rt=1/0,oi=-1/0,Zt=1/0,Wt=-1/0;for(const ai of wt)Rt=Math.min(Rt,ai[0]),Zt=Math.min(Zt,ai[1]),oi=Math.max(oi,ai[0]),Wt=Math.max(Wt,ai[1]);oi>=Ne.x&&Rt<=nt.x&&Wt>=Ne.y&&Zt<=nt.y&&(gt=[wt.map(ai=>new i.P(ai[0],ai[1]))],(Rt<Ne.x||oi>nt.x||Zt<Ne.y||Wt>nt.y)&&(gt=i.bu(gt,Ne.x,Ne.y,nt.x,nt.y)))}for(const Rt of gt){$e.reset(Rt,.25*ft);let oi=0;oi=$e.length<=.5*ft?1:Math.ceil($e.paddedLength/Et)+1;for(let Zt=0;Zt<oi;Zt++){const Wt=Zt/Math.max(oi-1,1),ai=$e.lerp(Wt),Pi=ai.x+xn,yi=ai.y+xn;J.push(Pi,yi,ft,0);const gn=Pi-ft,an=yi-ft,Hi=Pi+ft,Yi=yi+ft;if(ot=ot&&this.isOffscreen(gn,an,Hi,Yi),et=et||this.isInsideGrid(gn,an,Hi,Yi),!s&&this.grid.hitTestCircle(Pi,yi,ft,B)&&(Re=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!k&&Re||!et?[]:J,offscreen:ot,collisionDetected:Re,occluded:be.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let d=1/0,_=1/0,y=-1/0,w=-1/0;for(const k of t){const N=new i.P(k.x+xn,k.y+xn);d=Math.min(d,N.x),_=Math.min(_,N.y),y=Math.max(y,N.x),w=Math.max(w,N.y),s.push(N)}const C=this.grid.query(d,_,y,w).concat(this.ignoredGrid.query(d,_,y,w)),z={},L={};for(const k of C){const N=k.key;if(z[N.bucketInstanceId]===void 0&&(z[N.bucketInstanceId]={}),z[N.bucketInstanceId][N.featureIndex])continue;const B=[new i.P(k.x1,k.y1),new i.P(k.x2,k.y1),new i.P(k.x2,k.y2),new i.P(k.x1,k.y2)];i.bv(s,B)&&(z[N.bucketInstanceId][N.featureIndex]=!0,L[N.bucketInstanceId]===void 0&&(L[N.bucketInstanceId]=[]),L[N.bucketInstanceId].push(N.featureIndex))}return L}insertCollisionBox(t,s,d,_,y){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,d,_,y){const w=s?this.ignoredGrid:this.grid,C={bucketInstanceId:d,featureIndex:_,collisionGroupID:y};for(let z=0;z<t.length;z+=4)w.insertCircle(C,t[z],t[z+1],t[z+2])}projectAndGetPerspectiveRatio(t,s,d,_,y,w,C){const z=[s,d,_,1];let L=!1;_||this.transform.pitch>0?(i.ab.vec4.transformMat4(z,z,t),this.fogState&&y&&C.name!=="globe"&&(L=function(B,G,Y,X,J,Q){const re=Q.calculateFogTileMatrix(J),ue=[G,Y,X];return i.ab.vec3.transformMat4(ue,ue,re),ri(B,i.ab.vec3.length(ue),Q.pitch,Q._fov)}(this.fogState,s,d,_,y.toUnwrapped(),this.transform)>.9)):ma(z,z,t);const k=z[3];return{point:new i.P((z[0]/k+1)/2*this.transform.width+xn,(-z[1]/k+1)/2*this.transform.height+xn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/k*.5,1.5),signedDistanceFromCamera:k,occluded:w&&z[2]>k||L}}isOffscreen(t,s,d,_){return d<xn||t>=this.screenRightBoundary||_<xn||s>this.screenBottomBoundary}isInsideGrid(t,s,d,_){return d>=0&&t<this.gridRightBoundary&&_>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=i.ab.mat4.identity([]);return i.ab.mat4.translate(t,t,[-100,-100,0]),t}}function ys(h,t,s){const d=t.createTileMatrix(h,h.worldSize,s.toUnwrapped());return i.ab.mat4.multiply(new Float32Array(16),h.projMatrix,d)}function Bn(h,t,s){if(t.projection.name===s.projection.name)return h.projMatrix;const d=s.clone();return d.setProjection(t.projection),ys(d,t.getProjection(),h)}function ac(h,t,s){return t.name===s.projection.name?h.projMatrix:ys(s,t,h)}class xs{constructor(t,s,d,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class ao{constructor(t,s,d,_,y,w=!1){this.text=new xs(t?t.text:null,s,d,y),this.icon=new xs(t?t.icon:null,s,_,y),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class el{constructor(t,s,d,_=!1){this.text=t,this.icon=s,this.skipFade=d,this.clipped=_}}class _a{constructor(){this.invProjMatrix=i.ab.mat4.create(),this.viewportMatrix=i.ab.mat4.create(),this.circles=[]}}class Og{constructor(t,s,d,_,y){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=y}}class lo{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:d=>d.collisionGroupID===s}}return this.collisionGroups[t]}}function kp(h,t,s,d,_){const{horizontalAlign:y,verticalAlign:w}=i.bD(h),C=-(y-.5)*t,z=-(w-.5)*s,L=i.bC(h,d);return new i.P(C+L[0]*_,z+L[1]*_)}function Tu(h,t,s,d,_){const y=new i.P(h,t);return s&&y._rotate(d?_:-_),y}class Gr{constructor(t,s,d,_,y,w){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Cs(this.transform,y),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new lo(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,d,_,y=1){const w=d.getBucket(s),C=d.latestFeatureIndex;if(!w||!C||s.fqid!==w.layerIds[0])return;const z=w.layers[0].layout,L=w.layers[0].paint,k=d.collisionBoxArray,N=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),B=d.tileSize/i.ag,G=d.tileID.toUnwrapped();this.transform.setProjection(w.projection);const Y=(X=d.tileID,J=w.getProjection(),Q=this.transform,J.name===this.projection?Q.calculateProjMatrix(X.toUnwrapped()):ys(Q,J,X));var X,J,Q;const re=z.get("text-pitch-alignment")==="map",ue=z.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const le=s.dynamicFilter(),_e=s.dynamicFilterNeedsFeature(),fe=this.transform.calculatePixelsToTileUnitsMatrix(d),pe=fa(Y,d.tileID.canonical,re,ue,this.transform,w.getProjection(),fe);let de=null;if(re){const ft=Tr(Y,d.tileID.canonical,re,ue,this.transform,w.getProjection(),fe);de=i.ab.mat4.multiply([],this.transform.labelPlaneMatrix,ft)}let be=null;le&&d.latestFeatureIndex&&(be={unwrappedTileID:G,dynamicFilter:le,dynamicFilterNeedsFeature:_e}),this.retainedQueryData[w.bucketInstanceId]=new Og(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,d.tileID);const[Ie,He]=w.layers[0].layout.get("text-size-scale-range"),Ve=i.aw(y,Ie,He),[Ee,Re]=z.get("icon-size-scale-range"),et=i.aw(y,Ee,Re),ot={bucket:w,layout:z,paint:L,posMatrix:Y,textLabelPlaneMatrix:pe,labelToScreenMatrix:de,clippingData:be,scale:N,textPixelRatio:B,holdingForFade:d.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:i.bp(w.textSizeData,this.transform.zoom,Ve),partiallyEvaluatedIconSize:i.bp(w.iconSizeData,this.transform.zoom,et),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(_)for(const ft of w.sortKeyRanges){const{sortKey:Ne,symbolInstanceStart:nt,symbolInstanceEnd:$e}=ft;t.push({sortKey:Ne,symbolInstanceStart:nt,symbolInstanceEnd:$e,parameters:ot})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:ot})}attemptAnchorPlacement(t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X,J,Q,re){const{textOffset0:ue,textOffset1:le,crossTileID:_e}=B,fe=[ue,le],pe=kp(t,d,_,fe,y),de=this.collisionIndex.placeCollisionBox(Y,y,s,Tu(pe.x,pe.y,w,C,this.transform.angle),N,z,L,k.predicate);if(J){const be=Y.getSymbolInstanceIconSize(re,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,be,J,Tu(pe.x,pe.y,w,C,this.transform.angle),N,z,L,k.predicate).box.length===0)return}if(de.box.length>0){let be;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(be=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:fe,width:d,height:_,anchor:t,textScale:y,prevAnchor:be},this.markUsedJustification(Y,t,B,X),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,X,B),this.placedOrientations[_e]=X),{shift:pe,placedGlyphBoxes:de}}}placeLayerBucketPart(t,s,d,_,y=1){const{bucket:w,layout:C,paint:z,posMatrix:L,textLabelPlaneMatrix:k,labelToScreenMatrix:N,clippingData:B,textPixelRatio:G,holdingForFade:Y,collisionBoxArray:X,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:Q,collisionGroup:re,latestFeatureIndex:ue}=t.parameters,le=C.get("text-optional"),_e=C.get("icon-optional"),fe=C.get("text-allow-overlap"),pe=C.get("icon-allow-overlap"),de=C.get("text-rotation-alignment")==="map",be=C.get("text-pitch-alignment")==="map",Ie=C.get("symbol-z-elevate"),He=z.get("symbol-z-offset"),Ve=C.get("symbol-elevation-reference")==="sea",[Ee,Re]=C.get("text-size-scale-range"),[et,ot]=C.get("icon-size-scale-range"),ft=i.aw(y,Ee,Re),Ne=i.aw(y,et,ot);this.transform.setProjection(w.projection);let nt=fe&&(pe||!w.hasIconData()||_e),$e=pe&&(fe||!w.hasTextData()||le);const ut=!He.isConstant();!w.collisionArrays&&X&&w.deserializeCollisionBoxes(X),d&&_&&w.updateCollisionDebugBuffers(this.transform.zoom,X,ft,Ne);const st=(tt,wt,Et)=>{const{crossTileID:gt,numVerticalGlyphVertices:Rt}=tt;let oi=null;if(B&&B.dynamicFilterNeedsFeature||ut){const fn=this.retainedQueryData[w.bucketInstanceId];oi=ue.loadFeature({featureIndex:tt.featureIndex,bucketIndex:fn.bucketIndex,sourceLayerIndex:fn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},oi,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new i.P(tt.tileAnchorX,tt.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[gt]=new el(!1,!1,!1,!0),void s.add(gt);const Zt=He.evaluate(oi,{});if(s.has(gt))return;if(Y)return void(this.placements[gt]=new el(!1,!1,!1));let Wt=!1,ai=!1,Pi=!0,yi=!1,gn=!1,an=null,Hi={box:null,offscreen:null,occluded:null},Yi={box:null,offscreen:null,occluded:null},xi=null,zi=null,ei=null,Vi=0,Tn=0,dr=0;Et.textFeatureIndex?Vi=Et.textFeatureIndex:tt.useRuntimeCollisionCircles&&(Vi=tt.featureIndex),Et.verticalTextFeatureIndex&&(Tn=Et.verticalTextFeatureIndex);const Kr=fn=>{fn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const rn=this.transform.elevation;fn.elevation=Ve?Zt:Zt+(rn?rn.getAtTileOffset(fn.tileID,fn.tileAnchorX,fn.tileAnchorY):0),fn.elevation+=tt.zOffset},Er=Et.textBox;if(Er){Kr(Er);const fn=Ri=>{let An=i.bq.horizontal;if(w.allowVerticalPlacement&&!Ri&&this.prevPlacement){const rr=this.prevPlacement.placedOrientations[gt];rr&&(this.placedOrientations[gt]=rr,An=rr,this.markUsedOrientation(w,An,tt))}return An},rn=(Ri,An)=>{if(w.allowVerticalPlacement&&Rt>0&&Et.verticalTextBox){for(const rr of w.writingModes)if(rr===i.bq.vertical?(Hi=An(),Yi=Hi):Hi=Ri(),Hi&&Hi.box&&Hi.box.length)break}else Hi=Ri()};if(C.get("text-variable-anchor")){let Ri=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[gt]){const ln=this.prevPlacement.variableOffsets[gt];Ri.indexOf(ln.anchor)>0&&(Ri=Ri.filter(br=>br!==ln.anchor),Ri.unshift(ln.anchor))}const An=(ln,br,ls)=>{const Vr=w.getSymbolInstanceTextSize(J,tt,this.transform.zoom,wt),vo=(ln.x2-ln.x1)*Vr+2*ln.padding,eo=(ln.y2-ln.y1)*Vr+2*ln.padding,Ar=tt.hasIconTextFit&&!pe?br:null;Ar&&Kr(Ar);let cs={box:[],offscreen:!1,occluded:!1};const bo=fe?2*Ri.length:Ri.length;for(let Os=0;Os<bo;++Os){const Pa=this.attemptAnchorPlacement(Ri[Os%Ri.length],ln,vo,eo,Vr,de,be,G,L,re,Os>=Ri.length,tt,wt,w,ls,Ar,J,Q);if(Pa&&(cs=Pa.placedGlyphBoxes,cs&&cs.box&&cs.box.length)){Wt=!0,an=Pa.shift;break}}return cs};rn(()=>An(Er,Et.iconBox,i.bq.horizontal),()=>{const ln=Et.verticalTextBox;return ln&&Kr(ln),w.allowVerticalPlacement&&!(Hi&&Hi.box&&Hi.box.length)&&Rt>0&&ln?An(ln,Et.verticalIconBox,i.bq.vertical):{box:null,offscreen:null,occluded:null}}),Hi&&(Wt=Hi.box,Pi=Hi.offscreen,yi=Hi.occluded);const rr=fn(!(!Hi||!Hi.box));if(!Wt&&this.prevPlacement){const ln=this.prevPlacement.variableOffsets[gt];ln&&(this.variableOffsets[gt]=ln,this.markUsedJustification(w,ln.anchor,tt,rr))}}else{const Ri=(An,rr)=>{const ln=w.getSymbolInstanceTextSize(J,tt,this.transform.zoom,wt,y),br=this.collisionIndex.placeCollisionBox(w,ln,An,new i.P(0,0),fe,G,L,re.predicate);return br&&br.box&&br.box.length&&(this.markUsedOrientation(w,rr,tt),this.placedOrientations[gt]=rr),br};rn(()=>Ri(Er,i.bq.horizontal),()=>{const An=Et.verticalTextBox;return w.allowVerticalPlacement&&Rt>0&&An?(Kr(An),Ri(An,i.bq.vertical)):{box:null,offscreen:null,occluded:null}}),fn(!!(Hi&&Hi.box&&Hi.box.length))}}if(xi=Hi,Wt=xi&&xi.box&&xi.box.length>0,Pi=xi&&xi.offscreen,yi=xi&&xi.occluded,tt.useRuntimeCollisionCircles){const fn=w.text.placedSymbolArray.get(tt.centerJustifiedTextSymbolIndex>=0?tt.centerJustifiedTextSymbolIndex:tt.verticalPlacedTextSymbolIndex),rn=i.br(w.textSizeData,J,fn),Ri=C.get("text-padding");zi=this.collisionIndex.placeCollisionCircles(w,fe,fn,w.lineVertexArray,w.glyphOffsetArray,rn,L,k,N,d,be,re.predicate,tt.collisionCircleDiameter*rn/i.bw,Ri,this.retainedQueryData[w.bucketInstanceId].tileID),Wt=fe||zi.circles.length>0&&!zi.collisionDetected,Pi=Pi&&zi.offscreen,yi=zi.occluded}if(Et.iconFeatureIndex&&(dr=Et.iconFeatureIndex),Et.iconBox){const fn=rn=>{Kr(rn);const Ri=tt.hasIconTextFit&&an?Tu(an.x,an.y,de,be,this.transform.angle):new i.P(0,0),An=w.getSymbolInstanceIconSize(Q,this.transform.zoom,tt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,An,rn,Ri,pe,G,L,re.predicate)};Yi&&Yi.box&&Yi.box.length&&Et.verticalIconBox?(ei=fn(Et.verticalIconBox),ai=ei.box.length>0):(ei=fn(Et.iconBox),ai=ei.box.length>0),Pi=Pi&&ei.offscreen,gn=ei.occluded}const nr=le||tt.numHorizontalGlyphVertices===0&&Rt===0,Nn=_e||tt.numIconVertices===0;if(nr||Nn?Nn?nr||(ai=ai&&Wt):Wt=ai&&Wt:ai=Wt=ai&&Wt,Wt&&xi&&xi.box&&this.collisionIndex.insertCollisionBox(xi.box,C.get("text-ignore-placement"),w.bucketInstanceId,Yi&&Yi.box&&Tn?Tn:Vi,re.ID),ai&&ei&&this.collisionIndex.insertCollisionBox(ei.box,C.get("icon-ignore-placement"),w.bucketInstanceId,dr,re.ID),zi&&(Wt&&this.collisionIndex.insertCollisionCircles(zi.circles,C.get("text-ignore-placement"),w.bucketInstanceId,Vi,re.ID),d)){const fn=w.bucketInstanceId;let rn=this.collisionCircleArrays[fn];rn===void 0&&(rn=this.collisionCircleArrays[fn]=new _a);for(let Ri=0;Ri<zi.circles.length;Ri+=4)rn.circles.push(zi.circles[Ri+0]),rn.circles.push(zi.circles[Ri+1]),rn.circles.push(zi.circles[Ri+2]),rn.circles.push(zi.collisionDetected?1:0)}const Rn=w.projection.name!=="globe";nt=nt&&(Rn||!yi),$e=$e&&(Rn||!gn),this.placements[gt]=new el(Wt||nt,ai||$e,Pi||w.justReloaded),s.add(gt)};if(Ie&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),w.sortFeaturesByY){const tt=w.getSortedSymbolIndexes(this.transform.angle);for(let wt=tt.length-1;wt>=0;--wt){const Et=tt[wt];st(w.symbolInstances.get(Et),Et,w.collisionArrays[Et])}w.hasAnyZOffset&&i.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const tt=w.getSortedIndexesByZOffset();for(let wt=0;wt<tt.length;++wt){const Et=tt[wt];st(w.symbolInstances.get(Et),Et,w.collisionArrays[Et])}}else for(let tt=t.symbolInstanceStart;tt<t.symbolInstanceEnd;tt++)st(w.symbolInstances.get(tt),tt,w.collisionArrays[tt]);if(d&&w.bucketInstanceId in this.collisionCircleArrays){const tt=this.collisionCircleArrays[w.bucketInstanceId];i.ab.mat4.invert(tt.invProjMatrix,L),tt.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(t,s,d,_){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:z,crossTileID:L}=d,k=i.bB(s),N=_===i.bq.vertical?z:k==="left"?y:k==="center"?w:k==="right"?C:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=N>=0&&y!==N?0:L),w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=N>=0&&w!==N?0:L),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=N>=0&&C!==N?0:L),z>=0&&(t.text.placedSymbolArray.get(z).crossTileID=N>=0&&z!==N?0:L)}markUsedOrientation(t,s,d){const _=s===i.bq.horizontal||s===i.bq.horizontalOnly?s:0,y=s===i.bq.vertical?s:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:L}=d,k=t.text.placedSymbolArray;w>=0&&(k.get(w).placedOrientation=_),C>=0&&(k.get(C).placedOrientation=_),z>=0&&(k.get(z).placedOrientation=_),L>=0&&(k.get(L).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let d=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const _=s?s.symbolFadeChange(t):1,y=s?s.opacities:{},w=s?s.variableOffsets:{},C=s?s.placedOrientations:{};for(const z in this.placements){const L=this.placements[z],k=y[z];k?(this.opacities[z]=new ao(k,_,L.text,L.icon,null,L.clipped),d=d||L.text!==k.text.placed||L.icon!==k.icon.placed):(this.opacities[z]=new ao(null,_,L.text,L.icon,L.skipFade,L.clipped),d=d||L.text||L.icon)}for(const z in y){const L=y[z];if(!this.opacities[z]){const k=new ao(L,_,!1,!1);k.isHidden()||(this.opacities[z]=k,d=d||L.text.placed||L.icon.placed)}}for(const z in w)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=w[z]);for(const z in C)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=C[z]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,d,_){const y=new Set;for(const w of s){const C=w.getBucket(t);C&&w.latestFeatureIndex&&t.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,y,w,w.collisionBoxArray,d,_,w.tileID,t.scope),C.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,w.tileID),C.updateZOffset()))}}updateBucketOpacities(t,s,d,_,y,w,C,z){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const L=t.layers[0].layout,k=t.layers[0].paint,N=!!t.layers[0].dynamicFilter(),B=new ao(null,0,!1,!1,!0),G=L.get("text-allow-overlap"),Y=L.get("icon-allow-overlap"),X=L.get("text-variable-anchor"),J=L.get("text-rotation-alignment")==="map",Q=L.get("text-pitch-alignment")==="map",re=k.get("symbol-z-offset"),ue=L.get("symbol-elevation-reference")==="sea",le=!re.isConstant(),_e=new ao(null,0,G&&(Y||!t.hasIconData()||L.get("icon-optional")),Y&&(G||!t.hasTextData()||L.get("text-optional")),!0);!t.collisionArrays&&_&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(_);const fe=(de,be,Ie)=>{for(let He=0;He<be/4;He++)de.opacityVertexArray.emplaceBack(Ie)};let pe=0;w&&t.updateReplacement(C,w);for(let de=0;de<t.symbolInstances.length;de++){const be=t.symbolInstances.get(de),{numHorizontalGlyphVertices:Ie,numVerticalGlyphVertices:He,crossTileID:Ve,numIconVertices:Ee,tileAnchorX:Re,tileAnchorY:et}=be;let ot=null;const ft=this.retainedQueryData[t.bucketInstanceId];le&&be&&ft&&(ot=d.latestFeatureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:ft.bucketIndex,sourceLayerIndex:ft.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ne=re.evaluate(ot,{}),nt=s.has(Ve);let $e=this.opacities[Ve];nt?$e=B:$e||($e=_e,this.opacities[Ve]=$e),s.add(Ve);const ut=Ie>0||He>0,st=Ee>0,tt=this.placedOrientations[Ve],wt=tt===i.bq.vertical,Et=tt===i.bq.horizontal||tt===i.bq.horizontalOnly;!ut&&!st||$e.isHidden()||pe++;let gt=!1;if((ut||st)&&w)for(const Rt of t.activeReplacements){if(i.bx(Rt,y,i.by.Symbol,z)||Rt.min.x>Re||Re>Rt.max.x||Rt.min.y>et||et>Rt.max.y)continue;const oi=i.bz(Re,et,C.canonical,Rt.footprintTileId.canonical);if(gt=i.bA(oi,Rt.footprint),gt)break}if(ut){const Rt=gt?Ps:Fp($e.text);fe(t.text,Ie,wt?Ps:Rt),fe(t.text,He,Et?Ps:Rt);const oi=$e.text.isHidden(),{leftJustifiedTextSymbolIndex:Zt,centerJustifiedTextSymbolIndex:Wt,rightJustifiedTextSymbolIndex:ai,verticalPlacedTextSymbolIndex:Pi}=be,yi=t.text.placedSymbolArray,gn=oi||wt?1:0;Zt>=0&&(yi.get(Zt).hidden=gn),Wt>=0&&(yi.get(Wt).hidden=gn),ai>=0&&(yi.get(ai).hidden=gn),Pi>=0&&(yi.get(Pi).hidden=oi||Et?1:0);const an=this.variableOffsets[Ve];an&&this.markUsedJustification(t,an.anchor,be,tt);const Hi=this.placedOrientations[Ve];Hi&&(this.markUsedJustification(t,"left",be,Hi),this.markUsedOrientation(t,Hi,be))}if(st){const Rt=gt?Ps:Fp($e.icon),{placedIconSymbolIndex:oi,verticalPlacedIconSymbolIndex:Zt}=be,Wt=t.icon.placedSymbolArray,ai=$e.icon.isHidden()?1:0;oi>=0&&(fe(t.icon,Ee,wt?Ps:Rt),Wt.get(oi).hidden=ai),Zt>=0&&(fe(t.icon,be.numVerticalIconVertices,Et?Ps:Rt),Wt.get(Zt).hidden=ai)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Rt=t.collisionArrays[de];if(Rt){let oi=new i.P(0,0),Zt=!0;if(Rt.textBox||Rt.verticalTextBox){if(X){const ai=this.variableOffsets[Ve];ai?(oi=kp(ai.anchor,ai.width,ai.height,ai.textOffset,ai.textScale),J&&oi._rotate(Q?this.transform.angle:-this.transform.angle)):Zt=!1}N&&(Zt=!$e.clipped),Rt.textBox&&Su(t.textCollisionBox.collisionVertexArray,$e.text.placed,!Zt||wt,Ne,ue,oi.x,oi.y),Rt.verticalTextBox&&Su(t.textCollisionBox.collisionVertexArray,$e.text.placed,!Zt||Et,Ne,ue,oi.x,oi.y)}const Wt=Zt&&!!(!Et&&Rt.verticalIconBox);Rt.iconBox&&Su(t.iconCollisionBox.collisionVertexArray,$e.icon.placed,Wt,Ne,ue,be.hasIconTextFit?oi.x:0,be.hasIconTextFit?oi.y:0),Rt.verticalIconBox&&Su(t.iconCollisionBox.collisionVertexArray,$e.icon.placed,!Wt,Ne,ue,be.hasIconTextFit?oi.x:0,be.hasIconTextFit?oi.y:0)}}}if(t.fullyClipped=pe===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const de=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=de.invProjMatrix,t.placementViewportMatrix=de.viewportMatrix,t.collisionCircleArray=de.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const d=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Su(h,t,s,d,_,y,w){h.emplaceBack(t?1:0,s?1:0,y||0,w||0,d,_?1:0),h.emplaceBack(t?1:0,s?1:0,y||0,w||0,d,_?1:0),h.emplaceBack(t?1:0,s?1:0,y||0,w||0,d,_?1:0),h.emplaceBack(t?1:0,s?1:0,y||0,w||0,d,_?1:0)}const Mu=Math.pow(2,25),Op=Math.pow(2,24),lc=Math.pow(2,17),Fg=Math.pow(2,16),Bg=Math.pow(2,9),cc=Math.pow(2,8),uc=Math.pow(2,1);function Fp(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,s=Math.floor(127*h.opacity);return s*Mu+t*Op+s*lc+t*Fg+s*Bg+t*cc+s*uc+t}const Ps=0;class Bp{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,d,_,y,w){const C=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(C,_,t[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((z,L)=>z.sortKey-L.sortKey));this._currentPartIndex<C.length;){const z=C[this._currentPartIndex];if(s.placeLayerBucketPart(z,this._seenCrossTileIDs,d,z.symbolInstanceStart===0,w),this._currentPartIndex++,y())return!0}return!1}}class Eu{constructor(t,s,d,_,y,w,C,z,L){this.placement=new Gr(t,y,w,C,z,L),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,s,d,_,y){const w=i.q.now(),C=()=>{const z=i.q.now()-w;return!this._forceFullPlacement&&z>2};for(;this._currentPlacementIndex>=0;){const z=s[t[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=L)&&(!z.maxzoom||z.maxzoom>L)){const k=z,N=k.layout.get("symbol-z-elevate"),B=k.layout.get("symbol-sort-key").constantOr(1)!==void 0,G=k.layout.get("symbol-z-order"),Y=G==="viewport-y"||G==="auto"&&!(G!=="viewport-y"&&B),X=k.layout.get("text-allow-overlap")||k.layout.get("icon-allow-overlap")||k.layout.get("text-ignore-placement")||k.layout.get("icon-ignore-placement"),J=Y&&X,Q=this._inProgressLayer=this._inProgressLayer||new Bp(k),re=i.aC(z.source,z.scope);if(Q.continuePlacement(N||J?_[re]:d[re],this.placement,this._showCollisionBoxes,z,C,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ks=512/i.ag/2;class Ng{constructor(t,s,d){this.tileID=t,this.bucketInstanceId=d,this.index=new i.bE(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=t.canonical.x*i.ag,y=t.canonical.y*i.ag;for(let w=0;w<s.length;w++){const{key:C,crossTileID:z,tileAnchorX:L,tileAnchorY:k}=s.get(w),N=Math.floor((_+L)*Ks),B=Math.floor((y+k)*Ks);this.index.add(N,B),this.keys.push(C),this.crossTileIDs.push(z)}this.index.finish()}findMatches(t,s,d){const _=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),y=Ks/Math.pow(2,s.canonical.z-this.tileID.canonical.z),w=s.canonical.x*i.ag,C=s.canonical.y*i.ag;for(let z=0;z<t.length;z++){const L=t.get(z);if(L.crossTileID)continue;const{key:k,tileAnchorX:N,tileAnchorY:B}=L,G=Math.floor((w+N)*y),Y=Math.floor((C+B)*y),X=this.index.range(G-_,Y-_,G+_,Y+_);for(const J of X){const Q=this.crossTileIDs[J];if(this.keys[J]===k&&!d.has(Q)){d.add(Q),L.crossTileID=Q;break}}}}}class Vg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ug{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const d in this.indexes){const _=this.indexes[d],y={};for(const w in _){const C=_[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+s),y[C.tileID.key]=C}this.indexes[d]=y}this.lng=t}addBucket(t,s,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const _=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>t.overscaledZ)for(const C in w){const z=w[C];z.tileID.isChildOf(t)&&z.findMatches(s.symbolInstances,t,_)}else{const C=w[t.scaledTo(Number(y)).key];C&&C.findMatches(s.symbolInstances,t,_)}}for(let y=0;y<s.symbolInstances.length;y++){const w=s.symbolInstances.get(y);w.crossTileID||(w.crossTileID=d.generate(),_.add(w.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ng(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const d of s.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let s=!1;for(const d in this.indexes){const _=this.indexes[d];for(const y in _)t[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[y]),delete _[y],s=!0)}return s}}class Np{constructor(){this.layerIndexes={},this.crossTileIDs=new Vg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,d,_){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new Ug);let w=!1;const C={};_.name!=="globe"&&y.handleWrapJump(d);for(const z of s){const L=z.getBucket(t);L&&t.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(z.tileID,L,this.crossTileIDs)&&(w=!0),C[L.bucketInstanceId]=!0)}return y.removeStaleBuckets(C)&&(w=!0),w}pruneUnusedLayers(t){const s={};t.forEach(d=>{s[d]=!0});for(const d in this.layerIndexes)s[d]||delete this.layerIndexes[d]}}const tl=771;class bi{constructor(t,s,d,_){this.blendFunction=t,this.blendColor=s,this.mask=d,this.blendEquation=_}}bi.Replace=[1,0,1,0],bi.disabled=new bi(bi.Replace,i.aj.transparent,[!1,!1,!1,!1]),bi.unblended=new bi(bi.Replace,i.aj.transparent,[!0,!0,!0,!0]),bi.alphaBlended=new bi([1,tl,1,tl],i.aj.transparent,[!0,!0,!0,!0]),bi.alphaBlendedNonPremultiplied=new bi([770,tl,770,tl],i.aj.transparent,[!0,!0,!0,!0]),bi.multiply=new bi([774,0,774,0],i.aj.transparent,[!0,!0,!0,!0]);class $t{constructor(t,s,d){this.func=t,this.mask=s,this.range=d}}$t.ReadOnly=!1,$t.ReadWrite=!0,$t.disabled=new $t(519,$t.ReadOnly,[0,1]);const Au=7680;class hi{constructor(t,s,d,_,y,w){this.test=t,this.ref=s,this.mask=d,this.fail=_,this.depthFail=y,this.pass=w}}hi.disabled=new hi({func:519,mask:0},0,0,Au,Au,Au);const Iu=1029,co=2305;class ni{constructor(t,s,d){this.enable=t,this.mode=s,this.frontFace=d}}function od(h,t){const s=i.bG(h,3);i.ab.mat4.fromQuat(h,t),i.bI(h,3,s)}function Cu(h,t){const s=i.ab.quat.identity([]);return i.ab.quat.rotateZ(s,s,-t),i.ab.quat.rotateX(s,s,-h),s}function il(h,t){const s=[h[0],h[1],0],d=[t[0],t[1],0];if(i.ab.vec3.length(s)>=1e-15){const w=i.ab.vec3.normalize([],s);i.ab.vec3.scale(d,w,i.ab.vec3.dot(d,w)),t[0]=d[0],t[1]=d[1]}const _=i.ab.vec3.cross([],t,h);if(i.ab.vec3.len(_)<1e-15)return null;const y=Math.atan2(-_[1],_[0]);return Cu(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}ni.disabled=new ni(!1,Iu,co),ni.backCCW=new ni(!0,Iu,co),ni.backCW=new ni(!0,Iu,2304),ni.frontCW=new ni(!0,1028,2304),ni.frontCCW=new ni(!0,1028,co);class nl{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof i.aa?t:new i.aa(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=i.bF(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const d=this.position,_=this._elevation?this._elevation.getAtPointOrZero(i.aa.fromLngLat(t)):0,y=i.aa.fromLngLat(t,_),w=[y.x-d.x,y.y-d.y,y.z-d.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=il(w,s)}setPitchBearing(t,s){this.orientation=Cu(i.ai(t),i.ai(-s))}}class hc{constructor(t,s){this._transform=i.ab.mat4.identity([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new i.aa(t[0],t[1],t[2])}get position(){const t=i.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&i.bI(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||i.ab.quat.identity([]),t&&od(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=Cu(t,s),od(this._transform,this._orientation)}forward(){const t=i.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=i.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=i.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const d=new Float64Array(16);return i.ab.mat4.invert(d,this.getWorldToCamera(t,s)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,d){const _=this.position;i.ab.vec3.scale(_,_,-t);const y=new Float64Array(16);return i.ab.mat4.fromScaling(y,[d,d,d]),i.ab.mat4.translate(y,y,_),y[10]*=s,y}getWorldToCamera(t,s){const d=new Float64Array(16),_=new Float64Array(4),y=this.position;return i.ab.quat.conjugate(_,this._orientation),i.ab.vec3.scale(y,y,-t),i.ab.mat4.fromQuat(d,_),i.ab.mat4.translate(d,d,y),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=s,d[9]*=s,d[10]*=s,d[11]*=s,d}getCameraToClipPerspective(t,s,d,_){const y=new Float64Array(16);return i.ab.mat4.perspective(y,t,s,d,_),y}getCameraToClipOrthographic(t,s,d,_,y,w){const C=new Float64Array(16);return i.ab.mat4.ortho(C,t,s,d,_,y,w),C}getDistanceToElevation(t,s=!1){const d=t===0?0:i.bH(t,s?i.aS(this.position[1]):this.position[1]),_=this.forward();return(d-this.position[2])/_[2]}clone(){return new hc([...this.position],[...this.orientation])}}const yr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Hr{constructor(t=0,s=0,d=0,_=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=d,this.right=_}interpolate(t,s,d){return s.top!=null&&t.top!=null&&(this.top=i.af(t.top,s.top,d)),s.bottom!=null&&t.bottom!=null&&(this.bottom=i.af(t.bottom,s.bottom,d)),s.left!=null&&t.left!=null&&(this.left=i.af(t.left,s.left,d)),s.right!=null&&t.right!=null&&(this.right=i.af(t.right,s.right,d)),this}getCenter(t,s){const d=i.aw((this.left+t-this.right)/2,0,t),_=i.aw((this.top+s-this.bottom)/2,0,s);return new i.P(d,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Hr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Pu=(h,t,s)=>(1-s)*h+s*t,vt=h=>h*h*h*h*h;class Du{constructor(t,s,d,_,y,w,C){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=d??0,this._maxPitch=_??60,this.setProjection(w),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new i.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Hr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new hc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Du(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return i.ay(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=i.bP(this.projectionOptions);const d=this.getProjection(),_=!i.bn(s,d);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bP({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=i.ab.mat2.create(),i.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=i.aw(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=i.ai(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let _=0,y=0;for(let w=0;w<s.length;w++){const C=new i.P(s[w][0]*this.width,d+s[w][1]*(this.height-d)),z=t.pointCoordinate(C);if(!z)continue;const L=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);_+=z[3]*L,y+=L}return y===0?NaN:_/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*s,_=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-d,y);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const _=i.ab.vec3.length(i.ab.vec3.sub([],this._camera.position,d));return i.aw(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!i.ab.quat.exactEquals(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];i.ab.vec3.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new nl;return s.position=new i.aa(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!i.ab.quat.length(t))return!1;i.ab.quat.normalize(t,t);const s=i.ab.vec3.transformQuat([],[0,0,-1],t),d=i.ab.vec3.transformQuat([],[0,-1,0],t);if(d[2]<0)return!1;const _=il(s,d);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;t[2]=i.aw(t[2],_/d,_/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,d){this._unmodified=!1,this._edgeInsets.interpolate(t,s,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new i.bQ(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new i.P(0,0)),_=this.pointCoordinate(new i.P(this.width,0)),y=this.pointCoordinate(new i.P(this.width,this.height)),w=this.pointCoordinate(new i.P(0,this.height)),C=Math.floor(Math.min(d.x,_.x,y.x,w.x)),z=Math.floor(Math.max(d.x,_.x,y.x,w.x)),L=1;for(let k=C-L;k<=z+L;k++)k!==0&&s.push(new i.bQ(k,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,d){let _=[];const y=d!==void 0,w=!y;if(w&&this.zoom<s||y&&d[0]===0&&d[1]===0)return _;const C=new Set,z=(k,N,B,G,Y)=>{const X=i.c5(N,k,B,G,Y);C.has(X)||(_.push(new i.aG(k,N,B,G,Y)),C.add(X))};for(let k=0;k<t.length;k++){const N=t[k];if(w&&N.canonical.z!==s)continue;const B=N.canonical,G=N.overscaledZ,Y=N.wrap,X=1<<B.z,J=B.x+1<X,Q=B.x>0,re=B.y+1<X,ue=B.y>0,le=N.wrap-(Q?0:1),_e=N.wrap+(J?0:1),fe=Q?B.x-1:X-1,pe=J?B.x+1:0;if(y)d[0]<0?(z(G,_e,B.z,pe,B.y),d[1]<0&&re&&(z(G,Y,B.z,B.x,B.y+1),z(G,_e,B.z,pe,B.y+1)),d[1]>0&&ue&&(z(G,Y,B.z,B.x,B.y-1),z(G,_e,B.z,pe,B.y-1))):d[0]>0?(z(G,le,B.z,fe,B.y),d[1]<0&&re&&(z(G,Y,B.z,B.x,B.y+1),z(G,le,B.z,fe,B.y+1)),d[1]>0&&ue&&(z(G,Y,B.z,B.x,B.y-1),z(G,le,B.z,fe,B.y-1))):d[1]<0&&re?z(G,Y,B.z,B.x,B.y+1):ue&&z(G,Y,B.z,B.x,B.y-1);else{const de=N.visibleQuadrants;1&de&&(z(G,le,B.z,fe,B.y),ue&&(z(G,Y,B.z,B.x,B.y-1),z(G,le,B.z,fe,B.y-1))),2&de&&(z(G,_e,B.z,pe,B.y),ue&&(z(G,Y,B.z,B.x,B.y-1),z(G,_e,B.z,pe,B.y-1))),4&de&&(z(G,le,B.z,fe,B.y),re&&(z(G,Y,B.z,B.x,B.y+1),z(G,le,B.z,fe,B.y+1))),8&de&&(z(G,_e,B.z,pe,B.y),re&&(z(G,Y,B.z,B.x,B.y+1),z(G,_e,B.z,pe,B.y+1)))}}const L=[];for(const k of _)_.some(N=>k.isChildOf(N))||L.push(k);if(_=L.filter(k=>!t.some(N=>!!(k.overscaledZ<s&&N.isChildOf(k))||k.equals(N)||k.isChildOf(N))),w){const k=1<<s,N=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[k*N.x,k*N.y],G=4,Y=G*G;_=_.filter(X=>{const J=X.canonical.x+.5-B[0],Q=X.canonical.y+.5-B[1];return J*J+Q*Q<Y})}return _}coveringTiles(t){let s=this.coveringZoomLevel(t);const d=s,_=this.elevation&&this.elevation.exaggeration(),y=_&&!t.isTerrainDEM,w=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const C=this.locationCoordinate(this.center),z=this.center.lat,L=1<<s,k=[L*C.x,L*C.y,0],N=this.projection.name==="globe",B=!N,G=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,B),Y=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=L*i.bH(1,this.center.lat),J=this._camera.position[2]/i.bH(1,this.center.lat),Q=[L*Y.x,L*Y.y,J*(B?1:X)],re=N||_,ue=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),le=this.isLODDisabled(!0)?s:0;let _e;if(this._elevation&&t.isTerrainDEM)_e=1e4*this._elevation.exaggeration();else if(this._elevation){const Ne=this._elevation.getMinMaxForVisibleTiles();_e=Ne?Ne.max:this._centerAltitude}else _e=this._centerAltitude;const fe=t.isTerrainDEM?-_e:this._elevation?this._elevation.getMinElevationBelowMSL():0,pe=this.projection.isReprojectedInTileSpace?i.bS(this):1,de=Ne=>{const $e=new i.aa(Ne.x+25e-6,Ne.y,Ne.z),ut=new i.aa(Ne.x,Ne.y+25e-6,Ne.z),st=Ne.toLngLat(),tt=$e.toLngLat(),wt=ut.toLngLat(),Et=this.locationCoordinate(st),gt=this.locationCoordinate(tt),Rt=this.locationCoordinate(wt),oi=Math.hypot(gt.x-Et.x,gt.y-Et.y),Zt=Math.hypot(Rt.x-Et.x,Rt.y-Et.y);return Math.sqrt(oi*Zt)*pe/25e-6},be=Ne=>{const nt=_e,$e=fe;return{aabb:i.bV(this,L,0,0,0,Ne,$e,nt,this.projection),zoom:0,x:0,y:0,minZ:$e,maxZ:nt,wrap:Ne,fullyVisible:!1}},Ie=[];let He=[];const Ve=s,Ee=t.reparseOverscaled?d:s,Re=(J-this._centerAltitude)*X,et=Ne=>{if(!this._elevation||!Ne.tileID||!w)return;const nt=this._elevation.getMinMaxForTile(Ne.tileID),$e=Ne.aabb;nt?($e.min[2]=nt.min,$e.max[2]=nt.max,$e.center[2]=($e.min[2]+$e.max[2])/2):(Ne.shouldSplit=ft(Ne),Ne.shouldSplit||($e.min[2]=$e.max[2]=$e.center[2]=this._centerAltitude))},ot=(Ne,nt)=>{if(.707*nt<Ne)return 1;const $e=nt/Ne;return $e/(1.4144271570014144+(Math.pow(1.1,$e-1.4144271570014144+1)-1)/(1.1-1)-1)},ft=Ne=>{if(Ne.zoom<le)return!0;if(Ne.zoom===Ve)return!1;if(Ne.shouldSplit!=null)return Ne.shouldSplit;const nt=Ne.aabb.distanceX(Q),$e=Ne.aabb.distanceY(Q);let ut=Re,st=1;if(N){ut=Ne.aabb.distanceZ(Q);const Zt=Math.pow(2,Ne.zoom),Wt=i.aS((Ne.y+1)/Zt),ai=i.aS(Ne.y/Zt),Pi=Math.min(Math.max(z,Wt),ai),yi=i.c9(Pi)/i.c9(z);if(st=Pi===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,yi/this._mercatorScaleRatio),this.zoom<=i.c6&&Ne.zoom===Ve-1&&yi>=.9)return!0}else if(y&&(ut=Ne.aabb.distanceZ(Q)*X),this.projection.isReprojectedInTileSpace&&d<=5){const Zt=Math.pow(2,Ne.zoom),Wt=de(new i.aa((Ne.x+.5)/Zt,(Ne.y+.5)/Zt));st=Wt>.85?1:Wt}if(!w){const Zt=Math.sqrt(nt*nt+$e*$e+ut*ut);let Wt=(1<<Ve-Ne.zoom)*ue*st;return Wt*=ot(Math.max(ut,Re),Zt),Zt<Wt}let tt=Number.MAX_VALUE,wt=0;const Et=Ne.aabb.getCorners(),gt=[];for(const Zt of Et){i.ab.vec3.sub(gt,Zt,Q),N||(y?gt[2]*=X:gt[2]=Re);const Wt=i.ab.vec3.dot(gt,this._camera.forward());Wt<tt&&(tt=Wt,wt=Math.abs(gt[2]))}let Rt=(1<<Ve-Ne.zoom)*ue*st;if(Rt*=ot(Math.max(wt,Re),tt),tt<Rt)return!0;const oi=Ne.aabb.closestPoint(k);return oi[0]===k[0]&&oi[1]===k[1]};if(this.renderWorldCopies)for(let Ne=1;Ne<=3;Ne++)Ie.push(be(-Ne)),Ie.push(be(Ne));for(Ie.push(be(0));Ie.length>0;){const Ne=Ie.pop(),nt=Ne.x,$e=Ne.y;let ut=Ne.fullyVisible;const st=()=>this.projection.name==="globe"&&(Ne.y===0||Ne.y===(1<<Ne.zoom)-1);if(!ut){let tt=re?Ne.aabb.intersects(G):Ne.aabb.intersectsFlat(G);if(tt===0&&st()){const wt=new i.bT(Ne.zoom,nt,$e);tt=i.bU(this,L,wt,!0).intersects(G)}if(tt===0)continue;ut=tt===2}if(Ne.zoom!==Ve&&ft(Ne))for(let tt=0;tt<4;tt++){const wt=(nt<<1)+tt%2,Et=($e<<1)+(tt>>1),gt={aabb:w?Ne.aabb.quadrant(tt):i.bV(this,L,Ne.zoom+1,wt,Et,Ne.wrap,Ne.minZ,Ne.maxZ,this.projection),zoom:Ne.zoom+1,x:wt,y:Et,wrap:Ne.wrap,fullyVisible:ut,tileID:void 0,shouldSplit:void 0,minZ:Ne.minZ,maxZ:Ne.maxZ};y&&!N&&(gt.tileID=new i.aG(Ne.zoom+1===Ve?Ee:Ne.zoom+1,Ne.wrap,Ne.zoom+1,wt,Et),et(gt)),Ie.push(gt)}else{const tt=Ne.zoom===Ve?Ee:Ne.zoom;if(t.minzoom&&t.minzoom>tt)continue;let wt=0;if(!ut){let oi=re?Ne.aabb.intersectsPrecise(G):Ne.aabb.intersectsPreciseFlat(G);if(oi===0&&st()){const Zt=new i.bT(Ne.zoom,nt,$e);oi=i.bU(this,L,Zt,!0).intersectsPrecise(G)}if(oi===0)continue;if(t.calculateQuadrantVisibility)if(G.containsPoint(Ne.aabb.center))wt=15;else for(let Zt=0;Zt<4;Zt++)Ne.aabb.quadrant(Zt).intersects(G)!==0&&(wt|=1<<Zt)}const Et=k[0]-(.5+nt+(Ne.wrap<<Ne.zoom))*(1<<s-Ne.zoom),gt=k[1]-.5-$e,Rt=Ne.tileID?Ne.tileID:new i.aG(tt,Ne.wrap,Ne.zoom,nt,$e);t.calculateQuadrantVisibility&&(Rt.visibleQuadrants=wt),He.push({tileID:Rt,distanceSq:Et*Et+gt*gt})}}if(this.fogCullDistSq){const Ne=this.fogCullDistSq,nt=this.horizonLineFromTop();He=He.filter($e=>{const ut=[0,0,0,1],st=[i.ag,i.ag,0,1],tt=this.calculateFogTileMatrix($e.tileID.toUnwrapped());i.ab.vec4.transformMat4(ut,ut,tt),i.ab.vec4.transformMat4(st,st,tt);const wt=i.ab.vec4.min([],ut,st),Et=i.ab.vec4.max([],ut,st),gt=i.bW(wt,Et);if(gt===0)return!0;let Rt=!1;const oi=this._elevation;if(oi&&gt>Ne&&nt!==0){const Zt=this.calculateProjMatrix($e.tileID.toUnwrapped());let Wt;t.isTerrainDEM||(Wt=oi.getMinMaxForTile($e.tileID)),Wt||(Wt={min:fe,max:_e});const ai=i.c7(this.rotation),Pi=[ai[0]*i.ag,ai[1]*i.ag,Wt.max];i.ab.vec3.transformMat4(Pi,Pi,Zt),Rt=(1-Pi[1])*this.height*.5<nt}return gt<Ne||Rt})}return He.sort((Ne,nt)=>Ne.distanceSq-nt.distanceSq).map(Ne=>Ne.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=i.aw(t.lat,-i.bX,i.bX),d=this.projection.project(t.lng,s);return new i.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let d,_;const y=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;d=(s.x-y.x)/C,_=(s.y-y.y)/C}else{const C=this.pointCoordinate(s),z=this.pointCoordinate(y);d=C.x-z.x,_=C.y-z.y}const w=this.locationCoordinate(t);this.setLocation(new i.aa(w.x-d,w.y-_))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,s){const d=s?i.bH(s,t.lat):void 0,_=this.projection.project(t.lng,t.lat);return new i.aa(_.x,_.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const d=s??this._centerAltitude,_=[t.x,t.y,0,1],y=[t.x,t.y,1,1];i.ab.vec4.transformMat4(_,_,this.pixelMatrixInverse),i.ab.vec4.transformMat4(y,y,this.pixelMatrixInverse);const w=y[3];i.ab.vec4.scale(_,_,1/_[3]),i.ab.vec4.scale(y,y,1/w);const C=_[2],z=y[2];return{p0:_,p1:y,t:C===z?0:(d-C)/(z-C)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return i.ab.vec4.transformMat4(s,s,this.pixelMatrixInverse),i.ab.vec4.transformMat4(d,d,this.pixelMatrixInverse),i.ab.vec4.scale(s,s,1/s[3]),i.ab.vec4.scale(d,d,1/d[3]),s[2]=i.bH(s[2],this._center.lat)*this.worldSize,d[2]=i.bH(d[2],this._center.lat)*this.worldSize,i.ab.vec4.scale(s,s,1/this.worldSize),i.ab.vec4.scale(d,d,1/this.worldSize),new i.aq([s[0],s[1],s[2]],i.ab.vec3.normalize([],i.ab.vec3.sub([],d,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:d,t:_}=t,y=i.bH(s[2],this._center.lat),w=i.bH(d[2],this._center.lat);return new i.aa(i.af(s[0],d[0],_)/this.worldSize,i.af(s[1],d[1],_)/this.worldSize,i.af(y,w,_))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let s=this.projection.pointCoordinate3D(this,t.x,t.y);if(s)return new i.aa(s[0],s[1],s[2]);let d=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t);const y=.02*_,w=t.clone();for(let C=0;C<10&&_-d>y;C++){w.y=i.af(d,_,.66);const z=this.projection.pointCoordinate3D(this,w.x,w.y);z?(_=w.y,s=z):d=w.y}return s?new i.aa(s[0],s[1],s[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=i.bY)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const d=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,_=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return i.ab.vec4.transformMat4(_,_,this.pixelMatrix),_[3]>0?new i.P(_[0]/_[3],_[1]/_[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointLocation3D(new i.P(s,t)),w=this.pointLocation3D(new i.P(_,t)),C=this.pointLocation3D(new i.P(_,d)),z=this.pointLocation3D(new i.P(s,d));let L=Math.min(y.lng,w.lng,C.lng,z.lng),k=Math.max(y.lng,w.lng,C.lng,z.lng),N=Math.min(y.lat,w.lat,C.lat,z.lat),B=Math.max(y.lat,w.lat,C.lat,z.lat);const G=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,X=(J,Q,re,ue,le)=>{const _e=(J+re)/2,fe=(Q+ue)/2,pe=new i.P(_e,fe),{lng:de,lat:be}=this.pointLocation3D(pe),Ie=Math.max(0,L-de,N-be,de-k,be-B);L=Math.min(L,de),k=Math.max(k,de),N=Math.min(N,be),B=Math.max(B,be),(le<Y||Ie>G)&&(X(J,Q,_e,fe,le+1),X(_e,fe,re,ue,le+1))};if(X(s,t,_,t,1),X(_,t,_,d,1),X(_,d,s,d,1),X(s,d,s,t,1),this.projection.name==="globe"){const[J,Q]=i.bZ(this);J?(B=90,k=180,L=-180):Q&&(N=-90,k=180,L=-180)}return new i.az(new i.bO(L,N),new i.bO(k,B))}_getBoundsRectangular(t,s){const{top:d,left:_}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,C=new i.P(_,d),z=new i.P(w,d),L=new i.P(w,y),k=new i.P(_,y);let N=this.pointCoordinate(C,t),B=this.pointCoordinate(z,t);const G=this.pointCoordinate(L,s),Y=this.pointCoordinate(k,s),X=(J,Q)=>(Q.y-J.y)/(Q.x-J.x);return N.y>1&&B.y>=0?N=new i.aa((1-Y.y)/X(Y,N)+Y.x,1):N.y<0&&B.y<=1&&(N=new i.aa(-Y.y/X(Y,N)+Y.x,0)),B.y>1&&N.y>=0?B=new i.aa((1-G.y)/X(G,B)+G.x,1):B.y<0&&N.y<=1&&(B=new i.aa(-G.y/X(G,B)+G.x,0)),new i.az().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce((d,_)=>{if(_.dem){const y=_.dem.tree;d.min=Math.min(d.min,y.minimums[0]),d.max=Math.max(d.max,y.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-i.bX,this.maxLat=i.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.at(this.minLng)*this.tileSize,this.worldMaxX=i.at(this.maxLng)*this.tileSize,this.worldMinY=i.aA(this.maxLat)*this.tileSize,this.worldMaxY=i.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,d=this._distanceTileDataCache;if(d[s])return d[s];const _=t.canonical,y=1/this.height,w=this.cameraWorldSize,C=w/this.zoomScale(_.z),z=(_.x+Math.pow(2,_.z)*t.wrap)*C,L=_.y*C,k=this.point;k.x*=w/this.worldSize,k.y*=w/this.worldSize;const N=this.angle,B=Math.sin(-N),G=-Math.cos(-N);return d[s]={bearing:[B,G],center:[(k.x-z)*y,(k.y-L)*y],scale:C/i.ag*y},d[s]}calculateFogTileMatrix(t){const s=t.key,d=this._fogTileMatrixCache;if(d[s])return d[s];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return i.ab.mat4.multiply(_,this.worldToFogMatrix,_),d[s]=new Float32Array(_),d[s]}calculateProjMatrix(t,s=!1,d=!1){const _=t.key;let y;if(y=d?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,y[_])return y[_];const w=this.calculatePosMatrix(t,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,i.ab.mat4.multiply(w,C,w),y[_]=new Float32Array(w),y[_]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[s])return d[s];const _=i.b_(t,this);return d[s]=_,d[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=i.ab.mat4.fromScaling([],[t,t,t]);return i.ab.mat4.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=i.bH(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(s),_=this._camera.forward(),y=i.bH(1,this._center.lat);d[2]/=y,_[2]/=y,i.ab.vec3.normalize(_,_);const w=t.raycast(d,_,t.exaggeration());if(w){const C=i.ab.vec3.scaleAndAdd([],d,_,w),z=new i.aa(C[0],C[1],i.bH(C[2],i.aS(C[1]))),L=(z.z+i.ab.vec3.length([z.x-d[0],z.y-d[1],z.z-d[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,d=i.bH(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),y=s.getAtPointOrZero(new i.aa(..._)),w=this.pixelsPerMeter/this.worldSize*y,C=this._minimumHeightOverTerrain(),z=_[2]-w;if(z<=C)if(z<0||t){const L=this.locationCoordinate(this._center,this._centerAltitude),k=[_[0],_[1],L.z-_[2]],N=i.ab.vec3.length(k);k[2]-=(C-z)/this._pixelsPerMercatorPixel;const B=i.ab.vec3.length(k);if(B===0)return;i.ab.vec3.scale(k,k,N/B*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],L.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=i.aw(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=i.aw(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const s=this._unmodified,{x:d,y:_}=this.point;let y=0,w=d,C=_;const z=this.width/2,L=this.height/2,k=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(_-L<k&&(C=k+L),_+L>N&&(C=N-L),N-k<this.height&&(y=Math.max(y,this.height/(N-k)),C=(N+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,Y=this.worldSize/2-(B+G)/2;w=(d+Y+this.worldSize)%this.worldSize-Y,w-z<B&&(w=B+z),w+z>G&&(w=G-z),G-B<this.width&&(y=Math.max(y,this.width/(G-B)),w=(G+B)/2)}w===d&&C===_||(this.center=this.unproject(new i.P(w,C))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bH(1,this.center.lat)/i.bH(1,i.c8));const _=i.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?d:1,w=this._camera.getWorldToCamera(this.worldSize,y);let C;const z=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(z[8]=2*-t.x/this.width,z[9]=2*t.y/this.height,this.isOrthographic){let be=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ie=be*this.aspect,He=-Ie,Ve=-be;Ie-=t.x,He-=t.x,be+=t.y,Ve+=t.y,C=this._camera.getCameraToClipOrthographic(He,Ie,Ve,be,this._nearZ,this._farZ),((Ee,Re,et,ot)=>{for(let ft=0;ft<16;ft++)Ee[ft]=Pu(Re[ft],et[ft],ot)})(C,C,z,vt(this.pitch>=15?1:this.pitch/15))}else C=z;const L=i.ab.mat4.mul([],z,w);let k=i.ab.mat4.mul([],C,w);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),Ie=i.ab.mat4.identity([]);i.ab.mat4.translate(Ie,Ie,[be.x*this.worldSize,be.y*this.worldSize,0]),i.ab.mat4.multiply(Ie,Ie,i.c0(this)),i.ab.mat4.translate(Ie,Ie,[-be.x*this.worldSize,-be.y*this.worldSize,0]),i.ab.mat4.multiply(k,k,Ie),i.ab.mat4.multiply(L,L,Ie),this.inverseAdjustmentMatrix=i.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ab.mat4.scale([],k,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=k,this.invProjMatrix=i.ab.mat4.invert(new Float64Array(16),this.projMatrix),s){const be=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);be[8]=2*-t.x/this.width,be[9]=2*t.y/this.height,this.expandedFarZProjMatrix=i.ab.mat4.mul([],be,w)}else this.expandedFarZProjMatrix=this.projMatrix;const N=i.ab.mat4.invert([],C);this.frustumCorners=i.c2.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const B=new Float32Array(16);i.ab.mat4.identity(B),i.ab.mat4.scale(B,B,[1,-1,1]),i.ab.mat4.rotateX(B,B,this._pitch),i.ab.mat4.rotateZ(B,B,this.angle);const G=i.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ab.mat4.clone(G);const Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-t.x/this.width,G[9]=2*(t.y+Y)/this.height,this.skyboxMatrix=i.ab.mat4.multiply(B,G,B);const X=this.point,J=X.x,Q=X.y,re=this.width%2/2,ue=this.height%2/2,le=Math.cos(this.angle),_e=Math.sin(this.angle),fe=J-Math.round(J)+le*re+_e*ue,pe=Q-Math.round(Q)+le*ue+_e*re,de=new Float64Array(k);if(i.ab.mat4.translate(de,de,[fe>.5?fe-1:fe,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=de,k=i.ab.mat4.create(),i.ab.mat4.scale(k,k,[this.width/2,-this.height/2,1]),i.ab.mat4.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=i.ab.mat4.create(),i.ab.mat4.scale(k,k,[1,-1,1]),i.ab.mat4.translate(k,k,[-1,-1,0]),i.ab.mat4.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=i.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},k=i.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.c3(this);const be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ab.vec3.transformMat4(be,be,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,d=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,s];i.ab.vec3.scale(y,y,_),i.ab.vec3.scale(d,d,-1),i.ab.vec3.multiply(d,d,y);const w=i.ab.mat4.create();i.ab.mat4.translate(w,w,d),i.ab.mat4.scale(w,w,y),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,_)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-d[0]*y,_.y/this.worldSize-d[1]*y,t/this.worldSize*this._centerAltitude-d[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],_=t[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((s-d)/_,1)),this._camera.position=i.ab.vec3.scaleAndAdd([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:d,bearing:_}=this._camera.getPitchBearing(),y=i.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ai(this._maxPitch)),C=Math.max((t[2]-y)/Math.cos(d),w),z=this._zoomFromMercatorZ(C);i.ab.vec3.scaleAndAdd(t,t,s,C),this._pitch=i.aw(d,i.ai(this.minPitch),i.ai(this.maxPitch)),this.angle=i.bF(_,-Math.PI,Math.PI),this._setZoom(i.aw(z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.aa(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,d=i.bY,_=0,y=1/0;for(;d-s>1e-6&&d>s;){const w=s+.5*(d-s),C=this.tileSize*Math.pow(2,w),z=this.getCameraToCenterDistance(this.projection,w,C),L=this.scaleZoom(z/(t*this.tileSize)),k=Math.abs(w-L);k<y&&(y=k,_=w),w<L?s=w:d=w}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const d=Math.min(t.x,s.x),_=Math.max(t.x,s.x),y=Math.min(t.y,s.y),w=Math.max(t.y,s.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new i.P(d,y),new i.P(_,w),new i.P(d,w),new i.P(_,y)],z=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const k of C){const N=this.pointRayIntersection(k);if(N.t<0)return!0;const B=this.rayIntersectionCoordinate(N);if(B.x<z||B.y<0||B.x>L||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(t,s){const d=i.ab.vec3.length(i.ab.vec3.sub([],this._camera.position,t)),_=this._zoomFromMercatorZ(d)+s;return d-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([s,d,_],y){const w=[s,d,_,1];i.ab.vec4.transformMat4(w,w,y);const C=w[3]=Math.max(w[3],1e-6);return w[0]/=C,w[1]/=C,w[2]/=C,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,d=this.worldSize){const _=i.b$(t,s,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,d,_);let w=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(w=Pu(1,w,vt(this.pitch>=15?1:this.pitch/15))),w}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ab.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const uo=(h,t)=>{if(t>0&&h.terrain&&i.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=h.transform,d=Math.max(Math.abs(s._zoom-(h.minCutoffZoom-1)),1),_=s.isLODDisabled(!1)?i.ac(60,45,s.pitch):i.ac(30,15,s.pitch),y=s._farZ-s._nearZ,w=t*s.height,C=((1-(z=_))*s.cameraToCenterDistance+z*(s._farZ+w))*d;var z;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(C-s._nearZ)/y,(C-w-s._nearZ)/y]}}},xr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Vp{constructor(t,s){this.aabb=t,this.lastCascade=s}}class zu{add(t,s){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],s.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],s.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],s.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],s.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],s.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],s.max[2])):this.receivers[t.key]=new Vp(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,d){const _=i.cd.fromPoints(t.points);let y=0;for(const w in this.receivers){const C=this.receivers[w];if(!C||!_.intersectsAabb(C.aabb))continue;C.aabb.min=_.closestPoint(C.aabb.min),C.aabb.max=_.closestPoint(C.aabb.max);const z=C.aabb.getCorners();for(let L=0;L<d.length;L++){let k=!0;for(const N of z){const B=[N[0]*s,N[1]*s,N[2]];if(i.ab.vec3.transformMat4(B,B,d[L].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){k=!1;break}}if(C.lastCascade=L,y=Math.max(y,L),k)break}}return y+1}}class ho{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new zu,this._depthMode=new $t(t.context.gl.LEQUAL,$t.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(xr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(xr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(xr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const _=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||_<=0||(this._shadowLayerCount=d.style.order.reduce((Y,X)=>{const J=d.style._mergedLayers[X];return Y+(J.hasShadowPass()&&!J.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=d.context,w=xr.shadowMapResolution,C=xr.shadowMapResolution;if(this._cascades.length===0||xr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<xr.cascadeCount;++Y){const X=d._shadowMapDebug,J=y.gl,Q=y.createFramebuffer(w,C,X,"texture"),re=new i.T(y,{width:w,height:C,data:null},J.DEPTH_COMPONENT16);if(Q.depthAttachment.set(re.texture),X){const ue=new i.T(y,{width:w,height:C,data:null},J.RGBA8);Q.colorAttachment.set(ue.texture)}this._cascades.push({framebuffer:Q,texture:re,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bR,scale:0})}}this.shadowDirection=Fo(s);let z=0;if(t.elevation){const Y=t.elevation,X=[1e4,-1e4];Y.visibleDemTiles.filter(J=>J.dem).forEach(J=>{const Q=J.dem.tree;X[0]=Math.min(X[0],Q.minimums[0]),X[1]=Math.max(X[1],Q.maximums[0])}),X[0]!==1e4&&(z=(X[1]-X[0])*Y.exaggeration())}const L=1.5*t.cameraToCenterDistance,k=3*L,N=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){const X=this._cascades[Y];let J=t.height/50,Q=1;xr.cascadeCount===1?Q=k:Y===0?Q=L:(J=L,Q=k);const[re,ue]=ol(t,this.shadowDirection,J,Q,xr.shadowMapResolution,z);X.scale=t.scale,X.matrix=re,X.boundingSphereRadius=ue,i.ab.mat4.invert(N,X.matrix),X.frustum=i.bR.fromInvProjectionMatrix(N,1,0,!0),X.far=Q}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/xr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=xr.shadowMapResolution,this._uniformValues.u_shadowmap_0=yr.ShadowMap0,this._uniformValues.u_shadowmap_1=yr.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const G=d.transform.elevation;for(const Y of this._groundShadowTiles){let X={min:0,max:0};if(G){const J=G.getMinMaxForTile(Y);J&&(X=J)}this.addShadowReceiver(Y.toUnwrapped(),X.min,X.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const d=this.painter,_=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),_.viewport.set([0,0,xr.shadowMapResolution,xr.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){d.currentShadowCascade=y,_.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),_.clear({color:i.aj.white,depth:1});for(const w of t.order){const C=t._mergedLayers[w];if(!C.hasShadowPass()||C.isHidden(d.transform.zoom))continue;const z=t.getLayerSourceCache(C),L=z?s[z.id]:void 0;(C.type==="model"||L&&L.length)&&d.renderLayer(d,z,C,L)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,d=t.context,_=s.directionalLight,y=s.ambientLight;if(!_||!y)return;const w=[],C=uo(t,t.longestCutoffRange);C.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),w.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&w.push("NORMAL_OFFSET");const z=sl(s,_,y),L=new $t(d.gl.LEQUAL,$t.ReadOnly,t.depthRangeFor3D);for(const k of this._groundShadowTiles){const N=k.toUnwrapped(),B=t.isTileAffectedByFog(k),G=t.getOrCreateProgram("groundShadow",{defines:w,overrideFog:B});this.setupShadows(N,G),t.uploadCommonUniforms(d,G,N,null,C);const Y={u_matrix:t.transform.calculateProjMatrix(N),u_ground_shadow_factor:z};G.draw(t,d.gl.TRIANGLES,L,hi.disabled,bi.multiply,ni.disabled,Y,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?bi.unblended:bi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,d=s.calculatePosMatrix(t,s.worldSize);return i.ab.mat4.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return i.ab.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,s,d,_=0){if(!this.enabled)return;const y=this.painter.transform,w=this.painter.context,C=w.gl,z=this._uniformValues,L=new Float64Array(16),k=y.calculatePosMatrix(t,y.worldSize);for(let N=0;N<this._cascades.length;N++)i.ab.mat4.multiply(L,this._cascades[N].matrix,k),z[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),w.activeTexture.set(C.TEXTURE0+yr.ShadowMap0+N),this._cascades[N].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){const N=i.cc(t.canonical),B=2/y.tileSize*i.ag/xr.shadowMapResolution,G=B*this._cascades[0].boundingSphereRadius,Y=B*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(d==="vector-tile"?1:3)/Math.pow(2,_-t.canonical.z-(1-y.zoom+Math.floor(y.zoom)));z.u_shadow_normal_offset=[N,G*X,Y*X],z.u_shadow_bias=[6e-5,.0012,.012]}else z.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(w,z)}setupShadowsFromMatrix(t,s,d=!1){if(!this.enabled)return;const _=this.painter.context,y=_.gl,w=this._uniformValues,C=new Float64Array(16);for(let z=0;z<xr.cascadeCount;z++)i.ab.mat4.multiply(C,this._cascades[z].matrix,t),w[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),_.activeTexture.set(y.TEXTURE0+yr.ShadowMap0+z),this._cascades[z].texture.bind(y.NEAREST,y.CLAMP_TO_EDGE);if(this.useNormalOffset=d,d){const z=xr.normalOffset;w.u_shadow_normal_offset=[1,z,z],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(_,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,d,_){if(_[2]>=0)return{};const y=function(z,L,k){const N=k/(1<<z.canonical.z);return new i.cd([z.canonical.x*N+z.wrap*k,z.canonical.y*N+z.wrap*k,0],[(z.canonical.x+1)*N+z.wrap*k,(z.canonical.y+1)*N+z.wrap*k,L])}(t,s,d).getCorners(),w=s/-_[2];_[0]<0?(i.ab.vec3.add(y[0],y[0],[_[0]*w,0,0]),i.ab.vec3.add(y[3],y[3],[_[0]*w,0,0])):_[0]>0&&(i.ab.vec3.add(y[1],y[1],[_[0]*w,0,0]),i.ab.vec3.add(y[2],y[2],[_[0]*w,0,0])),_[1]<0?(i.ab.vec3.add(y[0],y[0],[0,_[1]*w,0]),i.ab.vec3.add(y[1],y[1],[0,_[1]*w,0])):_[1]>0&&(i.ab.vec3.add(y[2],y[2],[0,_[1]*w,0]),i.ab.vec3.add(y[3],y[3],[0,_[1]*w,0]));const C={};return C.vertices=y,C.planes=[rl(y[1],y[0],y[4]),rl(y[2],y[1],y[5]),rl(y[3],y[2],y[6]),rl(y[0],y[3],y[7])],C}addShadowReceiver(t,s,d){this._receivers.add(t,i.cd.fromTileIdAndHeight(t,s,d))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function rl(h,t,s){const d=i.ab.vec3.sub([],s,t),_=i.ab.vec3.sub([],h,t),y=i.ab.vec3.cross([],d,_),w=i.ab.vec3.length(y);return w===0?[0,0,1,0]:(i.ab.vec3.scale(y,y,1/w),[y[0],y[1],y[2],-i.ab.vec3.dot(y,t)])}function Fo(h){const t=h.properties.get("direction"),s=i.cb(t.x,t.y,t.z);s[2]=i.aw(s[2],0,75);const d=i.ce([s[0],s[1],s[2]]);return i.ab.vec3.fromValues(d.x,d.y,d.z)}function sl(h,t,s){const d=t.properties.get("color-use-theme")==="none",_=t.properties.get("color"),y=t.properties.get("intensity"),w=t.properties.get("direction"),C=[w.x,w.y,w.z],z=s.properties.get("color-use-theme")==="none",L=s.properties.get("color"),k=s.properties.get("intensity"),N=Math.max(i.ab.vec3.dot([0,0,1],C),0),B=[0,0,0];i.ab.vec3.scale(B,L.toRenderColor(z?null:h.getLut(t.scope)).toArray01Linear().slice(0,3),k);const G=[0,0,0];return i.ab.vec3.scale(G,_.toRenderColor(d?null:h.getLut(s.scope)).toArray01Linear().slice(0,3),N*y),i.cf([B[0]>0?B[0]/(B[0]+G[0]):0,B[1]>0?B[1]/(B[1]+G[1]):0,B[2]>0?B[2]/(B[2]+G[2]):0])}function ol(h,t,s,d,_,y){const w=h.zoom,C=h.scale,z=h.worldSize,L=1/z,k=h.aspect,N=Math.sqrt(1+k*k)*Math.tan(.5*h.fovX),B=N*N,G=d-s,Y=d+s;let X,J;B>G/Y?(X=d,J=d*N):(X=.5*Y*(1+B),J=.5*Math.sqrt(G*G+2*(d*d+s*s)*B+Y*Y*B*B));const Q=h.projection.pixelsPerMeter(h.center.lat,z),re=h._camera.getCameraToWorldMercator(),ue=[0,0,-X*L];i.ab.vec3.transformMat4(ue,ue,re);let le=J*L;const _e=h._edgeInsets;if(!(_e.left===0&&_e.top===0&&_e.right===0&&_e.bottom===0||_e.left===_e.right&&_e.top===_e.bottom)){const ut=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?Q:1),st=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,s,d);st[8]=2*-h.centerOffset.x/h.width,st[9]=2*h.centerOffset.y/h.height;const tt=new Float64Array(16);i.ab.mat4.mul(tt,st,ut);const wt=new Float64Array(16);i.ab.mat4.invert(wt,tt);const Et=i.bR.fromInvProjectionMatrix(wt,z,w,!0);for(const gt of Et.points){const Rt=((fe=gt)[0]/=C,fe[1]/=C,fe[2]=i.bH(fe[2],h._center.lat),fe);le=Math.max(le,i.ab.vec3.len(i.ab.vec3.subtract([],ue,Rt)))}}var fe;le*=_/(_-1);const pe=Math.acos(t[2]),de=Math.atan2(-t[0],-t[1]),be=new hc;be.position=ue,be.setPitchBearing(pe,de);const Ie=be.getWorldToCamera(z,Q),He=le*z,Ve=Math.min(h._mercatorZfromZoom(17)*z*-2,-2*He),Ee=be.getCameraToClipOrthographic(-He,He,-He,He,Ve,(He+y*Q)/t[2]),Re=new Float64Array(16);i.ab.mat4.multiply(Re,Ee,Ie);const et=i.ab.vec3.fromValues(Math.floor(1e6*ue[0])/1e6*z,Math.floor(1e6*ue[1])/1e6*z,0),ot=.5*_,ft=[0,0,0];i.ab.vec3.transformMat4(ft,et,Re),i.ab.vec3.scale(ft,ft,ot);const Ne=[Math.floor(ft[0]),Math.floor(ft[1]),Math.floor(ft[2])],nt=[0,0,0];i.ab.vec3.sub(nt,ft,Ne),i.ab.vec3.scale(nt,nt,-1/ot);const $e=new Float64Array(16);return i.ab.mat4.identity($e),i.ab.mat4.translate($e,$e,nt),i.ab.mat4.multiply(Re,$e,Re),[Re,He]}class jg extends i.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,s){return i.aM(this.requestManager.transformRequest(s,i.R.Model).url).then(d=>{if(!d)return;const _=i.aN(d),y=new i.aO(t,void 0,void 0,_);return y.computeBoundsAndApplyParent(),y}).catch(d=>{if(d&&d.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${t} from ${s}: ${d.message}`)))})}load(t,s){this.models[s]||(this.models[s]={});const d=Object.keys(t);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+d.length;const _=[];for(const y of d)_.push(this.loadModel(y,t[y]));Promise.allSettled(_).then(y=>{for(let w=0;w<y.length;w++){const{status:C,value:z}=y[w];C==="fulfilled"&&z&&(this.models[s][d[w]]={model:z,numReferences:1})}this.numModelsLoading[s]-=d.length,this.fire(new i.z("data",{dataType:"style"}))}).catch(y=>{this.fire(new i.y(new Error(`Could not load models: ${y.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s){return!!this.getModel(t,s)}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}addModel(t,s,d){this.models[d]||(this.models[d]={}),this.hasModel(t,d)&&this.models[d][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(s)},d)}addModels(t,s){this.models[s]||(this.models[s]={});const d={};for(const _ in t)this.models[s][_]={},d[_]=this.requestManager.normalizeModelURL(t[_]);this.load(d,s)}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={});const d={};for(const _ of t)this.hasModel(_,s)?this.models[s][_].numReferences++:d[_]=this.requestManager.normalizeModelURL(_);this.load(d,s)}removeModel(t,s){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0)){const d=this.models[s][t].model;delete this.models[s][t],d.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const d in this.models[s])this.models[s][d].model&&this.models[s][d].model.upload(t.context)}}const Gg=new i.a5({data:new i.a6(i.a3.colorTheme.data)}),ad={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Up(h){return h=h||{},Object.assign(h,ad)}class jp extends i.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},i.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(w,C){const[z,L]=w,{center:k,radius:N}=C,[B,G]=k,Y=Math.abs(z-B);return Math.sqrt((Y>180?360-Y:Y)**2+(L-G)**2)<=N}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.z("floorplangone")));const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=new i.P(this._map.transform.width/2,this._map.transform.height/2),_=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],y=this._map.queryRenderedFeatures(t?_:d,s);y.length>0&&(this._selectedFloorplan&&y[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=y[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(y){const[[w,C],[z,L]]=y,k=(z-w+360)%360,N=k>180?360-k:k;return{center:[(w+N/2+360)%360,(C+L)/2],radius:Math.sqrt(N**2+(L-C)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const s=this._floorplanStates[this._indoorData.id].selectedBuilding,d=this._floorplanStates[this._indoorData.id].selectedLevel;let _;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const y of this._indoorData.levels)y.id===this._selectedLevel.id&&(_=y.id);if(this.fire(new i.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:_})),s){const y=this._indoorData.buildings.find(w=>w.id===s);this._buildingSelected(y,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(d){const y=this._indoorData.levels.find(w=>w.id===d);this._updateLevels(y,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,s){s&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const d=this._indoorData.levels.filter(_=>t.levels.includes(_.id));this.fire(new i.z("buildingselected",{buildingId:t.id,levels:d}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const s=this._indoorData.levels.find(d=>d.id===t);this._updateLevels(s,!0)}this.fire(new i.z("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,s){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(s&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function d(L){const k=L.indexOf("/floor/");if(k===-1)return L;const N=k+7,B=L.indexOf("/",N);return B===-1?L.slice(N):L.slice(N,B)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const _=[],y={},w={},C={},z={};for(const L of this._indoorData.levels)if(_.push(L.id),y[L.id]=L.height,w[L.id]=L.base,t){if(this.mergeFloors){const k=d(t.id),N=d(L.id);C[L.id]=N===k?"true":"false"}else C[L.id]=L.id===t.id?"true":"false";z[L.id]=L.base<t.base?"true":"false"}else z[L.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",z]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),s&&t.extent)){const L=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),k=this._map.getZoom(),N=L.zoom?Math.abs(k-L.zoom):0;this._map.fitBounds(t.extent,N>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:k})}}selectFloorplan(t){const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],_=this._map.queryRenderedFeatures(d,s);if(_.length>0){for(const y of _)if(JSON.parse(y.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=y,this._floorplanSelected(!0);break}}}selectBuilding(t){const s=this._indoorData.buildings.find(d=>d.id===t);this._buildingSelected(s,!0)}selectLevel(t){this._levelSelected(t)}}function Gp(h){if(!h.metadata||!h.metadata.content_area)return;const{left:t,top:s,width:d,height:_}=h.metadata.content_area;return[t,s,t+d,s+_]}const fo=(h,t)=>Le(h,t&&t.filter(s=>s.identifier!=="source.canvas")),Hg=i.ay(ki,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),qg=i.ay(ki,["setCenter","setZoom","setBearing","setPitch"]),ld=new Set(["background","sky","slot","custom"]),Hp={version:8,layers:[],sources:{}},cd={duration:300,delay:0};class Ds extends i.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=i.l({},cd),this._buildingIndex=new kg(this),this.crossTileSymbolIndex=new Np,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new Ue,this.dispatcher=s.dispatcher?s.dispatcher:new i.D(i.ci(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new bt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new i.cj(t._requestManager,s.localFontFamily?i.ck.all:s.localIdeographFontFamily?i.ck.ideographs:i.ck.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new jg(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",i.cl());const d=this;this._rtlTextPluginCallback=Ds.registerForPluginStateChange(_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,w)=>{if(i.cm(y),w&&w.every(C=>C))for(const C in d._sourceCaches){const z=d._sourceCaches[C],L=z.getSource().type;L!=="vector"&&L!=="geojson"||z.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.getOwnSource(_.sourceId);if(y&&y.vectorLayerIds)for(const w in this._layers){const C=this._layers[w];C.source===y.id&&this._validateLayer(C)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(i.f(t))return t;const s=i.cn(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${i.co(JSON.stringify(t))}`}_diffStyle(t,s,d){this.globalId=this._getGlobalId(t);const _=(y,w)=>{try{w(null,this.setState(y,d))}catch(C){w(C,!1)}};if(typeof t=="string"){const y=this.map._requestManager.normalizeStyleURL(t),w=this.map._requestManager.transformRequest(y,i.R.Style);i.n(w,(C,z)=>{C?this.fire(new i.y(C)):z&&_(z,s)})}else typeof t=="object"&&_(t,s)}loadURL(t,s={}){this.fire(new i.z("dataloading",{dataType:"style"}));const d=typeof s.validate=="boolean"?s.validate:!i.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const _=this.importsCache.get(t);if(_)return this._load(_,d);const y=this.map._requestManager.transformRequest(t,i.R.Style);this._request=i.n(y,(w,C)=>{if(this._request=null,w)this.fire(new i.y(w));else if(C)return this.importsCache.set(t,C),this._load(C,d)})}loadJSON(t,s={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=i.q.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(Hp,!1)}_loadImports(t,s,d){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const y of t){const w=this._createFragmentStyle(y),C=new Promise(k=>{w.once("style.import.load",k),w.once("error",k)}).then(()=>this.mergeAll());if(_.push(C),this.resolvedImports.has(y.url)){w.loadEmpty();continue}const z=y.data||this.importsCache.get(y.url);z?(w.loadJSON(z,{validate:s}),this._isInternalStyle(z)&&(w.globalId=null)):y.url?w.loadURL(y.url,{validate:s}):w.loadEmpty();const L={style:w,id:y.id,config:y.config};if(d){const k=this.fragments.findIndex(({id:N})=>N===d);this.fragments=this.fragments.slice(0,k).concat(L).concat(this.fragments.slice(k))}else this.fragments.push(L)}return Promise.allSettled(_)}getImportGlobalIds(t=this,s=new Set){for(const d of t.fragments)d.style.globalId&&s.add(d.style.globalId),this.getImportGlobalIds(d.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?i.aC(t.id,this.scope):t.id;let d;const _=this._initialConfig&&this._initialConfig[s];(t.config||_)&&(d=i.l({},t.config,_));const y=new Ds(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){const d=t.indoor?Up(t.schema):t.schema;if(this._isInternalStyle(t)){const w=i.l({},Hp,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(w,s)}if(this.updateConfig(this._config,d),s&&fo(this,Fr(t)))return;this._loaded=!0,this.stylesheet=i.cp(t);const _=()=>{for(const L in t.sources)this.addSource(L,t.sources[L],{validate:!1,isInitialLoad:!0});t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const w=rd(this.stylesheet.layers);if(this._order=w.map(L=>L.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new Ze(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ze(this.stylesheet.light)),this._layers={};for(const L of w){const k=i.cu(L,this.scope,this._styleColorTheme.lut,this.options);k.configDependencies.size!==0&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k;const N=this.getOwnLayerSourceCache(k),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&k.canCastShadows()&&B&&(N.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const z=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then(()=>{this._reloadImports(),this.fire(new i.z(z?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.z(z?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const w=this._evaluateColorThemeData(y);this._loadColorTheme(w).then(()=>{_()}).catch(C=>{i.w(`Couldn't load color theme from the stylesheet: ${C}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,s,d,_,y,w,C,z,L,k;const N={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(t=B.light),B.stylesheet.lights)for(const G of B.stylesheet.lights)G.type==="ambient"&&B.ambientLight!=null&&(s=B.ambientLight),G.type==="directional"&&B.directionalLight!=null&&(d=B.directionalLight);_=this._prioritizeTerrain(_,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(y=B.fog),B.stylesheet.snow&&B.snow!=null&&(w=B.snow),B.stylesheet.rain&&B.rain!=null&&(C=B.rain),B.stylesheet.camera!=null&&(k=B.stylesheet.camera),B.stylesheet.projection!=null&&(z=B.stylesheet.projection),B.stylesheet.transition!=null&&(L=B.stylesheet.transition),N[B.scope]=B._styleColorTheme}}),this.light=t,this.ambientLight=s,this.directionalLight=d,this.fog=y,this.snow=w,this.rain=C,this._styleColorThemeForScope=N,_===null?delete this.terrain:this.terrain=_,this.camera=k||{"camera-projection":"perspective"},this.projection=z||{name:"mercator"},this.transition=i.l({},cd,L),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const s=d=>{for(const _ of d.fragments)s(_.style);t(d)};s(this)}_prioritizeTerrain(t,s,d){const _=t&&t.drapeRenderMode===0;return d===null?s&&s.drapeRenderMode===0?s:_?t:null:s!=null&&(!t||_||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},d={};this.forEachFragmentStyle(_=>{for(const y in _._sourceCaches){const w=i.aC(y,_.scope);t[w]=_._sourceCaches[y]}for(const y in _._otherSourceCaches){const w=i.aC(y,_.scope);s[w]=_._otherSourceCaches[y]}for(const y in _._symbolSourceCaches){const w=i.aC(y,_.scope);d[w]=_._symbolSourceCaches[y]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=d}mergeLayers(){const t={},s=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(y=>{for(const w of y._order){const C=y._layers[w];if(C.type==="slot"){const z=i.cq(w);if(t[z])continue;t[z]=[]}C.slot&&t[C.slot]?t[C.slot].push(C):s.push(C)}}),this._mergedOrder=[];const _=(y=[])=>{for(const w of y)if(w.type==="slot"){const C=i.cq(w.id);t[C]&&_(t[C]),this._mergedSlots.push(C)}else{const C=i.aC(w.id,w.scope);this._mergedOrder.push(C),d[C]=w,w.is3D()&&(this._has3DLayers=!0),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};_(s),this._mergedOrder.sort((y,w)=>{const C=d[y],z=d[w];return C.hasInitialOcclusionOpacityProperties?z.is3D()?1:0:C.is3D()&&z.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=i.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(s,d,_){const y=i.l({},d);for(const C of Object.keys(i.a3.colorTheme))y[C]===void 0&&(y[C]=i.a3.colorTheme[C].default);const w=new i.a4(Gg,s,new Map(_));return w.setTransitionOrValue(y,_),w.untransitioned().possiblyEvaluate(new i.a8(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,_)=>{const y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let w=t;w.startsWith(y)||(w=y+w);const C="mapbox-reserved-lut",z=new Image;z.src=w,z.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},z.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void d();this._styleColorTheme.lutLoading=!1;const{width:L,height:k,data:N}=i.q.getImageData(z);if(k>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==k*k)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new i.r({width:L,height:k},N),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(C,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},d()):_(new Error("Missing LUT image."))}})}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(s,d,_){let y,w,C;const z=i.q.devicePixelRatio>1?"@2x":"";let L=i.n(d.transformRequest(d.normalizeSpriteURL(s,z,".json"),i.R.SpriteJSON),(B,G)=>{L=null,C||(C=B,y=G,N())}),k=i.o(d.transformRequest(d.normalizeSpriteURL(s,z,".png"),i.R.SpriteImage),(B,G)=>{k=null,C||(C=B,w=G,N())});function N(){if(C)_(C);else if(y&&w){const B=i.q.getImageData(w),G={};for(const Y in y){const{width:X,height:J,x:Q,y:re,sdf:ue,pixelRatio:le,stretchX:_e,stretchY:fe,content:pe}=y[Y],de=new i.r({width:X,height:J});i.r.copy(B,de,{x:Q,y:re},{x:0,y:0},{width:X,height:J},null),G[Y]={data:de,pixelRatio:le,sdf:ue,stretchX:_e,stretchY:fe,content:pe,usvg:!1}}_(null,G)}}return{cancel(){L&&(L.cancel(),L=null),k&&(k.cancel(),k=null)}}}(t,this.map._requestManager,(s,d)=>{if(this._spriteRequest=null,s)this.fire(new i.y(s));else if(d)for(const _ in d)this.imageManager.addImage(_,this.scope,d[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))})}_loadIconset(t){if(!i.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var d,_;this._spriteRequest=(_=(y,w)=>{if(this._spriteRequest=null,y)s?this._loadSprite(t):this.fire(new i.y(y));else if(w)for(const C in w)this.imageManager.addImage(C,this.scope,w[C]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bi((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),i.R.Iconset),(y,w)=>{if(y)return void _(y);const C={},z=i.cg(new i.bh(w));for(const L of z.icons){const k={version:1,pixelRatio:i.q.devicePixelRatio,content:Gp(L),stretchX:L.metadata?L.metadata.stretch_x_areas:void 0,stretchY:L.metadata?L.metadata.stretch_y_areas:void 0,sdf:!1,usvg:!0,icon:L};C[L.name]=k}_(null,C)}))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const d=t.sourceLayer;d&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(d)===-1)&&this.fire(new i.y(new Error(`Source layer "${d}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,s)=>{const d=this.fragments[s];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){const t={};for(const s in this._sourceCaches){const d=this._sourceCaches[s].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const s=[];for(const d of t){const _=this._layers[d];_&&_.type!=="custom"&&s.push(_.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new i.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new i.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const d=this.map.painter;if(d)for(let _=t.minzoom||0;_<(t.maxzoom||25.5);_++){const y=t.getProgramIds();if(y)for(const w of y){const C=t.getDefaultProgramParams(w,s.zoom,this._styleColorTheme.lut);C&&(d.style=this,this.fog&&(d._fogVisible=!0,C.overrideFog=!0,d.getOrCreateProgram(w,C)),d._fogVisible=!1,C.overrideFog=!1,d.getOrCreateProgram(w,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,d.getOrCreateProgram(w,C)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const d=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const C in w){const{updatedIds:z,removedIds:L}=w[C];(z||L)&&(this._updateWorkerLayers(C,z,L),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const y={};for(const w in this._mergedSourceCaches){const C=this._mergedSourceCaches[w];y[w]=C.used,C.used=!1,C.tileCoverLift=0}for(const w of this._mergedOrder){const C=this._mergedLayers[w];if(C.recalculate(t,this._availableImages),!C.isHidden(t.zoom)){const z=this.getLayerSourceCache(C);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,t)}):this.precompilePrograms(C,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();for(const w in y){const C=this._mergedSourceCaches[w];y[w]!==C.used&&C.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new i.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,s,d){const _=this.getFragmentStyle(t);_&&this.dispatcher.broadcast("updateLayers",{layers:s?_._serializeLayers(s):[],scope:t,removedIds:d||[],options:_.options})}setState(t,s){if(this._checkLoaded(),fo(this,Fr(t)))return!1;(t=i.cp(t)).layers=rd(t.layers);const d=function(w,C){if(!w)return[{command:ki.setStyle,args:[C]}];let z=[];try{if(!i.bn(w.version,C.version))return[{command:ki.setStyle,args:[C]}];if(i.bn(w.center,C.center)||z.push({command:ki.setCenter,args:[C.center]}),i.bn(w.zoom,C.zoom)||z.push({command:ki.setZoom,args:[C.zoom]}),i.bn(w.bearing,C.bearing)||z.push({command:ki.setBearing,args:[C.bearing]}),i.bn(w.pitch,C.pitch)||z.push({command:ki.setPitch,args:[C.pitch]}),i.bn(w.sprite,C.sprite)||z.push({command:ki.setSprite,args:[C.sprite]}),i.bn(w.glyphs,C.glyphs)||z.push({command:ki.setGlyphs,args:[C.glyphs]}),i.bn(w.imports,C.imports)||function(G=[],Y=[],X){Y=Y||[];const J=(G=G||[]).map(Gi),Q=Y.map(Gi),re=G.reduce(Oi,{}),ue=Y.reduce(Oi,{}),le=J.slice();let _e,fe,pe,de;for(_e=0,fe=0;_e<J.length;_e++)pe=J[_e],ue.hasOwnProperty(pe)?fe++:(X.push({command:ki.removeImport,args:[pe]}),le.splice(le.indexOf(pe,fe),1));for(_e=0,fe=0;_e<Q.length;_e++)pe=Q[Q.length-1-_e],le[le.length-1-_e]!==pe&&(re.hasOwnProperty(pe)?(X.push({command:ki.removeImport,args:[pe]}),le.splice(le.lastIndexOf(pe,le.length-fe),1)):fe++,de=le[le.length-_e],X.push({command:ki.addImport,args:[ue[pe],de]}),le.splice(le.length-_e,0,pe));for(const be of Y){const Ie=re[be.id];Ie&&!i.bn(Ie,be)&&X.push({command:ki.updateImport,args:[be.id,be]})}}(w.imports,C.imports,z),i.bn(w.transition,C.transition)||z.push({command:ki.setTransition,args:[C.transition]}),i.bn(w.light,C.light)||z.push({command:ki.setLight,args:[C.light]}),i.bn(w.fog,C.fog)||z.push({command:ki.setFog,args:[C.fog]}),i.bn(w.snow,C.snow)||z.push({command:ki.setSnow,args:[C.snow]}),i.bn(w.rain,C.rain)||z.push({command:ki.setRain,args:[C.rain]}),i.bn(w.projection,C.projection)||z.push({command:ki.setProjection,args:[C.projection]}),i.bn(w.lights,C.lights)||z.push({command:ki.setLights,args:[C.lights]}),i.bn(w.camera,C.camera)||z.push({command:ki.setCamera,args:[C.camera]}),!i.bn(w["color-theme"],C["color-theme"]))return[{command:ki.setStyle,args:[C]}];const L={},k=[];(function(G,Y,X,J){let Q;for(Q in Y=Y||{},G=G||{})G.hasOwnProperty(Q)&&(Y.hasOwnProperty(Q)||gs(Q,X,J));for(Q in Y){if(!Y.hasOwnProperty(Q))continue;const re=Y[Q];G.hasOwnProperty(Q)?i.bn(G[Q],re)||(G[Q].type==="geojson"&&re.type==="geojson"&&Ja(G,Y,Q)?X.push({command:ki.setGeoJSONSourceData,args:[Q,re.data]}):sd(Q,Y,X,J)):xu(Q,Y,X)}})(w.sources,C.sources,k,L);const N=[];w.layers&&w.layers.forEach(G=>{G.source&&L[G.source]?z.push({command:ki.removeLayer,args:[G.id]}):N.push(G)});let B=w.terrain;B&&L[B.source]&&(z.push({command:ki.setTerrain,args:[void 0]}),B=void 0),z=z.concat(k),i.bn(B,C.terrain)||z.push({command:ki.setTerrain,args:[C.terrain]}),function(G,Y,X){Y=Y||[];const J=(G=G||[]).map(Gi),Q=Y.map(Gi),re=G.reduce(Oi,{}),ue=Y.reduce(Oi,{}),le=J.slice(),_e=Object.create(null);let fe,pe,de,be,Ie,He,Ve;for(fe=0,pe=0;fe<J.length;fe++)de=J[fe],ue.hasOwnProperty(de)?pe++:(X.push({command:ki.removeLayer,args:[de]}),le.splice(le.indexOf(de,pe),1));for(fe=0,pe=0;fe<Q.length;fe++)de=Q[Q.length-1-fe],le[le.length-1-fe]!==de&&(re.hasOwnProperty(de)?(X.push({command:ki.removeLayer,args:[de]}),le.splice(le.lastIndexOf(de,le.length-pe),1)):pe++,He=le[le.length-fe],X.push({command:ki.addLayer,args:[ue[de],He]}),le.splice(le.length-fe,0,de),_e[de]=!0);for(fe=0;fe<Q.length;fe++)if(de=Q[fe],be=re[de],Ie=ue[de],!_e[de]&&!i.bn(be,Ie))if(i.bn(be.source,Ie.source)&&i.bn(be["source-layer"],Ie["source-layer"])&&i.bn(be.type,Ie.type)){for(Ve in kt(be.layout,Ie.layout,X,de,null,ki.setLayoutProperty),kt(be.paint,Ie.paint,X,de,null,ki.setPaintProperty),i.bn(be.slot,Ie.slot)||X.push({command:ki.setSlot,args:[de,Ie.slot]}),i.bn(be.filter,Ie.filter)||X.push({command:ki.setFilter,args:[de,Ie.filter]}),i.bn(be.minzoom,Ie.minzoom)&&i.bn(be.maxzoom,Ie.maxzoom)||X.push({command:ki.setLayerZoomRange,args:[de,Ie.minzoom,Ie.maxzoom]}),be)be.hasOwnProperty(Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&Ve!=="slot"&&(Ve.indexOf("paint.")===0?kt(be[Ve],Ie[Ve],X,de,Ve.slice(6),ki.setPaintProperty):i.bn(be[Ve],Ie[Ve])||X.push({command:ki.setLayerProperty,args:[de,Ve,Ie[Ve]]}));for(Ve in Ie)Ie.hasOwnProperty(Ve)&&!be.hasOwnProperty(Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&Ve!=="slot"&&(Ve.indexOf("paint.")===0?kt(be[Ve],Ie[Ve],X,de,Ve.slice(6),ki.setPaintProperty):i.bn(be[Ve],Ie[Ve])||X.push({command:ki.setLayerProperty,args:[de,Ve,Ie[Ve]]}))}else X.push({command:ki.removeLayer,args:[de]}),He=le[le.lastIndexOf(de)+1],X.push({command:ki.addLayer,args:[Ie,He]})}(N,C.layers,z)}catch(L){console.warn("Unable to compute style diff:",L),z=[{command:ki.setStyle,args:[C]}]}return z}(this.serialize(),t).filter(w=>!(w.command in qg));if(d.length===0)return!1;const _=d.filter(w=>!(w.command in Hg));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);const y=[];return d.forEach(w=>{y.push(this[w.command].apply(this,w.args))}),s&&Promise.all(y).then(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,s){return this.getImage(t)?this.fire(new i.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,s),this._afterImageUpdated(t),this)}updateImage(t,s,d=!1){this.imageManager.updateImage(t,this.scope,s),d&&this._afterImageUpdated(t)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new i.y(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new i.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,s,d={}){return this._checkLoaded(),this._validate(De,`models.${t}`,s,null,d)||(this.modelManager.addModel(t,s,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,s,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(la,`sources.${t}`,s,null,d))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const _=td(t,s,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const y=w=>{const C=(w?"symbol:":"other:")+_.id,z=i.aC(C,this.scope),L=this._sourceCaches[C]=new _s(z,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=L,L.onAdd(this.map)};y(!1),s.type!=="vector"&&s.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new i.y(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new i.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const d=this.getOwnSourceCaches(t);for(const _ of d){const y=i.cq(_.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(_.id),_.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const d=this.getOwnSourceCache(s);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const d=t[s]._tiles;for(const _ in d){const y=d[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const _ of t){if(this._validate(tc,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const y=this.ambientLight;y.set(_),y.updateTransitions(s)}else this.ambientLight=new ur(_,qi||(qi=new i.a5({color:new i.a6(i.a3.properties_light_ambient.color),"color-use-theme":new i.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a6(i.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const y=this.directionalLight;y.set(_),y.updateTransitions(s)}else this.directionalLight=new ur(_,Xi||(Xi=new i.a5({direction:new i.ak(i.a3.properties_light_directional.direction),color:new i.a6(i.a3.properties_light_directional.color),"color-use-theme":new i.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a6(i.a3.properties_light_directional.intensity),"cast-shadows":new i.a6(i.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a6(i.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a6(i.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=new i.a8(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const d=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),_=t.properties.get("color").toRenderColor(null).toArray01(),y=t.properties.get("intensity"),w=t.properties.get("direction"),C=1-i.cb(w.x,w.y,w.z)[2]/90,z=d(_)*y*C,L=s.properties.get("color").toRenderColor(null).toArray01(),k=s.properties.get("intensity"),N=d(L)*k;return Number(((z+N)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(i.cr(t)){const s=i.cs(t),d=this.fragments.find(({id:y})=>y===s);if(!d)throw new Error(`Style import '${t}' not found`);const _=i.cq(t);return d.style.getFragmentStyle(_)}{const s=this.fragments.find(({id:d})=>d===t);if(!s)throw new Error(`Style import '${t}' not found`);return s.style}}setFeaturesetSelectors(t){if(!t)return;const s={},d=(_,y="")=>`${_}::${y}`;this.featuresetSelectors={};for(const _ in t){const y=this.featuresetSelectors[_]=[];for(const w of t[_].selectors){if(w.featureNamespace){const z=this.getOwnLayer(w.layer);if(!z){i.w(`Layer is undefined for selector: ${w.layer}`);continue}const L=d(z.source,z.sourceLayer);if(L in s&&s[L]!==w.featureNamespace){i.w(`"featureNamespace ${w.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}s[L]=w.featureNamespace}let C;if(w.properties)for(const z in w.properties){const L=i.U(w.properties[z]);L.result==="success"&&(C=C||{},C[z]=L.value)}y.push({layerId:w.layer,namespace:w.featureNamespace,properties:C})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const d=[];for(const _ in s.stylesheet.featuresets)d.push({featuresetId:_,importId:s.scope?s.scope:void 0});return d}getFeaturesetLayers(t,s){const d=this.getFragmentStyle(s),_=d.stylesheet.featuresets;if(!_||!_[t])return this.fire(new i.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const w of _[t].selectors){const C=d.getOwnLayer(w.layer);C&&y.push(C)}return y}getConfigProperty(t,s){const d=this.getFragmentStyle(t);if(!d)return null;const _=i.aC(s,d.scope),y=d.options.get(_),w=y?y.value||y.default:null;return w?w.serialize():null}setConfigProperty(t,s,d){const _=this.getFragmentStyle(t);if(!_)return;const y=_.stylesheet.indoor?Up(_.stylesheet.schema):_.stylesheet.schema;if(!y||!y[s])return;const w=i.U(d);if(w.result!=="success")return void fo(this,w.value);const C=w.value.expression,z=i.aC(s,_.scope),L=_.options.get(z);if(!L)return;let k;const{minValue:N,maxValue:B,stepValue:G,type:Y,values:X}=y[s],J=i.U(y[s].default);J.result==="success"&&(k=J.value.expression),k?(this.options.set(z,{...L,value:C,default:k,minValue:N,maxValue:B,stepValue:G,type:Y,values:X}),this.updateConfigDependencies(s)):this.fire(new i.y(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const d=s.stylesheet.schema;if(!d)return null;const _={};for(const y in d){const w=i.aC(y,s.scope),C=s.options.get(w),z=C?C.value||C.default:null;_[y]=z?z.serialize():null}return _}setConfig(t,s){const d=this.getFragmentStyle(t);d&&(d.updateConfig(s,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=s,d.updateConfig(d._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const d in s){let _,y;const w=i.U(s[d].default);if(w.result==="success"&&(_=w.value.expression),t&&t[d]!==void 0){const B=i.U(t[d]);B.result==="success"&&(y=B.value.expression)}const{minValue:C,maxValue:z,stepValue:L,type:k,values:N}=s[d];if(_){const B=i.aC(d,this.scope);this.options.set(B,{default:_,value:y,minValue:C,maxValue:z,stepValue:L,type:k,values:N})}else this.fire(new i.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const s of this._configDependentLayers){const d=this.getLayer(s);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const d=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(d){const _=s._evaluateColorThemeData(d);(!s._styleColorTheme.lut&&_!==""||s._styleColorTheme.lut&&_!==s._styleColorTheme.lut.data)&&s.setColorTheme(d)}}),this._changes.setDirty()}addLayer(t,s,d={}){this._checkLoaded();const _=t.id;if(this._layers[_])return void this.fire(new i.y(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(t.type==="custom"){if(fo(this,i.ct(t)))return;y=i.cu(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(_,t.source),t=i.cp(t),t=i.l(t,{source:_})),this._validate(ie,`layers.${_}`,t,{arrayIndex:-1},d))return;y=i.cu(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let w=this._order.length;if(s){const k=this._order.indexOf(s);if(k===-1)return void this.fire(new i.y(new Error(`Layer with id "${s}" does not exist on this map.`)));y.slot===this._layers[s].slot?w=k:i.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=y;const C=this.getOwnLayerSourceCache(y),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&y.canCastShadows()&&z&&(C.castsShadows=!0);const L=this._changes.getRemovedLayer(y);if(L&&y.source&&C&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const k=i.aC(y.source,y.scope);L.type!==y.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),C.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===s)return;const _=this._order.indexOf(t);this._order.splice(_,1);let y=this._order.length;if(s){const w=this._order.indexOf(s);if(w===-1)return void this.fire(new i.y(new Error(`Layer with id "${s}" does not exist on this map.`)));d.slot===this._layers[s].slot?y=w:i.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const _=this.getOwnLayerSourceCache(s);if(_&&_.castsShadows){let y=!1;for(const w in this._layers)if(this._layers[w].source===s.source&&this._layers[w].canCastShadows()){y=!0;break}_.castsShadows=y}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,d){this._checkLoaded();const _=this._checkLayer(t);_&&(_.minzoom===s&&_.maxzoom===d||(s!=null&&(_.minzoom=s),d!=null&&(_.maxzoom=d),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==s&&(d.slot=s,this._updateLayer(d))}setFilter(t,s,d={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!i.bn(_.filter,s))return s==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(he,`layers.${_.id}.filter`,s,{layerType:_.type},d)||(_.filter=i.cp(s),this._updateLayer(_)))}getFilter(t){const s=this._checkLayer(t);if(s)return i.cp(s.filter)}setLayoutProperty(t,s,d,_={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!i.bn(y.getLayoutProperty(s),d)){if(d!=null&&(!_||_.validate!==!1)&&fo(y,Me.call(Fr,{key:`layers.${t}.layout.${s}`,layerType:y.type,objectKey:s,value:d,styleSpec:i.a3,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(s,d),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(t,s){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(s)}setPaintProperty(t,s,d,_={}){this._checkLoaded();const y=this._checkLayer(t);if(!y||i.bn(y.getPaintProperty(s),d)||d!=null&&(!_||_.validate!==!1)&&fo(y,Te.call(Fr,{key:`layers.${t}.paint.${s}`,layerType:y.type,objectKey:s,value:d,styleSpec:i.a3})))return;const w=y.setPaintProperty(s,d);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),w&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,s){const d=this._checkLayer(t);if(d)return d.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:z,importId:L}=t.target,k=this.getFragmentStyle(L),N=k.getFeaturesetLayers(z);for(const{source:B,sourceLayer:G}of N)k.setFeatureState({id:t.id,source:B,sourceLayer:G},s)}else if("layerId"in t.target){const{layerId:z}=t.target,L=this.getLayer(z);this.setFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},s)}return}const d=t.source,_=t.sourceLayer,y=this._checkSource(d);if(!y)return;const w=y.type;if(w==="geojson"&&_)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(d);for(const z of C)z.setFeatureState(_,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:z,importId:L}=t.target,k=this.getFragmentStyle(L),N=k.getFeaturesetLayers(z);for(const{source:B,sourceLayer:G}of N)k.removeFeatureState({id:t.id,source:B,sourceLayer:G},s)}else if("layerId"in t.target){const{layerId:z}=t.target,L=this.getLayer(z);this.removeFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},s)}return}const d=t.source,_=this._checkSource(d);if(!_)return;const y=_.type,w=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!w)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(d);for(const z of C)z.removeFeatureState(w,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let y;if("featuresetId"in t.target){const{featuresetId:w,importId:C}=t.target,z=this.getFragmentStyle(C),L=z.getFeaturesetLayers(w);for(const{source:k,sourceLayer:N}of L){const B=z.getFeatureState({id:t.id,source:k,sourceLayer:N});if(B&&!y)y=B;else if(!i.bn(y,B))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:w}=t.target,C=this.getLayer(w);y=this.getFeatureState({id:t.id,source:C.source,sourceLayer:C.sourceLayer})}return y}const s=t.source,d=t.sourceLayer,_=this._checkSource(s);if(_){if(_.type!=="vector"||d)return t.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(d,t.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=i.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return i.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),d=i.aC(t.source,t.scope),_=this._changes.getUpdatedSourceCaches();t.source&&!_[d]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=C=>this._mergedLayers[C].is3D(),d=this.order,_={},y=[];for(let C=d.length-1;C>=0;C--){const z=d[C];if(s(z)){_[z]=C;for(const L of t){const k=L[z];if(k)for(const N of k)y.push(N)}}}y.sort((C,z)=>z.intersectionZ-C.intersectionZ);const w=[];for(let C=d.length-1;C>=0;C--){const z=d[C];if(s(z))for(let L=y.length-1;L>=0;L--){const k=y[L].feature;if(k.layer&&_[k.layer.id]<C)break;w.push(k),y.pop()}else for(const L of t){const k=L[z];if(k)for(const N of k)w.push(N.feature)}}return w}queryRenderedFeatures(t,s,d){let _;s&&!Array.isArray(s)&&s.filter&&(this._validate(he,"queryRenderedFeatures.filter",s.filter,null,s),_=i.aZ(s.filter));const y={},w=k=>{if(ld.has(k.type))return;const N=this.getOwnLayerSourceCache(k),B=y[N.id]=y[N.id]||{sourceCache:N,layers:{},has3DLayers:!1};k.is3D()&&(B.has3DLayers=!0),B.layers[k.fqid]=B.layers[k.fqid]||{styleLayer:k,targets:[]},B.layers[k.fqid].targets.push({filter:_})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const k of s.layers){const N=this._layers[k];if(!N)return this.fire(new i.y(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];w(N)}}else for(const k in this._layers)w(this._layers[k]);const C=this._queryRenderedFeatures(t,y,d),z=this._flattenAndSortRenderedFeatures(C),L=[];for(const k of z)i.cs(k.layer.id)===this.scope&&L.push(k);return L}queryRenderedFeatureset(t,s,d){let _;s&&!Array.isArray(s)&&s.filter&&(this._validate(he,"queryRenderedFeatures.filter",s.filter,null,s),_=i.aZ(s.filter));const y="mock",w=[];if(s&&s.target)w.push({...s,targetId:y,filter:_});else{const L=this.getFeaturesetDescriptors();for(const k of L)w.push({targetId:y,filter:_,target:k});for(const{style:k}of this.fragments){const N=k.getFeaturesetDescriptors();for(const B of N)w.push({targetId:y,filter:_,target:B})}}const C=this.queryRenderedTargets(t,w,d),z=[];for(const L of C)for(const k of L.variants[y])z.push(new i.cw(L,k));return z}queryRenderedTargets(t,s,d){const _={},y=(C,z,L,k)=>{const N=_[z.id]=_[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};N.layers[C.fqid]=N.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D()&&(N.has3DLayers=!0),N.layers[C.fqid].targets.push(k?{...L,namespace:k.namespace,properties:k.properties}:L)};for(const C of s)if("featuresetId"in C.target){const{featuresetId:z,importId:L}=C.target,k=this.getFragmentStyle(L),N=k.featuresetSelectors[z];if(!N){this.fire(new i.y(new Error(`The featureset '${z}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of N){const G=k.getOwnLayer(B.layerId);G&&!ld.has(G.type)&&y(G,k.getOwnLayerSourceCache(G),C,B)}}else if("layerId"in C.target){const{layerId:z}=C.target,L=this.getLayer(z);if(!L||ld.has(L.type))continue;y(L,this.getLayerSourceCache(L),C)}const w=this._queryRenderedFeatures(t,_,d);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(t,s,d){const _=[],y=!!this.map._showQueryGeometry,w=pr.createFromScreenPoints(t,d);for(const C in s){const z=Rp(w,s[C],this._availableImages,d,y);Object.keys(z).length&&_.push(z)}if(this.placement)for(const C in s){if(!s[C].sourceCache._onlySymbols)continue;const z=fu(w.screenGeometry,s[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(z).length&&_.push(z)}return _}querySourceFeatures(t,s){const d=s&&s.filter;d&&this._validate(he,"querySourceFeatures.filter",d,null,s);let _=[];const y=this.getOwnSourceCaches(t);for(const w of y)_=_.concat(nc(w,s));return _}addSourceType(t,s,d){return Ds.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(Ds.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,d={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const C in t)if(!i.bn(t[C],_[C])){y=!0;break}if(!y)return;const w=this._getTransitionParameters();this.light.setLight(t,s,d),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const _=t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const C="terrain-dem-src";this.addSource(C,d.source),d=i.cp(d),d=i.l(d,{source:C})}const y=i.l({},d),w={};if(this.terrain&&_){y.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(w.style=C.serialize())}if(this._validate(Xa,"terrain",y,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&s!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,s),this.fire(new i.z("data",{dataType:"style"}))}else{const y=this.terrain,w=y.get();for(const C of Object.keys(i.a3.terrain))!d.hasOwnProperty(C)&&i.a3.terrain[C].default&&(d[C]=i.a3.terrain[C].default);for(const C in t)if(!i.bn(t[C],w[C])){y.set(t,this.options),this.stylesheet.terrain=t;const z=this._getTransitionParameters({duration:0});y.updateTransitions(z),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Zi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}_createSnow(t){const s=this.snow=new $n(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}_createRain(t){const s=this.rain=new Dr(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(s);this._loadColorTheme(d).then(()=>{this.fire(new i.z("colorthemeset")),t()}).catch(_=>{i.w(`Couldn't set color theme: ${_}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=s,d._reloadColorTheme())}_getTransitionParameters(t){return{now:i.q.now(),transition:i.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):s.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const d=this.terrain=new Qe(t,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,d,_,y={}){if(y&&y.validate===!1)return!1;const w=i.l({},this.serialize());return fo(this,t.call(Fr,i.l({key:s,style:w,value:d,styleSpec:i.a3},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const d of s)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const s=this.getSourceCaches(t);for(const d of s)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let s;this.directionalLight&&(s=Fo(this.directionalLight));for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(t,void 0,void 0,s)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,d,_,y,w,C=!1){let z=!1,L=!1;const k={},N={};for(const B of this._mergedOrder){const G=this._mergedLayers[B];if(G.type!=="symbol")continue;const Y=i.aC(G.source,G.scope);let X=k[Y];if(!X){const Q=this.getLayerSourceCache(G);if(!Q)continue;const re=Q.getRenderableIds(!0).map(ue=>Q.getTileByID(ue));N[Y]=re.slice(),X=k[Y]=re.sort((ue,le)=>le.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(le.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(G,X,s.center.lng,s.projection);z=z||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new i.z("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),s.zoom))&&(this.pauseablePlacement=new Eu(s,this._mergedOrder,C,d,_,y,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,N,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),L=!0),z&&this.pauseablePlacement.placement.setStale()),L||z){this._buildingIndex.onNewFrame(s.zoom);for(let B=0;B<this._mergedOrder.length;B++){const G=this._mergedLayers[this._mergedOrder[B]];if(G.type!=="symbol")continue;const Y=this.isLayerClipped(G);this.placement.updateLayerOpacities(G,k[i.aC(G.source,G.scope)],B,Y?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:y})=>y===t.id)!==-1)return void this.fire(new i.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return d.push(t),this._loadImports([t],!0);const _=d.findIndex(({id:y})=>y===s);return _===-1&&this.fire(new i.y(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,_).concat(t).concat(d.slice(_)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(t);return _===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==d[_].url&&this.setImportUrl(t,s.url),i.bn(s.config,d[_].config)||this.setImportConfig(t,s.config),i.bn(s.data,d[_].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let d=this.stylesheet.imports||[];const _=this.getImportIndex(t);if(_===-1)return this;const y=this.getImportIndex(s);if(y===-1)return this;const w=d[_],C=this.fragments[_];return d=d.filter(({id:z})=>z!==t),this.fragments=this.fragments.filter(({id:z})=>z!==t),this.stylesheet.imports=d.slice(0,y).concat(w).concat(d.slice(y)),this.fragments=this.fragments.slice(0,y).concat(C).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(t);if(_===-1)return this;d[_].url=s;const y=this.fragments[_];return y.style=this._createFragmentStyle(d[_]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const d=this.getImportIndex(t),_=this.stylesheet.imports||[];return d===-1?this:s?(this.fragments[d].style.setState(s),this._reloadImports(),this):(delete _[d].data,this.setImportUrl(t,_[d].url))}setImportConfig(t,s){this._checkLoaded();const d=this.getImportIndex(t),_=this.stylesheet.imports||[];if(d===-1)return this;s?_[d].config=s:delete _[d].config;const y=this.fragments[d],w=y.style.stylesheet&&y.style.stylesheet.schema;return y.config=s,y.style.updateConfig(s,w),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(s.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return s===-1&&this.fire(new i.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[s];d&&t.push(d.getSource())}return t}getSource(t,s){const d=this.getSourceCache(t,s);return d&&d.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const d=i.aC(t,s);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const s=i.aC(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const d=t[s];d==="reload"?this.reloadSource(s):d==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const d of s){const _=this.getLayer(d);_&&_.updateTransitions(t)}}getImages(t,s,d){this.imageManager.getImages(s.icons,s.scope,d),this._updateTilesForChangedImages();const _=y=>{y&&y.setDependencies(s.tileID.key,s.type,s.icons)};_(this._otherSourceCaches[s.source]),_(this._symbolSourceCaches[s.source])}rasterizeImages(t,s,d){this.imageManager.rasterizeImages(s,d)}getGlyphs(t,s,d){this.glyphManager.getGlyphs(s.stacks,s.scope,d)}getResource(t,s,d){return i.cy(s,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${t}'`))),!1):s.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const d=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(d||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ds.getSourceType=function(h){return ha[h]},Ds.setSourceType=function(h,t){ha[h]=t},Ds.registerForPluginStateChange=i.ch;var dc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,qp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ud=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ru="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",fc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Lu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Bo=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ku=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,hd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ga=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,al=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ya=[];No(dc,ya),No(ud,ya),No(qp,ya);const xa={"_prelude_fog.vertex.glsl":Lu,"_prelude_terrain.vertex.glsl":fc,"_prelude_shadow.vertex.glsl":ga,"_prelude_fog.fragment.glsl":Bo,"_prelude_shadow.fragment.glsl":al,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ku,"_prelude_raster_particle.glsl":hd},po={};Ai("",fc),Ai(Bo,Lu),Ai(al,ga),Ai(ku,""),Ai(hd,"");const pc=Ai(qp,ud),Ou=dc;var dd={background:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ai("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ai(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ai("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ai("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ai(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ai(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ai(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec2 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
halfwidth=(u_width_scale*a_z_offset_width.y)/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec2 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ai("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ai("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ai(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ai(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ai("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ai(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ru),skyboxGradient:Ai(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ru),skyboxCapture:Ai(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ai(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ai(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ai("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ai("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ai("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ai("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function No(h,t){const s=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of s)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=d.split(" ");for(const y of _)t.includes(y)||t.push(y)}}function Ai(h,t){const s=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(L=>{const k=L.split(" ");return k[k.length-1]}),_=[...new Set(_)]);const y={},w=[],C=[];if(h=h.replace(s,(L,k)=>(C.push(k),"")),(t=t.replace(s,(L,k)=>(w.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let z=[...ya];No(h,z),No(t,z);for(const L of[...w,...C])xa[L]||console.error(`Undefined include: ${L}`),po[L]||(po[L]=[],No(xa[L],po[L])),z=[...z,...po[L]];return{fragmentSource:h=h.replace(d,(L,k,N,B,G)=>(y[G]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${N} ${B} ${G};
#else
uniform ${N} ${B} u_${G};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${G}
    ${N} ${B} ${G} = u_${G};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${N} ${B} ${G};
#endif
`:k==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(d,(L,k,N,B,G)=>{const Y=B==="float"?"vec2":B,X=G.match(/color/)?"color":Y;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${G}
in ${N} ${B} a_${G};
#endif
`:y[G]?k==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${N} ${Y} a_${G};
out ${N} ${B} ${G};
#else
uniform ${N} ${B} u_${G};
#endif
`:k==="initialize"?X==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${N} ${B} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${X}(a_${G}, u_${G}_t);
#else
    ${N} ${B} ${G} = u_${G};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${N} ${B} a_${G};
    out ${N} ${B} ${G};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${G} = a_${G};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${N} ${Y} a_${G};
#else
uniform ${N} ${B} u_${G};
#endif
`:k==="define-instanced"?X==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${G}0;
in vec4 a_${G}1;
in vec4 a_${G}2;
in vec4 a_${G}3;
#else
uniform ${N} ${B} u_${G};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${N} ${Y} a_${G};
#else
uniform ${N} ${B} u_${G};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${N} ${B} ${G} = a_${G};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${N} ${B} ${G} = a_${G};
#else
    ${N} ${B} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${N} ${B} ${G} = unpack_mix_${X}(a_${G}, u_${G}_t);
#else
    ${N} ${B} ${G} = u_${G};
#endif
`}),staticAttributes:_,usedDefines:z,vertexIncludes:w,fragmentIncludes:C}}class mc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,d,_,y,w,C,z){this.context=t;let L=this.boundPaintVertexBuffers.length!==_.length;for(let N=0;!L&&N<_.length;N++)this.boundPaintVertexBuffers[N]!==_[N]&&(L=!0);let k=this.boundDynamicVertexBuffers.length!==C.length;for(let N=0;!k&&N<C.length;N++)this.boundDynamicVertexBuffers[N]!==C[N]&&(k=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==d||L||k||this.boundIndexBuffer!==y||this.boundVertexOffset!==w)this.freshBind(s,d,_,y,w,C,z);else{t.bindVertexArrayOES.set(this.vao);for(const N of C)N&&(N.bind(),z&&N.instanceCount&&N.setVertexAttribDivisor(t.gl,s,z));y&&y.dynamicDraw&&y.bind()}}freshBind(t,s,d,_,y,w,C){const z=t.numAttributes,L=this.context,k=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=w,s.enableAttributes(k,t),s.bind(),s.setVertexAttribPointers(k,t,y);for(const N of d)N.enableAttributes(k,t),N.bind(),N.setVertexAttribPointers(k,t,y);for(const N of w)N&&(N.enableAttributes(k,t),N.bind(),N.setVertexAttribPointers(k,t,y),C&&N.instanceCount&&N.setVertexAttribDivisor(k,t,C));_&&_.bind(),L.currentNumAttributes=z}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function $p(h,t){const s=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new i.aa(0,d/s).toLngLat().lat,new i.aa(0,(d+1)/s).toLngLat().lat]}function Wp(h,t,s,d,_,y,w){const C=h.context,z=C.gl,L=s.hillshadeFBO;if(!L)return;h.prepareDrawTile();const k=h.isTileAffectedByFog(t),N=h.getOrCreateProgram("hillshade",{overrideFog:k});C.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,L.colorAttachment.get());const B=((J,Q,re,ue)=>{const le=re.paint.get("hillshade-shadow-color"),_e=re.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",fe=re.paint.get("hillshade-highlight-color"),pe=re.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",de=re.paint.get("hillshade-accent-color"),be=re.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ie=re.paint.get("hillshade-emissive-strength");let He=i.ai(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")He-=J.transform.angle;else if(J.style&&J.style.enable3dLights()&&J.style.directionalLight){const Ee=J.style.directionalLight.properties.get("direction"),Re=i.cb(Ee.x,Ee.y,Ee.z);He=i.ai(Re[1])}const Ve=!J.options.moving;return{u_matrix:ue||J.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),Ve),u_image:0,u_latrange:$p(0,Q.tileID),u_light:[re.paint.get("hillshade-exaggeration"),He],u_shadow:le.toRenderColor(_e?null:re.lut),u_highlight:fe.toRenderColor(pe?null:re.lut),u_emissive_strength:Ie,u_accent:de.toRenderColor(be?null:re.lut)}})(h,s,d,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(C,N,t.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:Y,tileBoundsSegments:X}=h.getTileBoundsBuffers(s);N.draw(h,z.TRIANGLES,_,y,w,ni.disabled,B,d.id,G,Y,X)}function fd(h,t,s){if(!t.needsDEMTextureUpload)return;const d=h.context,_=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(s.stride);const y=s.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new i.T(d,y,_.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function ll(h,t,s){const d=h.context,_=d.gl;if(!t.dem)return;const y=t.dem;if(d.activeTexture.set(_.TEXTURE1),fd(h,t,y),!t.demTexture)return;t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const w=y.dim;d.activeTexture.set(_.TEXTURE0);let C=t.hillshadeFBO;if(!C){const B=new i.T(d,{width:w,height:w,data:null},_.RGBA8);B.bind(_.LINEAR,_.CLAMP_TO_EDGE),C=t.hillshadeFBO=d.createFramebuffer(w,w,!0,"renderbuffer"),C.colorAttachment.set(B.texture)}d.bindFramebuffer.set(C.framebuffer),d.viewport.set([0,0,w,w]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:L,tileBoundsSegments:k}=h.getMercatorTileBoundsBuffers(),N=[];h.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(h,_.TRIANGLES,$t.disabled,hi.disabled,bi.unblended,ni.disabled,((B,G)=>{const Y=G.stride,X=i.ab.mat4.create();return i.ab.mat4.ortho(X,0,i.ag,-i.ag,0,0,1),i.ab.mat4.translate(X,X,[0,-i.ag,0]),{u_matrix:X,u_image:1,u_dimension:[Y,Y],u_zoom:B.overscaledZ}})(t.tileID,y),s.id,z,L,k),t.needsHillshadePrepare=!1}class _n{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $g extends _n{getDefault(){return i.aj.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Wg extends _n{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Zg extends _n{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class pd extends _n{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class md extends _n{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class _d extends _n{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class gd extends _n{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Zp extends _n{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Xp extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Xg extends _n{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class _c extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class gc extends _n{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Yp extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class qr extends _n{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class yd extends _n{getDefault(){return i.aj.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Fu extends _n{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Bu extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class xd extends _n{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class vd extends _n{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Nu=class extends _n{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class bd extends _n{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class wd extends _n{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Vu extends _n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Kp extends _n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Jp extends _n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class cl extends _n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Yg extends _n{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Kg extends _n{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Jg extends _n{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Qg extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ey extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Td extends _n{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Sd extends Td{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Uu extends Td{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Qp extends Td{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ul extends Uu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const em=(h,t,s)=>({u_matrix:h,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:s}),Md=(h,t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:s,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_frustum_tl:w,u_frustum_tr:C,u_frustum_br:z,u_frustum_bl:L,u_globe_pos:k,u_globe_radius:N,u_viewport:B,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:G,u_far_z_cutoff:Y});function Ed(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const Vo=new class{constructor(){this.operations={}}newMorphing(h,t,s,d,_){if(h in this.operations){const y=this.operations[h];y.to.tileID.key!==s.tileID.key&&(y.queued=s)}else this.operations[h]={startTime:d,phase:0,duration:_,from:t,to:s,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const s=this.operations[t];for(s.phase=(h-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Uo={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ad(h,t,s){if(t===0)return 0;const d=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*d}function jo(h,t){const s=1<<h.z;return!t&&(h.x===0||h.x===s-1)||h.y===0||h.y===s-1}const yc=h=>({u_matrix:h});function hl(h,t,s,d,_){if(_>0){const y=i.q.now(),w=(y-h.timeAdded)/_,C=t?(y-t.timeAdded)/_:-1,z=s.getSource(),L=d.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),k=!t||Math.abs(t.tileID.overscaledZ-L)>Math.abs(h.tileID.overscaledZ-L),N=k&&h.refreshedUponExpiration?1:i.aw(k?w:1-C,0,1);return h.refreshedUponExpiration&&w>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class tm extends _s{constructor(t){const s={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new i.D(i.ci(),null),_=td("mock-dem",s,d,t.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class im extends _s{constructor(t){const s=td("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new i.D(i.ci(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,d){if(t.freezeTileCoverage)return;this.transform=t;const _=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,w)=>{if(y[w.key]="",!this._tiles[w.key]){const C=new Oo(w,this._source.tileSize*w.overscaleFactor(),t.tileZoom);C.state="loaded",this._tiles[w.key]=C}return y},{});for(const y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const d=Object.values(s);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ju extends i.aG{constructor(t,s,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=d}}class Gu extends i.cJ{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,_,y]=function(z){const L=new i.b4,k=new i.aU,N=131;L.reserve(17161),k.reserve(33800);const B=i.ag/128,G=i.ag+B/2,Y=G+B;for(let J=-B;J<Y;J+=B)for(let Q=-B;Q<Y;Q+=B){const re=Q<0||Q>G||J<0||J>G?24575:0,ue=i.aw(Math.round(Q),0,i.ag),le=i.aw(Math.round(J),0,i.ag);L.emplaceBack(ue+re,le)}const X=(J,Q)=>{const re=Q*N+J;k.emplaceBack(re+1,re,re+N),k.emplaceBack(re+N,re+N+1,re+1)};for(let J=1;J<129;J++)for(let Q=1;Q<129;Q++)X(Q,J);return[0,129].forEach(J=>{for(let Q=0;Q<130;Q++)X(Q,J),X(J,Q)}),[L,k,32768]}(),w=t.context;this.gridBuffer=w.createVertexBuffer(d,i.b6.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=i.b7.simpleSegment(0,0,d.length,_.length),this.gridNoSkirtSegments=i.b7.simpleSegment(0,0,d.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new im(s.map),this.orthoMatrix=i.ab.mat4.create(),i.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.ag,0,i.ag,0,1);const C=w.gl;this._overlapStencilMode=new hi({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new tm(s.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,s,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const _=t.terrain.properties,y=t.terrain.drapeRenderMode===0,w=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const C=t.terrain&&t.terrain.scope,z=_.get("source"),L=y?this._mockSourceCache:t.getSourceCache(z,C);if(!L)return void i.w(`Couldn't find terrain source "${z}".`);if(this.sourceCache=L,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(s):_.get("exaggeration"),!s.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(s,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),s.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const _=s!=null?d-s:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const y=t.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(y);let C=y-this._previousZoom;const z=this._previousUpdateTimestamp;let L=y;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(y-L)>.5&&(C=.5*(y-L+C)),C*_<0&&(L+=C)),this._evaluationZoom=L;const k=w.getExaggeration(L),N=k===w.getExaggeration(Math.max(0,L-.1));if(N&&Math.abs(k-this._exaggeration)<.01)return k;let B=Math.min(.1,.00375*(this._updateTimestamp-z));return(N||k<.1||Math.abs(C)<1e-4)&&(B=Math.min(.2,4*B)),i.af(this._exaggeration,k,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(i.aa.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=s.getIds().map(z=>{const L=s.getTileByID(z).tileID;return L.projMatrix=d.calculateProjMatrix(L.toUnwrapped()),L});(function(z,L){const k=L.transform.pointCoordinate(L.transform.getCameraPoint()),N=new i.P(k.x,k.y);z.sort((B,G)=>{if(G.overscaledZ-B.overscaledZ)return G.overscaledZ-B.overscaledZ;const Y=new i.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),X=new i.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),J=N.mult(1<<B.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(Y)-J.distSqr(X)})})(_,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},_.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const z in w){const L=w[z];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,t[z],y),L.usedForTerrain))continue;const k=t[z];L.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[s.id]=_.map(z=>new ju(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const L=this.terrainTileForTile[z.key];if(!L)continue;const k=L.tileID.key;k in C||(this._visibleDemTiles.push(L),C[k]=k)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const d=this._findTileCoveringTileID(s,this.sourceCache);d&&(this.terrainTileForTile[s.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const d in this.terrainTileForTile){const _=this.terrainTileForTile[d],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),fd(this.painter,_,y))}}_prepareDemTileUniforms(t,s,d,_){if(!s||s.demTexture==null)return!1;const y=t.tileID.canonical,w=Math.pow(2,s.tileID.canonical.z-y.z),C=_||"";return d[`u_dem_tl${C}`]=[y.x*w%1,y.y*w%1],d[`u_dem_scale${C}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce((d,_)=>{if(!_.dem)return d;const y=_.dem.tree.minimums[0];return y>0&&t++,d+y},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const d=this._getLoadedAreaMinimum(),_=new i.cK({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new i.T(t,_,s.R32F,{premultiply:!1}),y}setupElevationDraw(t,s,d){const _=this.painter.context,y=_.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let C=null,z=null,L=1;if(d&&d.morphing&&this._useVertexMorphing){const G=d.morphing.srcDemTile,Y=d.morphing.dstDemTile;L=d.morphing.phase,G&&Y&&(this._prepareDemTileUniforms(t,G,w,"_prev")&&(z=G),this._prepareDemTileUniforms(t,Y,w)&&(C=Y))}const k=G=>G&&G.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let N=null;var B;if(this.enabled?z&&C?(N=C.demTexture,_.activeTexture.set(y.TEXTURE4),z.demTexture.bind(k(z),y.CLAMP_TO_EDGE),w.u_dem_lerp=L):(C=this.terrainTileForTile[t.tileID.key],N=this._prepareDemTileUniforms(t,C,w)?C.demTexture:this.emptyDEMTexture):N=this.emptyDEMTexture,_.activeTexture.set(y.TEXTURE2),N&&(w.u_dem_size=(B=N).size[0]===1?1:B.size[0]-2,N.bind(k(C),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,s,w),d&&d.useMeterToDem&&C){const G=(1<<C.tileID.canonical.z)*i.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=G}if(d&&d.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),s.setTerrainUniformValues(_,w),this.painter.transform.projection.name==="globe"){const G=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);s.setGlobeUniformValues(_,G)}}globeUniformValues(t,s,d){const _=t.projection;return{u_tile_tl_up:_.upVector(s,0,0),u_tile_tr_up:_.upVector(s,i.ag,0),u_tile_br_up:_.upVector(s,i.ag,i.ag),u_tile_bl_up:_.upVector(s,0,i.ag),u_tile_up_scale:d?i.cL(1):_.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,y,w,C,z){if(_.transform.projection.name==="globe")(function(L,k,N,B,G){const Y=L.context,X=Y.gl;let J,Q;const re=L.transform,ue=i.cC(L,Y,re),le=(Ee,Re)=>{if(Q===Re)return;const et=[Uo[Re],"PROJECTION_GLOBE_VIEW"];ue&&et.push("CUSTOM_ANTIALIASING");const ot=L.isTileAffectedByFog(Ee);J=L.getOrCreateProgram("globeRaster",{defines:et,overrideFog:ot}),Q=Re},_e=L.colorModeForRenderPass(),fe=new $t(X.LEQUAL,$t.ReadWrite,L.depthRangeFor3D);Vo.update(G);const pe=i.cD(re),de=[i.at(re.center.lng),i.aA(re.center.lat)],be=L.globeSharedBuffers,Ie=[re.width*i.q.devicePixelRatio,re.height*i.q.devicePixelRatio],He=Float32Array.from(re.globeMatrix),Ve={useDenormalizedUpVectorScale:!0};{const Ee=L.transform,Re=Ad(Ee.zoom,k.exaggeration(),k.sourceCache._source.tileSize);Q=-1;const et=X.TRIANGLES;for(const ot of B){const ft=N.getTile(ot),Ne=hi.disabled,nt=k.prevTerrainTileForTile[ot.key],$e=k.terrainTileForTile[ot.key];Ed(nt,$e)&&Vo.newMorphing(ot.key,nt,$e,G,250),Y.activeTexture.set(X.TEXTURE0),ft.texture&&ft.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const ut=Vo.getMorphValuesForProxy(ot.key),st=ut?1:0;ut&&i.J(Ve,{morphing:{srcDemTile:ut.from,dstDemTile:ut.to,phase:i.cB(ut.phase)}});const tt=i.cE(ot.canonical),wt=i.cF(tt.getCenter().lat),Et=i.cG(ot.canonical,tt,wt,Ee.worldSize/Ee._pixelsPerMercatorPixel),gt=i.bb(i.cH(ot.canonical)),Rt=Md(Ee.expandedFarZProjMatrix,He,pe,gt,i.ae(Ee.zoom),de,Ee.frustumCorners.TL,Ee.frustumCorners.TR,Ee.frustumCorners.BR,Ee.frustumCorners.BL,Ee.globeCenterInViewSpace,Ee.globeRadius,Ie,Re,Ee._farZ,Et);if(le(ot,st),J&&(k.setupElevationDraw(ft,J,Ve),L.uploadCommonUniforms(Y,J,ot.toUnwrapped()),be)){const[oi,Zt,Wt]=be.getGridBuffers(wt,Re!==0);J.draw(L,et,fe,Ne,_e,ni.backCCW,Rt,"globe_raster",oi,Zt,Wt)}}}if(be&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const Ee=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&Ee.push("CUSTOM_ANTIALIASING"),J=L.getOrCreateProgram("globeRaster",{defines:Ee});for(const Re of B){const{x:et,y:ot,z:ft}=Re.canonical,Ne=ot===0,nt=ot===(1<<ft)-1,[$e,ut,st,tt]=be.getPoleBuffers(ft,!1);if(tt&&(Ne||nt)){const wt=N.getTile(Re);Y.activeTexture.set(X.TEXTURE0),wt.texture&&wt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let Et=i.cI(ft,et,re);const gt=i.bb(i.cH(Re.canonical)),Rt=(oi,Zt)=>oi.draw(L,X.TRIANGLES,fe,hi.disabled,_e,ni.disabled,Md(re.expandedFarZProjMatrix,Et,Et,gt,0,de,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,Ie,0,re._farZ),"globe_pole_raster",Zt,st,tt);k.setupElevationDraw(wt,J,Ve),L.uploadCommonUniforms(Y,J,Re.toUnwrapped()),Ne&&L.renderDefaultNorthPole&&Rt(J,$e),nt&&L.renderDefaultSouthPole&&(Et=i.ab.mat4.scale(i.ab.mat4.create(),Et,[1,-1,1]),Rt(J,ut))}}}})(_,y,w,C,z);else{const L=_.context,k=L.gl;let N,B;const G=_.shadowRenderer,Y=uo(_,_.longestCutoffRange),X=_e=>{if(B===_e)return;const fe=[];fe.push(Uo[_e]),Y.shouldRenderCutoff&&fe.push("RENDER_CUTOFF"),G&&(fe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&fe.push("NORMAL_OFFSET")),N=_.getOrCreateProgram("terrainRaster",{defines:fe}),B=_e},J=_.colorModeForRenderPass(),Q=new $t(k.LEQUAL,$t.ReadWrite,_.depthRangeFor3D);Vo.update(z);const re=_.transform,ue=Ad(re.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let le=[0,0,0];if(G){const _e=_.style.directionalLight,fe=_.style.ambientLight;_e&&fe&&(le=sl(_.style,_e,fe))}{B=-1;const _e=k.TRIANGLES,[fe,pe]=[y.gridIndexBuffer,y.gridSegments];for(const de of C){const be=w.getTile(de),Ie=hi.disabled,He=y.prevTerrainTileForTile[de.key],Ve=y.terrainTileForTile[de.key];Ed(He,Ve)&&Vo.newMorphing(de.key,He,Ve,z,250),L.activeTexture.set(k.TEXTURE0),be.texture&&be.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Ee=Vo.getMorphValuesForProxy(de.key),Re=Ee?1:0;let et;Ee&&(et={morphing:{srcDemTile:Ee.from,dstDemTile:Ee.to,phase:i.cB(Ee.phase)}});const ot=em(de.projMatrix,jo(de.canonical,re.renderWorldCopies)?ue/10:ue,le);if(X(Re),!N)continue;y.setupElevationDraw(be,N,et);const ft=de.toUnwrapped();G&&G.setupShadows(ft,N),_.uploadCommonUniforms(L,N,ft,null,Y),N.draw(_,_e,Q,Ie,J,ni.backCCW,ot,"terrain_raster",y.gridBuffer,fe,pe)}}}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,d=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),C=s.style.order,z=[];let L=0;for(const k of y){const N=_.getTileByID(k.proxyTileKey),B=_.proxyCachedFBO[k.key]?_.proxyCachedFBO[k.key][t]:void 0,G=B!==void 0?_.renderCache[B]:this.pool[L++],Y=B!==void 0;if(N.texture=G.tex,Y&&!G.dirty){z.push(N.tileID);continue}let X;d.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(d.clear({color:i.aj.transparent,stencil:0}),G.dirty=!1);for(let J=w.start;J<=w.end;++J){const Q=s.style._mergedLayers[C[J]];if(Q.isHidden(s.transform.zoom))continue;const re=s.style.getLayerSourceCache(Q),ue=re?this.proxyToSource[k.key][re.id]:[k];if(!ue)continue;const le=ue;d.viewport.set([0,0,G.fb.width,G.fb.height]),X!==(re?re.id:null)&&(this._setupStencil(G,ue,Q,re),X=re?re.id:null),s.renderLayer(s,re,Q,le)}if(this._drapedRenderBatches.length===0)for(const J of this._pendingGroundEffectLayers){const Q=s.style._mergedLayers[C[J]];if(Q.isHidden(s.transform.zoom))continue;const re=s.style.getLayerSourceCache(Q),ue=re?this.proxyToSource[k.key][re.id]:[k];if(!ue)continue;const le=ue;d.viewport.set([0,0,G.fb.width,G.fb.height]),X!==(re?re.id:null)&&(this._setupStencil(G,ue,Q,re),X=re?re.id:null),s.renderLayer(s,re,Q,le)}this.renderedToTile?(G.dirty=!0,z.push(N.tileID)):Y||--L,L===5&&(L=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,s.width,s.height]),w.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let d=-1,_=s;for(let y=0;y<s;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?d=Math.max(d,y):_=Math.min(_,y);return _>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,d){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const w=y.tileID,C=1<<w.overscaledZ,{x:z,y:L}=w.canonical,k=z/C,N=(z+1)/C,B=L/C,G=(L+1)/C;return{minx:k,miny:B,maxx:N,maxy:G,t:y.dem.tree.raycastRoot(k,B,N,G,t,s,d),tile:y}});_.sort((y,w)=>(y.t!==null?y.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const y of _){if(y.t==null)return null;const w=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,s,d);if(w!=null)return w}return null}_createFBO(){const t=this.painter.context,s=t.gl,d=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const _=new i.T(t,{width:d[0],height:d[1],data:null},s.RGBA8);_.bind(s.LINEAR,s.CLAMP_TO_EDGE);const y=t.createFramebuffer(d[0],d[1],!0,null);return y.colorAttachment.set(_.texture),y.depthAttachment=new ul(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._mergedLayers[t],d=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!d&&s.shouldRedrape():!d&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof du){t=!0;break}if(!t)return;const s={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(_);if(y&&!s[y.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof i.a9){s[y.id]=!0;for(const w of this.proxyCoords){const C=this.proxyToSource[w.key][y.id];if(C)for(const z of C)this._clearRenderCacheForTile(y.id,z)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Ya){t=!0;break}if(!t)return;const s={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(_);if(!y||s[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const w=_.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const z=this.proxyToSource[C.key][y.id];if(z)for(const L of z){const k=hl(y.getTile(L),y.findLoadedParent(L,0),y,this.painter.transform,w);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(y.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const d=[];this._pendingGroundEffectLayers=[];let _,y=0,w=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++y<s;)w=this._style._mergedLayers[t[y]];for(;y<s;++y){const C=this._style._mergedLayers[t[y]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?_===void 0&&(_=y):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),_!==void 0&&(d.push({start:_,end:y-1}),_=void 0)))}if(_!==void 0&&d.push({start:_,end:y-1}),d.length!==0){const C=d[d.length-1];this._pendingGroundEffectLayers.every(z=>z>C.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const w=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let C=0;C<w.length;++C){const z=Object.values(w[C]);s.renderCachePool.push(...z)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,_=this._tilesDirty;for(let w=d.length-1;w>=0;w--){const C=d[w];if(s.getTileByID(C.key),s.proxyCachedFBO[C.key]!==void 0){const z=t[C.key],L=this.proxyToSource[C.key];let k=0;for(const N in L){const B=L[N],G=z[N];if(!G||G.length!==B.length||B.some((Y,X)=>Y!==G[X]||_[N]&&_[N].hasOwnProperty(Y.key))){k=-1;break}++k}for(const N in s.proxyCachedFBO[C.key])s.renderCache[s.proxyCachedFBO[C.key][N]].dirty=k<0||k!==Object.values(z).length}}const y=[...this._drapedRenderBatches];y.sort((w,C)=>C.end-C.start-(w.end-w.start));for(const w of y)for(const C of d){if(s.proxyCachedFBO[C.key])continue;let z=s.renderCachePool.pop();z===void 0&&s.renderCache.length<50&&(z=s.renderCache.length,s.renderCache.push(this._createFBO())),z!==void 0&&(s.proxyCachedFBO[C.key]={},s.proxyCachedFBO[C.key][w.start]=z,s.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,d,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,w=y.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let C;if(d.isTileClipped())C=s.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):hi.disabled}_renderTileClippingMasks(t,s){const d=this.painter,_=this.painter.context,y=_.gl;d._tileClippingMaskIDs={},_.setColorMode(bi.disabled),_.setDepthMode($t.disabled);const w=d.getOrCreateProgram("clippingMask");for(const C of t){const z=d._tileClippingMaskIDs[C.key]=--s;w.draw(d,y.TRIANGLES,$t.disabled,new hi({func:y.ALWAYS,mask:0},z,255,y.KEEP,y.KEEP,y.REPLACE),bi.disabled,ni.disabled,yc(C.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const d=[t.x,t.y,1,1];i.ab.vec4.transformMat4(d,d,s.pixelMatrixInverse),i.ab.vec4.scale(d,d,1/d[3]),d[0]/=s.worldSize,d[1]/=s.worldSize;const _=s._camera.position,y=i.bH(1,s.center.lat),w=[_[0],_[1],_[2]/y,0],C=i.ab.vec3.subtract([],d.slice(0,3),w);i.ab.vec3.normalize(C,C);const z=this.raycast(w,C,this._exaggeration);return z!==null&&z?(i.ab.vec3.scaleAndAdd(w,w,C,z),w[3]=w[2],w[2]*=y,w):null}_setupProxiedCoordsForOrtho(t,s,d){if(t.getSource()instanceof i.aJ)return this._setupProxiedCoordsForImageSource(t,s,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const _=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let z=0;z<y.length;z++){const L=y[z],k=this._findTileCoveringTileID(L,t);if(k){const N=this._createProxiedId(L,k,d[L.key]&&d[L.key][t.id]);_.push(N),this.proxyToSource[L.key][t.id]=[N]}}let w=!1;const C=new Set;for(let z=0;z<s.length;z++){const L=t.getTile(s[z]);if(!L||!L.hasData())continue;const k=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==L.tileID.canonical.z){const N=this.proxyToSource[k.tileID.key][t.id],B=this._createProxiedId(k.tileID,L,d[k.tileID.key]&&d[k.tileID.key][t.id]);N?N.splice(N.length-1,0,B):this.proxyToSource[k.tileID.key][t.id]=[B];const G=this.proxyToSource[k.tileID.key][t.id];C.has(G)||C.add(G),_.push(B),w=!0}}if(this._sourceTilesOverlap[t.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const z of C)z.sort((L,k)=>k.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(t,s,d){if(!t.getSource().loaded())return;const _=this.proxiedCoords[t.id]=[],y=this.proxyCoords,w=t.getSource(),C=w.tileID;if(!C)return;const z=new i.P(C.x,C.y)._div(1<<C.z),L=w.coordinates.map(i.aa.fromLngLat).reduce((N,B)=>(N.min.x=Math.min(N.min.x,B.x-z.x),N.min.y=Math.min(N.min.y,B.y-z.y),N.max.x=Math.max(N.max.x,B.x-z.x),N.max.y=Math.max(N.max.y,B.y-z.y),N),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(N,B)=>{const G=N.wrap+N.canonical.x/(1<<N.canonical.z),Y=N.canonical.y/(1<<N.canonical.z),X=i.ag/(1<<N.canonical.z),J=B.wrap+B.canonical.x/(1<<B.canonical.z),Q=B.canonical.y/(1<<B.canonical.z);return G+X<J+L.min.x||G>J+L.max.x||Y+X<Q+L.min.y||Y>Q+L.max.y};for(let N=0;N<y.length;N++){const B=y[N];for(let G=0;G<s.length;G++){const Y=t.getTile(s[G]);if(!Y||!Y.hasData()||k(B,Y.tileID))continue;const X=this._createProxiedId(B,Y,d[B.key]&&d[B.key][t.id]),J=this.proxyToSource[B.key][t.id];J?J.push(X):this.proxyToSource[B.key][t.id]=[X],_.push(X)}}}_createProxiedId(t,s,d){let _=this.orthoMatrix;if(d){const y=d.find(w=>w.key===s.tileID.key);if(y)return y}if(s.tileID.key!==t.key){const y=t.canonical.z-s.tileID.canonical.z;let w,C,z;_=i.ab.mat4.create();const L=s.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(w=i.ag>>y,C=w*((s.tileID.canonical.x<<y)-t.canonical.x+L),z=w*((s.tileID.canonical.y<<y)-t.canonical.y)):(w=i.ag<<-y,C=i.ag*(s.tileID.canonical.x-(t.canonical.x+L<<-y)),z=i.ag*(s.tileID.canonical.y-(t.canonical.y<<-y))),i.ab.mat4.ortho(_,0,w,0,w,0,1),i.ab.mat4.translate(_,_,[C,z,0])}return new ju(s.tileID,t.key,_)}_findTileCoveringTileID(t,s){let d=s.getTile(t);if(d&&d.hasData())return d;const _=this._findCoveringTileCache[s.id],y=_[t.key];if(d=y?s.getTileByID(y):null,d&&d.hasData()||y===null)return d;let w=d?d.tileID:t,C=w.overscaledZ;const z=s.getSource().minzoom,L=[];if(!y){const N=s.getSource().maxzoom;if(t.canonical.z>=N){const B=t.canonical.z-N;s.getSource().reparseOverscaled?(C=Math.max(t.canonical.z+2,s.transform.tileZoom),w=new i.aG(C,t.wrap,N,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(C=N,w=new i.aG(C,t.wrap,N,t.canonical.x>>B,t.canonical.y>>B))}w.key!==t.key&&(L.push(w.key),d=s.getTile(w))}const k=N=>{L.forEach(B=>{_[B]=N}),L.length=0};for(C-=1;C>=z&&(!d||!d.hasData());C--){d&&k(d.tileID.key);const N=w.calculateScaledKey(C);if(d=s.getTileByID(N),d&&d.hasData())break;const B=_[N];if(B===null)break;B===void 0?L.push(N):d=s.getTileByID(B)}return k(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[s.key]=!0}}function ty(h,t,s){const d=function(C,z,L){const k=i.ab.vec3.dot(z,C),N=i.ab.vec3.dot(L,[.2126,.7152,.0722]),B=(Y,X,J)=>(1-J)*Y+J*X,G=B(1-.3*Math.min(N,1),1,Math.min(k+1,1));return B(.92,1,Math.asin(i.aw(z[2],-1,1))/Math.PI+.5)*G}(h,[0,0,1],t),_=[0,0,0];i.ab.vec3.scale(_,s.slice(0,3),d);const y=[0,0,0];i.ab.vec3.scale(y,t.slice(0,3),h[2]);const w=[0,0,0];return i.ab.vec3.add(w,_,y),i.cf(w)}const nm=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],xc=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class rm{static cacheKey(t,s,d,_){let y=`${s}${_?_.cacheKey:""}`;for(const w of d)t.usedDefines.includes(w)&&(y+=`/${w}`);return y}constructor(t,s,d,_,y,w){const C=t.gl;this.program=C.createProgram(),this.configuration=_,this.name=s,this.fixedDefines=[...w];const z=_?_.getBinderAttributes():[],L=(d.staticAttributes||[]).concat(z);let k=_?_.defines():[];k=k.concat(w.map(J=>`#define ${J}`));const N=`#version 300 es
`;let B=N+k.concat("precision mediump float;",Ou,pc.fragmentSource).join(`
`);for(const J of d.fragmentIncludes)B+=`
${xa[J]}`;B+=`
${d.fragmentSource}`;let G=N+k.concat("precision highp float;",Ou,pc.vertexSource).join(`
`);for(const J of d.vertexIncludes)G+=`
${xa[J]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(G+=`
uniform int u_instanceID;
`),G+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(G=G.replaceAll("gl_InstanceID","u_instanceID"));const Y=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Y,B),C.compileShader(Y),C.attachShader(this.program,Y);const X=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(X,G),C.compileShader(X),C.attachShader(this.program,X),this.attributes={},this.numAttributes=L.length;for(let J=0;J<this.numAttributes;J++)if(L[J]){const Q=L[J].startsWith("a_")?L[J]:`a_${L[J]}`;C.bindAttribLocation(this.program,J,Q),this.attributes[Q]=J}C.linkProgram(this.program),C.deleteShader(X),C.deleteShader(Y),this.fixedUniforms=y(t),this.binderUniforms=_?_.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(J=>({u_instanceID:new i.bN(J)}))(t)),(w.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(J=>({u_dem:new i.bN(J),u_dem_prev:new i.bN(J),u_dem_tl:new i.bK(J),u_dem_scale:new i.bM(J),u_dem_tl_prev:new i.bK(J),u_dem_scale_prev:new i.bM(J),u_dem_size:new i.bM(J),u_dem_lerp:new i.bM(J),u_exaggeration:new i.bM(J),u_depth:new i.bN(J),u_depth_size_inv:new i.bK(J),u_depth_range_unpack:new i.bK(J),u_occluder_half_size:new i.bM(J),u_occlusion_depth_offset:new i.bM(J),u_meter_to_dem:new i.bM(J),u_label_plane_matrix_inv:new i.bJ(J)}))(t)),w.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new i.bL(J),u_tile_tr_up:new i.bL(J),u_tile_br_up:new i.bL(J),u_tile_bl_up:new i.bL(J),u_tile_up_scale:new i.bM(J)}))(t)),w.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new i.bJ(J),u_fog_range:new i.bK(J),u_fog_color:new i.ca(J),u_fog_horizon_blend:new i.bM(J),u_fog_vertical_limit:new i.bK(J),u_fog_temporal_offset:new i.bM(J),u_frustum_tl:new i.bL(J),u_frustum_tr:new i.bL(J),u_frustum_br:new i.bL(J),u_frustum_bl:new i.bL(J),u_globe_pos:new i.bL(J),u_globe_radius:new i.bM(J),u_globe_transition:new i.bM(J),u_is_globe:new i.bN(J),u_viewport:new i.bK(J)}))(t)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new i.ca(J)}))(t)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new i.bL(J),u_lighting_directional_dir:new i.bL(J),u_lighting_directional_color:new i.bL(J),u_ground_radiance:new i.bL(J)}))(t)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new i.bJ(J),u_light_matrix_1:new i.bJ(J),u_fade_range:new i.bK(J),u_shadow_normal_offset:new i.bL(J),u_shadow_intensity:new i.bM(J),u_shadow_texel_size:new i.bM(J),u_shadow_map_resolution:new i.bM(J),u_shadow_direction:new i.bL(J),u_shadow_bias:new i.bL(J),u_shadowmap_0:new i.bN(J),u_shadowmap_1:new i.bN(J)}))(t))}}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)d[_]&&d[_].set(this.program,_,s[_])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)d[_]&&d[_].set(this.program,_,s[_])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)d[_].set(this.program,_,s[_])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)d[_].set(this.program,_,s[_])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)d[_].set(this.program,_,s[_])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const _ in s)d[_].set(this.program,_,s[_])}_drawDebugWireframe(t,s,d,_,y,w,C,z,L,k){const N=t.options.wireframe;if(N.terrain===!1&&N.layers2D===!1&&N.layers3D===!1)return;const B=t.context;if(!(!(!N.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!N.layers2D||t._terrain&&t._terrain.renderingToTexture||!nm.includes(this.name))||!(!N.layers3D||!xc.includes(this.name))))return;const G=B.gl,Y=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,B);if(!Y)return;const X=[...this.fixedDefines];X.push("DEBUG_WIREFRAME");const J=t.getOrCreateProgram(this.name,{config:this.configuration,defines:X});B.program.set(J.program);const Q=(le,_e,fe)=>{if(_e[le]&&fe[le])for(const pe in _e[le])fe[le][pe]&&fe[le][pe].set(fe.program,pe,_e[le][pe].current)};L&&L.setUniforms(J.program,B,J.binderUniforms,C,{zoom:z}),Q("fixedUniforms",this,J),Q("terrainUniforms",this,J),Q("globeUniforms",this,J),Q("fogUniforms",this,J),Q("lightsUniforms",this,J),Q("shadowUniforms",this,J),Y.bind(),B.setColorMode(new bi([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],i.aj.transparent,[!0,!0,!0,!1])),B.setDepthMode(new $t(s.func===G.LESS?G.LEQUAL:s.func,$t.ReadOnly,s.range)),B.setStencilMode(hi.disabled);const re=3*w.primitiveLength*2,ue=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const le=k||1;for(let _e=0;_e<le;++_e)J.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",_e),G.drawElements(G.LINES,re,G.UNSIGNED_SHORT,ue)}else k&&k>1?G.drawElementsInstanced(G.LINES,re,G.UNSIGNED_SHORT,ue,k):G.drawElements(G.LINES,re,G.UNSIGNED_SHORT,ue);y.bind(),B.program.set(this.program),B.setDepthMode(s),B.setStencilMode(d),B.setColorMode(_)}checkUniforms(t,s,d){if(this.fixedDefines.includes(s)){for(const _ of Object.keys(d))if(!d[_].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${_} not set but required by ${s} being defined`)}}draw(t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X,J){const Q=t.context,re=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(d),Q.setStencilMode(_),Q.setColorMode(y),Q.setCullFace(w);for(const _e of Object.keys(this.fixedUniforms))this.fixedUniforms[_e].set(this.program,_e,C[_e]);Y&&Y.setUniforms(this.program,Q,this.binderUniforms,B,{zoom:G});const ue={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[s];this.checkUniforms(z,"RENDER_SHADOWS",this.shadowUniforms);const le=J&&J>0?1:void 0;for(const _e of N.get()){const fe=_e.vaos||(_e.vaos={});if((fe[z]||(fe[z]=new mc)).bind(Q,this,L,Y?Y.getPaintVertexBuffers():[],k,_e.vertexOffset,X||[],le),this.forceManualRenderingForInstanceIDShaders){const pe=J||1;for(let de=0;de<pe;++de)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",de),k?re.drawElements(s,_e.primitiveLength*ue,re.UNSIGNED_SHORT,_e.primitiveOffset*ue*2):re.drawArrays(s,_e.vertexOffset,_e.vertexLength)}else J&&J>1?re.drawElementsInstanced(s,_e.primitiveLength*ue,re.UNSIGNED_SHORT,_e.primitiveOffset*ue*2,J):k?re.drawElements(s,_e.primitiveLength*ue,re.UNSIGNED_SHORT,_e.primitiveOffset*ue*2):re.drawArrays(s,_e.vertexOffset,_e.vertexLength);s===re.TRIANGLES&&k&&this._drawDebugWireframe(t,d,_,y,k,_e,B,G,Y,J)}}}function sm(h,t){const s=Math.pow(2,t.tileID.overscaledZ),d=t.tileSize*Math.pow(2,h.transform.tileZoom)/s,_=d*(t.tileID.canonical.x+t.tileID.wrap*s),y=d*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ar(t,1,h.transform.tileZoom),u_pixel_coord_upper:[_>>16,y>>16],u_pixel_coord_lower:[65535&_,65535&y]}}const vc={terrain:0,flat:1},iy=i.ab.mat4.create(),Hu=(h,t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X,J,Q)=>{const re=t.style.light,ue=re.properties.get("position"),le=[ue.x,ue.y,ue.z],_e=i.ab.mat3.create();re.properties.get("anchor")==="viewport"&&(i.ab.mat3.fromRotation(_e,-t.transform.angle),i.ab.vec3.transformMat3(le,le,_e));const fe=re.properties.get("color"),pe=t.transform,de={u_matrix:h,u_lightpos:le,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_vertical_gradient:+s,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:iy,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:vc[L],u_base_type:vc[k],u_ao:_,u_edge_radius:y,u_width_scale:w,u_flood_light_color:Y,u_vertical_scale:X,u_flood_light_intensity:J,u_ground_shadow_factor:Q};return pe.projection.name==="globe"&&(de.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],de.u_zoom_transition=N,de.u_inv_rot_matrix=G,de.u_merc_center=B,de.u_up_dir=pe.projection.upVector(new i.bT(0,0,0),B[0]*i.ag,B[1]*i.ag),de.u_height_lift=z),de},Id=(h,t,s,d,_,y)=>({u_matrix:h,u_edge_radius:t,u_width_scale:s,u_vertical_scale:d,u_height_type:vc[_],u_base_type:vc[y]}),bc=(h,t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X,J)=>{const Q=Hu(h,t,s,d,_,y,w,C,L,k,N,B,G,Y,X,J,1,[0,0,0]),re={u_height_factor:-Math.pow(2,C.overscaledZ)/z.tileSize/8};return i.l(Q,sm(t,z),re)},qu=(h,t)=>({u_matrix:h,u_emissive_strength:t}),dl=(h,t,s,d)=>i.l(qu(h,t),sm(s,d)),om=(h,t,s)=>({u_matrix:h,u_world:s,u_emissive_strength:t}),$u=(h,t,s,d,_)=>i.l(dl(h,t,s,d),{u_world:_}),Wu=(h,t,s,d)=>{const _=i.ag/s.tileSize;return{u_matrix:h,u_camera_to_center_distance:t.getCameraToCenterDistance(d),u_extrude_scale:[t.pixelsToGLUnits[0]/_,t.pixelsToGLUnits[1]/_]}},Zu=(h,t,s=1)=>({u_matrix:h,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),am=i.ab.mat4.create(),ny=(h,t,s,d,_,y,w)=>{const C=h.transform,z=C.projection.name==="globe",L=z?i.cN(C.zoom,t.canonical)*C._pixelsPerMercatorPixel:i.ar(s,1,y),k={u_matrix:t.projMatrix,u_extrude_scale:L,u_intensity:w,u_inv_rot_matrix:am,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){k.u_inv_rot_matrix=d,k.u_merc_center=_,k.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],k.u_zoom_transition=i.ae(C.zoom);const N=_[0]*i.ag,B=_[1]*i.ag;k.u_up_dir=C.projection.upVector(new i.bT(0,0,0),N,B)}return k};function va(h,[t,s,d,_],[y,w]){if(y===w)return[0,0,0,0];const C=255*(h-1)/(h*(w-y));return[t*C,s*C,d*C,_*C]}function wc(h,t,[s,d]){return s===d?0:.5/h+(t-s)*(h-1)/(h*(d-s))}const Ot=(h,t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X,J,Q,re,ue,le)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:L,u_fade_t:k.mix,u_opacity:k.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:i.cO(N.paint.get("raster-saturation")),u_contrast_factor:i.cP(N.paint.get("raster-contrast")),u_spin_weights:lm(N.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:G,u_zoom_transition:w,u_merc_center:C,u_cutoff_params:z,u_colorization_mix:va(i.cQ,X,Q),u_colorization_offset:wc(i.cQ,J,Q),u_color_ramp:Y,u_texture_offset:[ue/(re+2*ue),re/(re+2*ue)],u_texture_res:[re+2*ue,re+2*ue],u_emissive_strength:le});function lm(h){h*=Math.PI/180;const t=Math.sin(h),s=Math.cos(h);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const ba=.05,wa=(h,t,s,d,_,y,w,C,z,L,k,N)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:L,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:w,u_merc_center:C,u_cutoff_params:z}),Ta=(h,t,s,d,_,y,w,C,z,L)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:d,u_color_ramp:y,u_velocity_res:_,u_max_speed:w,u_uv_offset:C,u_data_scale:[255*z[0],255*z[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[ba,ba]}),Ht=(h,t,s,d,_,y,w,C,z,L)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:d,u_max_speed:_,u_speed_factor:y,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*z[0],255*z[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[ba,ba]}),Xu=i.ab.mat4.create(),cm=(h,t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X,J,Q,re,ue,le,_e)=>{const fe=_.transform,pe={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:fe.getCameraToCenterDistance(re),u_rotate_symbol:+s,u_aspect_ratio:fe.width/fe.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:C,u_is_text:+L,u_elevation_from_sea:z?1:0,u_pitch_with_map:+d,u_texsize:k,u_texsize_icon:N,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Xu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Xu,u_up_vector:[0,-1,0],u_color_adj_mat:ue,u_icon_transition:le||0,u_gamma_scale:d?_.transform.getCameraToCenterDistance(re)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:_e||1};return re.name==="globe"&&(pe.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],pe.u_zoom_transition=Y,pe.u_inv_rot_matrix=J,pe.u_merc_center=X,pe.u_camera_forward=fe._camera.forward(),pe.u_ecef_origin=i.cR(fe.globeMatrix,G.toUnwrapped()),pe.u_tile_matrix=Float32Array.from(fe.globeMatrix),pe.u_up_vector=Q),pe},um=(h,t,s,d)=>({u_matrix:h,u_emissive_strength:t,u_opacity:s,u_color:d}),Yu=(h,t,s,d,_,y,w,C,z)=>i.l(function(L,k,N,B,G,Y){const{width:X,height:J}=B.imageManager.getPixelSize(k),Q=Math.pow(2,Y.tileID.overscaledZ),re=Y.tileSize*Math.pow(2,B.transform.tileZoom)/Q,ue=re*(Y.tileID.canonical.x+Y.tileID.wrap*Q),le=re*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[X,J],u_pattern_size:N.displaySize,u_pattern_units_to_pixels:G?[B.transform.width,-1*B.transform.height]:[1/i.ar(Y,1,B.transform.tileZoom),1/i.ar(Y,1,B.transform.tileZoom)],u_pixel_coord_upper:[ue>>16,le>>16],u_pixel_coord_lower:[65535&ue,65535&le]}}(0,y,w,d,C,z),{u_matrix:h,u_emissive_strength:t,u_opacity:s}),Ku=new Float32Array(i.ab.mat4.identity([])),Ju=(h,t,s,d,_,y,w,C,z,L,k,N,B,G=[0,0,0],Y)=>{const X=_.style.light,J=X.properties.get("position"),Q=[-J.x,-J.y,J.z],re=i.ab.mat3.create();X.properties.get("anchor")==="viewport"&&(i.ab.mat3.fromRotation(re,-_.transform.angle),i.ab.vec3.transformMat3(Q,Q,re));const ue=k.alphaMode==="MASK",le=X.properties.get("color").toRenderColor(null),_e=B.paint.get("model-ambient-occlusion-intensity"),fe=B.paint.get("model-color").constantOr(i.aj.white).toRenderColor(null),pe=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:d||Ku,u_lightpos:Q,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[le.r,le.g,le.b],u_camera_pos:G,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+ue,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:z,u_roughnessFactor:L,u_baseColorTexture:yr.BaseColor,u_metallicRoughnessTexture:yr.MetallicRoughness,u_normalTexture:yr.Normal,u_occlusionTexture:yr.Occlusion,u_emissionTexture:yr.Emission,u_lutTexture:yr.LUT,u_color_mix:[fe.r,fe.g,fe.b,pe],u_aoIntensity:_e,u_emissive_strength:N,u_occlusionTextureTransform:Y||[0,0,0,0]}},hm=(h,t=Ku,s=Ku)=>({u_matrix:h,u_instance:t,u_node_matrix:s}),ry={fillExtrusion:h=>({u_matrix:new i.bJ(h),u_lightpos:new i.bL(h),u_lightintensity:new i.bM(h),u_lightcolor:new i.bL(h),u_vertical_gradient:new i.bM(h),u_opacity:new i.bM(h),u_edge_radius:new i.bM(h),u_width_scale:new i.bM(h),u_ao:new i.bK(h),u_height_type:new i.bN(h),u_base_type:new i.bN(h),u_tile_id:new i.bL(h),u_zoom_transition:new i.bM(h),u_inv_rot_matrix:new i.bJ(h),u_merc_center:new i.bK(h),u_up_dir:new i.bL(h),u_height_lift:new i.bM(h),u_flood_light_color:new i.bL(h),u_vertical_scale:new i.bM(h),u_flood_light_intensity:new i.bM(h),u_ground_shadow_factor:new i.bL(h)}),fillExtrusionDepth:h=>({u_matrix:new i.bJ(h),u_edge_radius:new i.bM(h),u_width_scale:new i.bM(h),u_vertical_scale:new i.bM(h),u_height_type:new i.bN(h),u_base_type:new i.bN(h)}),fillExtrusionPattern:h=>({u_matrix:new i.bJ(h),u_lightpos:new i.bL(h),u_lightintensity:new i.bM(h),u_lightcolor:new i.bL(h),u_vertical_gradient:new i.bM(h),u_height_factor:new i.bM(h),u_edge_radius:new i.bM(h),u_width_scale:new i.bM(h),u_ao:new i.bK(h),u_height_type:new i.bN(h),u_base_type:new i.bN(h),u_tile_id:new i.bL(h),u_zoom_transition:new i.bM(h),u_inv_rot_matrix:new i.bJ(h),u_merc_center:new i.bK(h),u_up_dir:new i.bL(h),u_height_lift:new i.bM(h),u_image:new i.bN(h),u_texsize:new i.bK(h),u_pixel_coord_upper:new i.bK(h),u_pixel_coord_lower:new i.bK(h),u_tile_units_to_pixels:new i.bM(h),u_opacity:new i.bM(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new i.bJ(h),u_opacity:new i.bM(h),u_ao_pass:new i.bM(h),u_meter_to_tile:new i.bM(h),u_ao:new i.bK(h),u_flood_light_intensity:new i.bM(h),u_flood_light_color:new i.bL(h),u_attenuation:new i.bM(h),u_edge_radius:new i.bM(h),u_fb:new i.bN(h),u_fb_size:new i.bM(h),u_dynamic_offset:new i.bM(h)}),fill:h=>({u_matrix:new i.bJ(h),u_emissive_strength:new i.bM(h)}),fillPattern:h=>({u_matrix:new i.bJ(h),u_emissive_strength:new i.bM(h),u_image:new i.bN(h),u_texsize:new i.bK(h),u_pixel_coord_upper:new i.bK(h),u_pixel_coord_lower:new i.bK(h),u_tile_units_to_pixels:new i.bM(h)}),fillOutline:h=>({u_matrix:new i.bJ(h),u_emissive_strength:new i.bM(h),u_world:new i.bK(h)}),fillOutlinePattern:h=>({u_matrix:new i.bJ(h),u_emissive_strength:new i.bM(h),u_world:new i.bK(h),u_image:new i.bN(h),u_texsize:new i.bK(h),u_pixel_coord_upper:new i.bK(h),u_pixel_coord_lower:new i.bK(h),u_tile_units_to_pixels:new i.bM(h)}),circle:i.cS,collisionBox:h=>({u_matrix:new i.bJ(h),u_camera_to_center_distance:new i.bM(h),u_extrude_scale:new i.bK(h)}),collisionCircle:h=>({u_matrix:new i.bJ(h),u_inv_matrix:new i.bJ(h),u_camera_to_center_distance:new i.bM(h),u_viewport_size:new i.bK(h)}),debug:h=>({u_color:new i.cz(h),u_matrix:new i.bJ(h),u_overlay:new i.bN(h),u_overlay_scale:new i.bM(h)}),clippingMask:h=>({u_matrix:new i.bJ(h)}),heatmap:h=>({u_extrude_scale:new i.bM(h),u_intensity:new i.bM(h),u_matrix:new i.bJ(h),u_inv_rot_matrix:new i.bJ(h),u_merc_center:new i.bK(h),u_tile_id:new i.bL(h),u_zoom_transition:new i.bM(h),u_up_dir:new i.bL(h)}),heatmapTexture:h=>({u_image:new i.bN(h),u_color_ramp:new i.bN(h),u_opacity:new i.bM(h)}),hillshade:h=>({u_matrix:new i.bJ(h),u_image:new i.bN(h),u_latrange:new i.bK(h),u_light:new i.bK(h),u_shadow:new i.cz(h),u_highlight:new i.cz(h),u_emissive_strength:new i.bM(h),u_accent:new i.cz(h)}),hillshadePrepare:h=>({u_matrix:new i.bJ(h),u_image:new i.bN(h),u_dimension:new i.bK(h),u_zoom:new i.bM(h)}),line:i.cT,linePattern:i.cU,raster:h=>({u_matrix:new i.bJ(h),u_normalize_matrix:new i.bJ(h),u_globe_matrix:new i.bJ(h),u_merc_matrix:new i.bJ(h),u_grid_matrix:new i.cA(h),u_tl_parent:new i.bK(h),u_scale_parent:new i.bM(h),u_fade_t:new i.bM(h),u_opacity:new i.bM(h),u_image0:new i.bN(h),u_image1:new i.bN(h),u_brightness_low:new i.bM(h),u_brightness_high:new i.bM(h),u_saturation_factor:new i.bM(h),u_contrast_factor:new i.bM(h),u_spin_weights:new i.bL(h),u_perspective_transform:new i.bK(h),u_raster_elevation:new i.bM(h),u_zoom_transition:new i.bM(h),u_merc_center:new i.bK(h),u_cutoff_params:new i.ca(h),u_colorization_mix:new i.ca(h),u_colorization_offset:new i.bM(h),u_color_ramp:new i.bN(h),u_texture_offset:new i.bK(h),u_texture_res:new i.bK(h),u_emissive_strength:new i.bM(h)}),rasterParticle:h=>({u_matrix:new i.bJ(h),u_normalize_matrix:new i.bJ(h),u_globe_matrix:new i.bJ(h),u_merc_matrix:new i.bJ(h),u_grid_matrix:new i.cA(h),u_tl_parent:new i.bK(h),u_scale_parent:new i.bM(h),u_fade_t:new i.bM(h),u_opacity:new i.bM(h),u_image0:new i.bN(h),u_image1:new i.bN(h),u_raster_elevation:new i.bM(h),u_zoom_transition:new i.bM(h),u_merc_center:new i.bK(h),u_cutoff_params:new i.ca(h)}),rasterParticleTexture:h=>({u_texture:new i.bN(h),u_opacity:new i.bM(h)}),rasterParticleDraw:h=>({u_particle_texture:new i.bN(h),u_particle_texture_side_len:new i.bM(h),u_tile_offset:new i.bK(h),u_velocity:new i.bN(h),u_color_ramp:new i.bN(h),u_velocity_res:new i.bK(h),u_max_speed:new i.bM(h),u_uv_offset:new i.bK(h),u_data_scale:new i.bK(h),u_data_offset:new i.bM(h),u_particle_pos_scale:new i.bM(h),u_particle_pos_offset:new i.bK(h)}),rasterParticleUpdate:h=>({u_particle_texture:new i.bN(h),u_particle_texture_side_len:new i.bM(h),u_velocity:new i.bN(h),u_velocity_res:new i.bK(h),u_max_speed:new i.bM(h),u_speed_factor:new i.bM(h),u_reset_rate:new i.bM(h),u_rand_seed:new i.bM(h),u_uv_offset:new i.bK(h),u_data_scale:new i.bK(h),u_data_offset:new i.bM(h),u_particle_pos_scale:new i.bM(h),u_particle_pos_offset:new i.bK(h)}),symbol:h=>({u_is_size_zoom_constant:new i.bN(h),u_is_size_feature_constant:new i.bN(h),u_size_t:new i.bM(h),u_size:new i.bM(h),u_camera_to_center_distance:new i.bM(h),u_rotate_symbol:new i.bN(h),u_aspect_ratio:new i.bM(h),u_fade_change:new i.bM(h),u_matrix:new i.bJ(h),u_label_plane_matrix:new i.bJ(h),u_coord_matrix:new i.bJ(h),u_is_text:new i.bN(h),u_elevation_from_sea:new i.bN(h),u_pitch_with_map:new i.bN(h),u_texsize:new i.bK(h),u_texsize_icon:new i.bK(h),u_texture:new i.bN(h),u_texture_icon:new i.bN(h),u_gamma_scale:new i.bM(h),u_device_pixel_ratio:new i.bM(h),u_tile_id:new i.bL(h),u_zoom_transition:new i.bM(h),u_inv_rot_matrix:new i.bJ(h),u_merc_center:new i.bK(h),u_camera_forward:new i.bL(h),u_tile_matrix:new i.bJ(h),u_up_vector:new i.bL(h),u_ecef_origin:new i.bL(h),u_is_halo:new i.bN(h),u_icon_transition:new i.bM(h),u_color_adj_mat:new i.bJ(h),u_scale_factor:new i.bM(h)}),background:h=>({u_matrix:new i.bJ(h),u_emissive_strength:new i.bM(h),u_opacity:new i.bM(h),u_color:new i.cz(h)}),backgroundPattern:h=>({u_matrix:new i.bJ(h),u_emissive_strength:new i.bM(h),u_opacity:new i.bM(h),u_image:new i.bN(h),u_pattern_tl:new i.bK(h),u_pattern_br:new i.bK(h),u_texsize:new i.bK(h),u_pattern_size:new i.bK(h),u_pixel_coord_upper:new i.bK(h),u_pixel_coord_lower:new i.bK(h),u_pattern_units_to_pixels:new i.bK(h)}),terrainRaster:h=>({u_matrix:new i.bJ(h),u_image0:new i.bN(h),u_skirt_height:new i.bM(h),u_ground_shadow_factor:new i.bL(h)}),skybox:h=>({u_matrix:new i.bJ(h),u_sun_direction:new i.bL(h),u_cubemap:new i.bN(h),u_opacity:new i.bM(h),u_temporal_offset:new i.bM(h)}),skyboxGradient:h=>({u_matrix:new i.bJ(h),u_color_ramp:new i.bN(h),u_center_direction:new i.bL(h),u_radius:new i.bM(h),u_opacity:new i.bM(h),u_temporal_offset:new i.bM(h)}),skyboxCapture:h=>({u_matrix_3f:new i.cA(h),u_sun_direction:new i.bL(h),u_sun_intensity:new i.bM(h),u_color_tint_r:new i.ca(h),u_color_tint_m:new i.ca(h),u_luminance:new i.bM(h)}),globeRaster:h=>({u_proj_matrix:new i.bJ(h),u_globe_matrix:new i.bJ(h),u_normalize_matrix:new i.bJ(h),u_merc_matrix:new i.bJ(h),u_zoom_transition:new i.bM(h),u_merc_center:new i.bK(h),u_image0:new i.bN(h),u_grid_matrix:new i.cA(h),u_skirt_height:new i.bM(h),u_far_z_cutoff:new i.bM(h),u_frustum_tl:new i.bL(h),u_frustum_tr:new i.bL(h),u_frustum_br:new i.bL(h),u_frustum_bl:new i.bL(h),u_globe_pos:new i.bL(h),u_globe_radius:new i.bM(h),u_viewport:new i.bK(h)}),globeAtmosphere:h=>({u_frustum_tl:new i.bL(h),u_frustum_tr:new i.bL(h),u_frustum_br:new i.bL(h),u_frustum_bl:new i.bL(h),u_horizon:new i.bM(h),u_transition:new i.bM(h),u_fadeout_range:new i.bM(h),u_color:new i.ca(h),u_high_color:new i.ca(h),u_space_color:new i.ca(h),u_temporal_offset:new i.bM(h),u_horizon_angle:new i.bM(h)}),model:h=>({u_matrix:new i.bJ(h),u_lighting_matrix:new i.bJ(h),u_normal_matrix:new i.bJ(h),u_node_matrix:new i.bJ(h),u_lightpos:new i.bL(h),u_lightintensity:new i.bM(h),u_lightcolor:new i.bL(h),u_camera_pos:new i.bL(h),u_opacity:new i.bM(h),u_baseColorFactor:new i.ca(h),u_emissiveFactor:new i.ca(h),u_metallicFactor:new i.bM(h),u_roughnessFactor:new i.bM(h),u_baseTextureIsAlpha:new i.bN(h),u_alphaMask:new i.bN(h),u_alphaCutoff:new i.bM(h),u_baseColorTexture:new i.bN(h),u_metallicRoughnessTexture:new i.bN(h),u_normalTexture:new i.bN(h),u_occlusionTexture:new i.bN(h),u_emissionTexture:new i.bN(h),u_lutTexture:new i.bN(h),u_color_mix:new i.ca(h),u_aoIntensity:new i.bM(h),u_emissive_strength:new i.bM(h),u_occlusionTextureTransform:new i.ca(h)}),modelDepth:h=>({u_matrix:new i.bJ(h),u_instance:new i.bJ(h),u_node_matrix:new i.bJ(h)}),groundShadow:h=>({u_matrix:new i.bJ(h),u_ground_shadow_factor:new i.bL(h)}),stars:h=>({u_matrix:new i.bJ(h),u_up:new i.bL(h),u_right:new i.bL(h),u_intensity_multiplier:new i.bM(h)}),snowParticle:h=>({u_modelview:new i.bJ(h),u_projection:new i.bJ(h),u_time:new i.bM(h),u_cam_pos:new i.bL(h),u_velocityConeAperture:new i.bM(h),u_velocity:new i.bM(h),u_horizontalOscillationRadius:new i.bM(h),u_horizontalOscillationRate:new i.bM(h),u_boxSize:new i.bM(h),u_billboardSize:new i.bM(h),u_simpleShapeParameters:new i.bK(h),u_screenSize:new i.bK(h),u_thinningCenterPos:new i.bK(h),u_thinningShape:new i.bL(h),u_thinningAffectedRatio:new i.bM(h),u_thinningParticleOffset:new i.bM(h),u_particleColor:new i.ca(h),u_direction:new i.bL(h)}),rainParticle:h=>({u_modelview:new i.bJ(h),u_projection:new i.bJ(h),u_time:new i.bM(h),u_cam_pos:new i.bL(h),u_texScreen:new i.bN(h),u_velocityConeAperture:new i.bM(h),u_velocity:new i.bM(h),u_boxSize:new i.bM(h),u_rainDropletSize:new i.bK(h),u_distortionStrength:new i.bM(h),u_rainDirection:new i.bL(h),u_color:new i.ca(h),u_screenSize:new i.bK(h),u_thinningCenterPos:new i.bK(h),u_thinningShape:new i.bL(h),u_thinningAffectedRatio:new i.bM(h),u_thinningParticleOffset:new i.bM(h),u_shapeDirectionalPower:new i.bM(h),u_shapeNormalPower:new i.bM(h),u_mode:new i.bM(h)}),vignette:h=>({u_vignetteShape:new i.bL(h),u_vignetteColor:new i.ca(h)}),occlusion:h=>({u_matrix:new i.bJ(h),u_anchorPos:new i.bL(h),u_screenSizePx:new i.bK(h),u_occluderSizePx:new i.bK(h),u_color:new i.ca(h)})};class Js{constructor(t,s,d,_){this.id=Js.uniqueIdxCounter,Js.uniqueIdxCounter++,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||_||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Js.uniqueIdxCounter,Js.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Js.uniqueIdxCounter=0;const Cd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Pd{constructor(t,s,d,_,y,w){this.length=s.length,this.attributes=d,this.itemSize=s.bytesPerElement,this.dynamicDraw=_,this.instanceCount=w,this.context=t;const C=t.gl;this.buffer=C.createBuffer(),t.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||y||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let d=0;d<this.attributes.length;d++){const _=s.attributes[this.attributes[d].name];_!==void 0&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,s,d){for(let _=0;_<this.attributes.length;_++){const y=this.attributes[_],w=s.attributes[y.name];w!==void 0&&t.vertexAttribPointer(w,y.components,t[Cd[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,s,d){for(let _=0;_<this.attributes.length;_++){const y=s.attributes[this.attributes[_].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Qu{constructor(t,s,d,_,y){this.context=t,this.width=s,this.height=d;const w=this.framebuffer=t.gl.createFramebuffer();_&&(this.colorAttachment=new Sd(t,w)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Uu(t,w):new Qp(t,w))}destroy(){const t=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class $r{constructor(t,s){this.gl=t,this.clearColor=new $g(this),this.clearDepth=new Wg(this),this.clearStencil=new Zg(this),this.colorMask=new pd(this),this.depthMask=new md(this),this.stencilMask=new _d(this),this.stencilFunc=new gd(this),this.stencilOp=new Zp(this),this.stencilTest=new Xp(this),this.depthRange=new Xg(this),this.depthTest=new _c(this),this.depthFunc=new gc(this),this.blend=new Yp(this),this.blendFunc=new qr(this),this.blendColor=new yd(this),this.blendEquation=new Fu(this),this.cullFace=new Bu(this),this.cullFaceSide=new xd(this),this.frontFace=new vd(this),this.program=new Nu(this),this.activeTexture=new bd(this),this.viewport=new wd(this),this.bindFramebuffer=new Vu(this),this.bindRenderbuffer=new Kp(this),this.bindTexture=new Jp(this),this.bindVertexBuffer=new cl(this),this.bindElementBuffer=new Yg(this),this.bindVertexArrayOES=new Kg(this),this.pixelStoreUnpack=new Jg(this),this.pixelStoreUnpackPremultiplyAlpha=new Qg(this),this.pixelStoreUnpackFlipY=new ey(this),this.options=s?{...s}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,d){return new Js(this,t,s,d)}createVertexBuffer(t,s,d,_,y){return new Pd(this,t,s,d,_,y)}createRenderbuffer(t,s,d){const _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,t,s,d),this.bindRenderbuffer.set(null),y}createFramebuffer(t,s,d,_){return new Qu(this,t,s,d,_)}clear({color:t,depth:s,stencil:d,colorMask:_}){const y=this.gl;let w=0;t&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(_||[!0,!0,!0,!0])),s!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),d!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),y.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){i.bn(t.blendFunction,bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let zs;function Dd(h,t,s,d,_,y,w){const C=h.context,z=C.gl,L=h.transform,k=h.getOrCreateProgram("collisionBox"),N=[];let B=0,G=0;for(let le=0;le<d.length;le++){const _e=d[le],fe=t.getTile(_e),pe=fe.getBucket(s);if(!pe)continue;const de=Bn(_e,pe,L);let be=de;_[0]===0&&_[1]===0||(be=h.translatePosMatrix(de,fe,_,y));const Ie=w?pe.textCollisionBox:pe.iconCollisionBox,He=pe.collisionCircleArray;if(He.length>0){const Ve=i.ab.mat4.create(),Ee=be;i.ab.mat4.mul(Ve,pe.placementInvProjMatrix,L.glCoordMatrix),i.ab.mat4.mul(Ve,Ve,pe.placementViewportMatrix),N.push({circleArray:He,circleOffset:G,transform:Ee,invTransform:Ve,projection:pe.getProjection()}),B+=He.length/4,G=B}Ie&&(h.terrain&&h.terrain.setupElevationDraw(fe,k),k.draw(h,z.LINES,$t.disabled,hi.disabled,h.colorModeForRenderPass(),ni.disabled,Wu(be,L,fe,pe.getProjection()),s.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,L.zoom,null,[Ie.collisionVertexBuffer,Ie.collisionVertexBufferExt]))}if(!w||!N.length)return;const Y=h.getOrCreateProgram("collisionCircle"),X=new i.cV;X.resize(4*B),X._trim();let J=0;for(const le of N)for(let _e=0;_e<le.circleArray.length/4;_e++){const fe=4*_e,pe=le.circleArray[fe+0],de=le.circleArray[fe+1],be=le.circleArray[fe+2],Ie=le.circleArray[fe+3];X.emplace(J++,pe,de,be,Ie,0),X.emplace(J++,pe,de,be,Ie,1),X.emplace(J++,pe,de,be,Ie,2),X.emplace(J++,pe,de,be,Ie,3)}(!zs||zs.length<2*B)&&(zs=function(le){const _e=2*le,fe=new i.aU;fe.resize(_e),fe._trim();for(let pe=0;pe<_e;pe++){const de=6*pe;fe.uint16[de+0]=4*pe+0,fe.uint16[de+1]=4*pe+1,fe.uint16[de+2]=4*pe+2,fe.uint16[de+3]=4*pe+2,fe.uint16[de+4]=4*pe+3,fe.uint16[de+5]=4*pe+0}return fe}(B));const Q=C.createIndexBuffer(zs,!0),re=C.createVertexBuffer(X,i.cW.members,!0);for(const le of N){const _e={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(ue=L).getCameraToCenterDistance(le.projection),u_viewport_size:[ue.width,ue.height]};Y.draw(h,z.TRIANGLES,$t.disabled,hi.disabled,h.colorModeForRenderPass(),ni.disabled,_e,s.id,re,Q,i.b7.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,L.zoom)}var ue;re.destroy(),Q.destroy()}const fl=i.ab.mat4.create();function eh(h){const t=h._camera.getWorldToCamera(h.worldSize,1),s=i.ab.mat4.multiply([],t,h.globeMatrix);i.ab.mat4.invert(s,s);const d=[0,0,0],_=[0,1,0,0];return i.ab.vec4.transformMat4(_,_,s),d[0]=_[0],d[1]=_[1],d[2]=_[2],i.ab.vec3.normalize(d,d),d}function zd({width:h,height:t,anchor:s,textOffset:d,textScale:_},y){const{horizontalAlign:w,verticalAlign:C}=i.bD(s),z=-(w-.5)*h,L=-(C-.5)*t,k=i.bC(s,d);return new i.P((z/_+k[0])*y,(L/_+k[1])*y)}function dm(h,t,s,d,_,y,w,C,z,L,k){const N=h.text.placedSymbolArray,B=h.text.dynamicLayoutVertexArray,G=h.icon.dynamicLayoutVertexArray,Y={},X=h.getProjection(),J=ac(C,X,y),Q=y.elevation,re=X.upVectorScale(C.canonical,y.center.lat,y.worldSize).metersToTile;B.clear();for(let ue=0;ue<N.length;ue++){const le=N.get(ue),{tileAnchorX:_e,tileAnchorY:fe,numGlyphs:pe}=le,de=le.hidden||!le.crossTileID||h.allowVerticalPlacement&&!le.placedOrientation?null:d[le.crossTileID];if(de){let be=0,Ie=0,He=0;if(Q){const $e=Q?Q.getAtTileOffset(C,_e,fe):0,[ut,st,tt]=X.upVector(C.canonical,_e,fe);be=$e*ut*re,Ie=$e*st*re,He=$e*tt*re}let[Ve,Ee,Re,et]=hn(le.projectedAnchorX+be,le.projectedAnchorY+Ie,le.projectedAnchorZ+He,s?J:w);const ot=Lp(y.getCameraToCenterDistance(X),et);let ft=_.evaluateSizeForFeature(h.textSizeData,L,le)*ot/i.bw;s&&(ft*=h.tilePixelRatio/z);const Ne=zd(de,ft);s?({x:Ve,y:Ee,z:Re}=X.projectTilePoint(_e+Ne.x,fe+Ne.y,C.canonical),[Ve,Ee,Re]=hn(Ve+be,Ee+Ie,Re+He,w)):(t&&Ne._rotate(-y.angle),Ve+=Ne.x,Ee+=Ne.y,Re=0);const nt=h.allowVerticalPlacement&&le.placedOrientation===i.bq.vertical?Math.PI/2:0;for(let $e=0;$e<pe;$e++)i.bt(B,Ve,Ee,Re,nt);k&&le.associatedIconIndex>=0&&(Y[le.associatedIconIndex]={x:Ve,y:Ee,z:Re,angle:nt})}else pa(pe,B)}if(k){G.clear();const ue=h.icon.placedSymbolArray;for(let le=0;le<ue.length;le++){const _e=ue.get(le),{numGlyphs:fe}=_e,pe=Y[le];if(_e.hidden||!pe)pa(fe,G);else{const{x:de,y:be,z:Ie,angle:He}=pe;for(let Ve=0;Ve<fe;Ve++)i.bt(G,de,be,Ie,He)}}h.icon.dynamicLayoutVertexBuffer.updateData(G)}h.text.dynamicLayoutVertexBuffer.updateData(B)}function Wr(h,t,s,d,_,y,w={}){const C=s.paint.get("icon-translate"),z=s.paint.get("text-translate"),L=s.paint.get("icon-translate-anchor"),k=s.paint.get("text-translate-anchor"),N=s.layout.get("icon-rotation-alignment"),B=s.layout.get("text-rotation-alignment"),G=s.layout.get("icon-pitch-alignment"),Y=s.layout.get("text-pitch-alignment"),X=s.layout.get("icon-keep-upright"),J=s.layout.get("text-keep-upright"),Q=s.paint.get("icon-color-saturation"),re=s.paint.get("icon-color-contrast"),ue=s.paint.get("icon-color-brightness-min"),le=s.paint.get("icon-color-brightness-max"),_e=s.layout.get("symbol-elevation-reference")==="sea",fe=h.context,pe=fe.gl,de=h.transform,be=N==="map",Ie=B==="map",He=G==="map",Ve=Y==="map",Ee=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Re=!1;const et=h.depthModeForSublayer(0,$t.ReadOnly),ot=[i.at(de.center.lng),i.aA(de.center.lat)],ft=s.layout.get("text-variable-anchor"),Ne=de.projection.name==="globe",nt=[],$e=[0,-1,0];for(const ut of d){const st=t.getTile(ut),tt=st.getBucket(s);if(!tt||tt.projection.name==="mercator"&&Ne||tt.fullyClipped)continue;const wt=tt.projection.name==="globe",Et=wt?i.ae(de.zoom):0,gt=ac(ut,tt.getProjection(),de),Rt=de.calculatePixelsToTileUnitsMatrix(st),oi=ft&&tt.hasTextData(),Zt=tt.hasIconTextFit()&&oi&&tt.hasIconData(),Wt=tt.getProjection().createInversionMatrix(de,ut.canonical),ai=ei=>{de.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||h.terrain)&&(ei.push("DEPTH_D24"),ei.push("DEPTH_OCCLUSION"))},Pi=()=>{const ei=be&&s.layout.get("symbol-placement")!=="point",Vi=[];ai(Vi);const Tn=ei||Zt,dr=s.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&He&&Vi.push("PITCH_WITH_MAP_TERRAIN"),wt&&(Vi.push("PROJECTION_GLOBE_VIEW"),Tn&&Vi.push("PROJECTED_POS_ON_VIEWPORT")),dr>0&&Vi.push("ICON_TRANSITION"),tt.icon.zOffsetVertexBuffer&&Vi.push("Z_OFFSET"),Q===0&&re===0&&ue===0&&le===1||Vi.push("COLOR_ADJUSTMENT"),tt.sdfIcons&&Vi.push("RENDER_SDF");const Kr=tt.icon.programConfigurations.get(s.id),Er=h.getOrCreateProgram("symbol",{config:Kr,defines:Vi}),nr=st.imageAtlasTexture?st.imageAtlasTexture.size:[0,0],Nn=tt.iconSizeData,Rn=i.bp(Nn,de.zoom),fn=He||de.pitch!==0,rn=oo(gt,st.tileID.canonical,He,be,de,tt.getProjection(),Rt),Ri=Tr(gt,st.tileID.canonical,He,be,de,tt.getProjection(),Rt),An=h.translatePosMatrix(Ri,st,C,L,!0),rr=h.translatePosMatrix(gt,st,C,L),ln=Tn?fl:rn,br=be&&!He&&!ei;let ls=$e;!Ne&&!de.mercatorFromTransition||be||(ls=eh(de));const Vr=wt?ls:$e,vo=s.getColorAdjustmentMatrix(Q,re,ue,le),eo=cm(Nn.kind,Rn,br,He,h,rr,ln,An,_e,!1,nr,[0,0],!0,ut,Et,ot,Wt,Vr,tt.getProjection(),vo,dr),Ar=st.imageAtlasTexture?st.imageAtlasTexture:null,cs=s.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear,bo=tt.sdfIcons||h.options.rotating||h.options.zooming||cs||fn?pe.LINEAR:pe.NEAREST,Os=tt.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Pa=h.terrain&&He&&ei?i.ab.mat4.invert(i.ab.mat4.create(),rn):fl;if(ei&&tt.icon){const kc=de.elevation,nf=kc?kc.getAtTileOffsetFunc(ut,de.center.lat,de.worldSize,tt.getProjection()):null,yh=fa(gt,st.tileID.canonical,He,be,de,tt.getProjection(),Rt);bu(tt,gt,h,!1,yh,Ri,He,X,nf,ut)}return{program:Er,buffers:tt.icon,uniformValues:eo,atlasTexture:Ar,atlasTextureIcon:null,atlasInterpolation:bo,atlasInterpolationIcon:null,isSDF:tt.sdfIcons,hasHalo:Os,tile:st,labelPlaneMatrixInv:Pa}},yi=()=>{const ei=Ie&&s.layout.get("symbol-placement")!=="point",Vi=[],Tn=ei||ft||Zt;h.terrainRenderModeElevated()&&Ve&&Vi.push("PITCH_WITH_MAP_TERRAIN"),wt&&(Vi.push("PROJECTION_GLOBE_VIEW"),Tn&&Vi.push("PROJECTED_POS_ON_VIEWPORT")),tt.text.zOffsetVertexBuffer&&Vi.push("Z_OFFSET"),tt.iconsInText&&Vi.push("RENDER_TEXT_AND_SYMBOL"),Vi.push("RENDER_SDF"),ai(Vi);const dr=tt.text.programConfigurations.get(s.id),Kr=h.getOrCreateProgram("symbol",{config:dr,defines:Vi});let Er,nr=[0,0],Nn=null;const Rn=tt.textSizeData;tt.iconsInText&&(nr=st.imageAtlasTexture?st.imageAtlasTexture.size:[0,0],Nn=st.imageAtlasTexture?st.imageAtlasTexture:null,Er=Ve||de.pitch!==0||h.options.rotating||h.options.zooming||Rn.kind==="composite"||Rn.kind==="camera"?pe.LINEAR:pe.NEAREST);const fn=st.glyphAtlasTexture?st.glyphAtlasTexture.size:[0,0],rn=s.layout.get("text-size-scale-range"),Ri=i.aw(h.scaleFactor,rn[0],rn[1]),An=i.bp(Rn,de.zoom,Ri),rr=oo(gt,st.tileID.canonical,Ve,Ie,de,tt.getProjection(),Rt),ln=Tr(gt,st.tileID.canonical,Ve,Ie,de,tt.getProjection(),Rt),br=h.translatePosMatrix(ln,st,z,k,!0),ls=h.translatePosMatrix(gt,st,z,k),Vr=Tn?fl:rr,vo=Ie&&!Ve&&!ei;let eo=$e;!Ne&&!de.mercatorFromTransition||Ie||(eo=eh(de));const Ar=cm(Rn.kind,An,vo,Ve,h,ls,Vr,br,_e,!0,fn,nr,!0,ut,Et,ot,Wt,wt?eo:$e,tt.getProjection(),null,null,Ri),cs=st.glyphAtlasTexture?st.glyphAtlasTexture:null,bo=pe.LINEAR,Os=s.paint.get("text-halo-width").constantOr(1)!==0,Pa=h.terrain&&Ve&&ei?i.ab.mat4.invert(i.ab.mat4.create(),rr):fl;if(ei&&tt.text){const kc=de.elevation,nf=kc?kc.getAtTileOffsetFunc(ut,de.center.lat,de.worldSize,tt.getProjection()):null,yh=fa(gt,st.tileID.canonical,Ve,Ie,de,tt.getProjection(),Rt);bu(tt,gt,h,!0,yh,ln,Ve,J,nf,ut)}return{program:Kr,buffers:tt.text,uniformValues:Ar,atlasTexture:cs,atlasTextureIcon:Nn,atlasInterpolation:bo,atlasInterpolationIcon:Er,isSDF:!0,hasHalo:Os,tile:st,labelPlaneMatrixInv:Pa}},gn=tt.icon.segments.get().length,an=tt.text.segments.get().length,Hi=gn&&!w.onlyText?Pi():null,Yi=an&&!w.onlyIcons?yi():null,xi=s.paint.get("icon-opacity").constantOr(1),zi=s.paint.get("text-opacity").constantOr(1);if(Ee&&tt.canOverlap){Re=!0;const ei=xi&&!w.onlyText?tt.icon.segments.get():[],Vi=zi&&!w.onlyIcons?tt.text.segments.get():[];for(const Tn of ei)nt.push({segments:new i.b7([Tn]),sortKey:Tn.sortKey,state:Hi});for(const Tn of Vi)nt.push({segments:new i.b7([Tn]),sortKey:Tn.sortKey,state:Yi})}else w.onlyText||nt.push({segments:xi?tt.icon.segments:new i.b7([]),sortKey:0,state:Hi}),w.onlyIcons||nt.push({segments:zi?tt.text.segments:new i.b7([]),sortKey:0,state:Yi})}Re&&nt.sort((ut,st)=>ut.sortKey-st.sortKey);for(const ut of nt){const st=ut.state;if(st)if(h.terrain?h.terrain.setupElevationDraw(st.tile,st.program,{useDepthForOcclusion:de.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:st.labelPlaneMatrixInv}):h.setupDepthForOcclusion(de.depthOcclusionForSymbolsAndCircles,st.program),fe.activeTexture.set(pe.TEXTURE0),st.atlasTexture&&st.atlasTexture.bind(st.atlasInterpolation,pe.CLAMP_TO_EDGE,!0),st.atlasTextureIcon&&(fe.activeTexture.set(pe.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,pe.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,st.program),st.hasHalo){const tt=st.uniformValues;tt.u_is_halo=1,yn(st.buffers,ut.segments,s,h,st.program,et,_,y,tt,2),tt.u_is_halo=0}else{if(st.isSDF){const tt=st.uniformValues;st.hasHalo&&(tt.u_is_halo=1,yn(st.buffers,ut.segments,s,h,st.program,et,_,y,tt,1)),tt.u_is_halo=0}yn(st.buffers,ut.segments,s,h,st.program,et,_,y,st.uniformValues,1)}}}function yn(h,t,s,d,_,y,w,C,z,L){const k=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];_.draw(d,d.context.gl.TRIANGLES,y,w,C,ni.disabled,z,s.id,h.layoutVertexBuffer,h.indexBuffer,t,s.paint,d.transform.zoom,h.programConfigurations.get(s.id),k,L)}function Tc(h,t,s,d,_,y,w){const C=h.context.gl,z=s.paint.get("fill-pattern"),L=s.is3D(),k=L?h.stencilModeFor3D():hi.disabled,N=z&&z.constantOr(1);let B,G,Y,X,J;w?(G=N&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=C.LINES):(G=N?"fillPattern":"fill",B=C.TRIANGLES);for(const Q of d){const re=t.getTile(Q);if(N&&!re.patternsLoaded())continue;const ue=re.getBucket(s);if(!ue)continue;h.prepareDrawTile();const le=ue.programConfigurations.get(s.id),_e=h.isTileAffectedByFog(Q),fe=h.getOrCreateProgram(G,{config:le,overrideFog:_e});N&&(h.context.activeTexture.set(C.TEXTURE0),re.imageAtlasTexture&&re.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),le.updatePaintBuffers());const pe=z.constantOr(null);if(pe&&re.imageAtlas){const Ie=re.imageAtlas,He=i.A.from(pe),Ve=Ie.patternPositions[He.getSerializedPrimary()];Ve&&le.setConstantPatternPositions(Ve)}const de=h.translatePosMatrix(Q.projMatrix,re,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),be=s.paint.get("fill-emissive-strength");if(w){X=ue.indexBuffer2,J=ue.segments2;const Ie=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];Y=G==="fillOutlinePattern"&&N?$u(de,be,h,re,Ie):om(de,be,Ie)}else X=ue.indexBuffer,J=ue.segments,Y=N?dl(de,be,h,re):qu(de,be);h.uploadCommonUniforms(h.context,fe,Q.toUnwrapped()),fe.draw(h,B,_,L?k:h.stencilModeForClipping(Q),y,ni.disabled,Y,s.id,ue.layoutVertexBuffer,X,J,s.paint,h.transform.zoom,le,void 0)}}function pl(h,t,s,d,_,y,w,C){s.resetLayerRenderingStats(h);const z=h.context,L=z.gl,k=h.transform,N=s.paint.get("fill-extrusion-pattern"),B=N.constantOr(1),G=s.paint.get("fill-extrusion-opacity"),Y=h.style.enable3dLights(),X=s.paint.get(Y&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),J=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],Q=s.layout.get("fill-extrusion-edge-radius"),re=Q>0&&!s.paint.get("fill-extrusion-rounded-roof"),ue=re?0:Q,le=k.projection.name==="globe"?i.d3():0,_e=k.projection.name==="globe",fe=_e?i.ae(k.zoom):0,pe=[i.at(k.center.lng),i.aA(k.center.lat)],de=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",be=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(de?null:s.lut).toArray01().slice(0,3),Ie=s.paint.get("fill-extrusion-flood-light-intensity"),He=s.paint.get("fill-extrusion-vertical-scale"),Ve=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ee=s.paint.get("fill-extrusion-height-alignment"),Re=s.paint.get("fill-extrusion-base-alignment"),et=uo(h,s.paint.get("fill-extrusion-cutoff-fade-range")),ot=[];let ft;_e&&ot.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&ot.push("FAUX_AO"),re&&ot.push("ZERO_ROOF_RADIUS"),C&&ot.push("HAS_CENTROID"),Ie>0&&ot.push("FLOOD_LIGHT"),et.shouldRenderCutoff&&ot.push("RENDER_CUTOFF"),Ve&&ot.push("RENDER_WALL_MODE");const Ne=h.renderPass==="shadow",nt=h.shadowRenderer,$e=Ne&&!!nt;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let ut=[0,0,0];if(nt){const wt=h.style.directionalLight,Et=h.style.ambientLight;wt&&Et&&(ut=sl(h.style,wt,Et)),Ne||(ot.push("RENDER_SHADOWS","DEPTH_TEXTURE"),nt.useNormalOffset&&ot.push("NORMAL_OFFSET")),ft=ot.concat(["SHADOWS_SINGLE_CASCADE"])}const st=$e?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",tt=s.getLayerRenderingStats();for(const wt of d){const Et=t.getTile(wt),gt=Et.getBucket(s);if(!gt||gt.projection.name!==k.projection.name)continue;let Rt=!1;nt&&(Rt=nt.getMaxCascadeForTile(wt.toUnwrapped())===0);const oi=h.isTileAffectedByFog(wt),Zt=gt.programConfigurations.get(s.id),Wt=h.getOrCreateProgram(st,{config:Zt,defines:Rt?ft:ot,overrideFog:oi});if(h.terrain&&h.terrain.setupElevationDraw(Et,Wt,{useMeterToDem:!0}),!gt.centroidVertexBuffer){const Yi=Wt.attributes.a_centroid_pos;Yi!==void 0&&L.vertexAttrib2f(Yi,0,0)}!Ne&&nt&&nt.setupShadows(Et.tileID.toUnwrapped(),Wt,"vector-tile",Et.tileID.overscaledZ),B&&(h.context.activeTexture.set(L.TEXTURE0),Et.imageAtlasTexture&&Et.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Zt.updatePaintBuffers());const ai=N.constantOr(null);if(ai&&Et.imageAtlas){const Yi=Et.imageAtlas,xi=i.A.from(ai),zi=Yi.patternPositions[xi.getSerializedPrimary()];zi&&Zt.setConstantPatternPositions(zi)}const Pi=s.paint.get("fill-extrusion-vertical-gradient"),yi=1/gt.tileToMeter;let gn;if(Ne&&nt){if(_l(Et.tileID,gt,h))continue;const Yi=nt.calculateShadowPassMatrixFromTile(Et.tileID.toUnwrapped());gn=Id(Yi,ue,yi,He,Ee,Re)}else{const Yi=h.translatePosMatrix(wt.expandedProjMatrix,Et,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),xi=k.projection.createInversionMatrix(k,wt.canonical);gn=B?bc(Yi,h,Pi,G,J,ue,yi,wt,Et,le,Ee,Re,fe,pe,xi,be,He):Hu(Yi,h,Pi,G,J,ue,yi,wt,le,Ee,Re,fe,pe,xi,be,He,Ie,ut)}h.uploadCommonUniforms(z,Wt,wt.toUnwrapped(),null,et);let an=gt.segments;if(k.projection.name==="mercator"&&!Ne&&(an=gt.getVisibleSegments(Et.tileID,h.terrain,h.transform.getFrustum(0)),!an.get().length))continue;if(tt)if(Ne)for(const Yi of an.get())tt.numRenderedVerticesInShadowPass+=Yi.primitiveLength;else for(const Yi of an.get())tt.numRenderedVerticesInTransparentPass+=Yi.primitiveLength;const Hi=[];(h.terrain||C)&&Hi.push(gt.centroidVertexBuffer),_e&&Hi.push(gt.layoutVertexExtBuffer),Ve&&Hi.push(gt.wallVertexBuffer),Wt.draw(h,z.gl.TRIANGLES,_,y,w,ni.backCCW,gn,s.id,gt.layoutVertexBuffer,gt.indexBuffer,an,s.paint,h.transform.zoom,Zt,Hi)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function Sa(h,t,s,d,_,y,w,C,z,L,k,N,B,G,Y,X,J,Q,re){const ue=h.context,le=ue.gl,_e=h.transform,fe=h.transform.zoom,pe=[],de=uo(h,s.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(pe.push("CLEAR_SUBPASS"),re&&(pe.push("CLEAR_FROM_TEXTURE"),ue.activeTexture.set(le.TEXTURE0),re.bind(le.LINEAR,le.CLAMP_TO_EDGE))):L==="sdf"&&pe.push("SDF_SUBPASS"),J&&pe.push("HAS_CENTROID"),de.shouldRenderCutoff&&pe.push("RENDER_CUTOFF");const be=s.layout.get("fill-extrusion-edge-radius"),Ie=(He,Ve,Ee,Re,et)=>{const ot=Ve.programConfigurations.get(s.id),ft=h.isTileAffectedByFog(He),Ne=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:ot,defines:pe,overrideFog:ft}),nt=((ut,st,tt,wt,Et,gt,Rt,oi,Zt,Wt,ai)=>({u_matrix:st,u_opacity:tt,u_ao_pass:wt?1:0,u_meter_to_tile:Et,u_ao:gt,u_flood_light_intensity:Rt,u_flood_light_color:oi,u_attenuation:Zt,u_edge_radius:Wt,u_fb:0,u_fb_size:ai,u_dynamic_offset:1}))(0,Re,k,z,et,[N,B*et],G,Y,X,fe>=17?0:be*et,re?re.size[0]:0),$e=[];J&&$e.push(Ve.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(ue,Ne,He.toUnwrapped(),null,de),Ne.draw(h,ue.gl.TRIANGLES,_,y,w,C,nt,s.id,Ve.vertexBuffer,Ve.indexBuffer,Ee,s.paint,fe,ot,$e)};for(const He of d){const Ve=t.getTile(He),Ee=Ve.getBucket(s);if(!Ee||Ee.projection.name!==_e.projection.name||!Ee.groundEffect||Ee.groundEffect&&!Ee.groundEffect.hasData())continue;const Re=Ee.groundEffect,et=1/Ee.tileToMeter;{const ot=h.translatePosMatrix(He.projMatrix,Ve,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ft=Re.getDefaultSegment();Ie(He,Re,ft,ot,et)}if(Q)for(let ot=0;ot<4;ot++){const ft=i.d4[ot](He),Ne=t.getTile(ft);if(!Ne)continue;const nt=Ne.getBucket(s);if(!nt||nt.projection.name!==_e.projection.name||!nt.groundEffect||nt.groundEffect&&!nt.groundEffect.hasData())continue;const $e=nt.groundEffect;let ut,st;ot===0?(ut=[-i.ag,0,0],st=1):ot===1?(ut=[i.ag,0,0],st=0):ot===2?(ut=[0,-i.ag,0],st=3):(ut=[0,i.ag,0],st=2);const tt=$e.regionSegments[st];if(!tt)continue;const wt=new Float32Array(16);i.ab.mat4.translate(wt,He.projMatrix,ut),Ie(He,$e,tt,h.translatePosMatrix(wt,Ve,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),et)}}}function fm(h,t,s,d,_,y,w){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const C=y?y.findDEMTileFor(s):null;if(!(C&&C.dem||w))return;y&&C&&C.dem&&d.selfDEMTileTimestamp!==C.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=C.dem._timestamp);const z=Q=>new i.P(Math.ceil((Q+i.d7)*i.d8),0),L=Q=>{const re=t.getSource().minzoom,ue=_e=>{const fe=t.getTileByID(_e);if(fe&&fe.hasData())return fe.getBucket(_)},le=[0,-1,1];for(const _e of le){if(Q.overscaledZ+_e<re)continue;const fe=ue(Q.calculateScaledKey(Q.overscaledZ+_e));if(fe)return fe}},k=[0,0,0],N=(Q,re)=>(k[0]=Math.min(Q.min.y,re.min.y),k[1]=Math.max(Q.max.y,re.max.y),k[2]=i.ag-re.min.x>Q.max.x?re.min.x-i.ag:Q.max.x,k),B=(Q,re)=>(k[0]=Math.min(Q.min.x,re.min.x),k[1]=Math.max(Q.max.x,re.max.x),k[2]=i.ag-re.min.y>Q.max.y?re.min.y-i.ag:Q.max.y,k),G=[(Q,re)=>N(Q,re),(Q,re)=>N(re,Q),(Q,re)=>B(Q,re),(Q,re)=>B(re,Q)],Y=(Q,re,ue,le,_e,fe,pe)=>{if(!y)return 0;const de=[[fe?ue:Q,fe?Q:ue,0],[fe?ue:re,fe?re:ue,0]],be=pe<0?i.ag+pe:pe,Ie=[fe?be:(Q+re)/2,fe?(Q+re)/2:be,0];return ue===0&&pe<0||ue!==0&&pe>0?y.getForTilePoints(_e,[Ie],!0,le):de.push(Ie),y.getForTilePoints(s,de,!0,C),Math.max(de[0][2],de[1][2],Ie[2])/y.exaggeration()};for(let Q=0;Q<4;Q++){const re=d.borderFeatureIndices[Q];if(re.length===0)continue;const ue=i.d4[Q](s),le=L(ue);if(!(le&&le instanceof i.d5))continue;const _e=y?y.findDEMTileFor(ue):null;if(!(_e&&_e.dem||w)||(y&&_e&&_e.dem&&d.borderDEMTileTimestamp[Q]!==_e.dem._timestamp&&(d.borderDoneWithNeighborZ[Q]=-1,d.borderDEMTileTimestamp[Q]=_e.dem._timestamp),d.borderDoneWithNeighborZ[Q]===le.canonical.z))continue;le.centroidVertexArray.length===0&&le.createCentroidsBuffer();const fe=(Q<2?1:5)-Q,pe=le.borderDoneWithNeighborZ[fe]!==d.canonical.z,de=le.borderFeatureIndices[fe];let be=0;if(d.canonical.z!==le.canonical.z){for(const Ie of re)d.showCentroid(d.featuresOnBorder[Ie]);if(pe)for(const Ie of de)le.showCentroid(le.featuresOnBorder[Ie]);d.borderDoneWithNeighborZ[Q]=le.canonical.z,le.borderDoneWithNeighborZ[fe]=d.canonical.z}for(const Ie of re){const He=d.featuresOnBorder[Ie],Ve=d.centroidData[He.centroidDataIndex],Ee=He.borders[Q];let Re;for(;be<de.length;){Re=le.featuresOnBorder[de[be]];const et=Re.borders[fe];if(et[1]>Ee[0]+3||et[0]>Ee[0]-3)break;le.showCentroid(Re),be++}if(Re&&be<de.length){const et=be;let ot=0;for(;!(Re.borders[fe][0]>Ee[1]-3)&&(ot++,++be!==de.length);)Re=le.featuresOnBorder[de[be]];Re=le.featuresOnBorder[de[et]];let ft=!1;if(ot>=1){const $e=Re.borders[fe];Math.abs(Ee[0]-$e[0])<3&&Math.abs(Ee[1]-$e[1])<3&&(ot=1,ft=!0,be=et+1)}else if(ot===0){d.showCentroid(He);continue}const Ne=le.centroidData[Re.centroidDataIndex];w&&ft&&(((X=Ve).flags|(J=Ne).flags)&i.d6?(X.flags|=i.d6,J.flags|=i.d6):(X.flags&=~i.d6,J.flags&=~i.d6));const nt=He.intersectsCount()>1||Re.intersectsCount()>1;if(ot>1)be=et,Ve.centroidXY=Ne.centroidXY=new i.P(0,0);else if(_e&&_e.dem&&!nt){const $e=G[Q](Ve,Ne),ut=Q%2?i.ag-1:0,st=Y($e[0],Math.min(i.ag-1,$e[1]),ut,_e,ue,Q<2,$e[2]);Ve.centroidXY=Ne.centroidXY=z(st)}else nt?Ve.centroidXY=Ne.centroidXY=new i.P(0,0):(Ve.centroidXY=d.encodeBorderCentroid(He),Ne.centroidXY=le.encodeBorderCentroid(Re));d.writeCentroidToBuffer(Ve),le.writeCentroidToBuffer(Ne)}else d.showCentroid(He)}d.borderDoneWithNeighborZ[Q]=le.canonical.z,le.borderDoneWithNeighborZ[fe]=d.canonical.z}var X,J;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const pm=[1,0,0],sy=[0,1,0],ml=[0,0,1];function _l(h,t,s){const d=s.transform,_=s.shadowRenderer;if(!_)return!0;const y=h.toUnwrapped(),w=d.tileSize*_._cascades[s.currentShadowCascade].scale;let C=t.maxHeight;if(d.elevation){const X=d.elevation.getMinMaxForTile(h);X&&(C+=X.max)}const z=[..._.shadowDirection];z[2]=-z[2];const L=_.computeSimplifiedTileShadowVolume(y,C,w,z);if(!L)return!1;const k=[pm,sy,ml,z,[z[0],0,z[2]],[0,z[1],z[2]]],N=d.projection.name==="globe",B=d.scaleZoom(w),G=i.bR.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,B,!N),Y=_.getCurrentCascadeFrustum();return G.intersectsPrecise(L.vertices,L.planes,k)===0||Y.intersectsPrecise(L.vertices,L.planes,k)===0}function dt(h){return[h[0]*i.d9,h[1]*i.d9,h[2]*i.d9,0]}function Dt(h,t,s,d,_,y,w,C,z){const L=d.getSource(),k=s.globeSharedBuffers;if(!k)return;let N,B,G;if(t&&(N=d.getTile(t)),L instanceof i.aJ?(B=L.texture,G=i.cI(0,0,s.transform)):N&&t&&(B=N.texture,G=i.cI(t.canonical.z,t.canonical.x,s.transform)),!B||!G)return;h||(G=i.ab.mat4.scale(i.ab.mat4.create(),G,[1,-1,1]));const Y=s.context,X=Y.gl,J=_.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR,Q=s.colorModeForDrapableLayerRenderPass(y),re=w.defines;re.push("GLOBE_POLES");const ue=new $t(X.LEQUAL,$t.ReadWrite,s.depthRangeFor3D),le=Float32Array.from(s.transform.expandedFarZProjMatrix),_e=Float32Array.from(i.bb(i.cH(new i.bT(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),Y.activeTexture.set(X.TEXTURE0),B.bind(J,X.CLAMP_TO_EDGE),Y.activeTexture.set(X.TEXTURE1),B.bind(J,X.CLAMP_TO_EDGE),B.useMipmap&&Y.extTextureFilterAnisotropic&&s.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);const[fe,pe,de,be]=t?k.getPoleBuffers(t.canonical.z,!1):k.getPoleBuffers(0,!0),Ie=_.paint.get("raster-elevation");let He;h?(He=fe,s.renderDefaultNorthPole=Ie!==0):(He=pe,s.renderDefaultSouthPole=Ie!==0);const Ve=dt(w.mix),Ee=((et,ot,ft,Ne,nt,$e,ut,st,tt,wt,Et,gt,Rt)=>Ot(et,ot,ft,new Float32Array(16),new Float32Array(9),[0,0],Ne,[0,0],[0,0,0,0],1,{opacity:1,mix:0},$e,[0,0],st,2,wt,Et,gt,1,0,Rt))(le,_e,G,i.ae(s.transform.zoom),0,_,0,Ie,0,Ve,w.offset,w.range,y),Re=s.getOrCreateProgram("raster",{defines:re});s.uploadCommonUniforms(Y,Re,null),Re.draw(s,X.TRIANGLES,ue,z,Q,C,Ee,_.id,He,de,be)}function gl(h){const t=h._nearZ,s=h.projection.farthestPixelDistance(h),d=s-t,_=.2*h.height,y=t+_;return[t,s,(y-_-t)/d,(y-t)/d]}function Mn(h,t,s,d){if(h)return t instanceof ro&&h instanceof _u?t.getTextureDescriptor(h,s,!0):{texture:h.texture,mix:dt(d.mix),offset:d.offset,buffer:0,tileSize:1}}var je=i.da([{name:"a_index",type:"Int16",components:1}]);class mm{constructor(t,s,d,_){const y={width:d[0],height:d[1],data:null},w=t.gl;this.targetColorTexture=new i.T(t,y,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(t,y,w.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,_),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,_=s.width*s.height;this.particleTexture0=new i.T(this.context,s,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,s,d.RGBA8,{premultiply:!1,useMipmap:!1});const y=new i.db;y.reserve(_);for(let w=0;w<_;w++)y.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(y,je.members,!0),this.particleSegment=i.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function th(h,t,s){if(!h)return null;const d=t.getTextureDescriptor(h,s,!0);if(!d)return null;let{texture:_,mix:y,offset:w,tileSize:C,buffer:z,format:L}=d;if(!_||!L)return null;let k=!1;return L==="uint32"&&(k=!0,y[3]=0,y=va(i.dc,y,[0,s.paint.get("raster-particle-max-speed")]),w=wc(i.dc,w,[0,s.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[z/(C+2*z),C/(C+2*z)],tileSize:C,scalarData:k,scale:y,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function Rd(h){const t=h._nearZ,s=h.projection.farthestPixelDistance(h),d=s-t,_=.2*h.height,y=t+_;return[t,s,(y-_-t)/d,(y-t)/d]}const _m=new i.aj(1,0,0,1),gm=new i.aj(0,1,0,1),ym=new i.aj(0,0,1,1),yl=new i.aj(1,0,1,1),oy=new i.aj(0,1,1,1);function xl(h,t,s,d,_,y,w){const C=h.context,z=h.transform,L=C.gl,k=z.projection.name==="globe",N=k?["PROJECTION_GLOBE_VIEW"]:[];let B=i.ab.mat4.clone(s.projMatrix);if(k&&i.ae(z.zoom)>0){const Ve=i.ba(s.canonical,z),Ee=i.dd(Ve);B=i.ab.mat4.multiply(new Float32Array(16),z.globeMatrix,Ee),i.ab.mat4.multiply(B,z.projMatrix,B)}const G=i.ab.mat4.create();G[12]+=2*_/(i.q.devicePixelRatio*z.width),G[13]+=2*y/(i.q.devicePixelRatio*z.height),i.ab.mat4.multiply(B,G,B);const Y=h.getOrCreateProgram("debug",{defines:N}),X=t.getTileByID(s.key);h.terrain&&h.terrain.setupElevationDraw(X,Y);const J=$t.disabled,Q=hi.disabled,re=h.colorModeForRenderPass(),ue="$debug";C.activeTexture.set(L.TEXTURE0),h.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),k?X._makeGlobeTileDebugBuffers(h.context,z):X._makeDebugTileBoundsBuffers(h.context,z.projection);const le=X._tileDebugBuffer||h.debugBuffer,_e=X._tileDebugIndexBuffer||h.debugIndexBuffer,fe=X._tileDebugSegments||h.debugSegments;if(Y.draw(h,L.LINE_STRIP,J,Q,re,ni.disabled,Zu(B,d),ue,le,_e,fe,null,null,null,[X._globeTileDebugBorderBuffer]),w){const Ve=X.latestRawTileData,Ee=Math.floor((Ve&&Ve.byteLength||0)/1024);let Re=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Re+=` => ${s.overscaledZ}`),Re+=` ${X.state}`,Re+=` ${Ee}kb`,function(et,ot){et.initDebugOverlayCanvas();const ft=et.debugOverlayCanvas,Ne=et.context.gl,nt=et.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,ft.width,ft.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(ot,5,5),nt.strokeText(ot,5,5),et.debugOverlayTexture.update(ft),et.debugOverlayTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)}(h,Re)}const pe=t.getTile(s).tileSize,de=512/Math.min(pe,512)*(s.overscaledZ/z.zoom)*.5,be=X._tileDebugTextBuffer||h.debugBuffer,Ie=X._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,He=X._tileDebugTextSegments||h.debugSegments;Y.draw(h,L.TRIANGLES,J,Q,bi.alphaBlended,ni.disabled,Zu(B,i.aj.transparent,de),ue,be,Ie,He,null,null,null,[X._globeTileDebugTextBuffer])}function Ld(h,t,s,d){vl(h,0,t+s/2,h.transform.width,s,d)}function Sc(h,t,s,d){vl(h,t-s/2,0,s,h.transform.height,d)}function vl(h,t,s,d,_,y){const w=h.context,C=w.gl;C.enable(C.SCISSOR_TEST),C.scissor(t*i.q.devicePixelRatio,s*i.q.devicePixelRatio,d*i.q.devicePixelRatio,_*i.q.devicePixelRatio),w.clear({color:y}),C.disable(C.SCISSOR_TEST)}const xm=i.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:vm}=xm;function Rs(h,t,s,d){h.emplaceBack(t,s,d)}class Mc{constructor(t){this.vertexArray=new i.de,this.indices=new i.aU,Rs(this.vertexArray,-1,-1,1),Rs(this.vertexArray,1,-1,1),Rs(this.vertexArray,-1,1,1),Rs(this.vertexArray,1,1,1),Rs(this.vertexArray,-1,-1,-1),Rs(this.vertexArray,1,-1,-1),Rs(this.vertexArray,-1,1,-1),Rs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,vm),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=i.b7.simpleSegment(0,0,36,12)}}function Br(h,t,s,d,_,y){const w=h.context.gl,C=t.paint.get("sky-atmosphere-color"),z=t.paint.get("sky-atmosphere-halo-color"),L=t.paint.get("sky-atmosphere-sun-intensity"),k=((N,B,G,Y,X)=>({u_matrix_3f:N,u_sun_direction:B,u_sun_intensity:G,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(i.ab.mat3.fromMat4(i.ab.mat3.create(),d),_,L,C,z);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),s.draw(h,w.TRIANGLES,$t.disabled,hi.disabled,bi.unblended,ni.frontCW,k,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const bm=i.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ay{constructor(t){const s=new i.df;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const d=new i.aU;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,bm.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=i.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Nr=i.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ly{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ec{constructor(t){this.colorModeAlphaBlendedWriteRGB=new bi([1,tl,1,tl],i.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new bi([1,0,1,0],i.aj.transparent,[!1,!1,!1,!0]),this.params=new ly,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ay(s);const d=this.params.sizeRange,_=this.params.intensityRange,y=function(k){const N=i.di(30),B=[];for(let G=0;G<k;++G){const Y=2*Math.PI*N(),X=Math.acos(1-2*N())-.5*Math.PI;B.push(i.ab.vec3.fromValues(Math.cos(X)*Math.cos(Y),Math.cos(X)*Math.sin(Y),Math.sin(X)))}return B}(this.params.starsCount),w=i.di(300),C=new i.dg,z=new i.aU;let L=0;for(let k=0;k<y.length;++k){const N=i.ab.vec3.scale([],y[k],200),B=Math.max(0,1+.01*d*(1*w()-.5)),G=Math.max(0,1+.01*_*(1*w()-.5));C.emplaceBack(N[0],N[1],N[2],-1,-1,B,G),C.emplaceBack(N[0],N[1],N[2],1,-1,B,G),C.emplaceBack(N[0],N[1],N[2],1,1,B,G),C.emplaceBack(N[0],N[1],N[2],-1,1,B,G),z.emplaceBack(L+0,L+1,L+2),z.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=s.createVertexBuffer(C,Nr.members),this.starsIdx=s.createIndexBuffer(z),this.starsSegments=i.b7.simpleSegment(0,0,C.length,z.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const d=t.context,_=d.gl,y=t.transform,w=new $t(_.LEQUAL,$t.ReadOnly,[0,1]),C=i.ae(y.zoom),z=t.style.getLut(s.scope),L=s.properties.get("color-use-theme")==="none",k=s.properties.get("color").toRenderColor(L?null:z).toArray01(),N=s.properties.get("high-color-use-theme")==="none",B=s.properties.get("high-color").toRenderColor(N?null:z).toArray01(),G=s.properties.get("space-color-use-theme")==="none",Y=s.properties.get("space-color").toRenderColor(G?null:z).toArray01PremultipliedAlpha(),X=5e-4,J=i.dh(s.properties.get("horizon-blend"),0,1,X,.25),Q=i.cC(t,d,y)&&J===X?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,re=t.frameCounter/1e3%1,ue=i.ab.vec3.length(y.globeCenterInViewSpace),le=Math.sqrt(Math.pow(ue,2)-Math.pow(Q,2)),_e=Math.acos(le/ue),fe=pe=>{const de=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];pe&&de.push("ALPHA_PASS");const be=t.getOrCreateProgram("globeAtmosphere",{defines:de}),Ie=((Ve,Ee,Re,et,ot,ft,Ne,nt,$e,ut,st,tt)=>({u_frustum_tl:Ve,u_frustum_tr:Ee,u_frustum_br:Re,u_frustum_bl:et,u_horizon:ot,u_transition:ft,u_fadeout_range:Ne,u_color:nt,u_high_color:$e,u_space_color:ut,u_temporal_offset:st,u_horizon_angle:tt}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,C,J,k,B,Y,re,_e);t.uploadCommonUniforms(d,be);const He=this.atmosphereBuffer;He&&be.draw(t,_.TRIANGLES,w,hi.disabled,pe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ni.backCW,Ie,pe?"atmosphere_glow_alpha":"atmosphere_glow",He.vertexBuffer,He.indexBuffer,He.segments)};fe(!1),fe(!0)}drawStars(t,s){const d=i.aw(s.properties.get("star-intensity"),0,1);if(d===0)return;const _=t.context,y=_.gl,w=t.transform,C=t.getOrCreateProgram("stars"),z=i.ab.quat.identity([]);i.ab.quat.rotateX(z,z,-w._pitch),i.ab.quat.rotateZ(z,z,-w.angle),i.ab.quat.rotateX(z,z,i.ai(w._center.lat)),i.ab.quat.rotateY(z,z,-i.ai(w._center.lng));const L=i.ab.mat4.fromQuat(new Float32Array(16),z),k=i.ab.mat4.multiply([],w.starsProjMatrix,L),N=i.ab.mat3.fromMat4([],L),B=i.ab.mat3.invert([],N),G=[0,1,0];i.ab.vec3.transformMat3(G,G,B),i.ab.vec3.scale(G,G,this.params.sizeMultiplier);const Y=[1,0,0];i.ab.vec3.transformMat3(Y,Y,B),i.ab.vec3.scale(Y,Y,this.params.sizeMultiplier);const X=(J=G,Q=Y,re=d,{u_matrix:Float32Array.from(k),u_up:J,u_right:Q,u_intensity_multiplier:re});var J,Q,re;t.uploadCommonUniforms(_,C),this.starsVx&&this.starsIdx&&C.draw(t,y.TRIANGLES,$t.disabled,hi.disabled,this.colorModeAlphaBlendedWriteRGB,ni.disabled,X,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function dn(h,t){const s=[...h],d=t.cameraWorldSizeForFog/t.worldSize,_=i.ab.mat4.identity([]);return i.ab.mat4.scale(_,_,[d,d,1]),i.ab.mat4.multiply(s,_,s),i.ab.mat4.multiply(s,t.worldToFogMatrix,s),s}function Ni(h,t,s,d,_){const y=s.material,w=d.context,{baseColorTexture:C,metallicRoughnessTexture:z}=y.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:k,emissionTexture:N}=y;function B(Y,X,J){if(Y&&(h.push(X),w.activeTexture.set(w.gl.TEXTURE0+J),Y.gfxTexture)){const{minFilter:Q,magFilter:re,wrapS:ue,wrapT:le}=Y.sampler;Y.gfxTexture.bindExtraParam(Q,re,ue,le)}}B(C,"HAS_TEXTURE_u_baseColorTexture",yr.BaseColor),B(z,"HAS_TEXTURE_u_metallicRoughnessTexture",yr.MetallicRoughness),B(L,"HAS_TEXTURE_u_normalTexture",yr.Normal),B(k,"HAS_TEXTURE_u_occlusionTexture",yr.Occlusion),B(N,"HAS_TEXTURE_u_emissionTexture",yr.Emission),_&&(_.texture||(_.texture=new i.dk(d.context,_.image,[_.image.height,_.image.height,_.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+yr.LUT),_.texture&&_.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(h.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||h.push("DIFFUSE_SHADED"),h.push("USE_STANDARD_DERIVATIVES");const G=d.shadowRenderer;G&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&h.push("NORMAL_OFFSET"))}function Ac(h,t,s,d,_,y){const w=s.paint.get("model-opacity").constantOr(1),C=t.context,z=new $t(t.context.gl.LEQUAL,$t.ReadWrite,t.depthRangeFor3D),L=t.transform,k=h.mesh,N=k.material,B=N.pbrMetallicRoughness,G=t.style.fog;let Y;Y=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:i.ab.mat4.multiply([],d.zScaleMatrix,h.nodeModelMatrix),i.ab.mat4.multiply(Y,d.negCameraPosMatrix,Y);const X=i.ab.mat4.invert([],Y);i.ab.mat4.transpose(X,X);const J=s.paint.get("model-color-use-theme").constantOr("default")==="none",Q=s.paint.get("model-emissive-strength").constantOr(0),re=Ju(new Float32Array(h.worldViewProjection),new Float32Array(Y),new Float32Array(X),null,t,w,B.baseColorFactor.toRenderColor(null),N.emissiveFactor,B.metallicFactor,B.roughnessFactor,N,Q,s),ue={defines:[]},le=[],_e=t.shadowRenderer;_e&&(_e.useNormalOffset=!1),Ni(ue.defines,le,k,t,J?null:s.lut);let fe=null;if(G){const be=dn(h.nodeModelMatrix,t.transform);if(fe=new Float32Array(be),L.projection.name!=="globe"){const Ie=k.aabb.min,He=k.aabb.max,[Ve,Ee]=G.getOpacityForBounds(be,Ie[0],Ie[1],He[0],He[1]);ue.overrideFog=Ve>=zt||Ee>=zt}}const pe=uo(t,s.paint.get("model-cutoff-fade-range"));pe.shouldRenderCutoff&&ue.defines.push("RENDER_CUTOFF");const de=t.getOrCreateProgram("model",ue);t.uploadCommonUniforms(C,de,null,fe,pe),t.renderPass!=="shadow"&&_e&&_e.setupShadowsFromMatrix(h.nodeModelMatrix,de),de.draw(t,C.gl.TRIANGLES,z,_,y,k.material.doubleSided?ni.disabled:ni.backCCW,re,s.id,k.vertexBuffer,k.indexBuffer,k.segments,s.paint,t.transform.zoom,void 0,le)}function mo(h,t,s,d,_,y,w){let C;C=h.projection.name==="globe"?i.dl(s,h):[...s],i.ab.mat4.multiply(C,C,t.matrix);const z=i.ab.mat4.multiply([],d,C);if(t.meshes)for(const L of t.meshes){if(L.material.alphaMode!=="BLEND"){w.push({mesh:L,depth:0,modelIndex:_,worldViewProjection:z,nodeModelMatrix:C});continue}const k=i.ab.vec3.transformMat4([],L.centroid,z);k[2]>0&&y.push({mesh:L,depth:k[2],modelIndex:_,worldViewProjection:z,nodeModelMatrix:C})}if(t.children)for(const L of t.children)mo(h,L,s,d,_,y,w)}function bl(h,t,s,d){const _=s.shadowRenderer;if(!_)return;const y=_.getShadowPassDepthMode(),w=_.getShadowPassColorMode(),C=_.calculateShadowPassMatrixFromMatrix(t),z=hm(C);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,y,hi.disabled,w,ni.backCCW,z,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,s.transform.zoom,void 0,void 0)}function wl(h,t,s){const d=t.updateZoomBasedPaintProperties(),_=function(y,w,C){let z,L,k,N=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&N>0){const B=y.terrain,G=B.findDEMTileFor(C);G&&G.dem?z=i.dn.create(B,C,G):N=0}if(N===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),N===w.validForExaggeration&&(N===0||z&&z._demTile&&z._demTile.tileID===w.validForDEMTile.id&&z._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const B in w.instancesPerModel){const G=w.instancesPerModel[B];for(let Y=0;Y<G.instancedDataArray.length;++Y){const X=(z?N*z.getElevationAt(0|G.instancedDataArray.float32[16*Y],0|G.instancedDataArray.float32[16*Y+1],!0,!0):0)+G.instancesEvaluatedElevation[Y];G.instancedDataArray.float32[16*Y+6]=X,L=L?Math.min(w.terrainElevationMin,X):X,k=k?Math.max(w.terrainElevationMax,X):X}}return w.terrainElevationMin=L||0,w.terrainElevationMax=k||0,w.validForExaggeration=N,w.validForDEMTile=z&&z._demTile?{id:z._demTile.tileID,timestamp:z._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,t,s);(d||_)&&(t.uploaded=!1,t.upload(h.context))}const vs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.cd([0,0,0],[i.ag,i.ag,0])};function kd(h,t){const s=1<<h.canonical.z,d=t.getFreeCameraOptions().position,_=t.elevation,y=h.canonical.x/s,w=(h.canonical.x+1)/s,C=h.canonical.y/s,z=(h.canonical.y+1)/s;let L=t._centerAltitude;if(_){const G=_.getMinMaxForTile(h);G&&G.max>L&&(L=G.max)}const k=i.aw(d.x,y,w)-d.x,N=i.aw(d.y,C,z)-d.y,B=i.bH(L,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(k*k+N*N+B*B))}function _o(h,t,s,d,_,y,w){const C=h.context,z=h.renderPass==="shadow",L=h.shadowRenderer,k=z&&L?L.getShadowPassDepthMode():new $t(C.gl.LEQUAL,$t.ReadWrite,h.depthRangeFor3D),N=h.isTileAffectedByFog(y);if(s.meshes)for(const B of s.meshes){const G=["MODEL_POSITION_ON_GPU"],Y=[];let X,J,Q;d.instancedDataArray.length>20&&G.push("INSTANCED_ARRAYS");const re=uo(h,t.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),z&&L)X=h.getOrCreateProgram("modelDepth",{defines:G}),J=hm(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(s.matrix)),Q=L.getShadowPassColorMode();else{Ni(G,Y,B,h,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),X=h.getOrCreateProgram("model",{defines:G,overrideFog:N});const le=B.material,_e=le.pbrMetallicRoughness,fe=t.paint.get("model-opacity").constantOr(1),pe=t.paint.get("model-emissive-strength").constantOr(0);J=Ju(y.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,h,fe,_e.baseColorFactor.toRenderColor(null),le.emissiveFactor,_e.metallicFactor,_e.roughnessFactor,le,pe,t,_),L&&(w.shadowUniformsInitialized?X.setShadowUniformValues(C,L.getShadowUniformValues()):(L.setupShadows(y.toUnwrapped(),X,"model-tile",y.overscaledZ),w.shadowUniformsInitialized=!0)),Q=re.shouldRenderCutoff||fe<1||le.alphaMode!=="OPAQUE"?bi.alphaBlended:bi.unblended}h.uploadCommonUniforms(C,X,y.toUnwrapped(),null,re);const ue=B.material.doubleSided?ni.disabled:ni.backCCW;if(d.instancedDataArray.length>20)Y.push(d.instancedDataBuffer),X.draw(h,C.gl.TRIANGLES,k,hi.disabled,Q,ue,J,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,h.transform.zoom,void 0,Y,d.instancedDataArray.length);else{const le=z?"u_instance":"u_normal_matrix";for(let _e=0;_e<d.instancedDataArray.length;++_e)J[le]=new Float32Array(d.instancedDataArray.arrayBuffer,64*_e,16),X.draw(h,C.gl.TRIANGLES,k,hi.disabled,Q,ue,J,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,h.transform.zoom,void 0,Y)}}if(s.children)for(const B of s.children)_o(h,t,B,d,_,y,w)}const Go=[1,-1,1];function Ho(h,t,s,d){if(!s.modelManager)return!0;const _=s.modelManager;if(!s.shadowRenderer)return!0;const y=s.shadowRenderer,w=t.aabb;let C=!0,z=h.maxHeight;if(z===0){let k=0;for(const N in h.instancesPerModel){const B=_.getModel(N,d);B?k=Math.max(k,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):C=!1}z=h.maxScale*k*1.41+h.maxVerticalOffset,C&&(h.maxHeight=z)}w.max[2]=z,w.min[2]+=h.terrainElevationMin,w.max[2]+=h.terrainElevationMax,i.ab.vec3.transformMat4(w.min,w.min,t.tileMatrix),i.ab.vec3.transformMat4(w.max,w.max,t.tileMatrix);const L=w.intersects(y.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=L===2),L===0}function ih(h,t){const s=h.uniformValues.u_cutoff_params[0],d=h.uniformValues.u_cutoff_params[1],_=h.uniformValues.u_cutoff_params[2],y=h.uniformValues.u_cutoff_params[3];return d===s||y===_?1:i.aw(((t-s)/(d-s)-_)/(y-_),0,1)}function nh(h,t,s,d){if(t.pitch<20)return 1;const _=t.getWorldToCameraMatrix();i.ab.mat4.multiply(_,_,h);const y=i.ab.vec4.fromValues(s.min[0],s.min[1],s.min[2],1);let w=i.ab.vec4.transformMat4(i.ab.vec4.create(),y,_),C=w,z=w;y[1]=s.max[1],w=i.ab.vec4.transformMat4(i.ab.vec4.create(),y,_),C=w[1]<C[1]?w:C,z=w[1]>z[1]?w:z,y[0]=s.max[0],w=i.ab.vec4.transformMat4(i.ab.vec4.create(),y,_),C=w[1]<C[1]?w:C,z=w[1]>z[1]?w:z,y[1]=s.min[1],w=i.ab.vec4.transformMat4(i.ab.vec4.create(),y,_),C=w[1]<C[1]?w:C,z=w[1]>z[1]?w:z;const L=i.aw(d[0],0,1),k=100*t.pixelsPerMeter*i.aw(d[1],0,1),N=i.aw(d[2],0,1),B=i.ab.vec4.lerp(i.ab.vec4.create(),C,z,L),G=Math.tan(.5*t.fovX),Y=-B[2]*G;if(k===0)return B[1]<-Math.abs(Y)?N:1;const X=(-Math.abs(Y)-B[1])/k,J=(re,ue,le)=>(1-le)*re+le*ue,Q=i.aw(J(1,N,X),N,1);return J(1,Q,i.aw((t.pitch-20)/20,0,1))}class Od{}class Fd{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,d){{const N=this._storage.get(s.id);if(N)return N.lastUsedFrameIdx=t,N.buf}const _=d.gl,y=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),w=new ArrayBuffer(y),C=new Int16Array(w);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const z=new i.dq;for(let N=0;N<y/2;N+=3){const B=C[N],G=C[N+1],Y=C[N+2];z.emplaceBack(B,G),z.emplaceBack(G,Y),z.emplaceBack(Y,B)}const L=d.bindVertexArrayOES.current,k=new Od;return k.buf=new Js(d,z),k.lastUsedFrameIdx=t,this._storage.set(s.id,k),d.bindVertexArrayOES.set(L),k.buf}update(t){for(const[s,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class Bd{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const qo=i.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Nd{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ic{constructor(t,s){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Vd=i.da([{type:"Float32",name:"a_pos_2f",components:2}]);class Ud{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new i.dr,C=new i.aU;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(w,Vd.members),this.vignetteIdx=t.context.createIndexBuffer(C)}const _=i.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const w={u_vignetteShape:(y={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,$t.disabled,hi.disabled,bi.alphaBlended,ni.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,_,{})}var y}}class vr{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const d=t.getFreeCameraOptions().position,_=d.toAltitude(),y=d.toLngLat(),w=i.ai(y.lng),C=i.ai(y.lat),z=t.pixelsPerMeter/s,L=w*i.ds,k=i.ds*Math.log(Math.tan(Math.PI/4+C/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const N=-this._offsetYPrev+k,B=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*z,this._accumulatedOffsetY+=N*z,this._accumulatedElevation+=B*z,this._offsetXPrev=L,this._offsetYPrev=k,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function rh(h,t){return[-(h[0]-Math.floor(h[0]/t)*t),-(h[1]-Math.floor(h[1]/t)*t),-(h[2]-Math.floor(h[2]/t)*t)]}function sh(h){const t=i.di(1323123451230),s=[];for(let d=0;d<h;++d){const _=2*t()-1,y=2*t()-1,w=2*t()-1;s.push(i.ab.vec3.fromValues(_,y,w))}return s}function bs(h,t,s,d,_){const y=i.aw((_-s)/(d-s),0,1);return(1-y)*h+y*t}class $o{constructor(t){this._movement=new vr,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ud,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const _=d.starsProjMatrix,y=i.ab.quat.identity([]);i.ab.quat.rotateX(y,y,i.ai(90)-d._pitch),i.ab.quat.rotateZ(y,y,-d.angle);const w=i.ab.mat4.fromQuat(new Float32Array(16),y),C=i.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),z=i.ab.mat4.transpose([],C),L=i.ab.mat4.multiply([],z,w),k=Date.now()/1e3;return this._accumulatedTimeFromStart+=(k-this._prevTime)*s,this._prevTime=k,{projectionMatrix:_,modelviewMatrix:L}}}class jd extends $o{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ic(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const d=sh(this.particlesCount),_=new i.dt,y=new i.aU;let w=0;const C=i.di(1323123451230);for(let z=0;z<d.length;++z){const L=d[z],k=[2*C()-1,C(),C(),C()];_.emplaceBack(L[0],L[1],L[2],-1,-1,...k),_.emplaceBack(L[0],L[1],L[2],1,-1,...k),_.emplaceBack(L[0],L[1],L[2],1,1,...k),_.emplaceBack(L[0],L[1],L[2],-1,1,...k),y.emplaceBack(w+0,w+1,w+2),y.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=s.createVertexBuffer(_,qo.members),this.particlesIdx=s.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(s.revealStart>d)return;const _=bs(0,1,s.revealStart,s.revealStart+s.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let w=[-y.direction.x,y.direction.y,-100];i.ab.vec3.normalize(w,w);const C=structuredClone(this._vignetteParams);C.strength*=_,y.overrideStyleParameters||(y.intensity=t.style.rain.state.density,y.timeFactor=t.style.rain.state.intensity,y.color=structuredClone(t.style.rain.state.color),w=structuredClone(t.style.rain.state.direction),y.screenThinning.intensity=t.style.rain.state.centerThinning,y.dropletSizeX=t.style.rain.state.dropletSize[0],y.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],y.distortionStrength=100*t.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(t.style.rain.state.vignetteColor));const z=this.updateOnRender(t,y.timeFactor),L=t.context,k=L.gl,N=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new i.T(L,{width:t.width,height:t.height,data:null},k.RGBA8)),y.distortionStrength>0&&(L.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const B=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(L,B),L.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const G=[y.color.r,y.color.g,y.color.b,y.color.a],Y=(X,J)=>{const Q=rh(this._movement.getPosition(),X),re=y.dropletSizeX,ue=y.dropletSizeX*y.dropletSizeYScale,le=t.width/2,_e=t.height/2,fe=bs(0,y.screenThinning.start,0,1,y.screenThinning.intensity),pe=bs(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),de=bs(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),be=(Ie={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Q,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:X,rainDropletSize:[re,ue],distortionStrength:y.distortionStrength,rainDirection:w,color:G,screenSize:[N.width,N.height],thinningCenterPos:[le,_e],thinningShape:[fe,pe,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:de,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:J?0:1},{u_modelview:Float32Array.from(Ie.modelview),u_projection:Float32Array.from(Ie.projection),u_time:Ie.time,u_cam_pos:Ie.camPos,u_texScreen:0,u_velocityConeAperture:Ie.velocityConeAperture,u_velocity:Ie.velocity,u_boxSize:Ie.boxSize,u_rainDropletSize:Ie.rainDropletSize,u_distortionStrength:Ie.distortionStrength,u_rainDirection:Ie.rainDirection,u_color:Ie.color,u_screenSize:Ie.screenSize,u_thinningCenterPos:Ie.thinningCenterPos,u_thinningShape:Ie.thinningShape,u_thinningAffectedRatio:Ie.thinningAffectedRatio,u_thinningParticleOffset:Ie.thinningParticleOffset,u_shapeDirectionalPower:Ie.shapeDirectionalPower,u_shapeNormalPower:Ie.shapeNormalPower,u_mode:Ie.mode});var Ie;const He=Math.round(_*y.intensity*this.particlesCount),Ve=i.b7.simpleSegment(0,0,4*He,2*He);B.draw(t,k.TRIANGLES,$t.disabled,hi.disabled,bi.alphaBlended,ni.disabled,be,"rain_particles",this.particlesVx,this.particlesIdx,Ve,{})};y.distortionStrength>0&&Y(y.boxSize,!0),Y(y.boxSize,!1),this._vignette.draw(t,C)}}const Gd=i.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Hd extends $o{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ic(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const d=sh(this.particlesCount),_=new i.du,y=new i.aU;let w=0;const C=i.di(1323123451230);for(let z=0;z<d.length;++z){const L=d[z],k=C(),N=C(),B=C(),G=[z/d.length,k,N,B],Y=[C(),C()];_.emplaceBack(L[0],L[1],L[2],-1,-1,...G,...Y),_.emplaceBack(L[0],L[1],L[2],1,-1,...G,...Y),_.emplaceBack(L[0],L[1],L[2],1,1,...G,...Y),_.emplaceBack(L[0],L[1],L[2],-1,1,...G,...Y),y.emplaceBack(w+0,w+1,w+2),y.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=s.createVertexBuffer(_,Gd.members),this.particlesIdx=s.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let d=[-s.direction.x,s.direction.y,-100];i.ab.vec3.normalize(d,d);const _=structuredClone(this._vignetteParams),y=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=t.transform.zoom;if(y.revealStart>w)return;const C=bs(0,1,y.revealStart,y.revealStart+y.revealRange,w);_.strength*=C,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(t.style.snow.state.vignetteColor));const z=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=t.context,k=L.gl,N=t.transform,B=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(L,B),((G,Y,X)=>{const J=rh(this._movement.getPosition(),G),Q=N.width/2,re=N.height/2,ue=bs(0,X.screenThinning.start,0,1,X.screenThinning.intensity),le=bs(.001,X.screenThinning.range,0,1,X.screenThinning.intensity),_e=bs(0,X.screenThinning.particleOffset,0,1,X.screenThinning.intensity),fe=(pe={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:X.velocityConeAperture,velocity:X.velocity,horizontalOscillationRadius:X.horizontalOscillationRadius,horizontalOscillationRate:X.horizontalOscillationRate,boxSize:G,billboardSize:1*X.billboardSize,simpleShapeParameters:[X.shapeFadeStart,X.shapeFadePower],screenSize:[N.width,N.height],thinningCenterPos:[Q,re],thinningShape:[ue,le,Math.pow(10,X.screenThinning.fadePower)],thinningAffectedRatio:X.screenThinning.affectedRatio,thinningParticleOffset:_e,color:[X.color.r,X.color.g,X.color.b,X.color.a],direction:d},{u_modelview:Float32Array.from(pe.modelview),u_projection:Float32Array.from(pe.projection),u_time:pe.time,u_cam_pos:pe.camPos,u_velocityConeAperture:pe.velocityConeAperture,u_velocity:pe.velocity,u_horizontalOscillationRadius:pe.horizontalOscillationRadius,u_horizontalOscillationRate:pe.horizontalOscillationRate,u_boxSize:pe.boxSize,u_billboardSize:pe.billboardSize,u_simpleShapeParameters:pe.simpleShapeParameters,u_screenSize:pe.screenSize,u_thinningCenterPos:pe.thinningCenterPos,u_thinningShape:pe.thinningShape,u_thinningAffectedRatio:pe.thinningAffectedRatio,u_thinningParticleOffset:pe.thinningParticleOffset,u_particleColor:pe.color,u_direction:pe.direction});var pe;const de=Math.round(C*X.intensity*this.particlesCount),be=i.b7.simpleSegment(0,0,4*de,2*de);this.particlesVx&&this.particlesIdx&&B.draw(t,k.TRIANGLES,$t.disabled,hi.disabled,bi.alphaBlended,ni.disabled,fe,"snow_particles",this.particlesVx,this.particlesIdx,be,{})})(s.boxSize,0,s),this._vignette.draw(t,_)}}const go={symbol:function(h,t,s,d,_){if(h.renderPass!=="translucent")return;const y=hi.disabled,w=h.colorModeForRenderPass(),C=s.layout.get("text-variable-anchor"),z=s.layout.get("text-size-scale-range"),L=i.aw(h.scaleFactor,z[0],z[1]);C&&function(B,G,Y,X,J,Q,re,ue){const le=G.transform,_e=J==="map",fe=Q==="map";for(const pe of B){const de=X.getTile(pe),be=de.getBucket(Y);if(!be||!be.text||!be.text.segments.get().length)continue;const Ie=i.bp(be.textSizeData,le.zoom,ue),He=ac(pe,be.getProjection(),le),Ve=le.calculatePixelsToTileUnitsMatrix(de),Ee=oo(He,de.tileID.canonical,fe,_e,le,be.getProjection(),Ve),Re=be.hasIconTextFit()&&be.hasIconData();if(Ie){const et=Math.pow(2,le.zoom-de.tileID.overscaledZ);dm(be,_e,fe,re,i.cX,le,Ee,pe,et,Ie,Re)}}}(d,h,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),_,L);const k=s.paint.get("icon-opacity").constantOr(1)!==0,N=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||N)?Wr(h,t,s,d,y,w):(k&&Wr(h,t,s,d,y,w,{onlyIcons:!0}),N&&Wr(h,t,s,d,y,w,{onlyText:!0})),t.map.showCollisionBoxes&&(Dd(h,t,s,d,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Dd(h,t,s,d,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,s,d){if(h.renderPass!=="translucent")return;const _=s.paint.get("circle-opacity"),y=s.paint.get("circle-stroke-width"),w=s.paint.get("circle-stroke-opacity"),C=s.layout.get("circle-sort-key").constantOr(1)!==void 0,z=s.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(y.constantOr(1)===0||w.constantOr(1)===0))return;const L=h.context,k=L.gl,N=h.transform,B=h.depthModeForSublayer(0,$t.ReadOnly),G=hi.disabled,Y=h.colorModeForDrapableLayerRenderPass(z),X=N.projection.name==="globe",J=[i.at(N.center.lng),i.aA(N.center.lat)],Q=[];for(let ue=0;ue<d.length;ue++){const le=d[ue],_e=t.getTile(le),fe=_e.getBucket(s);if(!fe||fe.projection.name!==N.projection.name)continue;const pe=fe.programConfigurations.get(s.id),de=i.cY(s),be=h.isTileAffectedByFog(le);X&&de.push("PROJECTION_GLOBE_VIEW"),de.push("DEPTH_D24"),h.terrain&&N.depthOcclusionForSymbolsAndCircles&&de.push("DEPTH_OCCLUSION");const Ie=h.getOrCreateProgram("circle",{config:pe,defines:de,overrideFog:be}),He=fe.layoutVertexBuffer,Ve=fe.globeExtVertexBuffer,Ee=fe.indexBuffer,Re=N.projection.createInversionMatrix(N,le.canonical),et={programConfiguration:pe,program:Ie,layoutVertexBuffer:He,globeExtVertexBuffer:Ve,indexBuffer:Ee,uniformValues:i.cZ(h,le,_e,Re,J,s),tile:_e};if(C){const ot=fe.segments.get();for(const ft of ot)Q.push({segments:new i.b7([ft]),sortKey:ft.sortKey,state:et})}else Q.push({segments:fe.segments,sortKey:0,state:et})}C&&Q.sort((ue,le)=>ue.sortKey-le.sortKey);const re={useDepthForOcclusion:N.depthOcclusionForSymbolsAndCircles};for(const ue of Q){const{programConfiguration:le,program:_e,layoutVertexBuffer:fe,globeExtVertexBuffer:pe,indexBuffer:de,uniformValues:be,tile:Ie}=ue.state,He=ue.segments;h.terrain&&h.terrain.setupElevationDraw(Ie,_e,re),h.uploadCommonUniforms(L,_e,Ie.tileID.toUnwrapped()),_e.draw(h,k.TRIANGLES,B,G,Y,ni.disabled,be,s.id,fe,de,He,s.paint,N.zoom,le,[pe])}},heatmap:function(h,t,s,d){if(s.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const _=h.context,y=_.gl,w=hi.disabled,C=new bi([y.ONE,y.ONE,y.ONE,y.ONE],i.aj.transparent,[!0,!0,!0,!0]);(function(G,Y,X,J){const Q=G.gl,re=Y.width*J,ue=Y.height*J;G.activeTexture.set(Q.TEXTURE1),G.viewport.set([0,0,re,ue]);let le=X.heatmapFbo;if(!le||le&&(le.width!==re||le.height!==ue)){le&&le.destroy();const _e=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,_e),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),le=X.heatmapFbo=G.createFramebuffer(re,ue,!0,null),function(fe,pe,de,be,Ie,He){const Ve=fe.gl;Ve.texImage2D(Ve.TEXTURE_2D,0,fe.extRenderToTextureHalfFloat?Ve.RGBA16F:Ve.RGBA,Ie,He,0,Ve.RGBA,fe.extRenderToTextureHalfFloat?Ve.HALF_FLOAT:Ve.UNSIGNED_BYTE,null),be.colorAttachment.set(de)}(G,0,_e,le,re,ue)}else Q.bindTexture(Q.TEXTURE_2D,le.colorAttachment.get()),G.bindFramebuffer.set(le.framebuffer)})(_,h,s,h.transform.projection.name==="globe"?.5:.25),_.clear({color:i.aj.transparent});const z=h.transform,L=z.projection.name==="globe",k=L?["PROJECTION_GLOBE_VIEW"]:[],N=L?ni.frontCCW:ni.disabled,B=[i.at(z.center.lng),i.aA(z.center.lat)];for(let G=0;G<d.length;G++){const Y=d[G];if(t.hasRenderableParent(Y))continue;const X=t.getTile(Y),J=X.getBucket(s);if(!J||J.projection.name!==z.projection.name)continue;const Q=h.isTileAffectedByFog(Y),re=J.programConfigurations.get(s.id),ue=h.getOrCreateProgram("heatmap",{config:re,defines:k,overrideFog:Q}),{zoom:le}=h.transform;h.terrain&&h.terrain.setupElevationDraw(X,ue),h.uploadCommonUniforms(_,ue,Y.toUnwrapped());const _e=z.projection.createInversionMatrix(z,Y.canonical);ue.draw(h,y.TRIANGLES,$t.disabled,w,C,N,ny(h,Y,X,_e,B,le,s.paint.get("heatmap-intensity")),s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,h.transform.zoom,re,L?[J.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,y){const w=_.context,C=w.gl,z=y.heatmapFbo;if(!z)return;w.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,z.colorAttachment.get()),w.activeTexture.set(C.TEXTURE1);let L=y.colorRampTexture;L||(L=y.colorRampTexture=new i.T(w,y.colorRamp,C.RGBA8)),L.bind(C.LINEAR,C.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,C.TRIANGLES,$t.disabled,hi.disabled,_.colorModeForRenderPass(),ni.disabled,((k,N,B,G)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)}(h,s))},line:function(h,t,s,d){if(h.renderPass!=="translucent")return;const _=s.paint.get("line-opacity"),y=s.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;const w=s.paint.get("line-emissive-strength"),C=s.paint.get("line-occlusion-opacity"),z=s.layout.get("line-elevation-reference"),L=s.layout.get("line-width-unit")==="meters",k=z==="sea",N=h.context,B=N.gl,G=!s.isDraped();if(G&&h.transform.projection.name==="globe")return;const Y=s.layout.get("line-cross-slope"),X=Y!==void 0,J=Y<1,Q=G?new $t(h.depthOcclusion?B.GREATER:B.LEQUAL,$t.ReadOnly,h.depthRangeFor3D):h.depthModeForSublayer(0,$t.ReadOnly),re=h.colorModeForDrapableLayerRenderPass(w),ue=h.terrain&&h.terrain.renderingToTexture,le=ue?1:i.q.devicePixelRatio,_e=s.paint.get("line-dasharray"),fe=_e.constantOr(1),pe=s.layout.get("line-cap"),de=_e.constantOr(null),be=pe.constantOr(null),Ie=s.paint.get("line-pattern"),He=Ie.constantOr(1),Ve=Ie.constantOr(null),Ee=s.paint.get("line-opacity").constantOr(1);let Re=!He&&Ee!==1||h.depthOcclusion&&C>0&&C<1;const et=s.paint.get("line-gradient"),ot=He?"linePattern":"line",ft=i.c_(s);let Ne;if(ue&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(Re=!1),C!==0&&h.depthOcclusion){const $e=s.paint._values["line-opacity"];$e&&$e.value&&$e.value.kind==="constant"?Ne=$e.value:i.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}if(G&&(h.forceTerrainMode=!0),!G&&C!==0&&h.terrain&&!ue)return void i.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`);const nt=Re&&G?h.stencilModeFor3D():hi.disabled;G&&(ft.push("ELEVATED"),X&&ft.push(J?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),k&&ft.push("ELEVATION_REFERENCE_SEA")),y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&ft.push("VARIABLE_LINE_WIDTH");for(const $e of d){const ut=t.getTile($e);if(He&&!ut.patternsLoaded())continue;const st=ut.getBucket(s);if(!st)continue;h.prepareDrawTile();const tt=st.programConfigurations.get(s.id),wt=h.isTileAffectedByFog($e),Et=h.getOrCreateProgram(ot,{config:tt,defines:ft,overrideFog:wt,overrideRtt:!G&&void 0});if(Ve&&ut.imageAtlas){const yi=i.A.from(Ve),gn=ut.imageAtlas.patternPositions[yi.getSerializedPrimary()];gn&&tt.setConstantPatternPositions(gn)}if(!He&&de&&be&&ut.lineAtlas){const yi=ut.lineAtlas.getDash(de,be);yi&&tt.setConstantPatternPositions(yi)}let[gt,Rt]=s.paint.get("line-trim-offset");(be==="round"||be==="square")&&gt!==Rt&&(gt===0&&(gt-=1),Rt===1&&(Rt+=1));const oi=ue?$e.projMatrix:null,Zt=L?1/st.tileToMeter/i.ar(ut,1,h.transform.zoom):1,Wt=L?1/st.tileToMeter/i.ar(ut,1,Math.floor(h.transform.zoom)):1,ai=He?i.c$(h,ut,s,oi,le,Zt,Wt,[gt,Rt]):i.d0(h,ut,s,oi,st.lineClipsArray.length,le,Zt,Wt,[gt,Rt]);if(et){const yi=st.gradients[s.id];let gn=yi.texture;if(s.gradientVersion!==yi.version){let an=256;if(s.stepInterpolant){const Hi=t.getSource().maxzoom,Yi=$e.canonical.z===Hi?Math.ceil(1<<h.transform.maxZoom-$e.canonical.z):1;an=i.aw(i.d1(st.maxLineLength/i.ag*1024*Yi),256,N.maxTextureSize)}yi.gradient=i.d2({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:an,image:yi.gradient||void 0,clips:st.lineClipsArray}),yi.texture?yi.texture.update(yi.gradient):yi.texture=new i.T(N,yi.gradient,B.RGBA8),yi.version=s.gradientVersion,gn=yi.texture}N.activeTexture.set(B.TEXTURE1),gn.bind(s.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}fe&&(N.activeTexture.set(B.TEXTURE0),ut.lineAtlasTexture&&ut.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),tt.updatePaintBuffers()),He&&(N.activeTexture.set(B.TEXTURE0),ut.imageAtlasTexture&&ut.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),tt.updatePaintBuffers()),G&&!k&&h.terrain.setupElevationDraw(ut,Et),h.uploadCommonUniforms(N,Et,$e.toUnwrapped());const Pi=yi=>{Ne!=null&&(Ne.value=Ee*C),Et.draw(h,B.TRIANGLES,Q,yi,re,ni.disabled,ai,s.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,s.paint,h.transform.zoom,tt,[st.layoutVertexBuffer2,st.patternVertexBuffer,st.zOffsetVertexBuffer]),Ne!=null&&(Ne.value=Ee)};if(Re&&!G){const yi=h.stencilModeForClipping($e).ref;yi===0&&ue&&N.clear({stencil:0});const gn={func:B.EQUAL,mask:255};ai.u_alpha_discard_threshold=.8,Pi(new hi(gn,yi,255,B.KEEP,B.KEEP,B.INVERT)),ai.u_alpha_discard_threshold=0,Pi(new hi(gn,yi,255,B.KEEP,B.KEEP,B.KEEP))}else Re&&G&&(ai.u_alpha_discard_threshold=.001),Pi(G?nt:h.stencilModeForClipping($e))}G&&(h.forceTerrainMode=!1),Re&&(h.resetStencilClippingMasks(),ue&&N.clear({stencil:0})),C===0||h.depthOcclusion||ue||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,s,d){const _=s.paint.get("fill-color"),y=s.paint.get("fill-opacity"),w=s.is3D(),C=new $t(h.context.gl.LEQUAL,$t.ReadWrite,h.depthRangeFor3D);if(y.constantOr(1)===0)return;const z=s.paint.get("fill-emissive-strength"),L=h.colorModeForDrapableLayerRenderPass(z),k=s.paint.get("fill-pattern"),N=h.opaquePassEnabledForLayer()&&!k.constantOr(1)&&_.constantOr(i.aj.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===N){const B=w?C:h.depthModeForSublayer(1,h.renderPass==="opaque"?$t.ReadWrite:$t.ReadOnly);Tc(h,t,s,d,B,L,!1)}if(!w&&h.renderPass==="translucent"&&s.paint.get("fill-antialias")){const B=w?C:h.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,$t.ReadOnly);Tc(h,t,s,d,B,L,!0)}},"fill-extrusion":function(h,t,s,d){const _=s.paint.get("fill-extrusion-opacity"),y=h.context,w=y.gl,C=h.terrain,z=C&&C.renderingToTexture;if(_===0)return;const L=h.conflationActive&&h.style.isLayerClipped(s,t.getSource()),k=h.style.order.indexOf(s.fqid);if(L&&function(N,B,G,Y,X){for(const J of Y){const Q=B.getTile(J).getBucket(G);Q&&(Q.updateReplacement(J,N.replacementSource,X),Q.uploadCentroid(N.context))}}(h,t,s,d,k),C||L)for(const N of d){const B=t.getTile(N).getBucket(s);B&&fm(h.context,t,N,B,s,C,L)}if(h.renderPass==="shadow"&&h.shadowRenderer){const N=h.shadowRenderer;if(C&&_<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.a9)return;const B=N.getShadowPassDepthMode(),G=N.getShadowPassColorMode();pl(h,t,s,d,B,hi.disabled,G,L)}else if(h.renderPass==="translucent"){const N=!s.paint.get("fill-extrusion-pattern").constantOr(1),B=s.paint.get("fill-extrusion-color").constantOr(i.aj.white);if(!z&&B.a!==0){const G=new $t(h.context.gl.LEQUAL,$t.ReadWrite,h.depthRangeFor3D);_===1&&N?pl(h,t,s,d,G,hi.disabled,bi.unblended,L):(pl(h,t,s,d,G,hi.disabled,bi.disabled,L),pl(h,t,s,d,G,h.stencilModeFor3D(),h.colorModeForRenderPass(),L),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&N&&(!C&&h.transform.projection.name!=="globe"||z)){const G=s.paint.get("fill-extrusion-opacity"),Y=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),J=s.paint.get("fill-extrusion-flood-light-intensity"),Q=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",re=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(Q?null:s.lut).toArray01().slice(0,3),ue=Y>0&&X>0,le=J>0,_e=(pe,de,be)=>(1-be)*pe+be*de,fe=pe=>{const de=h.depthModeForSublayer(1,$t.ReadOnly,w.LEQUAL,!0),be=s.paint.get(pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ie=_e(.1,3,be),He=h._showOverdrawInspector;if(!He){const Ve=new hi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Ee=new bi([w.ONE,w.ONE,w.ONE,w.ONE],i.aj.transparent,[!1,!1,!1,!0],w.MIN);Sa(h,t,s,d,de,Ve,Ee,ni.disabled,pe,"sdf",G,Y,X,J,re,Ie,L,!1)}{const Ve=He?hi.disabled:new hi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ee=He?h.colorModeForRenderPass():new bi([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],i.aj.transparent,[!0,!0,!0,!0]);Sa(h,t,s,d,de,Ve,Ee,ni.disabled,pe,"color",G,Y,X,J,re,Ie,L,!1)}};if(z){const pe=(de,be,Ie)=>{const He=h.depthModeForSublayer(1,$t.ReadOnly,w.LEQUAL,!1),Ve=s.paint.get(de?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ee=_e(.1,3,Ve);{const Re=new bi([w.ONE,w.ONE,w.ONE,w.ONE],i.aj.transparent,[!1,!1,!1,!0]);Sa(h,t,s,d,He,hi.disabled,Re,ni.disabled,de,"clear",G,Y,X,J,re,Ee,L,be)}{const Re=new hi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),et=new bi([w.ONE,w.ONE,w.ONE,w.ONE],i.aj.transparent,[!1,!1,!1,!0],w.MIN);Sa(h,t,s,d,He,Re,et,ni.disabled,de,"sdf",G,Y,X,J,re,Ee,L,be)}{const Re=de?w.ZERO:w.ONE_MINUS_DST_ALPHA,et=new hi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),ot=new bi([Re,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],i.aj.transparent,[!0,!0,!0,!0]);Sa(h,t,s,d,He,et,ot,ni.disabled,de,"color",G,Y,X,J,re,Ee,L,be)}{const Re=new bi([w.ONE,w.ONE,w.ONE,de?w.ZERO:w.ONE],i.aj.transparent,[!1,!1,!1,!0],de?w.FUNC_ADD:w.MAX);Sa(h,t,s,d,He,hi.disabled,Re,ni.disabled,de,"clear",G,Y,X,J,re,Ee,L,be,Ie)}};if(ue||le){let de;if(h.prepareDrawTile(),C){const be=C.drapeBufferSize[0],Ie=C.drapeBufferSize[1];de=C.framebufferCopyTexture,de&&(!de||de.size[0]===be&&de.size[1]===Ie)||(de&&de.destroy(),de=C.framebufferCopyTexture=new i.T(y,new i.r({width:be,height:Ie}),w.RGBA8)),de.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,be,Ie)}ue&&pe(!0,!1,de),le&&pe(!1,!0,de)}}else ue&&fe(!0),le&&fe(!1),(ue||le)&&h.resetStencilClippingMasks()}}},hillshade:function(h,t,s,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const _=h.context,y=h.terrain&&h.terrain.renderingToTexture,[w,C]=h.renderPass!=="translucent"||y?[{},d]:h.stencilConfigForOverlap(d);for(const z of C){const L=t.getTile(z);if(L.needsHillshadePrepare&&h.renderPass==="offscreen")ll(h,L,s);else if(h.renderPass==="translucent"){const k=h.depthModeForSublayer(0,$t.ReadOnly),N=s.paint.get("hillshade-emissive-strength"),B=h.colorModeForDrapableLayerRenderPass(N),G=y&&h.terrain?h.terrain.stencilModeForRTTOverlap(z):w[z.overscaledZ];Wp(h,z,L,s,k,G,B)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,s,d,_,y){if(h.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const w=h.transform.projection.name==="globe",C=s.paint.get("raster-elevation")!==0,z=C&&w;if(h.renderElevatedRasterBackface&&!z)return;const L=h.context,k=L.gl,N=t.getSource(),B=function(fe,pe,de,be){const Ie=pe.paint.get("raster-color"),He=fe.type==="raster-array",Ve=[],Ee=pe.paint.get("raster-resampling"),Re=pe.paint.get("raster-color-mix");let et=pe.paint.get("raster-color-range");const ot=[Re[0],Re[1],Re[2],0],ft=Re[3];let Ne=Ee==="nearest"?be.NEAREST:be.LINEAR;if(He&&(Ve.push("RASTER_ARRAY"),Ie||Ve.push("RASTER_COLOR"),Ee==="linear"&&Ve.push("RASTER_ARRAY_LINEAR"),Ne=be.NEAREST,!et&&fe.rasterLayers)){const nt=fe.rasterLayers.find(({id:$e})=>$e===pe.sourceLayer);nt&&nt.fields&&nt.fields.range&&(et=nt.fields.range)}if(et=et||[0,1],Ie){Ve.push("RASTER_COLOR"),de.activeTexture.set(be.TEXTURE2),pe.updateColorRamp(et);let nt=pe.colorRampTexture;nt||(nt=pe.colorRampTexture=new i.T(de,pe.colorRamp,be.RGBA8)),nt.bind(be.LINEAR,be.CLAMP_TO_EDGE)}return{mix:ot,range:et,offset:ft,defines:Ve,resampling:Ne}}(N,s,L,k);if(N instanceof i.aJ&&!d.length&&!w)return;const G=s.paint.get("raster-emissive-strength"),Y=h.colorModeForDrapableLayerRenderPass(G),X=h.terrain&&h.terrain.renderingToTexture,J=!h.options.moving,Q=s.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(N instanceof i.aJ&&!d.length&&(N.onNorthPole||N.onSouthPole)){const fe=C?h.stencilModeFor3D():hi.disabled;return void Dt(!!N.onNorthPole,null,h,t,s,G,B,ni.disabled,fe)}if(!d.length)return;const[re,ue]=N instanceof i.aJ||X?[{},d]:h.stencilConfigForOverlap(d),le=ue[ue.length-1].overscaledZ;z&&B.defines.push("PROJECTION_GLOBE_VIEW"),C&&B.defines.push("RENDER_CUTOFF");const _e=(fe,pe,de)=>{for(const be of fe){const Ie=be.toUnwrapped(),He=t.getTile(be);if(X&&(!He||!He.hasData()))continue;L.activeTexture.set(k.TEXTURE0);const Ve=Mn(He,N,s,B);if(!Ve||!Ve.texture)continue;const{texture:Ee,mix:Re,offset:et,tileSize:ot,buffer:ft}=Ve;let Ne,nt;X?(Ne=$t.disabled,nt=be.projMatrix):C?(Ne=new $t(k.LEQUAL,$t.ReadWrite,h.depthRangeFor3D),nt=w?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(Ie,J)):(Ne=h.depthModeForSublayer(be.overscaledZ-le,s.paint.get("raster-opacity")===1?$t.ReadWrite:$t.ReadOnly,k.LESS),nt=h.transform.calculateProjMatrix(Ie,J));const $e=h.terrain&&X?h.terrain.stencilModeForRTTOverlap(be):re[be.overscaledZ],ut=y?0:s.paint.get("raster-fade-duration");He.registerFadeDuration(ut);const st=t.findLoadedParent(be,0),tt=hl(He,st,t,h.transform,ut);let wt,Et;h.terrain&&h.terrain.prepareDrawTile(),L.activeTexture.set(k.TEXTURE0),Ee.bind(Q,k.CLAMP_TO_EDGE),L.activeTexture.set(k.TEXTURE1),st?(st.texture&&st.texture.bind(Q,k.CLAMP_TO_EDGE),wt=Math.pow(2,st.tileID.overscaledZ-He.tileID.overscaledZ),Et=[He.tileID.canonical.x*wt%1,He.tileID.canonical.y*wt%1]):Ee.bind(Q,k.CLAMP_TO_EDGE),Ee.useMipmap&&L.extTextureFilterAnisotropic&&h.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const gt=h.transform;let Rt;const oi=C?gl(gt):[0,0,0,0];let Zt,Wt,ai,Pi,yi,gn=0;if(z&&N instanceof i.aJ&&N.coordinates.length>3)Zt=Float32Array.from(i.bb(i.cH(new i.bT(0,0,0)))),Wt=Float32Array.from(gt.globeMatrix),ai=Float32Array.from(i.cD(gt)),Pi=[i.at(gt.center.lng),i.aA(gt.center.lat)],Rt=N.elevatedGlobePerspectiveTransform,yi=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(z){const xi=i.cE(be.canonical);gn=i.cF(xi.getCenter().lat),Zt=Float32Array.from(i.bb(i.cH(be.canonical))),Wt=Float32Array.from(gt.globeMatrix),ai=Float32Array.from(i.cD(gt)),Pi=[i.at(gt.center.lng),i.aA(gt.center.lat)],Rt=[0,0],yi=Float32Array.from(i.cG(be.canonical,xi,gn,gt.worldSize/gt._pixelsPerMercatorPixel))}else Rt=N instanceof i.aJ?N.perspectiveTransform:[0,0],Zt=new Float32Array(16),Wt=new Float32Array(9),ai=new Float32Array(16),Pi=[0,0],yi=new Float32Array(9);const an=Ot(nt,Zt,Wt,ai,yi,Et||[0,0],i.ae(h.transform.zoom),Pi,oi,wt||1,tt,s,Rt,C?s.paint.get("raster-elevation"):0,2,Re,et,B.range,ot,ft,G),Hi=h.isTileAffectedByFog(be),Yi=h.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Hi});if(h.uploadCommonUniforms(L,Yi,Ie),N instanceof i.aJ){const xi=N.elevatedGlobeVertexBuffer,zi=N.elevatedGlobeIndexBuffer;if(X||!w)N.boundsBuffer&&N.boundsSegments&&Yi.draw(h,k.TRIANGLES,Ne,hi.disabled,Y,ni.disabled,an,s.id,N.boundsBuffer,h.quadTriangleIndexBuffer,N.boundsSegments);else if(xi&&zi){const ei=gt.zoom<=i.c6?N.elevatedGlobeSegments:N.getSegmentsForLongitude(gt.center.lng);ei&&Yi.draw(h,k.TRIANGLES,Ne,hi.disabled,Y,pe,an,s.id,xi,zi,ei)}}else if(z){Ne=new $t(k.LEQUAL,$t.ReadOnly,h.depthRangeFor3D);const xi=h.globeSharedBuffers;if(xi){const[zi,ei,Vi]=xi.getGridBuffers(gn,!1);Yi.draw(h,k.TRIANGLES,Ne,de||$e,h.colorModeForRenderPass(),pe,an,s.id,zi,ei,Vi)}}else{const{tileBoundsBuffer:xi,tileBoundsIndexBuffer:zi,tileBoundsSegments:ei}=h.getTileBoundsBuffers(He);Yi.draw(h,k.TRIANGLES,Ne,$e,Y,ni.disabled,an,s.id,xi,zi,ei)}}if(!(N instanceof i.aJ)&&z)for(const be of fe){const Ie=be.canonical.y===(1<<be.canonical.z)-1;be.canonical.y===0&&Dt(!0,be,h,t,s,G,B,pe,de||hi.disabled),Ie&&Dt(!1,be,h,t,s,G,B,pe===ni.frontCW?ni.backCW:ni.frontCW,de||hi.disabled)}};z?_e(ue,h.renderElevatedRasterBackface?ni.backCW:ni.frontCW,h.stencilModeFor3D()):_e(ue,ni.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,s,d,_,y){h.renderPass==="offscreen"&&function(w,C,z,L){if(!L.length)return;const k=w.context,N=k.gl,B=C.getSource();if(!(B instanceof ro))return;const G=Math.ceil(Math.sqrt(z.paint.get("raster-particle-count")));let Y=z.particlePositionRGBAImage;if(!Y||Y.width!==G){const ue=function(le){const _e=le*le,fe=new Uint8Array(4*_e),pe=function(be){return be|=0,be=Math.imul(2747636419^be,2654435769),be=Math.imul(be^be>>>16,2654435769),((be=Math.imul(be^be>>>16,2654435769))>>>0)/4294967296},de=1/1.1;for(let be=0;be<_e;be++){const Ie=de*(pe(2*be+0)+ba),He=de*(pe(2*be+1)+ba),Ve=255*Ie%1,Ee=255*He%1,Re=Ve,et=He-Ee/255,ot=Ee;fe[4*be+0]=255*(Ie-Ve/255),fe[4*be+1]=255*Re,fe[4*be+2]=255*et,fe[4*be+3]=255*ot}return fe}(G);Y=z.particlePositionRGBAImage=new i.r({width:G,height:G},ue)}let X=z.particleFramebuffer;X?X.width!==G&&(X.destroy(),X=z.particleFramebuffer=k.createFramebuffer(G,G,!0,null)):X=z.particleFramebuffer=k.createFramebuffer(G,G,!0,null);const J=[];for(const ue of L){const le=C.getTile(ue);if(!(le instanceof _u))continue;const _e=th(le,B,z);if(!_e)continue;const fe=[le.tileSize,le.tileSize];let pe=z.tileFramebuffer;pe||(pe=z.tileFramebuffer=k.createFramebuffer(fe[0],fe[1],!0,null));let de=le.rasterParticleState;de||(de=le.rasterParticleState=new mm(k,ue,fe,Y));const be=de.update(z.lastInvalidatedAt);de.particleTextureDimension!==G&&de.updateParticleTexture(ue,Y);const Ie=de.targetColorTexture;de.targetColorTexture=de.backgroundColorTexture,de.backgroundColorTexture=Ie;const He=de.particleTexture0;de.particleTexture0=de.particleTexture1,de.particleTexture1=He,J.push([ue,_e,de,be])}if(J.length===0)return;const Q=i.q.now(),re=z.previousDrawTimestamp?.001*(Q-z.previousDrawTimestamp):.0167;if(z.previousDrawTimestamp=Q,z.hasColorMap()){k.activeTexture.set(N.TEXTURE0+2);let ue=z.colorRampTexture;ue||(ue=z.colorRampTexture=new i.T(k,z.colorRamp,N.RGBA8)),ue.bind(N.LINEAR,N.CLAMP_TO_EDGE)}k.bindFramebuffer.set(z.tileFramebuffer.framebuffer),function(ue,le,_e){const fe=ue.context,pe=fe.gl,de=le.tileFramebuffer;fe.activeTexture.set(pe.TEXTURE0);const be={u_texture:0,u_opacity:1.05*(He=le.paint.get("raster-particle-fade-opacity-factor"))/(He+.05)},Ie=ue.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var He;for(const Ve of _e){const[,,Ee,Re]=Ve;de.colorAttachment.set(Ee.targetColorTexture.texture),fe.viewport.set([0,0,de.width,de.height]),fe.clear({color:i.aj.transparent}),Re&&(Ee.backgroundColorTexture.bind(pe.NEAREST,pe.CLAMP_TO_EDGE),Ie.draw(ue,pe.TRIANGLES,$t.disabled,hi.disabled,bi.alphaBlended,ni.disabled,be,le.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments))}}(w,z,J),function(ue,le,_e,fe){const pe=ue.context,de=pe.gl,be=_e.tileFramebuffer,Ie=ue.transform.projection.name==="globe",He=_e.paint.get("raster-particle-max-speed");for(const Ve of fe){const[Ee,Re,et]=Ve;pe.activeTexture.set(de.TEXTURE0+0),Re.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE),be.colorAttachment.set(et.targetColorTexture.texture);const ot=ue.getOrCreateProgram("rasterParticleDraw",{defines:Re.defines,overrideFog:!1});pe.activeTexture.set(de.TEXTURE0+1);const ft=Re.scalarData?[]:[0,1,2,3].map($e=>i.d4[$e](Ee));ft.push(Ee);const Ne=Ee.canonical.x,nt=Ee.canonical.y;for(const $e of ft){const ut=le.getTile(Ie?$e.wrapped():$e);if(!ut)continue;const st=ut.rasterParticleState;if(!st)continue;const tt=$e.canonical.x+(1<<$e.canonical.z)*($e.wrap-Ee.wrap),wt=$e.canonical.y;st.particleTexture0.bind(de.NEAREST,de.CLAMP_TO_EDGE);const Et=Ta(1,st.particleTexture0.size[0],[tt-Ne,wt-nt],0,Re.texture.size,2,He,Re.textureOffset,Re.scale,Re.offset);ot.draw(ue,de.POINTS,$t.disabled,hi.disabled,bi.alphaBlended,ni.disabled,Et,_e.id,st.particleIndexBuffer,void 0,st.particleSegment)}}}(w,C,z,J),k.bindFramebuffer.set(z.particleFramebuffer.framebuffer),function(ue,le,_e,fe){const pe=ue.context,de=pe.gl,be=le.paint.get("raster-particle-max-speed"),Ie=fe*le.paint.get("raster-particle-speed-factor")*.15,He=function(Ee){return Math.pow(Ee,6)}(.01+1*le.paint.get("raster-particle-reset-rate-factor")),Ve=le.particleFramebuffer;pe.viewport.set([0,0,Ve.width,Ve.height]);for(const Ee of _e){const[,Re,et]=Ee;pe.activeTexture.set(de.TEXTURE0+0),Re.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE),pe.activeTexture.set(de.TEXTURE0+1);const ot=et.particleTexture0;ot.bind(de.NEAREST,de.CLAMP_TO_EDGE);const ft=Ht(1,ot.size[0],0,Re.texture.size,be,Ie,He,Re.textureOffset,Re.scale,Re.offset);Ve.colorAttachment.set(et.particleTexture1.texture),pe.clear({color:i.aj.transparent}),ue.getOrCreateProgram("rasterParticleUpdate",{defines:Re.defines}).draw(ue,de.TRIANGLES,$t.disabled,hi.disabled,bi.unblended,ni.disabled,ft,le.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments)}}(w,z,J,re)}(h,t,s,d),h.renderPass==="translucent"&&(function(w,C,z,L,k){const N=w.context,B=N.gl,G=C.getSource().tileSize,Y=5*(1-i.ac(i.bY,i.bY+1,w.transform.zoom))*G+z.paint.get("raster-particle-elevation"),X=!w.options.moving,J=w.transform.projection.name==="globe";if(!L.length)return;const[Q,re]=w.stencilConfigForOverlap(L),ue=[];J&&ue.push("PROJECTION_GLOBE_VIEW");const le=w.stencilModeFor3D();for(const _e of re){const fe=_e.toUnwrapped(),pe=C.getTile(_e);if(!pe.rasterParticleState)continue;const de=pe.rasterParticleState,be=100;pe.registerFadeDuration(be);const Ie=C.findLoadedParent(_e,0),He=hl(pe,Ie,C,w.transform,be);let Ve,Ee;w.terrain&&w.terrain.prepareDrawTile(),N.activeTexture.set(B.TEXTURE0),de.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),N.activeTexture.set(B.TEXTURE1),Ie&&Ie.rasterParticleState?(Ie.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ve=Math.pow(2,Ie.tileID.overscaledZ-pe.tileID.overscaledZ),Ee=[pe.tileID.canonical.x*Ve%1,pe.tileID.canonical.y*Ve%1]):de.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Re=J?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(fe,X),et=w.transform,ot=Rd(et),ft=i.cE(_e.canonical),Ne=i.cF(ft.getCenter().lat);let nt,$e,ut,st,tt;J?(nt=Float32Array.from(i.bb(i.cH(_e.canonical))),$e=Float32Array.from(et.globeMatrix),ut=Float32Array.from(i.cD(et)),st=[i.at(et.center.lng),i.aA(et.center.lat)],tt=Float32Array.from(i.cG(_e.canonical,ft,Ne,et.worldSize/et._pixelsPerMercatorPixel))):(nt=new Float32Array(16),$e=new Float32Array(9),ut=new Float32Array(16),st=[0,0],tt=new Float32Array(9));const wt=wa(Re,nt,$e,ut,tt,Ee||[0,0],i.ae(w.transform.zoom),st,ot,Ve||1,He,Y),Et=w.isTileAffectedByFog(_e),gt=w.getOrCreateProgram("rasterParticle",{defines:ue,overrideFog:Et});if(w.uploadCommonUniforms(N,gt,fe),J){const Rt=new $t(B.LEQUAL,$t.ReadOnly,w.depthRangeFor3D),oi=0,Zt=w.globeSharedBuffers;if(Zt){const[Wt,ai,Pi]=Zt.getGridBuffers(Ne,oi!==0);gt.draw(w,B.TRIANGLES,Rt,le,bi.alphaBlended,w.renderElevatedRasterBackface?ni.frontCCW:ni.backCCW,wt,z.id,Wt,ai,Pi)}}else{const Rt=w.depthModeForSublayer(0,$t.ReadOnly),oi=Q[_e.overscaledZ],{tileBoundsBuffer:Zt,tileBoundsIndexBuffer:Wt,tileBoundsSegments:ai}=w.getTileBoundsBuffers(pe);gt.draw(w,B.TRIANGLES,Rt,oi,bi.alphaBlended,ni.disabled,wt,z.id,Zt,Wt,ai)}}w.resetStencilClippingMasks()}(h,t,s,d),h.style.map.triggerRepaint())},background:function(h,t,s,d){const _=s.paint.get("background-color"),y=s.paint.get("background-color-use-theme").constantOr("default")==="none",w=s.paint.get("background-opacity"),C=s.paint.get("background-emissive-strength"),z=s.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const L=h.context,k=L.gl,N=h.transform,B=N.tileSize,G=s.paint.get("background-pattern");let Y;if(G!==void 0&&(G===null||(Y=h.imageManager.getPattern(G.toString(),s.scope,h.style.getLut(s.scope)),!Y)))return;const X=!G&&_.a===1&&w===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==X)return;const J=hi.disabled,Q=h.depthModeForSublayer(0,X==="opaque"?$t.ReadWrite:$t.ReadOnly),re=h.colorModeForDrapableLayerRenderPass(C),ue=G?"backgroundPattern":"background";let le,_e=d;if(_e||(le=h.getBackgroundTiles(),_e=Object.values(le).map(fe=>fe.tileID)),G&&(L.activeTexture.set(k.TEXTURE0),h.imageManager.bind(h.context,s.scope)),z){const fe=h.getOrCreateProgram(ue,{overrideFog:!1,overrideRtt:!0}),pe=new Float32Array(i.ab.mat4.identity([])),de=new i.aG(0,0,0,0,0),be=G?Yu(pe,C,w,h,0,s.scope,Y,z,{tileID:de,tileSize:B}):um(pe,C,w,_.toRenderColor(y?null:s.lut));fe.draw(h,k.TRIANGLES,Q,J,re,ni.disabled,be,s.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const fe of _e){const pe=h.isTileAffectedByFog(fe),de=h.getOrCreateProgram(ue,{overrideFog:pe}),be=fe.toUnwrapped(),Ie=d?fe.projMatrix:h.transform.calculateProjMatrix(be);h.prepareDrawTile();const He=t?t.getTile(fe):le?le[fe.key]:new Oo(fe,B,N.zoom,h),Ve=G?Yu(Ie,C,w,h,0,s.scope,Y,z,{tileID:fe,tileSize:B}):um(Ie,C,w,_.toRenderColor(y?null:s.lut));h.uploadCommonUniforms(L,de,be);const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:Re,tileBoundsSegments:et}=h.getTileBoundsBuffers(He);de.draw(h,k.TRIANGLES,Q,J,re,ni.disabled,Ve,s.id,Ee,Re,et)}},sky:function(h,t,s){const d=h._atmosphere?i.ae(h.transform.zoom):1,_=s.paint.get("sky-opacity")*d;if(_===0)return;const y=h.context,w=s.paint.get("sky-type"),C=new $t(y.gl.LEQUAL,$t.ReadOnly,[0,1]),z=h.frameCounter/1e3%1;w==="atmosphere"?h.renderPass==="offscreen"?s.needsSkyboxCapture(h)&&(function(L,k,N,B){const G=L.context,Y=G.gl;let X=k.skyboxFbo;if(!X){X=k.skyboxFbo=G.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new Mc(G),k.skyboxTexture=G.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,k.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let ue=0;ue<6;++ue)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(X.framebuffer),G.viewport.set([0,0,32,32]);const J=k.getCenter(L,!0),Q=L.getOrCreateProgram("skyboxCapture"),re=new Float64Array(16);i.ab.mat4.identity(re),i.ab.mat4.rotateY(re,re,.5*-Math.PI),Br(L,k,Q,re,J,0),i.ab.mat4.identity(re),i.ab.mat4.rotateY(re,re,.5*Math.PI),Br(L,k,Q,re,J,1),i.ab.mat4.identity(re),i.ab.mat4.rotateX(re,re,.5*-Math.PI),Br(L,k,Q,re,J,2),i.ab.mat4.identity(re),i.ab.mat4.rotateX(re,re,.5*Math.PI),Br(L,k,Q,re,J,3),i.ab.mat4.identity(re),Br(L,k,Q,re,J,4),i.ab.mat4.identity(re),i.ab.mat4.rotateY(re,re,Math.PI),Br(L,k,Q,re,J,5),G.viewport.set([0,0,L.width,L.height])}(h,s),s.markSkyboxValid(h)):h.renderPass==="sky"&&function(L,k,N,B,G){const Y=L.context,X=Y.gl,J=L.transform,Q=L.getOrCreateProgram("skybox");Y.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,k.skyboxTexture);const re=((ue,le,_e,fe,pe)=>({u_matrix:ue,u_sun_direction:le,u_cubemap:0,u_opacity:fe,u_temporal_offset:pe}))(J.skyboxMatrix,k.getCenter(L,!1),0,B,G);L.uploadCommonUniforms(Y,Q),Q.draw(L,X.TRIANGLES,N,hi.disabled,L.colorModeForRenderPass(),ni.backCW,re,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(h,s,C,_,z):w==="gradient"&&h.renderPass==="sky"&&function(L,k,N,B,G){const Y=L.context,X=Y.gl,J=L.transform,Q=L.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new Mc(Y)),Y.activeTexture.set(X.TEXTURE0);let re=k.colorRampTexture;re||(re=k.colorRampTexture=new i.T(Y,k.colorRamp,X.RGBA8)),re.bind(X.LINEAR,X.CLAMP_TO_EDGE);const ue=((le,_e,fe,pe,de)=>({u_matrix:le,u_color_ramp:0,u_center_direction:_e,u_radius:i.ai(fe),u_opacity:pe,u_temporal_offset:de}))(J.skyboxMatrix,k.getCenter(L,!1),k.paint.get("sky-gradient-radius"),B,G);L.uploadCommonUniforms(Y,Q),Q.draw(L,X.TRIANGLES,N,hi.disabled,L.colorModeForRenderPass(),ni.backCW,ue,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(h,s,C,_,z)},debug:function(h,t,s,d,_,y){for(let w=0;w<s.length;w++)if(_){const L=new i.aj(d.r*.8,d.g*.8,d.b*.8,1);xl(h,t,s[w],d,-1,-1,y),xl(h,t,s[w],d,-1,1,y),xl(h,t,s[w],d,1,1,y),xl(h,t,s[w],d,1,-1,y),xl(h,t,s[w],L,0,0,y)}else xl(h,t,s[w],d,0,0,y)},custom:function(h,t,s,d){const _=h.context,y=s.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&s.isDraped(t)){if(h.renderPass==="offscreen"){const w=y.prerender;if(w){if(h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const C=h.transform.pointMerc;w.call(y,_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),i.ae(h.transform.zoom),[C.x,C.y],h.transform.pixelsPerMeterRatio)}else w.call(y,_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const C=y.renderToTile;if(C){const z=d[0].canonical,L=new i.aa(z.x+d[0].wrap*(1<<z.z),z.y,z.z);_.setDepthMode($t.disabled),_.setStencilMode(hi.disabled),_.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),C.call(y,_.gl,L),_.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),_.setStencilMode(hi.disabled);const w=y.renderingMode==="3d"?new $t(h.context.gl.LEQUAL,$t.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,$t.ReadOnly);if(_.setDepthMode(w),h.transform.projection.name==="globe"){const C=h.transform.pointMerc;y.render(_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),i.ae(h.transform.zoom),[C.x,C.y],h.transform.pixelsPerMeterRatio)}else y.render(_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState(),_.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,s,d){if(h.renderPass==="opaque")return;const _=s.paint.get("model-opacity").constantOr(1);if(_===0)return;const y=s.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!y||h.terrain&&_<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof i.a9))return;const w=h.shadowRenderer,C=s.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,C||(w.enabled=!1));const z=()=>{w&&(w.useNormalOffset=!0,C||(w.enabled=!0))},L=t.getSource();if(h.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(Q,re,ue,le,_e){const fe=Q.transform;if(fe.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${fe.projection.name} projection is not yet implemented`);const pe=fe.getFreeCameraOptions().position;if(!Q.modelManager)return;const de=Q.modelManager;ue.modelManager=de;const be=Q.shadowRenderer;if(!ue._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ie=ue._unevaluatedLayout._values["model-id"],He={...ue.layout.get("model-id").parameters},Ve=Q.style.order.indexOf(ue.fqid);for(const Ee of le){const Re=re.getTile(Ee).getBucket(ue);if(!Re||Re.projection.name!==fe.projection.name)continue;const et=Re.getModelUris();et&&!Re.modelsRequested&&(de.addModelsFromBucket(et,_e),Re.modelsRequested=!0);const ot=kd(Ee,fe);He.zoom=ot;const ft=Ie.possiblyEvaluate(He);if(wl(Q,Re,Ee),vs.shadowUniformsInitialized=!1,vs.useSingleShadowCascade=!!be&&be.getMaxCascadeForTile(Ee.toUnwrapped())===0,Q.renderPass==="shadow"&&be){if(Q.currentShadowCascade===1&&Re.isInsideFirstShadowMapFrustum)continue;const $e=fe.calculatePosMatrix(Ee.toUnwrapped(),fe.worldSize);if(vs.tileMatrix.set($e),vs.shadowTileMatrix=Float32Array.from(be.calculateShadowPassMatrixFromMatrix($e)),vs.aabb.min.fill(0),vs.aabb.max[0]=vs.aabb.max[1]=i.ag,vs.aabb.max[2]=0,Ho(Re,vs,Q,ue.scope))continue}const Ne=1<<Ee.canonical.z,nt=[((pe.x-Ee.wrap)*Ne-Ee.canonical.x)*i.ag,(pe.y*Ne-Ee.canonical.y)*i.ag,pe.z*Ne*i.ag];Q.conflationActive&&Object.keys(Re.instancesPerModel).length>0&&Q.style.isLayerClipped(ue,re.getSource())&&Re.updateReplacement(Ee,Q.replacementSource,Ve,_e)&&(Re.uploaded=!1,Re.upload(Q.context));for(let $e in Re.instancesPerModel){const ut=Re.instancesPerModel[$e];ut.features.length>0&&($e=ft.evaluate(ut.features[0].feature,{}));const st=de.getModel($e,_e);if(st&&st.uploaded)for(const tt of st.nodes)_o(Q,ue,tt,ut,nt,Ee,vs)}}}(h,t,s,d,L.type==="vector"?s.scope:""),void z();if(!L.loaded())return;if(L.type==="batched-model")return function(Q,re,ue,le){ue.resetLayerRenderingStats(Q);const _e=Q.context,fe=Q.transform,pe=Q.style.fog,de=Q.shadowRenderer;if(fe.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${fe.projection.name} projection is not yet implemented`);const be=Q.transform.getFreeCameraOptions().position,Ie=i.ab.vec3.scale([],[be.x,be.y,be.z],Q.transform.worldSize),He=i.ab.vec3.negate([],Ie),Ve=i.ab.mat4.identity([]),Ee=i.dj(fe.center.lat,fe.zoom),Re=i.ab.mat4.fromScaling([],[1,1,1/Ee]);i.ab.mat4.translate(Ve,Ve,He);const et=ue.paint.get("model-opacity").constantOr(1),ot=new $t(_e.gl.LEQUAL,$t.ReadWrite,Q.depthRangeFor3D),ft=new $t(_e.gl.LEQUAL,$t.ReadOnly,Q.depthRangeFor3D),Ne=new i.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),nt=Q.renderPass==="shadow",$e=nt&&de?de.getCurrentCascadeFrustum():fe.getFrustum(fe.scaleZoom(fe.worldSize)),ut=ue.paint.get("model-front-cutoff"),st=ut[2]<1,tt=uo(Q,ue.paint.get("model-cutoff-fade-range")),wt=ue.getLayerRenderingStats();(function(Et,gt,Rt,oi){const Zt=Et.terrain?Et.terrain.exaggeration():0,Wt=Et.transform.zoom;for(const ai of oi){const Pi=gt.getTile(ai).getBucket(Rt);Pi&&(Et.conflationActive&&Pi.updateReplacement(ai,Et.replacementSource),Pi.evaluateScale(Et,Rt),Et.terrain&&Zt>0&&Pi.elevationUpdate(Et.terrain,Zt,ai,Rt.source),Pi.needsReEvaluation(Et,Wt,Rt)&&Pi.evaluate(Rt))}})(Q,re,ue,le),function(){let Et,gt,Rt;st?(Et=le.length-1,gt=-1,Rt=-1):(Et=0,gt=le.length,Rt=1);const oi=new Float64Array(16),Zt=i.ab.vec3.create(),Wt=new i.P(0,0);for(let ai=Et;ai!==gt;ai+=Rt){const Pi=le[ai],yi=re.getTile(Pi).getBucket(ue);if(!yi||!yi.uploaded)continue;let gn=!1;de&&(gn=de.getMaxCascadeForTile(Pi.toUnwrapped())===0);const an=fe.calculatePosMatrix(Pi.toUnwrapped(),fe.worldSize),Hi=yi.modelTraits;!nt&&st&&(i.ab.mat4.invert(oi,an),i.ab.vec3.transformMat4(Zt,Ie,oi),Wt.x=Zt[0],Wt.y=Zt[1]);const Yi=[];for(const xi of yi.getNodesInfo()){if(xi.hiddenByReplacement||!xi.node.meshes)continue;const zi=xi.node;let ei=0;Q.terrain&&zi.elevation&&(ei=zi.elevation*Q.terrain.exaggeration());const Vi=(()=>{const Ri=xi.aabb;return Ne.min=[...Ri.min],Ne.max=[...Ri.max],Ne.min[2]+=ei,Ne.max[2]+=ei,i.ab.vec3.transformMat4(Ne.min,Ne.min,an),i.ab.vec3.transformMat4(Ne.max,Ne.max,an),Ne})(),Tn=xi.evaluatedScale;if(Tn[0]<=1&&Tn[1]<=1&&Tn[2]<=1&&Vi.intersects($e)===0)continue;if(!nt&&st){const Ri=.16666666666666666;xi.cameraCollisionOpacity=Ie[0]>Vi.min[0]&&Ie[0]<Vi.max[0]&&Ie[1]>Vi.min[1]&&Ie[1]<Vi.max[1]&&Ie[2]*Ee<Vi.max[2]&&zi.footprint&&i.bA(Wt,zi.footprint)?Math.max(xi.cameraCollisionOpacity-Ri,0):Math.min(1,xi.cameraCollisionOpacity+Ri)}const dr=[...an],Kr=zi.anchor?zi.anchor[0]:0,Er=zi.anchor?zi.anchor[1]:0;i.ab.mat4.translate(dr,dr,[Kr*(Tn[0]-1),Er*(Tn[1]-1),ei]),i.ab.vec3.exactEquals(Tn,i.dm)||i.ab.mat4.scale(dr,dr,Tn);const nr=i.ab.mat4.multiply([],dr,zi.matrix),Nn=i.ab.mat4.multiply([],fe.expandedFarZProjMatrix,nr),Rn=i.ab.mat4.multiply([],fe.expandedFarZProjMatrix,dr),fn=i.ab.vec4.transformMat4([],[Kr,Er,ei,1],Nn)[2];zi.hidden=!1;let rn=et;nt||(st&&(rn*=xi.cameraCollisionOpacity,rn*=nh(dr,fe,xi.aabb,ut)),rn*=ih(tt,fn)),rn!==0?Yi.push({nodeInfo:xi,depth:fn,opacity:rn,wvpForNode:Nn,wvpForTile:Rn,nodeModelMatrix:nr,tileModelMatrix:dr}):zi.hidden=!0}nt||Yi.sort((xi,zi)=>!st||xi.opacity===1&&zi.opacity===1?xi.depth<zi.depth?-1:1:xi.opacity===1?-1:zi.opacity===1?1:xi.depth>zi.depth?-1:1);for(const xi of Yi){const zi=xi.nodeInfo,ei=zi.node;let Vi=i.ab.mat4.multiply([],Re,xi.tileModelMatrix);i.ab.mat4.multiply(Vi,Ve,Vi);const Tn=i.ab.mat4.invert([],Vi);i.ab.mat4.transpose(Tn,Tn),i.ab.mat4.scale(Tn,Tn,Go),Vi=i.ab.mat4.multiply(Vi,Vi,ei.matrix);const dr=Q.renderPass==="light-beam",Kr=ue.paint.get("model-color-use-theme").constantOr("default")==="none",Er=Hi&i.dp.HasMapboxMeshFeatures,nr=Er?0:zi.evaluatedRMEA[0][2];for(let Nn=0;Nn<ei.meshes.length;++Nn){const Rn=ei.meshes[Nn],fn=Nn===ei.lightMeshIndex;let rn=xi.wvpForNode;if(fn){if(!dr&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}rn=xi.wvpForTile}else if(dr)continue;const Ri={defines:[]},An=[];if(!nt&&de&&(de.useNormalOffset=!!Rn.normalBuffer),Ni(Ri.defines,An,Rn,Q,Kr?null:ue.lut),Er||Ri.defines.push("DIFFUSE_SHADED"),gn&&Ri.defines.push("SHADOWS_SINGLE_CASCADE"),wt&&(nt?wt.numRenderedVerticesInShadowPass+=Rn.vertexArray.length:wt.numRenderedVerticesInTransparentPass+=Rn.vertexArray.length),nt){bl(Rn,xi.nodeModelMatrix,Q,ue);continue}let rr=null;if(pe){const eo=dn(xi.nodeModelMatrix,Q.transform);if(rr=new Float32Array(eo),fe.projection.name!=="globe"){const Ar=Rn.aabb.min,cs=Rn.aabb.max,[bo,Os]=pe.getOpacityForBounds(eo,Ar[0],Ar[1],cs[0],cs[1]);Ri.overrideFog=bo>=zt||Os>=zt}}const ln=Rn.material;let br;ln.occlusionTexture&&ln.occlusionTexture.offsetScale&&(br=ln.occlusionTexture.offsetScale,Ri.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ls=Q.getOrCreateProgram("model",Ri);!nt&&de&&de.setupShadowsFromMatrix(xi.tileModelMatrix,ls,de.useNormalOffset),Q.uploadCommonUniforms(_e,ls,null,rr);const Vr=ln.pbrMetallicRoughness;Vr.metallicFactor=.9,Vr.roughnessFactor=.5;const vo=Ju(new Float32Array(rn),new Float32Array(Vi),new Float32Array(Tn),new Float32Array(ei.matrix),Q,xi.opacity,Vr.baseColorFactor.toRenderColor(null),ln.emissiveFactor,Vr.metallicFactor,Vr.roughnessFactor,ln,nr,ue,[0,0,0],br);!fn&&(zi.hasTranslucentParts||xi.opacity<1)&&ls.draw(Q,_e.gl.TRIANGLES,ot,hi.disabled,bi.disabled,ni.backCCW,vo,ue.id,Rn.vertexBuffer,Rn.indexBuffer,Rn.segments,ue.paint,Q.transform.zoom,void 0,An),ls.draw(Q,_e.gl.TRIANGLES,fn?ft:ot,hi.disabled,fn||xi.opacity<1||zi.hasTranslucentParts?bi.alphaBlended:bi.unblended,ni.backCCW,vo,ue.id,Rn.vertexBuffer,Rn.indexBuffer,Rn.segments,ue.paint,Q.transform.zoom,void 0,An)}}}}()}(h,t,s,d),void z();if(L.type!=="model")return;const k=L.getModels(),N=[],B=h.transform.getFreeCameraOptions().position,G=i.ab.vec3.scale([],[B.x,B.y,B.z],h.transform.worldSize);i.ab.vec3.negate(G,G);const Y=[],X=[];let J=0;for(const Q of k){const re=s.paint.get("model-rotation").constantOr(null),ue=s.paint.get("model-scale").constantOr(null),le=s.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(h,re,ue,le,!0,!0,!1);const _e=i.ab.mat4.identity([]),fe=i.dj(Q.position.lat,h.transform.zoom),pe=i.ab.mat4.fromScaling([],[1,1,1/fe]);i.ab.mat4.translate(_e,_e,G),N.push({zScaleMatrix:pe,negCameraPosMatrix:_e});for(const de of Q.nodes)mo(h.transform,de,Q.matrix,h.transform.expandedFarZProjMatrix,J,Y,X);J++}if(Y.sort((Q,re)=>re.depth-Q.depth),h.renderPass!=="shadow"){if(_===1)for(const Q of X)Ac(Q,h,s,N[Q.modelIndex],hi.disabled,h.colorModeForRenderPass());else{for(const Q of X)Ac(Q,h,s,N[Q.modelIndex],hi.disabled,bi.disabled);for(const Q of X)Ac(Q,h,s,N[Q.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const Q of Y)Ac(Q,h,s,N[Q.modelIndex],hi.disabled,h.colorModeForRenderPass());z()}else{for(const Q of X)bl(Q.mesh,Q.nodeModelMatrix,h,s);for(const Q of Y)bl(Q.mesh,Q.nodeModelMatrix,h,s);z()}}},oh={model:function(h,t,s){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,d.type==="vector"?h.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const _=d.getModels();for(const y of _)y.upload(s.context)},raster:function(h,t,s){const d=t.getSource();if(!(d instanceof ro&&d.loaded()))return;const _=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const y=h.paint.get("raster-array-band")||d.getInitialBand(_);if(y==null)return;const w=t.getIds().map(C=>t.getTileByID(C));for(const C of w)C.updateNeeded(_,y)&&d.prepareTile(C,_,y)},"raster-particle":function(h,t,s){const d=t.getSource();if(!(d instanceof ro&&d.loaded()))return;const _=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const y=h.paint.get("raster-particle-array-band")||d.getInitialBand(_);if(y==null)return;const w=t.getIds().map(C=>t.getTileByID(C));for(const C of w)C.updateNeeded(_,y)&&d.prepareTile(C,_,y)}};class qd{constructor(t,s,d,_,y){this.context=new $r(t,s),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const z of w)this._debugParams.enabledLayers[z]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const z of w)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],z);this.occlusionParams=new Bd(y),this.setup(),this.numSublayers=_s.maxUnderzooming+_s.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ho(this),this._wireframeDebugCache=new Fd,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,C,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_}updateTerrain(t,s){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Gu(this,t));const _=this._terrain;this.transform.elevation=d?_:null,_.update(t,this.transform,s),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,_]=s.getFovAdjustedRange(this.transform._fov);if(d>_)return void(this.transform.fogCullDistSq=null);const y=d+.78*(_-d);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Gu(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*i.q.devicePixelRatio,this.height=s*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,s=new i.b4;s.emplaceBack(0,0),s.emplaceBack(i.ag,0),s.emplaceBack(0,i.ag),s.emplaceBack(i.ag,i.ag),this.tileExtentBuffer=t.createVertexBuffer(s,i.b6.members),this.tileExtentSegments=i.b7.simpleSegment(0,0,4,2);const d=new i.b4;d.emplaceBack(0,0),d.emplaceBack(i.ag,0),d.emplaceBack(0,i.ag),d.emplaceBack(i.ag,i.ag),this.debugBuffer=t.createVertexBuffer(d,i.b6.members),this.debugSegments=i.b7.simpleSegment(0,0,4,5);const _=new i.b4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,i.b6.members),this.viewportSegments=i.b7.simpleSegment(0,0,4,2);const y=new i.aT;y.emplaceBack(0,0,0,0),y.emplaceBack(i.ag,0,i.ag,0),y.emplaceBack(0,i.ag,0,i.ag),y.emplaceBack(i.ag,i.ag,i.ag,i.ag),this.mercatorBoundsBuffer=t.createVertexBuffer(y,i.b9.members),this.mercatorBoundsSegments=i.b7.simpleSegment(0,0,4,2);const w=new i.aU;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const C=new i.b5;for(const L of[0,1,3,2,0])C.emplaceBack(L);this.debugIndexBuffer=t.createIndexBuffer(C),this.emptyTexture=new i.T(t,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=i.ab.mat4.create();const z=this.context.gl;this.stencilClearMode=new hi({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,$t.disabled,this.stencilClearMode,bi.disabled,ni.disabled,yc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,d){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const z of d)if(this._tileClippingMaskIDs[z.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=s.id;const _=this.context,y=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(bi.disabled),_.setDepthMode($t.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of d){const z=s.getTile(C),L=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:N,tileBoundsSegments:B}=this.getTileBoundsBuffers(z);w.draw(this,y.TRIANGLES,$t.disabled,new hi({func:y.ALWAYS,mask:0},L,255,y.KEEP,y.KEEP,y.REPLACE),bi.disabled,ni.disabled,yc(C.projMatrix),"$clipping",k,N,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new hi({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new hi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,d=t.sort((w,C)=>C.overscaledZ-w.overscaledZ),_=d[d.length-1].overscaledZ,y=d[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let C=0;C<y;C++)w[C+_]=new hi({func:s.GEQUAL,mask:255},C+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[w,d]}return[{[_]:hi.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new bi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new i.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?bi.unblended:bi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new bi([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new i.aj(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,s,d,_=!1){if(this.depthOcclusion)return new $t(this.context.gl.GREATER,$t.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return $t.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new $t(d||this.context.gl.LEQUAL,s,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),d=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&d!==0&&(this.depthFBO=new Qu(this.context,s,d,!1,"texture"),this.depthTexture=new i.T(this.context,{width:s,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,d,0,0,s,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,s)=>t+s/this._fpsHistory.length,0))}render(t,s){const d=i.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const _=this.style._mergedLayers,y=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(Ee=>{const Re=_[Ee];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]});let w=!1,C=!1;for(const Ee of y){const Re=_[Ee];Re.type==="circle"&&(w=!0),Re.type==="symbol"&&(Re.hasInitialOcclusionOpacityProperties?C=!0:w=!0)}const z=y.map(Ee=>_[Ee]),L=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let k=0,N=!1;for(const Ee in L){const Re=L[Ee];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++k)}let B=!1;for(const Ee of z)Ee.isHidden(this.transform.zoom)||(Ee.type==="clip"&&(B=!0),this.prepareLayer(Ee));const G={},Y={},X={},J={},Q={};for(const Ee in L){const Re=L[Ee];G[Ee]=Re.getVisibleCoordinates(),Y[Ee]=G[Ee].slice().reverse(),X[Ee]=Re.getVisibleCoordinates(!0).reverse(),J[Ee]=Re.getShadowCasterCoordinates(),Q[Ee]=Re.sortCoordinatesByDistance(G[Ee])}const re=Ee=>{const Re=this.style.getLayerSourceCache(Ee);return Re&&Re.used?Re.getSource():null};if(k||B||this._clippingActiveLastFrame){const Ee=[],Re=[];let et=0;for(const ot of z)this.isSourceForClippingOrConflation(ot,re(ot))&&(Ee.push(ot),Re.push(et)),et++;if(B||Ee.length>1||this._clippingActiveLastFrame){B=!1;const ot=[];for(let ft=0;ft<Ee.length;ft++){const Ne=Ee[ft],nt=Re[ft],$e=this.style.getLayerSourceCache(Ne);if(!$e||!$e.used||!$e.getSource().usedInConflation&&Ne.type!=="clip")continue;let ut=i.dx,st=i.by.None;const tt=[];let wt=!0;if(Ne.type==="clip"){ut=nt;for(const Et of Ne.layout.get("clip-layer-types"))st|=Et==="model"?i.by.Model:Et==="symbol"?i.by.Symbol:i.by.FillExtrusion;for(const Et of Ne.layout.get("clip-layer-scope"))tt.push(Et);Ne.isHidden(this.transform.zoom)?wt=!1:B=!0}wt&&ot.push({layer:Ne.fqid,cache:$e,order:ut,clipMask:st,clipScope:tt})}this.replacementSource.setSources(ot),N=!0}}this._clippingActiveLastFrame=B,N||this.replacementSource.clear(),this.conflationActive=N,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ee=0;Ee<z.length;Ee++){const Re=z[Ee],et=Re.cutoffRange();if(this.longestCutoffRange=Math.max(et,this.longestCutoffRange),et>0){const ot=re(Re);ot&&(this.minCutoffZoom=Math.max(ot.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ee),this._lastOcclusionLayer=Ee)}const ue=this.style&&this.style.fog;ue?(this._fogVisible=ue.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ue.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(X),this.opaquePassCutoff=0);const le=this._shadowRenderer;if(le){le.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ee in L)for(const Re of G[Ee]){let et={min:0,max:0};this.terrain&&(et=this.terrain.getMinMaxForTile(Re)||et),le.addShadowReceiver(Re.toUnwrapped(),et.min,et.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ec(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const _e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),fe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(_e&&!this._snow&&(this._snow=new Hd(this)),!_e&&this._snow&&(this._snow.destroy(),delete this._snow),fe&&!this._rain&&(this._rain=new jd(this)),!fe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!nn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ee of z){const Re=t.getLayerSourceCache(Ee);if(!Ee.hasOffscreenPass()||Ee.isHidden(this.transform.zoom))continue;const et=Re?Y[Re.id]:void 0;(Ee.type==="custom"||Ee.type==="raster"||Ee.type==="raster-particle"||Ee.isSky()||et&&et.length)&&this.renderLayer(this,Re,Ee,et)}this.depthRangeFor3D=[0,1-(z.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,J)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const pe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),de=(()=>{if(s.showOverdrawInspector)return i.aj.black;const Ee=this.style.fog;if(Ee&&this.transform.projection.supportsFog){const Re=this.style.getLut(Ee.scope);if(!pe){const et=Ee.properties.get("color-use-theme")==="none",ot=Ee.properties.get("color").toRenderColor(et?null:Re).toArray01();return new i.aj(...ot)}if(pe){const et=Ee.properties.get("space-color-use-theme")==="none",ot=Ee.properties.get("space-color").toRenderColor(et?null:Re).toArray01();return new i.aj(...ot)}}return i.aj.transparent})();if(this.context.clear({color:de,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&pe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const Ee=z[this.currentLayer],Re=t.getLayerSourceCache(Ee);if(Ee.isSky())continue;const et=Re?(Ee.is3D()?Q:Y)[Re.id]:void 0;this._renderTileClippingMasks(Ee,Re,et),this.renderLayer(this,Re,Ee,et)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&pe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const Ee=z[this.currentLayer],Re=t.getLayerSourceCache(Ee);Ee.isSky()&&this.renderLayer(this,Re,Ee,Re?Y[Re.id]:void 0)}function be(Ee,Re){let et;return Re&&(et=(Ee.type==="symbol"?X:Ee.is3D()?Q:Y)[Re.id]),et}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<y.length;){const Ee=z[this.currentLayer];if(Ee.type==="raster"||Ee.type==="raster-particle"){const Re=t.getLayerSourceCache(Ee);this.renderLayer(this,Re,Ee,be(Ee,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ie=0;le&&(Ie=le.getShadowCastingLayerCount());let He=!1,Ve=-1;for(let Ee=0;Ee<y.length;++Ee){const Re=z[Ee];Re.isHidden(this.transform.zoom)||Re.is3D()&&(Ve=Ee)}for(C&&Ve===-1&&(w=!0);this.currentLayer<y.length;){const Ee=z[this.currentLayer],Re=t.getLayerSourceCache(Ee);if(Ee.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ee)){if(Ee.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(w&&!He&&this.terrain&&!this.transform.isOrthographic&&(He=!0,this.blitDepth()),C&&Ve!==-1&&this.currentLayer===Ve+1&&!this.transform.isOrthographic&&this.blitDepth(),Ee.is3D()||this.terrain||this._renderTileClippingMasks(Ee,Re,Re?G[Re.id]:void 0),this.renderLayer(this,Re,Ee,be(Ee,Re)),!this.terrain&&le&&Ie>0&&Ee.hasShadowPass()&&--Ie==0&&(le.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const et=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=et;this.currentLayer++){const ot=z[this.currentLayer];if(!ot.hasLightBeamPass())continue;const ft=t.getLayerSourceCache(ot);this.renderLayer(this,ft,ot,ft?Y[ft.id]:void 0)}this.currentLayer=et,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const et=this.currentLayer;this.depthOcclusion=!0;for(const ot of this.layersWithOcclusionOpacity){this.currentLayer=ot;const ft=z[this.currentLayer],Ne=t.getLayerSourceCache(ft),nt=Ne?Y[Ne.id]:void 0;ft.is3D()||this.terrain||this._renderTileClippingMasks(ft,Ne,Ne?G[Ne.id]:void 0),this.renderLayer(this,Ne,ft,nt)}this.depthOcclusion=!1,this.currentLayer=et,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ee=null;z.forEach(Re=>{const et=t.getLayerSourceCache(Re);et&&!Re.isHidden(this.transform.zoom)&&et.getVisibleCoordinates().length&&(!Ee||Ee.getSource().maxzoom<et.getSource().maxzoom)&&(Ee=et)}),Ee&&this.options.showTileBoundaries&&go.debug(this,Ee,Ee.getVisibleCoordinates(),i.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&go.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ee){const Re=Ee.transform.padding;Ld(Ee,Ee.transform.height-(Re.top||0),3,_m),Ld(Ee,Re.bottom||0,3,gm),Sc(Ee,Re.left||0,3,ym),Sc(Ee,Ee.transform.width-(Re.right||0),3,yl);const et=Ee.transform.centerPoint;(function(ot,ft,Ne,nt){vl(ot,ft-1,Ne-10,2,20,nt),vl(ot,ft-10,Ne-1,20,2,nt)})(Ee,et.x,Ee.transform.height-et.y,oy)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),N||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,d=!s||!s.includes(t.type);if(oh[t.type]&&(d||this.terrain&&t.type==="custom")){const _=this.style.getLayerSourceCache(t);oh[t.type](t,_,this)}this.gpuTimingEnd()}renderLayer(t,s,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||_&&_.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||go[d.type](t,s,d,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,d=this.context.gl;let _=this.gpuTimers[t.id];_||(_=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),_.calls++,d.beginQuery(s.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,d=s.createQuery();this.deferredRenderGpuTimeQueries.push(d),s.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const d in t){const _=t[d],y=this.context.extTimerQuery,w=y.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(_.query),s[d]=w}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let d=0;for(const _ of t)d+=s.getQueryParameter(_,s.QUERY_RESULT)/1e6,s.deleteQuery(_);return d}translatePosMatrix(t,s,d,_,y){if(!d[0]&&!d[1])return t;const w=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const L=Math.sin(w),k=Math.cos(w);d=[d[0]*k-d[1]*L,d[0]*L+d[1]*k]}const C=[y?d[0]:i.ar(s,d[0],this.transform.zoom),y?d[1]:i.ar(s,d[1],this.transform.zoom),0],z=new Float32Array(16);return i.ab.mat4.translate(z,t,C),z}saveTileTexture(t){const s=t.size[0],d=this._tileTextures[s];d?d.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,d){const _=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||_||s!==void 0&&!s||y.push("FOG","FOG_DITHERING"),_&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,s){this.cache=this.cache||{};const d=s&&s.defines||[],_=s&&s.config,y=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(d),w=rm.cacheKey(dd[t],t,y,_);return this.cache[w]||(this.cache[w]=new rm(this.context,t,dd[t],_,ry[t],y)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const d=this.style.directionalLight,_=this.style.ambientLight;if(d&&_){const y=((w,C,z)=>{const L=w.properties.get("direction"),k=w.properties.get("color-use-theme")==="none",N=w.properties.get("color").toRenderColor(k?null:z.getLut(w.scope)).toArray01(),B=w.properties.get("intensity"),G=C.properties.get("color-use-theme")==="none",Y=C.properties.get("color").toRenderColor(G?null:z.getLut(C.scope)).toArray01(),X=C.properties.get("intensity"),J=[L.x,L.y,L.z],Q=i.cM(Y,X),re=i.cM(N,B);return{u_lighting_ambient_color:Q,u_lighting_directional_dir:J,u_lighting_directional_color:re,u_ground_radiance:ty(J,re,Q)}})(d,_,this.style);s.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,s,d,_,y){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const C=w.getOpacity(this.transform.pitch),z=((L,k,N,B,G,Y,X,J,Q,re,ue,le)=>{const _e=L.transform,fe=k.properties.get("color-use-theme")==="none",pe=k.properties.get("color").toRenderColor(fe?null:L.style.getLut(k.scope)).toArray01();pe[3]=B;const de=L.frameCounter/1e3%1,[be,Ie]=k.properties.get("vertical-range");return{u_fog_matrix:N?_e.calculateFogTileMatrix(N):le||L.identityMat,u_fog_range:k.getFovAdjustedRange(_e._fov),u_fog_color:pe,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(be,Ie),Ie],u_fog_temporal_offset:de,u_frustum_tl:G,u_frustum_tr:Y,u_frustum_br:X,u_frustum_bl:J,u_globe_pos:Q,u_globe_radius:re,u_viewport:ue,u_globe_transition:i.ae(_e.zoom),u_is_globe:+(_e.projection.name==="globe")}})(this,w,d,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],_);s.setFogUniformValues(t,z)}y&&s.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const _ of d)s[_.key]=t[_.key]||new Oo(_,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=zt||s[1]>=zt}setupDepthForOcclusion(t,s,d){const _=this.context,y=_.gl,w=!!d;var C;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE0),w||s.setTerrainUniformValues(_,d)}}function ah(h,t){let s=!1,d=null;const _=()=>{d=null,s&&(h(),d=setTimeout(_,t),s=!1)};return()=>(s=!0,d||_(),d)}class lh{constructor(t){this._hashName=t&&encodeURIComponent(t),i.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ah(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=ch(t);if(this._hashName){const d=this._hashName;let _=!1;const y=location.hash.slice(1).split("&").map(w=>{const C=w.split("=")[0];return C===d?(_=!0,`${C}=${s}`):w}).filter(w=>w);return _||y.push(`${d}=${s}`),`#${y.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(s=d)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(d=>isNaN(d))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:d,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ch(h,t){const s=h.getCenter(),d=Math.round(100*h.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),w=Math.round(s.lng*y)/y,C=Math.round(s.lat*y)/y,z=h.getBearing(),L=h.getPitch();let k=t?`/${w}/${C}/${d}`:`${d}/${C}/${w}`;return(z||L)&&(k+="/"+Math.round(10*z)/10),L&&(k+=`/${Math.round(L)}`),k}const Tl={linearity:.3,easing:i.dy(0,0,.3,1)},wm=i.l({deceleration:2500,maxSpeed:1400},Tl),Tm=i.l({deceleration:20,maxSpeed:1400},Tl),Sm=i.l({deceleration:1e3,maxSpeed:360},Tl),Mm=i.l({deceleration:1e3,maxSpeed:90},Tl);class Em{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=i.q.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(s.pan.mag()){const y=Pc(s.pan.mag(),d,i.l({},wm,t||{}));_.offset=s.pan.mult(y.amount/s.pan.mag()),_.center=this._map.transform.center,Cc(_,y)}if(s.zoom){const y=Pc(s.zoom,d,Tm);_.zoom=this._map.transform.zoom+y.amount,Cc(_,y)}if(s.bearing){const y=Pc(s.bearing,d,Sm);_.bearing=this._map.transform.bearing+i.aw(y.amount,-179,179),Cc(_,y)}if(s.pitch){const y=Pc(s.pitch,d,Mm);_.pitch=this._map.transform.pitch+y.amount,Cc(_,y)}if(_.zoom||_.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Cc(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Pc(h,t,s){const{maxSpeed:d,linearity:_,deceleration:y}=s,w=i.aw(h*_/(t/1e3),-d,d),C=Math.abs(w)/(y*_);return{easing:s.easing,duration:1e3*C,amount:w*(C/2)}}class Zr extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d,_={}){const y=Ut(s.getCanvasContainer(),d),w=s.unproject(y);super(t,i.l({point:y,lngLat:w,originalEvent:d},_)),this._defaultPrevented=!1,this.target=s}}class Dc extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d){const _=t==="touchend"?d.changedTouches:d.touches,y=si(s.getCanvasContainer(),_),w=y.map(z=>s.unproject(z)),C=y.reduce((z,L,k,N)=>z.add(L.div(N.length)),new i.P(0,0));super(t,{points:y,point:C,lngLats:w,lngLat:s.unproject(C),originalEvent:d}),this._defaultPrevented=!1}}class Am extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class Im{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Am(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Zr(t.type,this._map,t))}mouseup(t){this._map.fire(new Zr(t.type,this._map,t))}preclick(t){const s=i.l({},t);s.type="preclick",this._map.fire(new Zr(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Zr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Zr(t.type,this._map,t))}mouseover(t){this._map.fire(new Zr(t.type,this._map,t))}mouseout(t){this._map.fire(new Zr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Dc(t.type,this._map,t))}touchmove(t){this._map.fire(new Dc(t.type,this._map,t))}touchend(t){this._map.fire(new Dc(t.type,this._map,t))}touchcancel(t){this._map.fire(new Dc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cm{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Zr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Zr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pm{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ye(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const d=s,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(d)||!this._box&&d.dist(_)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=xe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(_.x,d.x),C=Math.max(_.x,d.x),z=Math.min(_.y,d.y),L=Math.max(_.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${z}px)`,this._box.style.width=C-w+"px",this._box.style.height=L-z+"px")})}mouseupWindow(t,s){if(!this._active)return;const d=this._startPos,_=s;if(d&&t.button===0){if(this.reset(),rt(),d.x!==_.x||d.y!==_.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ct(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new i.z(t,{originalEvent:s}))}}function $d(h,t){const s={};for(let d=0;d<h.length;d++)s[h[d].identifier]=t[d];return s}class cy{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(_){const y=new i.P(0,0);for(const w of _)y._add(w);return y.div(_.length)}(s),this.touches=$d(d,s)))}touchmove(t,s,d){if(this.aborted||!this.centroid)return;const _=$d(d,s);for(const y in this.touches){const w=_[y];(!w||w.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,s,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class En{constructor(t){this.singleTap=new cy(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,d){this.singleTap.touchstart(t,s,d)}touchmove(t,s,d){this.singleTap.touchmove(t,s,d)}touchend(t,s,d){const _=this.singleTap.touchend(t,s,d);if(_){const y=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(y&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Dm{constructor(){this._zoomIn=new En({numTouches:1,numTaps:2}),this._zoomOut=new En({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,d){this._zoomIn.touchstart(t,s,d),this._zoomOut.touchstart(t,s,d)}touchmove(t,s,d){this._zoomIn.touchmove(t,s,d),this._zoomOut.touchmove(t,s,d)}touchend(t,s,d){const _=this._zoomIn.touchend(t,s,d),y=this._zoomOut.touchend(t,s,d);return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const uy={0:1,2:2};class Wd{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const d=It(t);this._correctButton(t,d)&&(this._lastPoint=s,this._eventButton=d)}mousemoveWindow(t,s){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(_,y){const w=uy[y];return _.buttons===void 0||(_.buttons&w)!==w}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(d,s)}}mouseupWindow(t){this._lastPoint&&It(t)===this._eventButton&&(this._moved&&rt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zc extends Wd{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Zd extends Wd{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const d=.8*(s.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){t.preventDefault()}}class uh extends Wd{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const d=-.5*(s.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){t.preventDefault()}}class hh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),i.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(t,s,d){return this._calculateTransform(t,s,d)}touchmove(t,s,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!i.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,d)}}touchend(t,s,d){this._calculateTransform(t,s,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,d){d.length>0&&(this._active=!0);const _=$d(d,s),y=new i.P(0,0),w=new i.P(0,0);let C=0;for(const L in _){const k=_[L],N=this._touches[L];N&&(y._add(k),w._add(k.sub(N)),C++,_[L]=k)}if(this._touches=_,C<this._minTouches||!w.mag())return;const z=w.div(C);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(C),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ls{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,d){return{}}touchstart(t,s,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,d){const _=this._firstTwoTouches;if(!_)return;t.preventDefault();const[y,w]=_,C=Ma(d,s,y),z=Ma(d,s,w);if(!C||!z)return;const L=this._aroundCenter?null:C.add(z).div(2);return this._move([C,z],L,t)}touchend(t,s,d){if(!this._firstTwoTouches)return;const[_,y]=this._firstTwoTouches,w=Ma(d,s,_),C=Ma(d,s,y);w&&C||(this._active&&rt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ma(h,t,s){for(let d=0;d<h.length;d++)if(h[d].identifier===s)return t[d]}function kn(h,t){return Math.log(h/t)/Math.LN2}class Qs extends Ls{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(kn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:kn(this._distance,d),pinchAround:s}}}function dh(h,t){return 180*h.angleWith(t)/Math.PI}class fh extends Ls{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:dh(this._vector,d),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const _=dh(t,d);return Math.abs(_)<s}}function ph(h){return Math.abs(h.y)>Math.abs(h.x)}class hy extends Ls{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ph(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,d){const _=this._lastPoints;if(!_)return;const y=t[0].sub(_[0]),w=t[1].sub(_[1]);return this._map._cooperativeGestures&&!i.dz()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(y,w,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5})}gestureBeginsVertically(t,s,d){if(this._valid!==void 0)return this._valid;const _=t.mag()>=2,y=s.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const w=t.y>0==s.y>0;return ph(t)&&ph(s)&&w}}const Rc={panStep:100,bearingStep:15,pitchStep:10};class dy{constructor(){const t=Rc;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,d=0,_=0,y=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:C=>{const z=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:fy,zoom:s?Math.round(z)+s*(t.shiftKey?2:1):z,bearing:C.getBearing()+d*this._bearingStep,pitch:C.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:C.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function fy(h){return h*(2-h)}const mh=4.000244140625,Xd=1/450;class Sl{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Xd,i.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||i.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=i.q.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,s!==0&&s%mh==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Ut(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>mh?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&k!==0&&(k=1/k);const N=s(),B=Math.pow(2,N),G=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(G*k))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:s(),_=this._startZoom,y=this._easing;let w,C=!1;if(this._type==="wheel"&&_&&y){const L=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),k=y(L);w=i.af(_,d,k),L<1?this._frameId||(this._frameId=!0):C=!0}else w=d,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let z=w-s();return z*this._lastDelta<0&&(z=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:z,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=i.dA;if(this._prevEase){const d=this._prevEase,_=(i.q.now()-d.start)/d.duration,y=d.easing(_+.01)-d.easing(_),w=.27/Math.sqrt(y*y+1e-4)*.01,C=Math.sqrt(.0729-w*w);s=i.dy(w,C,.25,1)}return this._prevEase={start:i.q.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ml{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ks{constructor(){this._tap=new En({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=s[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,s,d))}touchmove(t,s,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=s[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,s,d)}touchend(t,s,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,s,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wo{constructor(t,s,d){this._el=t,this._mousePan=s,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ea{constructor(t,s,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zo{constructor(t,s,d,_){this._el=t,this._touchZoom=s,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _h=h=>h.zoom||h.drag||h.pitch||h.rotate;class py extends i.z{}class my{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const d=i.ab.vec3.sub([],s,t);this.radius=i.ab.vec3.length(d[2]<0?i.ab.vec3.div([],d,this.constants):[d[0],d[1],0])}projectRay(t){i.ab.vec3.div(t,t,this.constants),i.ab.vec3.normalize(t,t),i.ab.vec3.mul(t,t,this.constants);const s=i.ab.vec3.scale([],t,this.radius);if(s[2]>0){const d=i.ab.vec3.scale([],[0,0,1],i.ab.vec3.dot(s,[0,0,1])),_=i.ab.vec3.scale([],i.ab.vec3.normalize([],[s[0],s[1],0]),this.radius),y=i.ab.vec3.add([],s,i.ab.vec3.scale([],i.ab.vec3.sub([],i.ab.vec3.add([],_,d),s),2));s[0]=y[0],s[1]=y[1]}return s}}function gh(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class zm{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Em(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new my,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),i.aP(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,y,w]of this._listeners){const C=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(y,C,w)}}destroy(){for(const[t,s,d]of this._listeners){const _=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,_,d)}}_addDefaultHandlers(t){const s=this._map,d=s.getCanvasContainer();this._add("mapEvent",new Im(s,t));const _=s.boxZoom=new Pm(s,t);this._add("boxZoom",_);const y=new Dm,w=new yo;s.doubleClickZoom=new Ml(w,y),this._add("tapZoom",y),this._add("clickZoom",w);const C=new ks;this._add("tapDragZoom",C);const z=s.touchPitch=new hy(s);this._add("touchPitch",z);const L=new Zd(t),k=new uh(t);s.dragRotate=new Ea(t,L,k),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const N=new zc(t),B=new hh(s,t);s.dragPan=new Wo(d,N,B),this._add("mousePan",N),this._add("touchPan",B,["touchZoom","touchRotate"]);const G=new fh,Y=new Qs;s.touchZoomRotate=new Zo(d,Y,G,C),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Cm(s));const X=s.scrollZoom=new Sl(s,this);this._add("scrollZoom",X,["mousePan"]);const J=s.keyboard=new dy;this._add("keyboard",J);for(const Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Q]&&s[Q].enable(t[Q])}_add(t,s,d){this._handlers.push({handlerName:t,handler:s,allowed:d}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_h(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,d){for(const _ in t)if(_!==d&&(!s||s.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const d of t)this._el.contains(d.target)&&s.push(d);return s}handleEvent(t,s){this._updatingCamera=!0;const d=t.type==="renderFrame",_=d?void 0:t,y={needsRenderFrame:!1},w={},C={},z=t.touches?this._getMapTouches(t.touches):void 0,L=z?si(this._el,z):d?void 0:Ut(this._el,t);for(const{handlerName:B,handler:G,allowed:Y}of this._handlers){if(!G.isEnabled())continue;let X;this._blockedByActive(C,Y,B)?G.reset():G[s||t.type]&&(X=G[s||t.type](t,L,z),this.mergeHandlerResult(y,w,X,B,_),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||G.isActive())&&(C[B]=G)}const k={};for(const B in this._previousActiveHandlers)C[B]||(k[B]=_);this._previousActiveHandlers=C,(Object.keys(k).length||gh(y))&&(this._changes.push([y,w,k]),this._triggerRenderFrame()),(Object.keys(C).length||gh(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=y;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(t,s,d,_,y){if(!d)return;i.l(t,d);const w={handlerName:_,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(s.zoom=w),d.panDelta!==void 0&&(s.drag=w),d.pitchDelta!==void 0&&(s.pitch=w),d.bearingDelta!==void 0&&(s.rotate=w)}_applyChanges(){const t={},s={},d={};for(const[_,y,w]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new i.P(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(t.around=_.around),_.aroundCoord!==void 0&&(t.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),i.l(s,y),i.l(d,w);this._updateMapTransform(t,s,d),this._changes=[]}_updateMapTransform(t,s,d){const _=this._map,y=_.transform,w=re=>[re.x,re.y,re.z];if((re=>{const ue=this._eventsInProgress.drag;return ue&&!this._handlersById[ue.handlerName].isActive()})()&&!gh(t)){const re=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),re!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&_._stop(!0),!gh(t))return void this._fireEvents(s,d,!0);let{panDelta:C,zoomDelta:z,bearingDelta:L,pitchDelta:k,around:N,aroundCoord:B,pinchAround:G}=t;y._isCameraConstrained&&(z>0&&(z=0),y._isCameraConstrained=!1),G!==void 0&&(N=G),(z||(re=>s[re]&&!this._eventsInProgress[re])("drag"))&&N&&(this._dragOrigin=w(y.pointCoordinate3D(N)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),N=N||_.transform.centerPoint,L&&(y.bearing+=L),k&&(y.pitch+=k),y._updateCameraState();const Y=[0,0,0];if(C)if(y.projection.name==="mercator"){const re=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(N).dir),ue=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(N.sub(C)).dir);Y[0]=ue[0]-re[0],Y[1]=ue[1]-re[1]}else{const re=y.pointCoordinate(N);if(y.projection.name==="globe"){C=C.rotate(-y.angle);const ue=y._pixelsPerMercatorPixel/y.worldSize;Y[0]=-C.x*i.dB(i.aS(re.y))*ue,Y[1]=-C.y*i.dB(y.center.lat)*ue}else{const ue=y.pointCoordinate(N.sub(C));re&&ue&&(Y[0]=ue.x-re.x,Y[1]=ue.y-re.y)}}const X=y.zoom,J=[0,0,0];if(z){const re=w(B||y.pointCoordinate3D(N)),ue={dir:i.ab.vec3.normalize([],i.ab.vec3.sub([],re,y._camera.position))};if(ue.dir[2]<0){const le=y.zoomDeltaToMovement(re,z);i.ab.vec3.scale(J,ue.dir,le)}}const Q=i.ab.vec3.add(Y,Y,J);y._translateCameraConstrained(Q),z&&Math.abs(y.zoom-X)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,d,!0)}_fireEvents(t,s,d){const _=_h(this._eventsInProgress),y=_h(t),w={};for(const k in t){const{originalEvent:N}=t[k];this._eventsInProgress[k]||(w[`${k}start`]=N),this._eventsInProgress[k]=t[k]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(const k in w)this._fireEvent(k,w[k]);y&&this._fireEvent("move",y.originalEvent);for(const k in t){const{originalEvent:N}=t[k];this._fireEvent(k,N)}const C={};let z;for(const k in this._eventsInProgress){const{handlerName:N,originalEvent:B}=this._eventsInProgress[k];this._handlersById[N].isActive()||(delete this._eventsInProgress[k],z=s[N]||B,C[`${k}end`]=z)}for(const k in C)this._fireEvent(k,C[k]);const L=_h(this._eventsInProgress);if(d&&(_||y)&&!L){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;k?(N(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:z})):(this._map.fire(new i.z("moveend",{originalEvent:z})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new i.z(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new py("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Mr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Yd extends i.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,i.aP(["_renderFrameCallback"],this)}getCenter(){return new i.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,d){return t=i.P.convert(t).mult(-1),this.panTo(this.transform.center,i.l({offset:t},s),d)}panTo(t,s,d){return this.easeTo(i.l({center:t},s),d)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,d){return this.easeTo(i.l({zoom:t},s),d)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,d){return this.easeTo(i.l({bearing:t},s),d)}resetNorth(t,s){return this.rotateTo(0,i.l({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=i.az.convert(t);const d=s&&s.bearing||0,_=s&&s.pitch||0,y=t.getNorthWest(),w=t.getSouthEast();return this._cameraForBounds(this.transform,y,w,d,_,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?i.l({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:i.l({},s,t)}_extendCameraOptions(t){return(t=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const d=s.max[0]-s.min[0],_=s.max[1]-s.min[1];return d/_>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):_/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,d,_,y,w){const C=t.clone(),z=this._extendCameraOptions(w);C.bearing=_,C.pitch=y;const L=i.bO.convert(s),k=i.bO.convert(d),N=.5*(L.lat+k.lat),B=.5*(L.lng+k.lng),G=i.dC(N,B),Y=i.ab.vec3.normalize([],G),X=i.ab.vec3.normalize([],i.ab.vec3.cross([],Y,[0,1,0])),J=i.ab.vec3.cross([],X,Y),Q=[X[0],X[1],X[2],0,J[0],J[1],J[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],re=[G,i.dC(L.lat,L.lng),i.dC(k.lat,L.lng),i.dC(k.lat,k.lng),i.dC(L.lat,k.lng),i.dC(N,L.lng),i.dC(N,k.lng),i.dC(L.lat,B),i.dC(k.lat,B)];let ue=i.cd.fromPoints(re.map($e=>[i.ab.vec3.dot(X,$e),i.ab.vec3.dot(J,$e),i.ab.vec3.dot(Y,$e)]));const le=i.ab.vec3.transformMat4([],ue.center,Q);i.ab.vec3.squaredLength(le)===0&&i.ab.vec3.set(le,0,0,1),i.ab.vec3.normalize(le,le),i.ab.vec3.scale(le,le,i.ax),C.center=i.dD(le);const _e=C.getWorldToCameraMatrix(),fe=i.ab.mat4.invert(new Float64Array(16),_e);ue=i.cd.applyTransform(ue,i.ab.mat4.multiply([],_e,Q));const pe=this._extendAABB(ue,C,z,_);if(!pe)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=pe,i.ab.vec3.transformMat4(le,le,_e);const de=.5*(ue.max[2]-ue.min[2]),be=this._minimumAABBFrustumDistance(C,ue),Ie=i.ab.vec3.scale([],[0,0,1],de),He=i.ab.vec3.add(Ie,le,Ie),Ve=be+(C.pitch===0?0:i.ab.vec3.distance(le,He)),Ee=C.globeCenterInViewSpace,Re=i.ab.vec3.sub([],le,[Ee[0],Ee[1],Ee[2]]);i.ab.vec3.normalize(Re,Re),i.ab.vec3.scale(Re,Re,Ve);const et=i.ab.vec3.add([],le,Re);i.ab.vec3.transformMat4(et,et,fe);const ot=i.ds/i.ax,ft=i.ab.vec3.length(et),Ne=i.bH(Math.max(ft*ot-i.ds,Number.EPSILON),0),nt=Math.min(C.zoomFromMercatorZAdjusted(Ne),z.maxZoom);return nt>.5*(i.c6+i.bY)?(C.setProjection({name:"mercator"}),C.zoom=nt,this._cameraForBounds(C,s,d,_,y,w)):{center:C.center,zoom:nt,bearing:_,pitch:y}}_extendAABB(t,s,d,_){const y=.5*((d.padding.left||0)+(d.padding.right||0)),w=.5*((d.padding.top||0)+(d.padding.bottom||0)),C=w,z=y,L=y,k=w,N=s.width-(z+L),B=s.height-(C+k),G=i.ab.vec3.sub([],t.max,t.min),Y=Math.min(N/G[0],B/G[1]),X=Math.min(s.scaleZoom(s.scale*Y),d.maxZoom);if(isNaN(X))return null;const J=s.scale/s.zoomScale(X),Q=new i.cd([t.min[0]-z*J,t.min[1]-k*J,t.min[2]],[t.max[0]+L*J,t.max[1]+C*J,t.max[2]]),re=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new i.P(d.offset.x,d.offset.y):i.P.convert(d.offset)).rotate(-i.ai(_));return Q.center[0]-=re.x*J,Q.center[1]+=re.y*J,Q}queryTerrainElevation(t,s){const d=this.transform.elevation;return d?(s=i.l({},{exaggerated:!0},s),d.getAtPoint(i.aa.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,d,_,y,w){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,d,_,y,w);const C=t.clone(),z=this._extendCameraOptions(w);C.bearing=_,C.pitch=y;const L=i.bO.convert(s),k=i.bO.convert(d),N=new i.bO(L.lng,k.lat),B=new i.bO(k.lng,L.lat),G=C.project(L),Y=C.project(k),X=this.queryTerrainElevation(L),J=this.queryTerrainElevation(k),Q=this.queryTerrainElevation(N),re=this.queryTerrainElevation(B),ue=[[G.x,G.y,Math.min(X||0,J||0,Q||0,re||0)],[Y.x,Y.y,Math.max(X||0,J||0,Q||0,re||0)]];let le=i.cd.fromPoints(ue);const _e=C.getWorldToCameraMatrix(),fe=i.ab.mat4.invert(new Float64Array(16),_e);le=i.cd.applyTransform(le,_e);const pe=this._extendAABB(le,C,z,_);if(!pe)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");le=pe;const de=.5*i.ab.vec3.sub([],le.max,le.min)[2],be=this._minimumAABBFrustumDistance(C,le),Ie=[0,0,1,0];i.ab.vec4.transformMat4(Ie,Ie,_e),i.ab.vec4.normalize(Ie,Ie);const He=i.ab.vec3.scale([],Ie,be+de),Ve=i.ab.vec3.add([],le.center,He);i.ab.vec3.transformMat4(le.center,le.center,fe),i.ab.vec3.transformMat4(Ve,Ve,fe);const Ee=C.unproject(new i.P(le.center[0],le.center[1])),Re=i.dE(C.projection,Ee),et=Math.pow(2,Re),ot=Math.min(C._zoomFromMercatorZ(Ve[2]*C.pixelsPerMeter*et/C.worldSize),z.maxZoom);return C.mercatorFromTransition&&ot<.5*(i.c6+i.bY)?(C.setProjection({name:"globe"}),C.zoom=ot,this._cameraForBounds(C,s,d,_,y,w)):{center:Ee,zoom:ot,bearing:_,pitch:y}}fitBounds(t,s,d){const _=this.cameraForBounds(t,s);return this._fitInternal(_,s,d)}fitScreenCoordinates(t,s,d,_,y){const w=i.P.convert(t),C=i.P.convert(s),z=new i.P(Math.min(w.x,C.x),Math.min(w.y,C.y)),L=new i.P(Math.max(w.x,C.x),Math.max(w.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,C))return this;const k=this.transform.pointLocation3D(z),N=this.transform.pointLocation3D(L),B=this.transform.pointLocation3D(new i.P(z.x,L.y)),G=this.transform.pointLocation3D(new i.P(L.x,z.y)),Y=[Math.min(k.lng,N.lng,B.lng,G.lng),Math.min(k.lat,N.lat,B.lat,G.lat)],X=[Math.max(k.lng,N.lng,B.lng,G.lng),Math.max(k.lat,N.lat,B.lat,G.lat)],J=_&&_.pitch?_.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,Y,X,d,J,_);return this._fitInternal(Q,_,y)}_fitInternal(t,s,d){return t?(s=i.l(t,s)).linear?this.easeTo(s,d):this.flyTo(s,d):this}jumpTo(t,s){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let _=!1,y=!1,w=!1;"zoom"in t&&d.zoom!==+t.zoom&&(_=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=i.bO.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(y=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(w=!0,d.pitch=+t.pitch);const C=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(C))if(t.retainPadding===!1){const z=d.clone();z.padding=C,d.setLocationAtPoint(d.center,z.centerPoint)}else d.padding=C;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new i.z("movestart",s)).fire(new i.z("move",s)),_&&this.fire(new i.z("zoomstart",s)).fire(new i.z("zoom",s)).fire(new i.z("zoomend",s)),y&&this.fire(new i.z("rotatestart",s)).fire(new i.z("rotate",s)).fire(new i.z("rotateend",s)),w&&this.fire(new i.z("pitchstart",s)).fire(new i.z("pitch",s)).fire(new i.z("pitchend",s)),this.fire(new i.z("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Mr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const d=this.transform;if(!d.projection.supportsFreeCamera)return i.w(Mr),this;this.stop();const _=d.zoom,y=d.pitch,w=d.bearing;d.setFreeCameraOptions(t);const C=_!==d.zoom,z=y!==d.pitch,L=w!==d.bearing;return this.fire(new i.z("movestart",s)).fire(new i.z("move",s)),C&&this.fire(new i.z("zoomstart",s)).fire(new i.z("zoom",s)).fire(new i.z("zoomend",s)),L&&this.fire(new i.z("rotatestart",s)).fire(new i.z("rotate",s)).fire(new i.z("rotateend",s)),z&&this.fire(new i.z("pitchstart",s)).fire(new i.z("pitch",s)).fire(new i.z("pitchend",s)),this.fire(new i.z("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=i.l({offset:[0,0],duration:500,easing:i.dA},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,_=this.getZoom(),y=this.getBearing(),w=this.getPitch(),C=this.getPadding(),z="zoom"in t?+t.zoom:_,L="bearing"in t?this._normalizeBearing(t.bearing,y):y,k="pitch"in t?+t.pitch:w,N=this._extendPadding(t.padding),B=i.P.convert(t.offset);let G,Y,X;if(d.projection.name==="globe"){const Ie=i.aa.fromLngLat(d.center),He=B.rotate(-d.angle);Ie.x+=He.x/d.worldSize,Ie.y+=He.y/d.worldSize;const Ve=Ie.toLngLat(),Ee=i.bO.convert(t.center||Ve);this._normalizeCenter(Ee),G=d.centerPoint.add(He),Y=new i.P(Ie.x,Ie.y).mult(d.worldSize),X=new i.P(i.at(Ee.lng),i.aA(Ee.lat)).mult(d.worldSize).sub(Y)}else{G=d.centerPoint.add(B);const Ie=d.pointLocation(G),He=i.bO.convert(t.center||Ie);this._normalizeCenter(He),Y=d.project(Ie),X=d.project(He).sub(Y)}const J=d.zoomScale(z-_);let Q,re;t.around&&(Q=i.bO.convert(t.around),re=d.locationPoint(Q));const ue=this._zooming||z!==_,le=this._rotating||y!==L,_e=this._pitching||k!==w,fe=!d.isPaddingEqual(N),pe=t.retainPadding===!1?d.clone():d,de=Ie=>He=>{if(ue&&(Ie.zoom=i.af(_,z,He)),le&&(Ie.bearing=i.af(y,L,He)),_e&&(Ie.pitch=i.af(w,k,He)),fe&&(pe.interpolatePadding(C,N,He),G=pe.centerPoint.add(B)),Q)Ie.setLocationAtPoint(Q,re);else{const Ve=Ie.zoomScale(Ie.zoom-_),Ee=z>_?Math.min(2,J):Math.max(.5,J),Re=Math.pow(Ee,1-He),et=Ie.unproject(Y.add(X.mult(He*Re)).mult(Ve));Ie.setLocationAtPoint(Ie.renderWorldCopies?et.wrap():et,G)}return t.preloadOnly||this._fireMoveEvents(s),Ie};if(t.preloadOnly){const Ie=this._emulate(de,t.duration,d);return this._preloadTiles(Ie),this}const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ue,this._rotating=le,this._pitching=_e,this._padding=fe,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,be),this._ease(de(d),Ie=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(s,Ie)},t),this}_prepareEase(t,s,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||d.moving||this.fire(new i.z("movestart",t)),this._zooming&&!d.zooming&&this.fire(new i.z("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new i.z("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new i.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new i.z("move",t)),this._zooming&&this.fire(new i.z("zoom",t)),this._rotating&&this.fire(new i.z("rotate",t)),this._pitching&&this.fire(new i.z("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new i.z("zoomend",t)),_&&this.fire(new i.z("rotateend",t)),y&&this.fire(new i.z("pitchend",t)),this.fire(new i.z("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const $e=i.ay(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo($e,s)}this.stop(),t=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.dA},t);const d=this.transform,_=this.getZoom(),y=this.getBearing(),w=this.getPitch(),C=this.getPadding(),z="zoom"in t?i.aw(+t.zoom,d.minZoom,d.maxZoom):_,L="bearing"in t?this._normalizeBearing(t.bearing,y):y,k="pitch"in t?+t.pitch:w,N=this._extendPadding(t.padding),B=d.zoomScale(z-_),G=i.P.convert(t.offset);let Y=d.centerPoint.add(G);const X=d.pointLocation(Y),J=i.bO.convert(t.center||X);this._normalizeCenter(J);const Q=d.project(X),re=d.project(J).sub(Q);let ue=t.curve;const le=Math.max(d.width,d.height),_e=le/B,fe=re.mag();if("minZoom"in t){const $e=i.aw(Math.min(t.minZoom,_,z),d.minZoom,d.maxZoom),ut=le/d.zoomScale($e-_);ue=Math.sqrt(ut/fe*2)}const pe=ue*ue;function de($e){const ut=(_e*_e-le*le+($e?-1:1)*pe*pe*fe*fe)/(2*($e?_e:le)*pe*fe);return Math.log(Math.sqrt(ut*ut+1)-ut)}function be($e){return(Math.exp($e)-Math.exp(-$e))/2}function Ie($e){return(Math.exp($e)+Math.exp(-$e))/2}const He=de(0);let Ve=function($e){return Ie(He)/Ie(He+ue*$e)},Ee=function($e){return le*((Ie(He)*(be(ut=He+ue*$e)/Ie(ut))-be(He))/pe)/fe;var ut},Re=(de(1)-He)/ue;if(Math.abs(fe)<1e-6||!isFinite(Re)){if(Math.abs(le-_e)<1e-6)return this.easeTo(t,s);const $e=_e<le?-1:1;Re=Math.abs(Math.log(_e/le))/ue,Ee=function(){return 0},Ve=function(ut){return Math.exp($e*ue*ut)}}t.duration="duration"in t?+t.duration:1e3*Re/("screenSpeed"in t?+t.screenSpeed/ue:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const et=y!==L,ot=k!==w,ft=!d.isPaddingEqual(N),Ne=t.retainPadding===!1?d.clone():d,nt=$e=>ut=>{const st=ut*Re,tt=1/Ve(st);$e.zoom=ut===1?z:_+$e.scaleZoom(tt),et&&($e.bearing=i.af(y,L,ut)),ot&&($e.pitch=i.af(w,k,ut)),ft&&(Ne.interpolatePadding(C,N,ut),Y=Ne.centerPoint.add(G));const wt=ut===1?J:$e.unproject(Q.add(re.mult(Ee(st))).mult(tt));return $e.setLocationAtPoint($e.renderWorldCopies?wt.wrap():wt,Y),$e._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),$e};if(t.preloadOnly){const $e=this._emulate(nt,t.duration,d);return this._preloadTiles($e),this}return this._zooming=!0,this._rotating=et,this._pitching=ot,this._padding=ft,this._prepareEase(s,!1),this._ease(nt(d),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,s)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,s,d){d.animate===!1||d.duration===0?(t(1),s()):(this._easeStart=i.q.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=i.bF(t,-180,180);const d=Math.abs(t-s);return Math.abs(t-360-s)<d&&(t-=360),Math.abs(t+360-s)<d&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const d=t.lng-s.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,d){const _=Math.ceil(15*s/1e3),y=[],w=t(d.clone());for(let C=0;C<=_;C++){const z=w(C/_);y.push(z.clone())}return y}_preloadTiles(t,s){}}class Kd{constructor(t={}){this.options=t,i.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=xe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const _=xe("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",d),this._innerContainer=xe("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(t){const d=s.reduce((_,y,w)=>(y.value&&(_+=`${y.key}=${y.value}${w<s.length-1?"&":""}`),_),"?");t.href=`${i.e.FEEDBACK_URL}/${d}#${ch(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const s=this._map.style._mergedSourceCaches;for(const _ in s){const y=s[_];if(y.used){const w=y.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t.sort((_,y)=>_.length-y.length),t=t.filter((_,y)=>{for(let w=y+1;w<t.length;w++)if(t[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Rm{constructor(){i.aP(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=xe("div","mapboxgl-ctrl");const s=xe("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const d=t[s].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Aa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,d=s?this._queue.concat(s):this._queue;for(const _ of d)if(_.id===t)return void(_.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const d of s)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Jd{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=i.cB((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,d){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+d}}const ws={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ts=["mouseenter","mouseover","mouseleave","mouseout"];class Ia extends i.z{constructor(t,s,d,_){const{point:y,lngLat:w,originalEvent:C,target:z}=t;super(t.type,{point:y,lngLat:w,originalEvent:C,target:z}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=d,this.feature=_}}class Ca{constructor(t){this.map=t,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.delegatedHandlers=new Map,this.handleType=this.handleType.bind(this)}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const{type:d,filter:_}=s;_&&this.filters.set(t,i.aZ(_));const y=this.interactionsByType.get(d)||new Map;if(y.size===0){if(Ts.includes(d)){const{mousemove:w,mouseout:C}=this._createDelegatedHandlers(t,s);this.map.on("mousemove",w),this.map.on("mouseout",C),this.delegatedHandlers.set(t,{mousemove:w,mouseout:C})}else this.map.on(d,this.handleType);this.interactionsByType.set(d,y)}y.set(t,s),this.typeById.set(t,d)}get(t){const s=this.typeById.get(t);if(!s)return;const d=this.interactionsByType.get(s);return d?d.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(s);if(d){if(d.delete(t),this.delegatedHandlers.has(t)){const{mousemove:_,mouseout:y}=this.delegatedHandlers.get(t);this.map.off("mousemove",_),this.map.off("mouseout",y),this.delegatedHandlers.delete(t)}d.size===0&&this.map.off(s,this.handleType)}}queryTargets(t,s){const d=[];for(const[_,y]of s)y.target&&d.push({targetId:_,target:y.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleType(t,s){const d=this.interactionsByType.get(t.type),_=Array.from(d).reverse();s=s||this.queryTargets(t.point,_);let y=!1;for(const w of s){for(const[C,z]of _){if(!z.target)continue;const L=w.variants?w.variants[C]:null;if(L){for(const k of L){const N=new i.cw(w,k);if(z.handler(new Ia(t,C,z,N))!==!1){y=!0;break}}if(y)break}}if(y)break}if(!y)for(const[w,C]of _){const{handler:z,target:L}=C;if(!L&&z(new Ia(t,w,C,null))!==!1)break}}_createDelegatedHandlers(t,s){switch(s.type){case"mouseenter":case"mouseover":{let d=!1,_=new Set;return{mousemove:y=>{const w=this.queryTargets(y.point,[[t,s]]),C=new Set;if(!w.length)return d=!1,void _.clear();const z=[];for(const L of w)_.has(L.id)||(C.add(L.id),z.push(L));d&&!z.length||(d=!0,_=C,y.type=s.type,this.handleType(y,z))},mouseout:()=>{d=!1,_.clear()}}}case"mouseleave":case"mouseout":{let d=[];return{mousemove:_=>{const y=this.queryTargets(_.point,[[t,s]]);if(!y.length)return _.type=s.type,this.handleType(_,d),void(d=y);const w=[],C=new Set(y.map(z=>z.id));for(const z of d)C.has(z.id)||w.push(z);w.length&&(_.type=s.type,this.handleType(_,w)),d=y},mouseout:_=>{d.length&&(_.type=s.type,this.handleType(_,d),d=[])}}}}}}function El(h,t){if(Array.isArray(h)&&Array.isArray(t)){const s=new Set(h),d=new Set(t);return s.size===d.size&&h.every(_=>d.has(_))}return i.bn(h,t)}const Qd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Bi={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xo{constructor(t,s,d=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Zd({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new uh({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),i.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),Ye()}move(t,s){const d=this.map,_=this.mouseRotate.mousemoveWindow(t,s),y=_&&_.bearingDelta;if(y&&d.setBearing(d.getBearing()+y),this.mousePitch){const w=this.mousePitch.mousemoveWindow(t,s),C=w&&w.pitchDelta;C&&d.setPitch(d.getPitch()+C)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ct(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(i.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Ut(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Ut(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=si(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=si(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Lm(h,t,s){if(h=new i.bO(h.lng,h.lat),t){const d=new i.bO(h.lng-360,h.lat),_=new i.bO(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-s.center.lng)/360),w=s.locationPoint(h).distSqr(t),C=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint(d).distSqr(t)<w&&(C||Math.abs(d.lng-s.center.lng)<y)?h=d:s.locationPoint(_).distSqr(t)<w&&(C||Math.abs(_.lng-s.center.lng)<y)&&(h=_)}for(;Math.abs(h.lng-s.center.lng)>180;){const d=s.locationPoint(h);if(d.x>=0&&d.y>=0&&d.x<=s.width&&d.y<=s.height)break;h.lng>s.center.lng?h.lng-=360:h.lng+=360}return h}const ef={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Lc extends i.E{constructor(t,s){if(super(),(t instanceof HTMLElement||s)&&(t=i.l({element:t},s)),i.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=i.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=xe("div");const y=41,w=27,C=Fe("svg",{display:"block",height:y*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${y}`},this._element),z=Fe("radialGradient",{id:"shadowGradient"},Fe("defs",{},C));Fe("stop",{offset:"10%","stop-opacity":.4},z),Fe("stop",{offset:"100%","stop-opacity":.05},z),Fe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),Fe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),Fe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),Fe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=i.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const d=this._element.classList;for(const y in ef)d.remove(`mapboxgl-marker-anchor-${y}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);const _=t&&t.className?t.className.trim().split(/\s+/):[];d.add(..._),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=i.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,d=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,d=this._element;this._popup&&(s===d||d.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const d=t.unproject(s),_=t.getFreeCameraOptions();if(!_.position)return!1;const y=_.position.toLngLat();return y.distanceTo(d)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(s);let _;t._showingGlobe()&&i.dH(t.transform,this._lngLat)?_=0:(_=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${ef[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,d=this.getPitchAlignment();if(!s||!t||d!=="map")return"";if(!s._showingGlobe()){const z=s.getPitch();return z?`rotateX(${z}deg)`:""}const _=i.c4(i.dI(s.transform,this._lngLat)),y=t.sub(i.dJ(s.transform)),w=Math.abs(y.x)+Math.abs(y.y);if(w===0)return"";const C=_/w;return`rotateX(${-y.y*C}deg) rotateY(${y.x*C}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let d=0;const _=this.getRotationAlignment();if(_==="map")if(s._showingGlobe()){const y=s.project(new i.bO(this._lngLat.lng,this._lngLat.lat+.001)),w=s.project(new i.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);d=i.c4(Math.atan2(w.y,w.x))-90}else d=-s.getBearing();else if(_==="horizon"){const y=i.ac(4,6,s.getZoom()),w=i.dJ(s.transform);w.y+=y*s.transform.height;const C=t.sub(w),z=i.c4(Math.atan2(C.y,C.x));d=(z>90?z-270:z+90)*(1-y)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=Lm(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=i.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const d=this._pointerdownPos,_=this._positionDelta;if(d&&_){if(!this._isDragging){const y=this._clickTolerance||s._clickTolerance;if(t.point.dist(d)<y)return;this._isDragging=!0}this._pos=t.point.sub(_),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,d=this._pos;s&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Yo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},xo={maxWidth:100,unit:"metric"},zr={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Xr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},mr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function tf(h=new i.P(0,0),t="bottom"){if(typeof h=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new i.P(0,h);case"top-left":return new i.P(s,s);case"top-right":return new i.P(-s,s);case"bottom":return new i.P(0,-h);case"bottom-left":return new i.P(s,-s);case"bottom-right":return new i.P(-s,-s);case"left":return new i.P(h,0);case"right":return new i.P(-h,0)}return new i.P(0,0)}return h instanceof i.P||Array.isArray(h)?i.P.convert(h):i.P.convert(h[t]||[0,0])}return{version:R,supported:ge.supported,setRTLTextPlugin:i.dK,getRTLTextPluginStatus:i.dL,Map:class extends Yd{constructor(h){j.mark(V.create);const t=h;if((h=i.l({},Qd,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&i.dF(window)&&(h.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Du(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Aa,this._domRenderTaskQueue=new Aa,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aV(),this._locale=i.l({},ws,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Jd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new Fn(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?{...h.contextCreateOptions}:{},typeof h.container=="string"){const s=document.getElementById(h.container);if(!s)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=s}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,i.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Nd),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new zm(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||i.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this.indoor=new jp(this),h.hash&&(this._hash=new lh(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const s=h.bounds;s&&(this.resize(),this.fitBounds(s,i.l({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Kd({customAttribution:h.customAttribution})),this._logoControl=new Rm,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new i.z(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new i.z(`${s.dataType}dataloading`,s))}),this._interactions=new Ca(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(s,d.firstChild):d.appendChild(s),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new i.z("movestart",h)).fire(new i.z("move",h)),this.fire(new i.z("resize",h)),t&&this.fire(new i.z("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(i.az.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(t=>t==="auto"?navigator.language:t):h}setLanguage(h){const t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,t=h.projection.name;let s;t==="globe"&&h.zoom>=i.bY?(h.setMercatorFromTransition(),s=!0):t==="mercator"&&h.zoom<i.bY&&(h.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;return t=h.name==="globe"&&this.transform.zoom>=i.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(i.bO.convert(h))}unproject(h){return this.transform.pointLocation3D(i.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,s){const d=_=>{let y=[];if(Array.isArray(t)){const w=t.filter(C=>this.getLayer(C));y=w.length?this.queryRenderedFeatures(_,{layers:w}):[]}else y=this.queryRenderedFeatures(_,{target:t});return y};if(h==="mouseenter"||h==="mouseover"){let _=!1;return{listener:s,targets:t,delegates:{mousemove:w=>{const C=d(w.point);C.length?_||(_=!0,s.call(this,new Zr(h,this,w.originalEvent,{features:C}))):_=!1},mouseout:()=>{_=!1}}}}if(h==="mouseleave"||h==="mouseout"){let _=!1;return{listener:s,targets:t,delegates:{mousemove:C=>{d(C.point).length?_=!0:_&&(_=!1,s.call(this,new Zr(h,this,C.originalEvent)))},mouseout:C=>{_&&(_=!1,s.call(this,new Zr(h,this,C.originalEvent)))}}}}{const _=y=>{const w=d(y.point);w.length&&(y.features=w,s.call(this,y),delete y.features)};return{listener:s,targets:t,delegates:{[h]:_}}}}on(h,t,s){if(typeof t=="function"||s===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(h,t,s){if(typeof t=="function"||s===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,s);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(h,t,s){if(typeof t=="function"||s===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[h]:void 0;return d&&(_=>{for(let y=0;y<_.length;y++){const w=_[y];if(w.listener===s&&El(w.targets,t)){for(const C in w.delegates)this.off(C,w.delegates[C]);return _.splice(y,1),this}}})(d),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(h===void 0||h instanceof i.P||Array.isArray(h)||t!==void 0||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!t){const y=this.style.queryRenderedFeatures(h,void 0,this.transform),w=this.style.queryRenderedFeatureset(h,void 0,this.transform);return y.concat(w)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(h,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const y of t.layers)if(!this._isValidId(y)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(h,t,this.transform)}let _=[];return d&&(_=_.concat(this.style.queryRenderedFeatures(h,t,this.transform))),s&&(_=_.concat(this.style.queryRenderedFeatureset(h,t,this.transform))),_}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}isPointOnSurface(h){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&i.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}setStyle(h,t){return t=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,(s,d)=>{s?(i.w(`Unable to perform style diff: ${String(s.message||s.error||s)}. Rebuilding the style from scratch.`),this._updateStyle(h,t)):d&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const s=i.l({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new Ds(this,s).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.cr(h)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const t of h)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,s)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:s=1,sdf:d=!1,stretchX:_,stretchY:y,content:w}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:C,height:z,data:L}=i.q.getImageData(t);this.style.addImage(h,{data:new i.r({width:C,height:z},L),pixelRatio:s,stretchX:_,stretchY:y,content:w,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:z}=t,L=t;this.style.addImage(h,{data:new i.r({width:C,height:z},new Uint8Array(L.data)),pixelRatio:s,stretchX:_,stretchY:y,content:w,sdf:d,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();const s=this.style.getImage(h);if(!s)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?i.q.getImageData(t):t,{width:_,height:y,data:w}=d;if(_===void 0||y===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==(s.usvg?s.icon.usvg_tree.width:s.data.width)||y!==(s.usvg?s.icon.usvg_tree.height:s.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${_}, ${y})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`)));const C=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let z=!1;s.usvg?(s.data=new i.r({width:_,height:y},new Uint8Array(w)),s.usvg=!1,s.icon=void 0,z=!0):s.data.replace(w,C),this.style.updateImage(h,s,z)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){i.o(this._requestManager.transformRequest(h,i.R.Image),(s,d)=>{t(s,d instanceof HTMLImageElement?i.q.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){const t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,s){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,s),this._update(!0)):this}setFilter(h,t,s={}){return this._isValidId(h)?(this.style.setFilter(h,t,s),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,s,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,s,d),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,s,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,s,d),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,s){return this.style.setConfigProperty(h,t,s),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,t),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bO.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,d,_,y=this._container;for(;y&&(!d||!_);){const w=window.getComputedStyle(y).transform;w&&w!=="none"&&(s=w.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(d=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(_=s[3])),y=y.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=_?Math.abs(t/_):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=xe("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=xe("div","mapboxgl-canvas-container",h);this._canvas=xe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=xe("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{d[_]=xe("div",`mapboxgl-ctrl-${_}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const s=i.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(h),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const h=i.l({},ge.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(ke(t,!0),this.painter=new qd(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(t)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new i.z("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,d=i.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=_.createQuery(),_.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,k=this.transform.pitch,N=i.q.now(),B=new i.a8(L,{now:N,fadeDuration:y,pitch:k,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(d);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,j.mark(V.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const L=i.q.now()-d;_.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const k=_.getQueryParameter(t,_.QUERY_RESULT)/1e6;_.deleteQuery(t),this.fire(new i.z("gpu-timing-frame",{cpuTime:L,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(L);this.fire(new i.z("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(L);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:k}))},50)}const z=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(z||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(w=this._updateAverageElevation(d,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,j.mark(V.fullLoad),this._performanceMetricsCollection&&ti(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){const s=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const _=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=h;const w=Math.abs(_-y);if(w>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(y),s(y);this._averageElevation.easeTo(y,h,300)}else if(w>1e-4)return this._averageElevation.jumpTo(y),s(y)}return!!this._averageElevation.isEasing(h)&&s(this._averageElevation.getValue(h))}_authenticate(){me(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===tn||h.status===401)){const t=this.painter.context.gl;ke(t,!1),this._logoControl instanceof Rm&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ar(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&mn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,d=s.createFramebuffer();function _(y){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,y,0);const w=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,w),w}return s.bindFramebuffer(s.FRAMEBUFFER,d),this._canvasPixelComparison(_(h),t.canvasCopies.map(_),t.timeStamps)}_canvasPixelComparison(h,t,s){let d=s[1]-s[0];const _=h.length/4;for(let y=0;y<t.length;y++){const w=t[y];let C=0;for(let z=0;z<w.length;z+=4)w[z]===h[z]&&w[z+1]===h[z+1]&&w[z+2]===h[z+2]&&w[z+3]===h[z+3]&&(C+=1);d+=(s[y+2]-s[y+1])*(1-C/_)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),nn.delete(this.painter.context.gl),Xt.remove(),Qt.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=i.q.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(h){const t=this.style?this.style.getSourceCaches():[];return i.bl(t,(s,d)=>s._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,t){i.dG(h,t)}get version(){return R}},NavigationControl:class{constructor(h={}){this.options=i.l({},Bi,h),this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(i.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),xe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),xe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=xe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),s=t===h.getMaxZoom(),d=t===h.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xo(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const s=xe("button",h,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(h,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",s),h.firstElementChild&&h.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends i.E{constructor(h={}){super();const t=navigator.geolocation;this.options=i.l({geolocation:t},Yo,h),i.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ah(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,h(s)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>t(s.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),s=h.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",h)),this._finish()}}_updateCamera(h){const t=new i.bO(h.coords.longitude,h.coords.latitude),s=h.coords.accuracy,d=this._map.getBearing(),_=i.l({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),_,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new i.bO(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=i.bH(1,h._center.lat)*h.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=xe("button","mapboxgl-ctrl-geolocate",this._container),xe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xe("div","mapboxgl-user-location"),this._dotElement.appendChild(xe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(xe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Lc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=xe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Lc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Kd,ScaleControl:class{constructor(h={}){this.options=i.l({},xo,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,d=t._containerWidth/2-h/2,_=t.unproject([d,s]),y=t.unproject([d+h,s]),w=_.distanceTo(y);if(this.options.unit==="imperial"){const C=3.2808*w;C>5280?this._setScale(h,C/5280,"mile"):this._setScale(h,C,"foot")}else this.options.unit==="nautical"?this._setScale(h,w/1852,"nautical-mile"):w>=1e3?this._setScale(h,w/1e3,"kilometer"):this._setScale(h,w,"meter")}_setScale(h,t,s){this._map._requestDomTask(()=>{const d=function(y){const w=Math.pow(10,`${Math.floor(y)}`.length-1);let C=y/w;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(z){const L=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*L)/L}(C),w*C}(t),_=d/t;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(d):`${d}&nbsp;${zr[s]}`,this._container.style.width=h*_+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:i.w("Full screen control 'container' must be a DOM element.")),i.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=xe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);xe("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(h){super(),this.options=i.l(Object.create(Xr),h),i.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=i.bO.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),s=document.createElement("body");let d;for(s.innerHTML=h;d=s.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=xe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const s=this._closeButton=xe("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,d=this._pos;if(!t||!s||!d)return"bottom";const _=s.offsetWidth,y=s.offsetHeight,w=d.x<_/2,C=d.x>t.transform.width-_/2;if(d.y+h<y)return w?"top-left":C?"top-right":"top";if(d.y>t.transform.height-y){if(w)return"bottom-left";if(C)return"bottom-right"}return w?"left":C?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let d=this._container;if(d||(d=this._container=xe("div","mapboxgl-popup",t.getContainer()),this._tip=xe("div","mapboxgl-popup-tip",d),d.appendChild(s)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Lm(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h instanceof i.P?h:t.project(this._lngLat),y=tf(this.options.offset),w=this._anchor=this._getAnchor(y.y),C=tf(this.options.offset,w),z=_.add(C).round();t._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${ef[w]} translate(${z.x}px,${z.y}px)`)})}if(!this._marker&&t._showingGlobe()){const _=i.dH(t.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(mr);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Lc,Style:Ds,LngLat:i.bO,LngLatBounds:i.az,Point:i.P,MercatorCoordinate:i.aa,FreeCameraOptions:nl,Evented:i.E,config:i.e,prewarm:i.dM,clearPrewarmedResources:i.dN,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(h){i.e.ACCESS_TOKEN=h},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(h){i.e.API_URL=h},get workerCount(){return i.dO.workerCount},set workerCount(h){i.dO.workerCount=h},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){i.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){i.dP(h)},get workerUrl(){return i.dQ.workerUrl},set workerUrl(h){i.dQ.workerUrl=h},get workerClass(){return i.dQ.workerClass},set workerClass(h){i.dQ.workerClass=h},get workerParams(){return i.dQ.workerParams},set workerParams(h){i.dQ.workerParams=h},get dracoUrl(){return i.dR()},set dracoUrl(h){i.dS(h)},get meshoptUrl(){return i.dT()},set meshoptUrl(h){i.dU(h)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var E=g;return E})}(Z_)),Z_.exports}var HD=GD();const Ff=UD(HD),qD={name:"MapboxComponent",props:["mapboxToken"],emits:["fetchStationData"],mounted(){Ff.accessToken=this.mapboxToken;const a=new Ff.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[126.9778,37.5665],zoom:10});a.addControl(new Ff.NavigationControl),a.on("load",()=>{a.addSource("bikeStations",{type:"geojson",data:"/seoul_bike_stations.geojson"}),a.addSource("district",{type:"geojson",data:"/seoul_district.geojson",generateId:!0}),a.addLayer({id:"district-base",type:"fill",source:"district",paint:{"fill-color":["interpolate",["linear"],["get","population"],5e4,"#FFFFFF",1e5,"#D1C1E0",15e4,"#A18DC7",2e5,"#7F68A4",25e4,"#4C2E7A"],"fill-opacity":.7}}),a.addLayer({id:"district-outline",type:"line",source:"district",paint:{"line-color":["case",["boolean",["feature-state","hover"],!1],"#ffff00","#5b64b4"],"line-width":2,"line-opacity":["case",["boolean",["feature-state","hover"],!1],.7,.3]}}),a.addLayer({id:"bike-stations",type:"circle",source:"bikeStations",paint:{"circle-color":"#5b64b4","circle-radius":4}}),a.on("click","bike-stations",p=>{if(!p.features||p.features.length===0){console.warn("No features found at the clicked location.");return}const g=p.features[0].geometry,b=p.features[0].properties;if(g.type==="Point"||g.type==="MultiPoint"){const E=g.coordinates.slice();let i=E[0];for(;Math.abs(p.lngLat.lng-i)>180;)i+=p.lngLat.lng>i?360:-360;if(b)if(this.$emit("fetchStationData",b),Array.isArray(E)&&E.length===2){const R=E;new Ff.Popup().setLngLat(R).setHTML("<h3>Station Info</h3>").addTo(a)}else console.warn("Invalid coordinates:",E)}});const r=new Ff.Popup({closeButton:!1,closeOnClick:!1});a.on("mouseenter","district-base",function(p){if(a.getCanvas().style.cursor="pointer",p.features&&p.features[0].properties){const g=new Intl.NumberFormat("de-DE").format(p.features[0].properties.population),b=`
          <h3>${p.features[0].properties.SIG_ENG_NM}</h3>
          <p><strong>Population:</strong> ${g}</p>
          `;r.setLngLat(p.lngLat).setHTML(b).addTo(a)}}),a.on("mouseleave","district-base",function(){a.getCanvas().style.cursor="",r.remove()});let c=null;a.on("mousemove","district-outline",p=>{p.features&&p.features.length>0&&(c!==null?a.setFeatureState({source:"district",id:c},{hover:!1}):p.features[0].id&&(c=p.features[0].id,a.setFeatureState({source:"district",id:c},{hover:!0})))}),a.on("mouseenter","bike-stations",()=>{a.getCanvas().style.cursor="pointer"}),a.on("mouseleave","bike-stations",()=>{a.getCanvas().style.cursor=""})})}},Wa=(a,r)=>{const c=a.__vccOpts||a;for(const[p,g]of r)c[p]=g;return c};function $D(a,r,c,p,g,b){return $s(),Ro("div",null,r[0]||(r[0]=[cn("div",{id:"map"},null,-1)]))}const WD=Wa(qD,[["render",$D],["__scopeId","data-v-1a0b53ac"]]);/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Pp(a){return a+.5|0}const Gl=(a,r,c)=>Math.max(Math.min(a,c),r);function $f(a){return Gl(Pp(a*2.55),0,255)}function Zl(a){return Gl(Pp(a*255),0,255)}function Na(a){return Gl(Pp(a/2.55)/100,0,1)}function b2(a){return Gl(Pp(a*100),0,100)}const io={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},m0=[..."0123456789ABCDEF"],ZD=a=>m0[a&15],XD=a=>m0[(a&240)>>4]+m0[a&15],C_=a=>(a&240)>>4===(a&15),YD=a=>C_(a.r)&&C_(a.g)&&C_(a.b)&&C_(a.a);function KD(a){var r=a.length,c;return a[0]==="#"&&(r===4||r===5?c={r:255&io[a[1]]*17,g:255&io[a[2]]*17,b:255&io[a[3]]*17,a:r===5?io[a[4]]*17:255}:(r===7||r===9)&&(c={r:io[a[1]]<<4|io[a[2]],g:io[a[3]]<<4|io[a[4]],b:io[a[5]]<<4|io[a[6]],a:r===9?io[a[7]]<<4|io[a[8]]:255})),c}const JD=(a,r)=>a<255?r(a):"";function QD(a){var r=YD(a)?ZD:XD;return a?"#"+r(a.r)+r(a.g)+r(a.b)+JD(a.a,r):void 0}const ez=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function fM(a,r,c){const p=r*Math.min(c,1-c),g=(b,E=(b+a/30)%12)=>c-p*Math.max(Math.min(E-3,9-E,1),-1);return[g(0),g(8),g(4)]}function tz(a,r,c){const p=(g,b=(g+a/60)%6)=>c-c*r*Math.max(Math.min(b,4-b,1),0);return[p(5),p(3),p(1)]}function iz(a,r,c){const p=fM(a,1,.5);let g;for(r+c>1&&(g=1/(r+c),r*=g,c*=g),g=0;g<3;g++)p[g]*=1-r-c,p[g]+=r;return p}function nz(a,r,c,p,g){return a===g?(r-c)/p+(r<c?6:0):r===g?(c-a)/p+2:(a-r)/p+4}function Q0(a){const c=a.r/255,p=a.g/255,g=a.b/255,b=Math.max(c,p,g),E=Math.min(c,p,g),i=(b+E)/2;let R,V,j;return b!==E&&(j=b-E,V=i>.5?j/(2-b-E):j/(b+E),R=nz(c,p,g,j,b),R=R*60+.5),[R|0,V||0,i]}function ev(a,r,c,p){return(Array.isArray(r)?a(r[0],r[1],r[2]):a(r,c,p)).map(Zl)}function tv(a,r,c){return ev(fM,a,r,c)}function rz(a,r,c){return ev(iz,a,r,c)}function sz(a,r,c){return ev(tz,a,r,c)}function pM(a){return(a%360+360)%360}function oz(a){const r=ez.exec(a);let c=255,p;if(!r)return;r[5]!==p&&(c=r[6]?$f(+r[5]):Zl(+r[5]));const g=pM(+r[2]),b=+r[3]/100,E=+r[4]/100;return r[1]==="hwb"?p=rz(g,b,E):r[1]==="hsv"?p=sz(g,b,E):p=tv(g,b,E),{r:p[0],g:p[1],b:p[2],a:c}}function az(a,r){var c=Q0(a);c[0]=pM(c[0]+r),c=tv(c),a.r=c[0],a.g=c[1],a.b=c[2]}function lz(a){if(!a)return;const r=Q0(a),c=r[0],p=b2(r[1]),g=b2(r[2]);return a.a<255?`hsla(${c}, ${p}%, ${g}%, ${Na(a.a)})`:`hsl(${c}, ${p}%, ${g}%)`}const w2={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},T2={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function cz(){const a={},r=Object.keys(T2),c=Object.keys(w2);let p,g,b,E,i;for(p=0;p<r.length;p++){for(E=i=r[p],g=0;g<c.length;g++)b=c[g],i=i.replace(b,w2[b]);b=parseInt(T2[E],16),a[i]=[b>>16&255,b>>8&255,b&255]}return a}let P_;function uz(a){P_||(P_=cz(),P_.transparent=[0,0,0,0]);const r=P_[a.toLowerCase()];return r&&{r:r[0],g:r[1],b:r[2],a:r.length===4?r[3]:255}}const hz=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function dz(a){const r=hz.exec(a);let c=255,p,g,b;if(r){if(r[7]!==p){const E=+r[7];c=r[8]?$f(E):Gl(E*255,0,255)}return p=+r[1],g=+r[3],b=+r[5],p=255&(r[2]?$f(p):Gl(p,0,255)),g=255&(r[4]?$f(g):Gl(g,0,255)),b=255&(r[6]?$f(b):Gl(b,0,255)),{r:p,g,b,a:c}}}function fz(a){return a&&(a.a<255?`rgba(${a.r}, ${a.g}, ${a.b}, ${Na(a.a)})`:`rgb(${a.r}, ${a.g}, ${a.b})`)}const jx=a=>a<=.0031308?a*12.92:Math.pow(a,1/2.4)*1.055-.055,Fh=a=>a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4);function pz(a,r,c){const p=Fh(Na(a.r)),g=Fh(Na(a.g)),b=Fh(Na(a.b));return{r:Zl(jx(p+c*(Fh(Na(r.r))-p))),g:Zl(jx(g+c*(Fh(Na(r.g))-g))),b:Zl(jx(b+c*(Fh(Na(r.b))-b))),a:a.a+c*(r.a-a.a)}}function D_(a,r,c){if(a){let p=Q0(a);p[r]=Math.max(0,Math.min(p[r]+p[r]*c,r===0?360:1)),p=tv(p),a.r=p[0],a.g=p[1],a.b=p[2]}}function mM(a,r){return a&&Object.assign(r||{},a)}function S2(a){var r={r:0,g:0,b:0,a:255};return Array.isArray(a)?a.length>=3&&(r={r:a[0],g:a[1],b:a[2],a:255},a.length>3&&(r.a=Zl(a[3]))):(r=mM(a,{r:0,g:0,b:0,a:1}),r.a=Zl(r.a)),r}function mz(a){return a.charAt(0)==="r"?dz(a):oz(a)}class yp{constructor(r){if(r instanceof yp)return r;const c=typeof r;let p;c==="object"?p=S2(r):c==="string"&&(p=KD(r)||uz(r)||mz(r)),this._rgb=p,this._valid=!!p}get valid(){return this._valid}get rgb(){var r=mM(this._rgb);return r&&(r.a=Na(r.a)),r}set rgb(r){this._rgb=S2(r)}rgbString(){return this._valid?fz(this._rgb):void 0}hexString(){return this._valid?QD(this._rgb):void 0}hslString(){return this._valid?lz(this._rgb):void 0}mix(r,c){if(r){const p=this.rgb,g=r.rgb;let b;const E=c===b?.5:c,i=2*E-1,R=p.a-g.a,V=((i*R===-1?i:(i+R)/(1+i*R))+1)/2;b=1-V,p.r=255&V*p.r+b*g.r+.5,p.g=255&V*p.g+b*g.g+.5,p.b=255&V*p.b+b*g.b+.5,p.a=E*p.a+(1-E)*g.a,this.rgb=p}return this}interpolate(r,c){return r&&(this._rgb=pz(this._rgb,r._rgb,c)),this}clone(){return new yp(this.rgb)}alpha(r){return this._rgb.a=Zl(r),this}clearer(r){const c=this._rgb;return c.a*=1-r,this}greyscale(){const r=this._rgb,c=Pp(r.r*.3+r.g*.59+r.b*.11);return r.r=r.g=r.b=c,this}opaquer(r){const c=this._rgb;return c.a*=1+r,this}negate(){const r=this._rgb;return r.r=255-r.r,r.g=255-r.g,r.b=255-r.b,this}lighten(r){return D_(this._rgb,2,r),this}darken(r){return D_(this._rgb,2,-r),this}saturate(r){return D_(this._rgb,1,r),this}desaturate(r){return D_(this._rgb,1,-r),this}rotate(r){return az(this._rgb,r),this}}/*!
 * Chart.js v4.4.7
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function La(){}const _z=(()=>{let a=0;return()=>a++})();function bn(a){return a==null}function er(a){if(Array.isArray&&Array.isArray(a))return!0;const r=Object.prototype.toString.call(a);return r.slice(0,7)==="[object"&&r.slice(-6)==="Array]"}function pn(a){return a!==null&&Object.prototype.toString.call(a)==="[object Object]"}function fr(a){return(typeof a=="number"||a instanceof Number)&&isFinite(+a)}function Us(a,r){return fr(a)?a:r}function Wi(a,r){return typeof a>"u"?r:a}const gz=(a,r)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100:+a/r,_M=(a,r)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100*r:+a;function Un(a,r,c){if(a&&typeof a.call=="function")return a.apply(c,r)}function Ln(a,r,c,p){let g,b,E;if(er(a))for(b=a.length,g=0;g<b;g++)r.call(c,a[g],g);else if(pn(a))for(E=Object.keys(a),b=E.length,g=0;g<b;g++)r.call(c,a[E[g]],E[g])}function ug(a,r){let c,p,g,b;if(!a||!r||a.length!==r.length)return!1;for(c=0,p=a.length;c<p;++c)if(g=a[c],b=r[c],g.datasetIndex!==b.datasetIndex||g.index!==b.index)return!1;return!0}function hg(a){if(er(a))return a.map(hg);if(pn(a)){const r=Object.create(null),c=Object.keys(a),p=c.length;let g=0;for(;g<p;++g)r[c[g]]=hg(a[c[g]]);return r}return a}function gM(a){return["__proto__","prototype","constructor"].indexOf(a)===-1}function yz(a,r,c,p){if(!gM(a))return;const g=r[a],b=c[a];pn(g)&&pn(b)?xp(g,b,p):r[a]=hg(b)}function xp(a,r,c){const p=er(r)?r:[r],g=p.length;if(!pn(a))return a;c=c||{};const b=c.merger||yz;let E;for(let i=0;i<g;++i){if(E=p[i],!pn(E))continue;const R=Object.keys(E);for(let V=0,j=R.length;V<j;++V)b(R[V],a,E,c)}return a}function sp(a,r){return xp(a,r,{merger:xz})}function xz(a,r,c){if(!gM(a))return;const p=r[a],g=c[a];pn(p)&&pn(g)?sp(p,g):Object.prototype.hasOwnProperty.call(r,a)||(r[a]=hg(g))}const M2={"":a=>a,x:a=>a.x,y:a=>a.y};function vz(a){const r=a.split("."),c=[];let p="";for(const g of r)p+=g,p.endsWith("\\")?p=p.slice(0,-1)+".":(c.push(p),p="");return c}function bz(a){const r=vz(a);return c=>{for(const p of r){if(p==="")break;c=c&&c[p]}return c}}function Xl(a,r){return(M2[r]||(M2[r]=bz(r)))(a)}function iv(a){return a.charAt(0).toUpperCase()+a.slice(1)}const vp=a=>typeof a<"u",Yl=a=>typeof a=="function",E2=(a,r)=>{if(a.size!==r.size)return!1;for(const c of a)if(!r.has(c))return!1;return!0};function wz(a){return a.type==="mouseup"||a.type==="click"||a.type==="contextmenu"}const Jn=Math.PI,Kn=2*Jn,Tz=Kn+Jn,dg=Number.POSITIVE_INFINITY,Sz=Jn/180,_r=Jn/2,Wc=Jn/4,A2=Jn*2/3,Hl=Math.log10,oa=Math.sign;function op(a,r,c){return Math.abs(a-r)<c}function I2(a){const r=Math.round(a);a=op(a,r,a/1e3)?r:a;const c=Math.pow(10,Math.floor(Hl(a))),p=a/c;return(p<=1?1:p<=2?2:p<=5?5:10)*c}function Mz(a){const r=[],c=Math.sqrt(a);let p;for(p=1;p<c;p++)a%p===0&&(r.push(p),r.push(a/p));return c===(c|0)&&r.push(c),r.sort((g,b)=>g-b).pop(),r}function Xh(a){return!isNaN(parseFloat(a))&&isFinite(a)}function Ez(a,r){const c=Math.round(a);return c-r<=a&&c+r>=a}function yM(a,r,c){let p,g,b;for(p=0,g=a.length;p<g;p++)b=a[p][c],isNaN(b)||(r.min=Math.min(r.min,b),r.max=Math.max(r.max,b))}function Io(a){return a*(Jn/180)}function nv(a){return a*(180/Jn)}function C2(a){if(!fr(a))return;let r=1,c=0;for(;Math.round(a*r)/r!==a;)r*=10,c++;return c}function xM(a,r){const c=r.x-a.x,p=r.y-a.y,g=Math.sqrt(c*c+p*p);let b=Math.atan2(p,c);return b<-.5*Jn&&(b+=Kn),{angle:b,distance:g}}function _0(a,r){return Math.sqrt(Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2))}function Az(a,r){return(a-r+Tz)%Kn-Jn}function Gs(a){return(a%Kn+Kn)%Kn}function bp(a,r,c,p){const g=Gs(a),b=Gs(r),E=Gs(c),i=Gs(b-g),R=Gs(E-g),V=Gs(g-b),j=Gs(g-E);return g===b||g===E||p&&b===E||i>R&&V<j}function Lr(a,r,c){return Math.max(r,Math.min(c,a))}function Iz(a){return Lr(a,-32768,32767)}function ja(a,r,c,p=1e-6){return a>=Math.min(r,c)-p&&a<=Math.max(r,c)+p}function rv(a,r,c){c=c||(E=>a[E]<r);let p=a.length-1,g=0,b;for(;p-g>1;)b=g+p>>1,c(b)?g=b:p=b;return{lo:g,hi:p}}const Ga=(a,r,c,p)=>rv(a,c,p?g=>{const b=a[g][r];return b<c||b===c&&a[g+1][r]===c}:g=>a[g][r]<c),Cz=(a,r,c)=>rv(a,c,p=>a[p][r]>=c);function Pz(a,r,c){let p=0,g=a.length;for(;p<g&&a[p]<r;)p++;for(;g>p&&a[g-1]>c;)g--;return p>0||g<a.length?a.slice(p,g):a}const vM=["push","pop","shift","splice","unshift"];function Dz(a,r){if(a._chartjs){a._chartjs.listeners.push(r);return}Object.defineProperty(a,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),vM.forEach(c=>{const p="_onData"+iv(c),g=a[c];Object.defineProperty(a,c,{configurable:!0,enumerable:!1,value(...b){const E=g.apply(this,b);return a._chartjs.listeners.forEach(i=>{typeof i[p]=="function"&&i[p](...b)}),E}})})}function P2(a,r){const c=a._chartjs;if(!c)return;const p=c.listeners,g=p.indexOf(r);g!==-1&&p.splice(g,1),!(p.length>0)&&(vM.forEach(b=>{delete a[b]}),delete a._chartjs)}function bM(a){const r=new Set(a);return r.size===a.length?a:Array.from(r)}const wM=function(){return typeof window>"u"?function(a){return a()}:window.requestAnimationFrame}();function TM(a,r){let c=[],p=!1;return function(...g){c=g,p||(p=!0,wM.call(window,()=>{p=!1,a.apply(r,c)}))}}function zz(a,r){let c;return function(...p){return r?(clearTimeout(c),c=setTimeout(a,r,p)):a.apply(this,p),r}}const sv=a=>a==="start"?"left":a==="end"?"right":"center",es=(a,r,c)=>a==="start"?r:a==="end"?c:(r+c)/2,Rz=(a,r,c,p)=>a===(p?"left":"right")?c:a==="center"?(r+c)/2:r;function SM(a,r,c){const p=r.length;let g=0,b=p;if(a._sorted){const{iScale:E,_parsed:i}=a,R=E.axis,{min:V,max:j,minDefined:W,maxDefined:te}=E.getUserBounds();W&&(g=Lr(Math.min(Ga(i,R,V).lo,c?p:Ga(r,R,E.getPixelForValue(V)).lo),0,p-1)),te?b=Lr(Math.max(Ga(i,E.axis,j,!0).hi+1,c?0:Ga(r,R,E.getPixelForValue(j),!0).hi+1),g,p)-g:b=p-g}return{start:g,count:b}}function MM(a){const{xScale:r,yScale:c,_scaleRanges:p}=a,g={xmin:r.min,xmax:r.max,ymin:c.min,ymax:c.max};if(!p)return a._scaleRanges=g,!0;const b=p.xmin!==r.min||p.xmax!==r.max||p.ymin!==c.min||p.ymax!==c.max;return Object.assign(p,g),b}const z_=a=>a===0||a===1,D2=(a,r,c)=>-(Math.pow(2,10*(a-=1))*Math.sin((a-r)*Kn/c)),z2=(a,r,c)=>Math.pow(2,-10*a)*Math.sin((a-r)*Kn/c)+1,ap={linear:a=>a,easeInQuad:a=>a*a,easeOutQuad:a=>-a*(a-2),easeInOutQuad:a=>(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1),easeInCubic:a=>a*a*a,easeOutCubic:a=>(a-=1)*a*a+1,easeInOutCubic:a=>(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2),easeInQuart:a=>a*a*a*a,easeOutQuart:a=>-((a-=1)*a*a*a-1),easeInOutQuart:a=>(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2),easeInQuint:a=>a*a*a*a*a,easeOutQuint:a=>(a-=1)*a*a*a*a+1,easeInOutQuint:a=>(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2),easeInSine:a=>-Math.cos(a*_r)+1,easeOutSine:a=>Math.sin(a*_r),easeInOutSine:a=>-.5*(Math.cos(Jn*a)-1),easeInExpo:a=>a===0?0:Math.pow(2,10*(a-1)),easeOutExpo:a=>a===1?1:-Math.pow(2,-10*a)+1,easeInOutExpo:a=>z_(a)?a:a<.5?.5*Math.pow(2,10*(a*2-1)):.5*(-Math.pow(2,-10*(a*2-1))+2),easeInCirc:a=>a>=1?a:-(Math.sqrt(1-a*a)-1),easeOutCirc:a=>Math.sqrt(1-(a-=1)*a),easeInOutCirc:a=>(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1),easeInElastic:a=>z_(a)?a:D2(a,.075,.3),easeOutElastic:a=>z_(a)?a:z2(a,.075,.3),easeInOutElastic(a){return z_(a)?a:a<.5?.5*D2(a*2,.1125,.45):.5+.5*z2(a*2-1,.1125,.45)},easeInBack(a){return a*a*((1.70158+1)*a-1.70158)},easeOutBack(a){return(a-=1)*a*((1.70158+1)*a+1.70158)+1},easeInOutBack(a){let r=1.70158;return(a/=.5)<1?.5*(a*a*(((r*=1.525)+1)*a-r)):.5*((a-=2)*a*(((r*=1.525)+1)*a+r)+2)},easeInBounce:a=>1-ap.easeOutBounce(1-a),easeOutBounce(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInOutBounce:a=>a<.5?ap.easeInBounce(a*2)*.5:ap.easeOutBounce(a*2-1)*.5+.5};function ov(a){if(a&&typeof a=="object"){const r=a.toString();return r==="[object CanvasPattern]"||r==="[object CanvasGradient]"}return!1}function R2(a){return ov(a)?a:new yp(a)}function Gx(a){return ov(a)?a:new yp(a).saturate(.5).darken(.1).hexString()}const Lz=["x","y","borderWidth","radius","tension"],kz=["color","borderColor","backgroundColor"];function Oz(a){a.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),a.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:r=>r!=="onProgress"&&r!=="onComplete"&&r!=="fn"}),a.set("animations",{colors:{type:"color",properties:kz},numbers:{type:"number",properties:Lz}}),a.describe("animations",{_fallback:"animation"}),a.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:r=>r|0}}}})}function Fz(a){a.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const L2=new Map;function Bz(a,r){r=r||{};const c=a+JSON.stringify(r);let p=L2.get(c);return p||(p=new Intl.NumberFormat(a,r),L2.set(c,p)),p}function Dp(a,r,c){return Bz(r,c).format(a)}const EM={values(a){return er(a)?a:""+a},numeric(a,r,c){if(a===0)return"0";const p=this.chart.options.locale;let g,b=a;if(c.length>1){const V=Math.max(Math.abs(c[0].value),Math.abs(c[c.length-1].value));(V<1e-4||V>1e15)&&(g="scientific"),b=Nz(a,c)}const E=Hl(Math.abs(b)),i=isNaN(E)?1:Math.max(Math.min(-1*Math.floor(E),20),0),R={notation:g,minimumFractionDigits:i,maximumFractionDigits:i};return Object.assign(R,this.options.ticks.format),Dp(a,p,R)},logarithmic(a,r,c){if(a===0)return"0";const p=c[r].significand||a/Math.pow(10,Math.floor(Hl(a)));return[1,2,3,5,10,15].includes(p)||r>.8*c.length?EM.numeric.call(this,a,r,c):""}};function Nz(a,r){let c=r.length>3?r[2].value-r[1].value:r[1].value-r[0].value;return Math.abs(c)>=1&&a!==Math.floor(a)&&(c=a-Math.floor(a)),c}var Cg={formatters:EM};function Vz(a){a.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(r,c)=>c.lineWidth,tickColor:(r,c)=>c.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Cg.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),a.route("scale.ticks","color","","color"),a.route("scale.grid","color","","borderColor"),a.route("scale.border","color","","borderColor"),a.route("scale.title","color","","color"),a.describe("scale",{_fallback:!1,_scriptable:r=>!r.startsWith("before")&&!r.startsWith("after")&&r!=="callback"&&r!=="parser",_indexable:r=>r!=="borderDash"&&r!=="tickBorderDash"&&r!=="dash"}),a.describe("scales",{_fallback:"scale"}),a.describe("scale.ticks",{_scriptable:r=>r!=="backdropPadding"&&r!=="callback",_indexable:r=>r!=="backdropPadding"})}const su=Object.create(null),g0=Object.create(null);function lp(a,r){if(!r)return a;const c=r.split(".");for(let p=0,g=c.length;p<g;++p){const b=c[p];a=a[b]||(a[b]=Object.create(null))}return a}function Hx(a,r,c){return typeof r=="string"?xp(lp(a,r),c):xp(lp(a,""),r)}class Uz{constructor(r,c){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=p=>p.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(p,g)=>Gx(g.backgroundColor),this.hoverBorderColor=(p,g)=>Gx(g.borderColor),this.hoverColor=(p,g)=>Gx(g.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(r),this.apply(c)}set(r,c){return Hx(this,r,c)}get(r){return lp(this,r)}describe(r,c){return Hx(g0,r,c)}override(r,c){return Hx(su,r,c)}route(r,c,p,g){const b=lp(this,r),E=lp(this,p),i="_"+c;Object.defineProperties(b,{[i]:{value:b[c],writable:!0},[c]:{enumerable:!0,get(){const R=this[i],V=E[g];return pn(R)?Object.assign({},V,R):Wi(R,V)},set(R){this[i]=R}}})}apply(r){r.forEach(c=>c(this))}}var tr=new Uz({_scriptable:a=>!a.startsWith("on"),_indexable:a=>a!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Oz,Fz,Vz]);function jz(a){return!a||bn(a.size)||bn(a.family)?null:(a.style?a.style+" ":"")+(a.weight?a.weight+" ":"")+a.size+"px "+a.family}function fg(a,r,c,p,g){let b=r[g];return b||(b=r[g]=a.measureText(g).width,c.push(g)),b>p&&(p=b),p}function Gz(a,r,c,p){p=p||{};let g=p.data=p.data||{},b=p.garbageCollect=p.garbageCollect||[];p.font!==r&&(g=p.data={},b=p.garbageCollect=[],p.font=r),a.save(),a.font=r;let E=0;const i=c.length;let R,V,j,W,te;for(R=0;R<i;R++)if(W=c[R],W!=null&&!er(W))E=fg(a,g,b,E,W);else if(er(W))for(V=0,j=W.length;V<j;V++)te=W[V],te!=null&&!er(te)&&(E=fg(a,g,b,E,te));a.restore();const ne=b.length/2;if(ne>c.length){for(R=0;R<ne;R++)delete g[b[R]];b.splice(0,ne)}return E}function Zc(a,r,c){const p=a.currentDevicePixelRatio,g=c!==0?Math.max(c/2,.5):0;return Math.round((r-g)*p)/p+g}function k2(a,r){!r&&!a||(r=r||a.getContext("2d"),r.save(),r.resetTransform(),r.clearRect(0,0,a.width,a.height),r.restore())}function y0(a,r,c,p){AM(a,r,c,p,null)}function AM(a,r,c,p,g){let b,E,i,R,V,j,W,te;const ne=r.pointStyle,ge=r.rotation,xe=r.radius;let Fe=(ge||0)*Sz;if(ne&&typeof ne=="object"&&(b=ne.toString(),b==="[object HTMLImageElement]"||b==="[object HTMLCanvasElement]")){a.save(),a.translate(c,p),a.rotate(Fe),a.drawImage(ne,-ne.width/2,-ne.height/2,ne.width,ne.height),a.restore();return}if(!(isNaN(xe)||xe<=0)){switch(a.beginPath(),ne){default:g?a.ellipse(c,p,g/2,xe,0,0,Kn):a.arc(c,p,xe,0,Kn),a.closePath();break;case"triangle":j=g?g/2:xe,a.moveTo(c+Math.sin(Fe)*j,p-Math.cos(Fe)*xe),Fe+=A2,a.lineTo(c+Math.sin(Fe)*j,p-Math.cos(Fe)*xe),Fe+=A2,a.lineTo(c+Math.sin(Fe)*j,p-Math.cos(Fe)*xe),a.closePath();break;case"rectRounded":V=xe*.516,R=xe-V,E=Math.cos(Fe+Wc)*R,W=Math.cos(Fe+Wc)*(g?g/2-V:R),i=Math.sin(Fe+Wc)*R,te=Math.sin(Fe+Wc)*(g?g/2-V:R),a.arc(c-W,p-i,V,Fe-Jn,Fe-_r),a.arc(c+te,p-E,V,Fe-_r,Fe),a.arc(c+W,p+i,V,Fe,Fe+_r),a.arc(c-te,p+E,V,Fe+_r,Fe+Jn),a.closePath();break;case"rect":if(!ge){R=Math.SQRT1_2*xe,j=g?g/2:R,a.rect(c-j,p-R,2*j,2*R);break}Fe+=Wc;case"rectRot":W=Math.cos(Fe)*(g?g/2:xe),E=Math.cos(Fe)*xe,i=Math.sin(Fe)*xe,te=Math.sin(Fe)*(g?g/2:xe),a.moveTo(c-W,p-i),a.lineTo(c+te,p-E),a.lineTo(c+W,p+i),a.lineTo(c-te,p+E),a.closePath();break;case"crossRot":Fe+=Wc;case"cross":W=Math.cos(Fe)*(g?g/2:xe),E=Math.cos(Fe)*xe,i=Math.sin(Fe)*xe,te=Math.sin(Fe)*(g?g/2:xe),a.moveTo(c-W,p-i),a.lineTo(c+W,p+i),a.moveTo(c+te,p-E),a.lineTo(c-te,p+E);break;case"star":W=Math.cos(Fe)*(g?g/2:xe),E=Math.cos(Fe)*xe,i=Math.sin(Fe)*xe,te=Math.sin(Fe)*(g?g/2:xe),a.moveTo(c-W,p-i),a.lineTo(c+W,p+i),a.moveTo(c+te,p-E),a.lineTo(c-te,p+E),Fe+=Wc,W=Math.cos(Fe)*(g?g/2:xe),E=Math.cos(Fe)*xe,i=Math.sin(Fe)*xe,te=Math.sin(Fe)*(g?g/2:xe),a.moveTo(c-W,p-i),a.lineTo(c+W,p+i),a.moveTo(c+te,p-E),a.lineTo(c-te,p+E);break;case"line":E=g?g/2:Math.cos(Fe)*xe,i=Math.sin(Fe)*xe,a.moveTo(c-E,p-i),a.lineTo(c+E,p+i);break;case"dash":a.moveTo(c,p),a.lineTo(c+Math.cos(Fe)*(g?g/2:xe),p+Math.sin(Fe)*xe);break;case!1:a.closePath();break}a.fill(),r.borderWidth>0&&a.stroke()}}function Ha(a,r,c){return c=c||.5,!r||a&&a.x>r.left-c&&a.x<r.right+c&&a.y>r.top-c&&a.y<r.bottom+c}function Pg(a,r){a.save(),a.beginPath(),a.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),a.clip()}function Dg(a){a.restore()}function Hz(a,r,c,p,g){if(!r)return a.lineTo(c.x,c.y);if(g==="middle"){const b=(r.x+c.x)/2;a.lineTo(b,r.y),a.lineTo(b,c.y)}else g==="after"!=!!p?a.lineTo(r.x,c.y):a.lineTo(c.x,r.y);a.lineTo(c.x,c.y)}function qz(a,r,c,p){if(!r)return a.lineTo(c.x,c.y);a.bezierCurveTo(p?r.cp1x:r.cp2x,p?r.cp1y:r.cp2y,p?c.cp2x:c.cp1x,p?c.cp2y:c.cp1y,c.x,c.y)}function $z(a,r){r.translation&&a.translate(r.translation[0],r.translation[1]),bn(r.rotation)||a.rotate(r.rotation),r.color&&(a.fillStyle=r.color),r.textAlign&&(a.textAlign=r.textAlign),r.textBaseline&&(a.textBaseline=r.textBaseline)}function Wz(a,r,c,p,g){if(g.strikethrough||g.underline){const b=a.measureText(p),E=r-b.actualBoundingBoxLeft,i=r+b.actualBoundingBoxRight,R=c-b.actualBoundingBoxAscent,V=c+b.actualBoundingBoxDescent,j=g.strikethrough?(R+V)/2:V;a.strokeStyle=a.fillStyle,a.beginPath(),a.lineWidth=g.decorationWidth||2,a.moveTo(E,j),a.lineTo(i,j),a.stroke()}}function Zz(a,r){const c=a.fillStyle;a.fillStyle=r.color,a.fillRect(r.left,r.top,r.width,r.height),a.fillStyle=c}function ou(a,r,c,p,g,b={}){const E=er(r)?r:[r],i=b.strokeWidth>0&&b.strokeColor!=="";let R,V;for(a.save(),a.font=g.string,$z(a,b),R=0;R<E.length;++R)V=E[R],b.backdrop&&Zz(a,b.backdrop),i&&(b.strokeColor&&(a.strokeStyle=b.strokeColor),bn(b.strokeWidth)||(a.lineWidth=b.strokeWidth),a.strokeText(V,c,p,b.maxWidth)),a.fillText(V,c,p,b.maxWidth),Wz(a,c,p,V,b),p+=Number(g.lineHeight);a.restore()}function wp(a,r){const{x:c,y:p,w:g,h:b,radius:E}=r;a.arc(c+E.topLeft,p+E.topLeft,E.topLeft,1.5*Jn,Jn,!0),a.lineTo(c,p+b-E.bottomLeft),a.arc(c+E.bottomLeft,p+b-E.bottomLeft,E.bottomLeft,Jn,_r,!0),a.lineTo(c+g-E.bottomRight,p+b),a.arc(c+g-E.bottomRight,p+b-E.bottomRight,E.bottomRight,_r,0,!0),a.lineTo(c+g,p+E.topRight),a.arc(c+g-E.topRight,p+E.topRight,E.topRight,0,-_r,!0),a.lineTo(c+E.topLeft,p)}const Xz=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Yz=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Kz(a,r){const c=(""+a).match(Xz);if(!c||c[1]==="normal")return r*1.2;switch(a=+c[2],c[3]){case"px":return a;case"%":a/=100;break}return r*a}const Jz=a=>+a||0;function av(a,r){const c={},p=pn(r),g=p?Object.keys(r):r,b=pn(a)?p?E=>Wi(a[E],a[r[E]]):E=>a[E]:()=>a;for(const E of g)c[E]=Jz(b(E));return c}function IM(a){return av(a,{top:"y",right:"x",bottom:"y",left:"x"})}function iu(a){return av(a,["topLeft","topRight","bottomLeft","bottomRight"])}function os(a){const r=IM(a);return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function Cr(a,r){a=a||{},r=r||tr.font;let c=Wi(a.size,r.size);typeof c=="string"&&(c=parseInt(c,10));let p=Wi(a.style,r.style);p&&!(""+p).match(Yz)&&(console.warn('Invalid font style specified: "'+p+'"'),p=void 0);const g={family:Wi(a.family,r.family),lineHeight:Kz(Wi(a.lineHeight,r.lineHeight),c),size:c,style:p,weight:Wi(a.weight,r.weight),string:""};return g.string=jz(g),g}function Wf(a,r,c,p){let g,b,E;for(g=0,b=a.length;g<b;++g)if(E=a[g],E!==void 0&&E!==void 0)return E}function Qz(a,r,c){const{min:p,max:g}=a,b=_M(r,(g-p)/2),E=(i,R)=>c&&i===0?0:i+R;return{min:E(p,-Math.abs(b)),max:E(g,b)}}function Ql(a,r){return Object.assign(Object.create(a),r)}function lv(a,r=[""],c,p,g=()=>a[0]){const b=c||a;typeof p>"u"&&(p=zM("_fallback",a));const E={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:a,_rootScopes:b,_fallback:p,_getTarget:g,override:i=>lv([i,...a],r,b,p)};return new Proxy(E,{deleteProperty(i,R){return delete i[R],delete i._keys,delete a[0][R],!0},get(i,R){return PM(i,R,()=>a3(R,r,a,i))},getOwnPropertyDescriptor(i,R){return Reflect.getOwnPropertyDescriptor(i._scopes[0],R)},getPrototypeOf(){return Reflect.getPrototypeOf(a[0])},has(i,R){return F2(i).includes(R)},ownKeys(i){return F2(i)},set(i,R,V){const j=i._storage||(i._storage=g());return i[R]=j[R]=V,delete i._keys,!0}})}function Yh(a,r,c,p){const g={_cacheable:!1,_proxy:a,_context:r,_subProxy:c,_stack:new Set,_descriptors:CM(a,p),setContext:b=>Yh(a,b,c,p),override:b=>Yh(a.override(b),r,c,p)};return new Proxy(g,{deleteProperty(b,E){return delete b[E],delete a[E],!0},get(b,E,i){return PM(b,E,()=>t3(b,E,i))},getOwnPropertyDescriptor(b,E){return b._descriptors.allKeys?Reflect.has(a,E)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(a,E)},getPrototypeOf(){return Reflect.getPrototypeOf(a)},has(b,E){return Reflect.has(a,E)},ownKeys(){return Reflect.ownKeys(a)},set(b,E,i){return a[E]=i,delete b[E],!0}})}function CM(a,r={scriptable:!0,indexable:!0}){const{_scriptable:c=r.scriptable,_indexable:p=r.indexable,_allKeys:g=r.allKeys}=a;return{allKeys:g,scriptable:c,indexable:p,isScriptable:Yl(c)?c:()=>c,isIndexable:Yl(p)?p:()=>p}}const e3=(a,r)=>a?a+iv(r):r,cv=(a,r)=>pn(r)&&a!=="adapters"&&(Object.getPrototypeOf(r)===null||r.constructor===Object);function PM(a,r,c){if(Object.prototype.hasOwnProperty.call(a,r)||r==="constructor")return a[r];const p=c();return a[r]=p,p}function t3(a,r,c){const{_proxy:p,_context:g,_subProxy:b,_descriptors:E}=a;let i=p[r];return Yl(i)&&E.isScriptable(r)&&(i=i3(r,i,a,c)),er(i)&&i.length&&(i=n3(r,i,a,E.isIndexable)),cv(r,i)&&(i=Yh(i,g,b&&b[r],E)),i}function i3(a,r,c,p){const{_proxy:g,_context:b,_subProxy:E,_stack:i}=c;if(i.has(a))throw new Error("Recursion detected: "+Array.from(i).join("->")+"->"+a);i.add(a);let R=r(b,E||p);return i.delete(a),cv(a,R)&&(R=uv(g._scopes,g,a,R)),R}function n3(a,r,c,p){const{_proxy:g,_context:b,_subProxy:E,_descriptors:i}=c;if(typeof b.index<"u"&&p(a))return r[b.index%r.length];if(pn(r[0])){const R=r,V=g._scopes.filter(j=>j!==R);r=[];for(const j of R){const W=uv(V,g,a,j);r.push(Yh(W,b,E&&E[a],i))}}return r}function DM(a,r,c){return Yl(a)?a(r,c):a}const r3=(a,r)=>a===!0?r:typeof a=="string"?Xl(r,a):void 0;function s3(a,r,c,p,g){for(const b of r){const E=r3(c,b);if(E){a.add(E);const i=DM(E._fallback,c,g);if(typeof i<"u"&&i!==c&&i!==p)return i}else if(E===!1&&typeof p<"u"&&c!==p)return null}return!1}function uv(a,r,c,p){const g=r._rootScopes,b=DM(r._fallback,c,p),E=[...a,...g],i=new Set;i.add(p);let R=O2(i,E,c,b||c,p);return R===null||typeof b<"u"&&b!==c&&(R=O2(i,E,b,R,p),R===null)?!1:lv(Array.from(i),[""],g,b,()=>o3(r,c,p))}function O2(a,r,c,p,g){for(;c;)c=s3(a,r,c,p,g);return c}function o3(a,r,c){const p=a._getTarget();r in p||(p[r]={});const g=p[r];return er(g)&&pn(c)?c:g||{}}function a3(a,r,c,p){let g;for(const b of r)if(g=zM(e3(b,a),c),typeof g<"u")return cv(a,g)?uv(c,p,a,g):g}function zM(a,r){for(const c of r){if(!c)continue;const p=c[a];if(typeof p<"u")return p}}function F2(a){let r=a._keys;return r||(r=a._keys=l3(a._scopes)),r}function l3(a){const r=new Set;for(const c of a)for(const p of Object.keys(c).filter(g=>!g.startsWith("_")))r.add(p);return Array.from(r)}function RM(a,r,c,p){const{iScale:g}=a,{key:b="r"}=this._parsing,E=new Array(p);let i,R,V,j;for(i=0,R=p;i<R;++i)V=i+c,j=r[V],E[i]={r:g.parse(Xl(j,b),V)};return E}const c3=Number.EPSILON||1e-14,Kh=(a,r)=>r<a.length&&!a[r].skip&&a[r],LM=a=>a==="x"?"y":"x";function u3(a,r,c,p){const g=a.skip?r:a,b=r,E=c.skip?r:c,i=_0(b,g),R=_0(E,b);let V=i/(i+R),j=R/(i+R);V=isNaN(V)?0:V,j=isNaN(j)?0:j;const W=p*V,te=p*j;return{previous:{x:b.x-W*(E.x-g.x),y:b.y-W*(E.y-g.y)},next:{x:b.x+te*(E.x-g.x),y:b.y+te*(E.y-g.y)}}}function h3(a,r,c){const p=a.length;let g,b,E,i,R,V=Kh(a,0);for(let j=0;j<p-1;++j)if(R=V,V=Kh(a,j+1),!(!R||!V)){if(op(r[j],0,c3)){c[j]=c[j+1]=0;continue}g=c[j]/r[j],b=c[j+1]/r[j],i=Math.pow(g,2)+Math.pow(b,2),!(i<=9)&&(E=3/Math.sqrt(i),c[j]=g*E*r[j],c[j+1]=b*E*r[j])}}function d3(a,r,c="x"){const p=LM(c),g=a.length;let b,E,i,R=Kh(a,0);for(let V=0;V<g;++V){if(E=i,i=R,R=Kh(a,V+1),!i)continue;const j=i[c],W=i[p];E&&(b=(j-E[c])/3,i[`cp1${c}`]=j-b,i[`cp1${p}`]=W-b*r[V]),R&&(b=(R[c]-j)/3,i[`cp2${c}`]=j+b,i[`cp2${p}`]=W+b*r[V])}}function f3(a,r="x"){const c=LM(r),p=a.length,g=Array(p).fill(0),b=Array(p);let E,i,R,V=Kh(a,0);for(E=0;E<p;++E)if(i=R,R=V,V=Kh(a,E+1),!!R){if(V){const j=V[r]-R[r];g[E]=j!==0?(V[c]-R[c])/j:0}b[E]=i?V?oa(g[E-1])!==oa(g[E])?0:(g[E-1]+g[E])/2:g[E-1]:g[E]}h3(a,g,b),d3(a,b,r)}function R_(a,r,c){return Math.max(Math.min(a,c),r)}function p3(a,r){let c,p,g,b,E,i=Ha(a[0],r);for(c=0,p=a.length;c<p;++c)E=b,b=i,i=c<p-1&&Ha(a[c+1],r),b&&(g=a[c],E&&(g.cp1x=R_(g.cp1x,r.left,r.right),g.cp1y=R_(g.cp1y,r.top,r.bottom)),i&&(g.cp2x=R_(g.cp2x,r.left,r.right),g.cp2y=R_(g.cp2y,r.top,r.bottom)))}function m3(a,r,c,p,g){let b,E,i,R;if(r.spanGaps&&(a=a.filter(V=>!V.skip)),r.cubicInterpolationMode==="monotone")f3(a,g);else{let V=p?a[a.length-1]:a[0];for(b=0,E=a.length;b<E;++b)i=a[b],R=u3(V,i,a[Math.min(b+1,E-(p?0:1))%E],r.tension),i.cp1x=R.previous.x,i.cp1y=R.previous.y,i.cp2x=R.next.x,i.cp2y=R.next.y,V=i}r.capBezierPoints&&p3(a,c)}function hv(){return typeof window<"u"&&typeof document<"u"}function dv(a){let r=a.parentNode;return r&&r.toString()==="[object ShadowRoot]"&&(r=r.host),r}function pg(a,r,c){let p;return typeof a=="string"?(p=parseInt(a,10),a.indexOf("%")!==-1&&(p=p/100*r.parentNode[c])):p=a,p}const zg=a=>a.ownerDocument.defaultView.getComputedStyle(a,null);function _3(a,r){return zg(a).getPropertyValue(r)}const g3=["top","right","bottom","left"];function nu(a,r,c){const p={};c=c?"-"+c:"";for(let g=0;g<4;g++){const b=g3[g];p[b]=parseFloat(a[r+"-"+b+c])||0}return p.width=p.left+p.right,p.height=p.top+p.bottom,p}const y3=(a,r,c)=>(a>0||r>0)&&(!c||!c.shadowRoot);function x3(a,r){const c=a.touches,p=c&&c.length?c[0]:a,{offsetX:g,offsetY:b}=p;let E=!1,i,R;if(y3(g,b,a.target))i=g,R=b;else{const V=r.getBoundingClientRect();i=p.clientX-V.left,R=p.clientY-V.top,E=!0}return{x:i,y:R,box:E}}function Jc(a,r){if("native"in a)return a;const{canvas:c,currentDevicePixelRatio:p}=r,g=zg(c),b=g.boxSizing==="border-box",E=nu(g,"padding"),i=nu(g,"border","width"),{x:R,y:V,box:j}=x3(a,c),W=E.left+(j&&i.left),te=E.top+(j&&i.top);let{width:ne,height:ge}=r;return b&&(ne-=E.width+i.width,ge-=E.height+i.height),{x:Math.round((R-W)/ne*c.width/p),y:Math.round((V-te)/ge*c.height/p)}}function v3(a,r,c){let p,g;if(r===void 0||c===void 0){const b=a&&dv(a);if(!b)r=a.clientWidth,c=a.clientHeight;else{const E=b.getBoundingClientRect(),i=zg(b),R=nu(i,"border","width"),V=nu(i,"padding");r=E.width-V.width-R.width,c=E.height-V.height-R.height,p=pg(i.maxWidth,b,"clientWidth"),g=pg(i.maxHeight,b,"clientHeight")}}return{width:r,height:c,maxWidth:p||dg,maxHeight:g||dg}}const L_=a=>Math.round(a*10)/10;function b3(a,r,c,p){const g=zg(a),b=nu(g,"margin"),E=pg(g.maxWidth,a,"clientWidth")||dg,i=pg(g.maxHeight,a,"clientHeight")||dg,R=v3(a,r,c);let{width:V,height:j}=R;if(g.boxSizing==="content-box"){const te=nu(g,"border","width"),ne=nu(g,"padding");V-=ne.width+te.width,j-=ne.height+te.height}return V=Math.max(0,V-b.width),j=Math.max(0,p?V/p:j-b.height),V=L_(Math.min(V,E,R.maxWidth)),j=L_(Math.min(j,i,R.maxHeight)),V&&!j&&(j=L_(V/2)),(r!==void 0||c!==void 0)&&p&&R.height&&j>R.height&&(j=R.height,V=L_(Math.floor(j*p))),{width:V,height:j}}function B2(a,r,c){const p=r||1,g=Math.floor(a.height*p),b=Math.floor(a.width*p);a.height=Math.floor(a.height),a.width=Math.floor(a.width);const E=a.canvas;return E.style&&(c||!E.style.height&&!E.style.width)&&(E.style.height=`${a.height}px`,E.style.width=`${a.width}px`),a.currentDevicePixelRatio!==p||E.height!==g||E.width!==b?(a.currentDevicePixelRatio=p,E.height=g,E.width=b,a.ctx.setTransform(p,0,0,p,0,0),!0):!1}const w3=function(){let a=!1;try{const r={get passive(){return a=!0,!1}};hv()&&(window.addEventListener("test",null,r),window.removeEventListener("test",null,r))}catch{}return a}();function N2(a,r){const c=_3(a,r),p=c&&c.match(/^(\d+)(\.\d+)?px$/);return p?+p[1]:void 0}function Qc(a,r,c,p){return{x:a.x+c*(r.x-a.x),y:a.y+c*(r.y-a.y)}}function T3(a,r,c,p){return{x:a.x+c*(r.x-a.x),y:p==="middle"?c<.5?a.y:r.y:p==="after"?c<1?a.y:r.y:c>0?r.y:a.y}}function S3(a,r,c,p){const g={x:a.cp2x,y:a.cp2y},b={x:r.cp1x,y:r.cp1y},E=Qc(a,g,c),i=Qc(g,b,c),R=Qc(b,r,c),V=Qc(E,i,c),j=Qc(i,R,c);return Qc(V,j,c)}const M3=function(a,r){return{x(c){return a+a+r-c},setWidth(c){r=c},textAlign(c){return c==="center"?c:c==="right"?"left":"right"},xPlus(c,p){return c-p},leftForLtr(c,p){return c-p}}},E3=function(){return{x(a){return a},setWidth(a){},textAlign(a){return a},xPlus(a,r){return a+r},leftForLtr(a,r){return a}}};function $h(a,r,c){return a?M3(r,c):E3()}function kM(a,r){let c,p;(r==="ltr"||r==="rtl")&&(c=a.canvas.style,p=[c.getPropertyValue("direction"),c.getPropertyPriority("direction")],c.setProperty("direction",r,"important"),a.prevTextDirection=p)}function OM(a,r){r!==void 0&&(delete a.prevTextDirection,a.canvas.style.setProperty("direction",r[0],r[1]))}function FM(a){return a==="angle"?{between:bp,compare:Az,normalize:Gs}:{between:ja,compare:(r,c)=>r-c,normalize:r=>r}}function V2({start:a,end:r,count:c,loop:p,style:g}){return{start:a%c,end:r%c,loop:p&&(r-a+1)%c===0,style:g}}function A3(a,r,c){const{property:p,start:g,end:b}=c,{between:E,normalize:i}=FM(p),R=r.length;let{start:V,end:j,loop:W}=a,te,ne;if(W){for(V+=R,j+=R,te=0,ne=R;te<ne&&E(i(r[V%R][p]),g,b);++te)V--,j--;V%=R,j%=R}return j<V&&(j+=R),{start:V,end:j,loop:W,style:a.style}}function BM(a,r,c){if(!c)return[a];const{property:p,start:g,end:b}=c,E=r.length,{compare:i,between:R,normalize:V}=FM(p),{start:j,end:W,loop:te,style:ne}=A3(a,r,c),ge=[];let xe=!1,Fe=null,Be,Ke,at;const Ye=()=>R(g,at,Be)&&i(g,at)!==0,ct=()=>i(b,Be)===0||R(b,at,Be),Lt=()=>xe||Ye(),rt=()=>!xe||ct();for(let Ut=j,si=j;Ut<=W;++Ut)Ke=r[Ut%E],!Ke.skip&&(Be=V(Ke[p]),Be!==at&&(xe=R(Be,g,b),Fe===null&&Lt()&&(Fe=i(Be,g)===0?Ut:si),Fe!==null&&rt()&&(ge.push(V2({start:Fe,end:Ut,loop:te,count:E,style:ne})),Fe=null),si=Ut,at=Be));return Fe!==null&&ge.push(V2({start:Fe,end:W,loop:te,count:E,style:ne})),ge}function NM(a,r){const c=[],p=a.segments;for(let g=0;g<p.length;g++){const b=BM(p[g],a.points,r);b.length&&c.push(...b)}return c}function I3(a,r,c,p){let g=0,b=r-1;if(c&&!p)for(;g<r&&!a[g].skip;)g++;for(;g<r&&a[g].skip;)g++;for(g%=r,c&&(b+=g);b>g&&a[b%r].skip;)b--;return b%=r,{start:g,end:b}}function C3(a,r,c,p){const g=a.length,b=[];let E=r,i=a[r],R;for(R=r+1;R<=c;++R){const V=a[R%g];V.skip||V.stop?i.skip||(p=!1,b.push({start:r%g,end:(R-1)%g,loop:p}),r=E=V.stop?R:null):(E=R,i.skip&&(r=R)),i=V}return E!==null&&b.push({start:r%g,end:E%g,loop:p}),b}function P3(a,r){const c=a.points,p=a.options.spanGaps,g=c.length;if(!g)return[];const b=!!a._loop,{start:E,end:i}=I3(c,g,b,p);if(p===!0)return U2(a,[{start:E,end:i,loop:b}],c,r);const R=i<E?i+g:i,V=!!a._fullLoop&&E===0&&i===g-1;return U2(a,C3(c,E,R,V),c,r)}function U2(a,r,c,p){return!p||!p.setContext||!c?r:D3(a,r,c,p)}function D3(a,r,c,p){const g=a._chart.getContext(),b=j2(a.options),{_datasetIndex:E,options:{spanGaps:i}}=a,R=c.length,V=[];let j=b,W=r[0].start,te=W;function ne(ge,xe,Fe,Be){const Ke=i?-1:1;if(ge!==xe){for(ge+=R;c[ge%R].skip;)ge-=Ke;for(;c[xe%R].skip;)xe+=Ke;ge%R!==xe%R&&(V.push({start:ge%R,end:xe%R,loop:Fe,style:Be}),j=Be,W=xe%R)}}for(const ge of r){W=i?W:ge.start;let xe=c[W%R],Fe;for(te=W+1;te<=ge.end;te++){const Be=c[te%R];Fe=j2(p.setContext(Ql(g,{type:"segment",p0:xe,p1:Be,p0DataIndex:(te-1)%R,p1DataIndex:te%R,datasetIndex:E}))),z3(Fe,j)&&ne(W,te-1,ge.loop,j),xe=Be,j=Fe}W<te-1&&ne(W,te-1,ge.loop,j)}return V}function j2(a){return{backgroundColor:a.backgroundColor,borderCapStyle:a.borderCapStyle,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderJoinStyle:a.borderJoinStyle,borderWidth:a.borderWidth,borderColor:a.borderColor}}function z3(a,r){if(!r)return!1;const c=[],p=function(g,b){return ov(b)?(c.includes(b)||c.push(b),c.indexOf(b)):b};return JSON.stringify(a,p)!==JSON.stringify(r,p)}/*!
 * Chart.js v4.4.7
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class R3{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(r,c,p,g){const b=c.listeners[g],E=c.duration;b.forEach(i=>i({chart:r,initial:c.initial,numSteps:E,currentStep:Math.min(p-c.start,E)}))}_refresh(){this._request||(this._running=!0,this._request=wM.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(r=Date.now()){let c=0;this._charts.forEach((p,g)=>{if(!p.running||!p.items.length)return;const b=p.items;let E=b.length-1,i=!1,R;for(;E>=0;--E)R=b[E],R._active?(R._total>p.duration&&(p.duration=R._total),R.tick(r),i=!0):(b[E]=b[b.length-1],b.pop());i&&(g.draw(),this._notify(g,p,r,"progress")),b.length||(p.running=!1,this._notify(g,p,r,"complete"),p.initial=!1),c+=b.length}),this._lastDate=r,c===0&&(this._running=!1)}_getAnims(r){const c=this._charts;let p=c.get(r);return p||(p={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},c.set(r,p)),p}listen(r,c,p){this._getAnims(r).listeners[c].push(p)}add(r,c){!c||!c.length||this._getAnims(r).items.push(...c)}has(r){return this._getAnims(r).items.length>0}start(r){const c=this._charts.get(r);c&&(c.running=!0,c.start=Date.now(),c.duration=c.items.reduce((p,g)=>Math.max(p,g._duration),0),this._refresh())}running(r){if(!this._running)return!1;const c=this._charts.get(r);return!(!c||!c.running||!c.items.length)}stop(r){const c=this._charts.get(r);if(!c||!c.items.length)return;const p=c.items;let g=p.length-1;for(;g>=0;--g)p[g].cancel();c.items=[],this._notify(r,c,Date.now(),"complete")}remove(r){return this._charts.delete(r)}}var Oa=new R3;const G2="transparent",L3={boolean(a,r,c){return c>.5?r:a},color(a,r,c){const p=R2(a||G2),g=p.valid&&R2(r||G2);return g&&g.valid?g.mix(p,c).hexString():r},number(a,r,c){return a+(r-a)*c}};class k3{constructor(r,c,p,g){const b=c[p];g=Wf([r.to,g,b,r.from]);const E=Wf([r.from,b,g]);this._active=!0,this._fn=r.fn||L3[r.type||typeof E],this._easing=ap[r.easing]||ap.linear,this._start=Math.floor(Date.now()+(r.delay||0)),this._duration=this._total=Math.floor(r.duration),this._loop=!!r.loop,this._target=c,this._prop=p,this._from=E,this._to=g,this._promises=void 0}active(){return this._active}update(r,c,p){if(this._active){this._notify(!1);const g=this._target[this._prop],b=p-this._start,E=this._duration-b;this._start=p,this._duration=Math.floor(Math.max(E,r.duration)),this._total+=b,this._loop=!!r.loop,this._to=Wf([r.to,c,g,r.from]),this._from=Wf([r.from,g,c])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(r){const c=r-this._start,p=this._duration,g=this._prop,b=this._from,E=this._loop,i=this._to;let R;if(this._active=b!==i&&(E||c<p),!this._active){this._target[g]=i,this._notify(!0);return}if(c<0){this._target[g]=b;return}R=c/p%2,R=E&&R>1?2-R:R,R=this._easing(Math.min(1,Math.max(0,R))),this._target[g]=this._fn(b,i,R)}wait(){const r=this._promises||(this._promises=[]);return new Promise((c,p)=>{r.push({res:c,rej:p})})}_notify(r){const c=r?"res":"rej",p=this._promises||[];for(let g=0;g<p.length;g++)p[g][c]()}}class VM{constructor(r,c){this._chart=r,this._properties=new Map,this.configure(c)}configure(r){if(!pn(r))return;const c=Object.keys(tr.animation),p=this._properties;Object.getOwnPropertyNames(r).forEach(g=>{const b=r[g];if(!pn(b))return;const E={};for(const i of c)E[i]=b[i];(er(b.properties)&&b.properties||[g]).forEach(i=>{(i===g||!p.has(i))&&p.set(i,E)})})}_animateOptions(r,c){const p=c.options,g=F3(r,p);if(!g)return[];const b=this._createAnimations(g,p);return p.$shared&&O3(r.options.$animations,p).then(()=>{r.options=p},()=>{}),b}_createAnimations(r,c){const p=this._properties,g=[],b=r.$animations||(r.$animations={}),E=Object.keys(c),i=Date.now();let R;for(R=E.length-1;R>=0;--R){const V=E[R];if(V.charAt(0)==="$")continue;if(V==="options"){g.push(...this._animateOptions(r,c));continue}const j=c[V];let W=b[V];const te=p.get(V);if(W)if(te&&W.active()){W.update(te,j,i);continue}else W.cancel();if(!te||!te.duration){r[V]=j;continue}b[V]=W=new k3(te,r,V,j),g.push(W)}return g}update(r,c){if(this._properties.size===0){Object.assign(r,c);return}const p=this._createAnimations(r,c);if(p.length)return Oa.add(this._chart,p),!0}}function O3(a,r){const c=[],p=Object.keys(r);for(let g=0;g<p.length;g++){const b=a[p[g]];b&&b.active()&&c.push(b.wait())}return Promise.all(c)}function F3(a,r){if(!r)return;let c=a.options;if(!c){a.options=r;return}return c.$shared&&(a.options=c=Object.assign({},c,{$shared:!1,$animations:{}})),c}function H2(a,r){const c=a&&a.options||{},p=c.reverse,g=c.min===void 0?r:0,b=c.max===void 0?r:0;return{start:p?b:g,end:p?g:b}}function B3(a,r,c){if(c===!1)return!1;const p=H2(a,c),g=H2(r,c);return{top:g.end,right:p.end,bottom:g.start,left:p.start}}function N3(a){let r,c,p,g;return pn(a)?(r=a.top,c=a.right,p=a.bottom,g=a.left):r=c=p=g=a,{top:r,right:c,bottom:p,left:g,disabled:a===!1}}function UM(a,r){const c=[],p=a._getSortedDatasetMetas(r);let g,b;for(g=0,b=p.length;g<b;++g)c.push(p[g].index);return c}function q2(a,r,c,p={}){const g=a.keys,b=p.mode==="single";let E,i,R,V;if(r===null)return;let j=!1;for(E=0,i=g.length;E<i;++E){if(R=+g[E],R===c){if(j=!0,p.all)continue;break}V=a.values[R],fr(V)&&(b||r===0||oa(r)===oa(V))&&(r+=V)}return!j&&!p.all?0:r}function V3(a,r){const{iScale:c,vScale:p}=r,g=c.axis==="x"?"x":"y",b=p.axis==="x"?"x":"y",E=Object.keys(a),i=new Array(E.length);let R,V,j;for(R=0,V=E.length;R<V;++R)j=E[R],i[R]={[g]:j,[b]:a[j]};return i}function qx(a,r){const c=a&&a.options.stacked;return c||c===void 0&&r.stack!==void 0}function U3(a,r,c){return`${a.id}.${r.id}.${c.stack||c.type}`}function j3(a){const{min:r,max:c,minDefined:p,maxDefined:g}=a.getUserBounds();return{min:p?r:Number.NEGATIVE_INFINITY,max:g?c:Number.POSITIVE_INFINITY}}function G3(a,r,c){const p=a[r]||(a[r]={});return p[c]||(p[c]={})}function $2(a,r,c,p){for(const g of r.getMatchingVisibleMetas(p).reverse()){const b=a[g.index];if(c&&b>0||!c&&b<0)return g.index}return null}function W2(a,r){const{chart:c,_cachedMeta:p}=a,g=c._stacks||(c._stacks={}),{iScale:b,vScale:E,index:i}=p,R=b.axis,V=E.axis,j=U3(b,E,p),W=r.length;let te;for(let ne=0;ne<W;++ne){const ge=r[ne],{[R]:xe,[V]:Fe}=ge,Be=ge._stacks||(ge._stacks={});te=Be[V]=G3(g,j,xe),te[i]=Fe,te._top=$2(te,E,!0,p.type),te._bottom=$2(te,E,!1,p.type);const Ke=te._visualValues||(te._visualValues={});Ke[i]=Fe}}function $x(a,r){const c=a.scales;return Object.keys(c).filter(p=>c[p].axis===r).shift()}function H3(a,r){return Ql(a,{active:!1,dataset:void 0,datasetIndex:r,index:r,mode:"default",type:"dataset"})}function q3(a,r,c){return Ql(a,{active:!1,dataIndex:r,parsed:void 0,raw:void 0,element:c,index:r,mode:"default",type:"data"})}function Bf(a,r){const c=a.controller.index,p=a.vScale&&a.vScale.axis;if(p){r=r||a._parsed;for(const g of r){const b=g._stacks;if(!b||b[p]===void 0||b[p][c]===void 0)return;delete b[p][c],b[p]._visualValues!==void 0&&b[p]._visualValues[c]!==void 0&&delete b[p]._visualValues[c]}}}const Wx=a=>a==="reset"||a==="none",Z2=(a,r)=>r?a:Object.assign({},a),$3=(a,r,c)=>a&&!r.hidden&&r._stacked&&{keys:UM(c,!0),values:null};class Do{constructor(r,c){this.chart=r,this._ctx=r.ctx,this.index=c,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const r=this._cachedMeta;this.configure(),this.linkScales(),r._stacked=qx(r.vScale,r),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(r){this.index!==r&&Bf(this._cachedMeta),this.index=r}linkScales(){const r=this.chart,c=this._cachedMeta,p=this.getDataset(),g=(W,te,ne,ge)=>W==="x"?te:W==="r"?ge:ne,b=c.xAxisID=Wi(p.xAxisID,$x(r,"x")),E=c.yAxisID=Wi(p.yAxisID,$x(r,"y")),i=c.rAxisID=Wi(p.rAxisID,$x(r,"r")),R=c.indexAxis,V=c.iAxisID=g(R,b,E,i),j=c.vAxisID=g(R,E,b,i);c.xScale=this.getScaleForId(b),c.yScale=this.getScaleForId(E),c.rScale=this.getScaleForId(i),c.iScale=this.getScaleForId(V),c.vScale=this.getScaleForId(j)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(r){return this.chart.scales[r]}_getOtherScale(r){const c=this._cachedMeta;return r===c.iScale?c.vScale:c.iScale}reset(){this._update("reset")}_destroy(){const r=this._cachedMeta;this._data&&P2(this._data,this),r._stacked&&Bf(r)}_dataCheck(){const r=this.getDataset(),c=r.data||(r.data=[]),p=this._data;if(pn(c)){const g=this._cachedMeta;this._data=V3(c,g)}else if(p!==c){if(p){P2(p,this);const g=this._cachedMeta;Bf(g),g._parsed=[]}c&&Object.isExtensible(c)&&Dz(c,this),this._syncList=[],this._data=c}}addElements(){const r=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(r.dataset=new this.datasetElementType)}buildOrUpdateElements(r){const c=this._cachedMeta,p=this.getDataset();let g=!1;this._dataCheck();const b=c._stacked;c._stacked=qx(c.vScale,c),c.stack!==p.stack&&(g=!0,Bf(c),c.stack=p.stack),this._resyncElements(r),(g||b!==c._stacked)&&(W2(this,c._parsed),c._stacked=qx(c.vScale,c))}configure(){const r=this.chart.config,c=r.datasetScopeKeys(this._type),p=r.getOptionScopes(this.getDataset(),c,!0);this.options=r.createResolver(p,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(r,c){const{_cachedMeta:p,_data:g}=this,{iScale:b,_stacked:E}=p,i=b.axis;let R=r===0&&c===g.length?!0:p._sorted,V=r>0&&p._parsed[r-1],j,W,te;if(this._parsing===!1)p._parsed=g,p._sorted=!0,te=g;else{er(g[r])?te=this.parseArrayData(p,g,r,c):pn(g[r])?te=this.parseObjectData(p,g,r,c):te=this.parsePrimitiveData(p,g,r,c);const ne=()=>W[i]===null||V&&W[i]<V[i];for(j=0;j<c;++j)p._parsed[j+r]=W=te[j],R&&(ne()&&(R=!1),V=W);p._sorted=R}E&&W2(this,te)}parsePrimitiveData(r,c,p,g){const{iScale:b,vScale:E}=r,i=b.axis,R=E.axis,V=b.getLabels(),j=b===E,W=new Array(g);let te,ne,ge;for(te=0,ne=g;te<ne;++te)ge=te+p,W[te]={[i]:j||b.parse(V[ge],ge),[R]:E.parse(c[ge],ge)};return W}parseArrayData(r,c,p,g){const{xScale:b,yScale:E}=r,i=new Array(g);let R,V,j,W;for(R=0,V=g;R<V;++R)j=R+p,W=c[j],i[R]={x:b.parse(W[0],j),y:E.parse(W[1],j)};return i}parseObjectData(r,c,p,g){const{xScale:b,yScale:E}=r,{xAxisKey:i="x",yAxisKey:R="y"}=this._parsing,V=new Array(g);let j,W,te,ne;for(j=0,W=g;j<W;++j)te=j+p,ne=c[te],V[j]={x:b.parse(Xl(ne,i),te),y:E.parse(Xl(ne,R),te)};return V}getParsed(r){return this._cachedMeta._parsed[r]}getDataElement(r){return this._cachedMeta.data[r]}applyStack(r,c,p){const g=this.chart,b=this._cachedMeta,E=c[r.axis],i={keys:UM(g,!0),values:c._stacks[r.axis]._visualValues};return q2(i,E,b.index,{mode:p})}updateRangeFromParsed(r,c,p,g){const b=p[c.axis];let E=b===null?NaN:b;const i=g&&p._stacks[c.axis];g&&i&&(g.values=i,E=q2(g,b,this._cachedMeta.index)),r.min=Math.min(r.min,E),r.max=Math.max(r.max,E)}getMinMax(r,c){const p=this._cachedMeta,g=p._parsed,b=p._sorted&&r===p.iScale,E=g.length,i=this._getOtherScale(r),R=$3(c,p,this.chart),V={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:j,max:W}=j3(i);let te,ne;function ge(){ne=g[te];const xe=ne[i.axis];return!fr(ne[r.axis])||j>xe||W<xe}for(te=0;te<E&&!(!ge()&&(this.updateRangeFromParsed(V,r,ne,R),b));++te);if(b){for(te=E-1;te>=0;--te)if(!ge()){this.updateRangeFromParsed(V,r,ne,R);break}}return V}getAllParsedValues(r){const c=this._cachedMeta._parsed,p=[];let g,b,E;for(g=0,b=c.length;g<b;++g)E=c[g][r.axis],fr(E)&&p.push(E);return p}getMaxOverflow(){return!1}getLabelAndValue(r){const c=this._cachedMeta,p=c.iScale,g=c.vScale,b=this.getParsed(r);return{label:p?""+p.getLabelForValue(b[p.axis]):"",value:g?""+g.getLabelForValue(b[g.axis]):""}}_update(r){const c=this._cachedMeta;this.update(r||"default"),c._clip=N3(Wi(this.options.clip,B3(c.xScale,c.yScale,this.getMaxOverflow())))}update(r){}draw(){const r=this._ctx,c=this.chart,p=this._cachedMeta,g=p.data||[],b=c.chartArea,E=[],i=this._drawStart||0,R=this._drawCount||g.length-i,V=this.options.drawActiveElementsOnTop;let j;for(p.dataset&&p.dataset.draw(r,b,i,R),j=i;j<i+R;++j){const W=g[j];W.hidden||(W.active&&V?E.push(W):W.draw(r,b))}for(j=0;j<E.length;++j)E[j].draw(r,b)}getStyle(r,c){const p=c?"active":"default";return r===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(p):this.resolveDataElementOptions(r||0,p)}getContext(r,c,p){const g=this.getDataset();let b;if(r>=0&&r<this._cachedMeta.data.length){const E=this._cachedMeta.data[r];b=E.$context||(E.$context=q3(this.getContext(),r,E)),b.parsed=this.getParsed(r),b.raw=g.data[r],b.index=b.dataIndex=r}else b=this.$context||(this.$context=H3(this.chart.getContext(),this.index)),b.dataset=g,b.index=b.datasetIndex=this.index;return b.active=!!c,b.mode=p,b}resolveDatasetElementOptions(r){return this._resolveElementOptions(this.datasetElementType.id,r)}resolveDataElementOptions(r,c){return this._resolveElementOptions(this.dataElementType.id,c,r)}_resolveElementOptions(r,c="default",p){const g=c==="active",b=this._cachedDataOpts,E=r+"-"+c,i=b[E],R=this.enableOptionSharing&&vp(p);if(i)return Z2(i,R);const V=this.chart.config,j=V.datasetElementScopeKeys(this._type,r),W=g?[`${r}Hover`,"hover",r,""]:[r,""],te=V.getOptionScopes(this.getDataset(),j),ne=Object.keys(tr.elements[r]),ge=()=>this.getContext(p,g,c),xe=V.resolveNamedOptions(te,ne,ge,W);return xe.$shared&&(xe.$shared=R,b[E]=Object.freeze(Z2(xe,R))),xe}_resolveAnimations(r,c,p){const g=this.chart,b=this._cachedDataOpts,E=`animation-${c}`,i=b[E];if(i)return i;let R;if(g.options.animation!==!1){const j=this.chart.config,W=j.datasetAnimationScopeKeys(this._type,c),te=j.getOptionScopes(this.getDataset(),W);R=j.createResolver(te,this.getContext(r,p,c))}const V=new VM(g,R&&R.animations);return R&&R._cacheable&&(b[E]=Object.freeze(V)),V}getSharedOptions(r){if(r.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},r))}includeOptions(r,c){return!c||Wx(r)||this.chart._animationsDisabled}_getSharedOptions(r,c){const p=this.resolveDataElementOptions(r,c),g=this._sharedOptions,b=this.getSharedOptions(p),E=this.includeOptions(c,b)||b!==g;return this.updateSharedOptions(b,c,p),{sharedOptions:b,includeOptions:E}}updateElement(r,c,p,g){Wx(g)?Object.assign(r,p):this._resolveAnimations(c,g).update(r,p)}updateSharedOptions(r,c,p){r&&!Wx(c)&&this._resolveAnimations(void 0,c).update(r,p)}_setStyle(r,c,p,g){r.active=g;const b=this.getStyle(c,g);this._resolveAnimations(c,p,g).update(r,{options:!g&&this.getSharedOptions(b)||b})}removeHoverStyle(r,c,p){this._setStyle(r,p,"active",!1)}setHoverStyle(r,c,p){this._setStyle(r,p,"active",!0)}_removeDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!1)}_setDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!0)}_resyncElements(r){const c=this._data,p=this._cachedMeta.data;for(const[i,R,V]of this._syncList)this[i](R,V);this._syncList=[];const g=p.length,b=c.length,E=Math.min(b,g);E&&this.parse(0,E),b>g?this._insertElements(g,b-g,r):b<g&&this._removeElements(b,g-b)}_insertElements(r,c,p=!0){const g=this._cachedMeta,b=g.data,E=r+c;let i;const R=V=>{for(V.length+=c,i=V.length-1;i>=E;i--)V[i]=V[i-c]};for(R(b),i=r;i<E;++i)b[i]=new this.dataElementType;this._parsing&&R(g._parsed),this.parse(r,c),p&&this.updateElements(b,r,c,"reset")}updateElements(r,c,p,g){}_removeElements(r,c){const p=this._cachedMeta;if(this._parsing){const g=p._parsed.splice(r,c);p._stacked&&Bf(p,g)}p.data.splice(r,c)}_sync(r){if(this._parsing)this._syncList.push(r);else{const[c,p,g]=r;this[c](p,g)}this.chart._dataChanges.push([this.index,...r])}_onDataPush(){const r=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-r,r])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(r,c){c&&this._sync(["_removeElements",r,c]);const p=arguments.length-2;p&&this._sync(["_insertElements",r,p])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Yt(Do,"defaults",{}),Yt(Do,"datasetElementType",null),Yt(Do,"dataElementType",null);function W3(a,r){if(!a._cache.$bar){const c=a.getMatchingVisibleMetas(r);let p=[];for(let g=0,b=c.length;g<b;g++)p=p.concat(c[g].controller.getAllParsedValues(a));a._cache.$bar=bM(p.sort((g,b)=>g-b))}return a._cache.$bar}function Z3(a){const r=a.iScale,c=W3(r,a.type);let p=r._length,g,b,E,i;const R=()=>{E===32767||E===-32768||(vp(i)&&(p=Math.min(p,Math.abs(E-i)||p)),i=E)};for(g=0,b=c.length;g<b;++g)E=r.getPixelForValue(c[g]),R();for(i=void 0,g=0,b=r.ticks.length;g<b;++g)E=r.getPixelForTick(g),R();return p}function X3(a,r,c,p){const g=c.barThickness;let b,E;return bn(g)?(b=r.min*c.categoryPercentage,E=c.barPercentage):(b=g*p,E=1),{chunk:b/p,ratio:E,start:r.pixels[a]-b/2}}function Y3(a,r,c,p){const g=r.pixels,b=g[a];let E=a>0?g[a-1]:null,i=a<g.length-1?g[a+1]:null;const R=c.categoryPercentage;E===null&&(E=b-(i===null?r.end-r.start:i-b)),i===null&&(i=b+b-E);const V=b-(b-Math.min(E,i))/2*R;return{chunk:Math.abs(i-E)/2*R/p,ratio:c.barPercentage,start:V}}function K3(a,r,c,p){const g=c.parse(a[0],p),b=c.parse(a[1],p),E=Math.min(g,b),i=Math.max(g,b);let R=E,V=i;Math.abs(E)>Math.abs(i)&&(R=i,V=E),r[c.axis]=V,r._custom={barStart:R,barEnd:V,start:g,end:b,min:E,max:i}}function jM(a,r,c,p){return er(a)?K3(a,r,c,p):r[c.axis]=c.parse(a,p),r}function X2(a,r,c,p){const g=a.iScale,b=a.vScale,E=g.getLabels(),i=g===b,R=[];let V,j,W,te;for(V=c,j=c+p;V<j;++V)te=r[V],W={},W[g.axis]=i||g.parse(E[V],V),R.push(jM(te,W,b,V));return R}function Zx(a){return a&&a.barStart!==void 0&&a.barEnd!==void 0}function J3(a,r,c){return a!==0?oa(a):(r.isHorizontal()?1:-1)*(r.min>=c?1:-1)}function Q3(a){let r,c,p,g,b;return a.horizontal?(r=a.base>a.x,c="left",p="right"):(r=a.base<a.y,c="bottom",p="top"),r?(g="end",b="start"):(g="start",b="end"),{start:c,end:p,reverse:r,top:g,bottom:b}}function eR(a,r,c,p){let g=r.borderSkipped;const b={};if(!g){a.borderSkipped=b;return}if(g===!0){a.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:E,end:i,reverse:R,top:V,bottom:j}=Q3(a);g==="middle"&&c&&(a.enableBorderRadius=!0,(c._top||0)===p?g=V:(c._bottom||0)===p?g=j:(b[Y2(j,E,i,R)]=!0,g=V)),b[Y2(g,E,i,R)]=!0,a.borderSkipped=b}function Y2(a,r,c,p){return p?(a=tR(a,r,c),a=K2(a,c,r)):a=K2(a,r,c),a}function tR(a,r,c){return a===r?c:a===c?r:a}function K2(a,r,c){return a==="start"?r:a==="end"?c:a}function iR(a,{inflateAmount:r},c){a.inflateAmount=r==="auto"?c===1?.33:0:r}class X_ extends Do{parsePrimitiveData(r,c,p,g){return X2(r,c,p,g)}parseArrayData(r,c,p,g){return X2(r,c,p,g)}parseObjectData(r,c,p,g){const{iScale:b,vScale:E}=r,{xAxisKey:i="x",yAxisKey:R="y"}=this._parsing,V=b.axis==="x"?i:R,j=E.axis==="x"?i:R,W=[];let te,ne,ge,xe;for(te=p,ne=p+g;te<ne;++te)xe=c[te],ge={},ge[b.axis]=b.parse(Xl(xe,V),te),W.push(jM(Xl(xe,j),ge,E,te));return W}updateRangeFromParsed(r,c,p,g){super.updateRangeFromParsed(r,c,p,g);const b=p._custom;b&&c===this._cachedMeta.vScale&&(r.min=Math.min(r.min,b.min),r.max=Math.max(r.max,b.max))}getMaxOverflow(){return 0}getLabelAndValue(r){const c=this._cachedMeta,{iScale:p,vScale:g}=c,b=this.getParsed(r),E=b._custom,i=Zx(E)?"["+E.start+", "+E.end+"]":""+g.getLabelForValue(b[g.axis]);return{label:""+p.getLabelForValue(b[p.axis]),value:i}}initialize(){this.enableOptionSharing=!0,super.initialize();const r=this._cachedMeta;r.stack=this.getDataset().stack}update(r){const c=this._cachedMeta;this.updateElements(c.data,0,c.data.length,r)}updateElements(r,c,p,g){const b=g==="reset",{index:E,_cachedMeta:{vScale:i}}=this,R=i.getBasePixel(),V=i.isHorizontal(),j=this._getRuler(),{sharedOptions:W,includeOptions:te}=this._getSharedOptions(c,g);for(let ne=c;ne<c+p;ne++){const ge=this.getParsed(ne),xe=b||bn(ge[i.axis])?{base:R,head:R}:this._calculateBarValuePixels(ne),Fe=this._calculateBarIndexPixels(ne,j),Be=(ge._stacks||{})[i.axis],Ke={horizontal:V,base:xe.base,enableBorderRadius:!Be||Zx(ge._custom)||E===Be._top||E===Be._bottom,x:V?xe.head:Fe.center,y:V?Fe.center:xe.head,height:V?Fe.size:Math.abs(xe.size),width:V?Math.abs(xe.size):Fe.size};te&&(Ke.options=W||this.resolveDataElementOptions(ne,r[ne].active?"active":g));const at=Ke.options||r[ne].options;eR(Ke,at,Be,E),iR(Ke,at,j.ratio),this.updateElement(r[ne],ne,Ke,g)}}_getStacks(r,c){const{iScale:p}=this._cachedMeta,g=p.getMatchingVisibleMetas(this._type).filter(j=>j.controller.options.grouped),b=p.options.stacked,E=[],i=this._cachedMeta.controller.getParsed(c),R=i&&i[p.axis],V=j=>{const W=j._parsed.find(ne=>ne[p.axis]===R),te=W&&W[j.vScale.axis];if(bn(te)||isNaN(te))return!0};for(const j of g)if(!(c!==void 0&&V(j))&&((b===!1||E.indexOf(j.stack)===-1||b===void 0&&j.stack===void 0)&&E.push(j.stack),j.index===r))break;return E.length||E.push(void 0),E}_getStackCount(r){return this._getStacks(void 0,r).length}_getStackIndex(r,c,p){const g=this._getStacks(r,p),b=c!==void 0?g.indexOf(c):-1;return b===-1?g.length-1:b}_getRuler(){const r=this.options,c=this._cachedMeta,p=c.iScale,g=[];let b,E;for(b=0,E=c.data.length;b<E;++b)g.push(p.getPixelForValue(this.getParsed(b)[p.axis],b));const i=r.barThickness;return{min:i||Z3(c),pixels:g,start:p._startPixel,end:p._endPixel,stackCount:this._getStackCount(),scale:p,grouped:r.grouped,ratio:i?1:r.categoryPercentage*r.barPercentage}}_calculateBarValuePixels(r){const{_cachedMeta:{vScale:c,_stacked:p,index:g},options:{base:b,minBarLength:E}}=this,i=b||0,R=this.getParsed(r),V=R._custom,j=Zx(V);let W=R[c.axis],te=0,ne=p?this.applyStack(c,R,p):W,ge,xe;ne!==W&&(te=ne-W,ne=W),j&&(W=V.barStart,ne=V.barEnd-V.barStart,W!==0&&oa(W)!==oa(V.barEnd)&&(te=0),te+=W);const Fe=!bn(b)&&!j?b:te;let Be=c.getPixelForValue(Fe);if(this.chart.getDataVisibility(r)?ge=c.getPixelForValue(te+ne):ge=Be,xe=ge-Be,Math.abs(xe)<E){xe=J3(xe,c,i)*E,W===i&&(Be-=xe/2);const Ke=c.getPixelForDecimal(0),at=c.getPixelForDecimal(1),Ye=Math.min(Ke,at),ct=Math.max(Ke,at);Be=Math.max(Math.min(Be,ct),Ye),ge=Be+xe,p&&!j&&(R._stacks[c.axis]._visualValues[g]=c.getValueForPixel(ge)-c.getValueForPixel(Be))}if(Be===c.getPixelForValue(i)){const Ke=oa(xe)*c.getLineWidthForValue(i)/2;Be+=Ke,xe-=Ke}return{size:xe,base:Be,head:ge,center:ge+xe/2}}_calculateBarIndexPixels(r,c){const p=c.scale,g=this.options,b=g.skipNull,E=Wi(g.maxBarThickness,1/0);let i,R;if(c.grouped){const V=b?this._getStackCount(r):c.stackCount,j=g.barThickness==="flex"?Y3(r,c,g,V):X3(r,c,g,V),W=this._getStackIndex(this.index,this._cachedMeta.stack,b?r:void 0);i=j.start+j.chunk*W+j.chunk/2,R=Math.min(E,j.chunk*j.ratio)}else i=p.getPixelForValue(this.getParsed(r)[p.axis],r),R=Math.min(E,c.min*c.ratio);return{base:i-R/2,head:i+R/2,center:i,size:R}}draw(){const r=this._cachedMeta,c=r.vScale,p=r.data,g=p.length;let b=0;for(;b<g;++b)this.getParsed(b)[c.axis]!==null&&!p[b].hidden&&p[b].draw(this._ctx)}}Yt(X_,"id","bar"),Yt(X_,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Yt(X_,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Y_ extends Do{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(r,c,p,g){const b=super.parsePrimitiveData(r,c,p,g);for(let E=0;E<b.length;E++)b[E]._custom=this.resolveDataElementOptions(E+p).radius;return b}parseArrayData(r,c,p,g){const b=super.parseArrayData(r,c,p,g);for(let E=0;E<b.length;E++){const i=c[p+E];b[E]._custom=Wi(i[2],this.resolveDataElementOptions(E+p).radius)}return b}parseObjectData(r,c,p,g){const b=super.parseObjectData(r,c,p,g);for(let E=0;E<b.length;E++){const i=c[p+E];b[E]._custom=Wi(i&&i.r&&+i.r,this.resolveDataElementOptions(E+p).radius)}return b}getMaxOverflow(){const r=this._cachedMeta.data;let c=0;for(let p=r.length-1;p>=0;--p)c=Math.max(c,r[p].size(this.resolveDataElementOptions(p))/2);return c>0&&c}getLabelAndValue(r){const c=this._cachedMeta,p=this.chart.data.labels||[],{xScale:g,yScale:b}=c,E=this.getParsed(r),i=g.getLabelForValue(E.x),R=b.getLabelForValue(E.y),V=E._custom;return{label:p[r]||"",value:"("+i+", "+R+(V?", "+V:"")+")"}}update(r){const c=this._cachedMeta.data;this.updateElements(c,0,c.length,r)}updateElements(r,c,p,g){const b=g==="reset",{iScale:E,vScale:i}=this._cachedMeta,{sharedOptions:R,includeOptions:V}=this._getSharedOptions(c,g),j=E.axis,W=i.axis;for(let te=c;te<c+p;te++){const ne=r[te],ge=!b&&this.getParsed(te),xe={},Fe=xe[j]=b?E.getPixelForDecimal(.5):E.getPixelForValue(ge[j]),Be=xe[W]=b?i.getBasePixel():i.getPixelForValue(ge[W]);xe.skip=isNaN(Fe)||isNaN(Be),V&&(xe.options=R||this.resolveDataElementOptions(te,ne.active?"active":g),b&&(xe.options.radius=0)),this.updateElement(ne,te,xe,g)}}resolveDataElementOptions(r,c){const p=this.getParsed(r);let g=super.resolveDataElementOptions(r,c);g.$shared&&(g=Object.assign({},g,{$shared:!1}));const b=g.radius;return c!=="active"&&(g.radius=0),g.radius+=Wi(p&&p._custom,b),g}}Yt(Y_,"id","bubble"),Yt(Y_,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),Yt(Y_,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function nR(a,r,c){let p=1,g=1,b=0,E=0;if(r<Kn){const i=a,R=i+r,V=Math.cos(i),j=Math.sin(i),W=Math.cos(R),te=Math.sin(R),ne=(at,Ye,ct)=>bp(at,i,R,!0)?1:Math.max(Ye,Ye*c,ct,ct*c),ge=(at,Ye,ct)=>bp(at,i,R,!0)?-1:Math.min(Ye,Ye*c,ct,ct*c),xe=ne(0,V,W),Fe=ne(_r,j,te),Be=ge(Jn,V,W),Ke=ge(Jn+_r,j,te);p=(xe-Be)/2,g=(Fe-Ke)/2,b=-(xe+Be)/2,E=-(Fe+Ke)/2}return{ratioX:p,ratioY:g,offsetX:b,offsetY:E}}class eu extends Do{constructor(r,c){super(r,c),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(r,c){const p=this.getDataset().data,g=this._cachedMeta;if(this._parsing===!1)g._parsed=p;else{let b=R=>+p[R];if(pn(p[r])){const{key:R="value"}=this._parsing;b=V=>+Xl(p[V],R)}let E,i;for(E=r,i=r+c;E<i;++E)g._parsed[E]=b(E)}}_getRotation(){return Io(this.options.rotation-90)}_getCircumference(){return Io(this.options.circumference)}_getRotationExtents(){let r=Kn,c=-Kn;for(let p=0;p<this.chart.data.datasets.length;++p)if(this.chart.isDatasetVisible(p)&&this.chart.getDatasetMeta(p).type===this._type){const g=this.chart.getDatasetMeta(p).controller,b=g._getRotation(),E=g._getCircumference();r=Math.min(r,b),c=Math.max(c,b+E)}return{rotation:r,circumference:c-r}}update(r){const c=this.chart,{chartArea:p}=c,g=this._cachedMeta,b=g.data,E=this.getMaxBorderWidth()+this.getMaxOffset(b)+this.options.spacing,i=Math.max((Math.min(p.width,p.height)-E)/2,0),R=Math.min(gz(this.options.cutout,i),1),V=this._getRingWeight(this.index),{circumference:j,rotation:W}=this._getRotationExtents(),{ratioX:te,ratioY:ne,offsetX:ge,offsetY:xe}=nR(W,j,R),Fe=(p.width-E)/te,Be=(p.height-E)/ne,Ke=Math.max(Math.min(Fe,Be)/2,0),at=_M(this.options.radius,Ke),Ye=Math.max(at*R,0),ct=(at-Ye)/this._getVisibleDatasetWeightTotal();this.offsetX=ge*at,this.offsetY=xe*at,g.total=this.calculateTotal(),this.outerRadius=at-ct*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-ct*V,0),this.updateElements(b,0,b.length,r)}_circumference(r,c){const p=this.options,g=this._cachedMeta,b=this._getCircumference();return c&&p.animation.animateRotate||!this.chart.getDataVisibility(r)||g._parsed[r]===null||g.data[r].hidden?0:this.calculateCircumference(g._parsed[r]*b/Kn)}updateElements(r,c,p,g){const b=g==="reset",E=this.chart,i=E.chartArea,V=E.options.animation,j=(i.left+i.right)/2,W=(i.top+i.bottom)/2,te=b&&V.animateScale,ne=te?0:this.innerRadius,ge=te?0:this.outerRadius,{sharedOptions:xe,includeOptions:Fe}=this._getSharedOptions(c,g);let Be=this._getRotation(),Ke;for(Ke=0;Ke<c;++Ke)Be+=this._circumference(Ke,b);for(Ke=c;Ke<c+p;++Ke){const at=this._circumference(Ke,b),Ye=r[Ke],ct={x:j+this.offsetX,y:W+this.offsetY,startAngle:Be,endAngle:Be+at,circumference:at,outerRadius:ge,innerRadius:ne};Fe&&(ct.options=xe||this.resolveDataElementOptions(Ke,Ye.active?"active":g)),Be+=at,this.updateElement(Ye,Ke,ct,g)}}calculateTotal(){const r=this._cachedMeta,c=r.data;let p=0,g;for(g=0;g<c.length;g++){const b=r._parsed[g];b!==null&&!isNaN(b)&&this.chart.getDataVisibility(g)&&!c[g].hidden&&(p+=Math.abs(b))}return p}calculateCircumference(r){const c=this._cachedMeta.total;return c>0&&!isNaN(r)?Kn*(Math.abs(r)/c):0}getLabelAndValue(r){const c=this._cachedMeta,p=this.chart,g=p.data.labels||[],b=Dp(c._parsed[r],p.options.locale);return{label:g[r]||"",value:b}}getMaxBorderWidth(r){let c=0;const p=this.chart;let g,b,E,i,R;if(!r){for(g=0,b=p.data.datasets.length;g<b;++g)if(p.isDatasetVisible(g)){E=p.getDatasetMeta(g),r=E.data,i=E.controller;break}}if(!r)return 0;for(g=0,b=r.length;g<b;++g)R=i.resolveDataElementOptions(g),R.borderAlign!=="inner"&&(c=Math.max(c,R.borderWidth||0,R.hoverBorderWidth||0));return c}getMaxOffset(r){let c=0;for(let p=0,g=r.length;p<g;++p){const b=this.resolveDataElementOptions(p);c=Math.max(c,b.offset||0,b.hoverOffset||0)}return c}_getRingWeightOffset(r){let c=0;for(let p=0;p<r;++p)this.chart.isDatasetVisible(p)&&(c+=this._getRingWeight(p));return c}_getRingWeight(r){return Math.max(Wi(this.chart.data.datasets[r].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Yt(eu,"id","doughnut"),Yt(eu,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),Yt(eu,"descriptors",{_scriptable:r=>r!=="spacing",_indexable:r=>r!=="spacing"&&!r.startsWith("borderDash")&&!r.startsWith("hoverBorderDash")}),Yt(eu,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(r){const c=r.data;if(c.labels.length&&c.datasets.length){const{labels:{pointStyle:p,color:g}}=r.legend.options;return c.labels.map((b,E)=>{const R=r.getDatasetMeta(0).controller.getStyle(E);return{text:b,fillStyle:R.backgroundColor,strokeStyle:R.borderColor,fontColor:g,lineWidth:R.borderWidth,pointStyle:p,hidden:!r.getDataVisibility(E),index:E}})}return[]}},onClick(r,c,p){p.chart.toggleDataVisibility(c.index),p.chart.update()}}}});class K_ extends Do{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(r){const c=this._cachedMeta,{dataset:p,data:g=[],_dataset:b}=c,E=this.chart._animationsDisabled;let{start:i,count:R}=SM(c,g,E);this._drawStart=i,this._drawCount=R,MM(c)&&(i=0,R=g.length),p._chart=this.chart,p._datasetIndex=this.index,p._decimated=!!b._decimated,p.points=g;const V=this.resolveDatasetElementOptions(r);this.options.showLine||(V.borderWidth=0),V.segment=this.options.segment,this.updateElement(p,void 0,{animated:!E,options:V},r),this.updateElements(g,i,R,r)}updateElements(r,c,p,g){const b=g==="reset",{iScale:E,vScale:i,_stacked:R,_dataset:V}=this._cachedMeta,{sharedOptions:j,includeOptions:W}=this._getSharedOptions(c,g),te=E.axis,ne=i.axis,{spanGaps:ge,segment:xe}=this.options,Fe=Xh(ge)?ge:Number.POSITIVE_INFINITY,Be=this.chart._animationsDisabled||b||g==="none",Ke=c+p,at=r.length;let Ye=c>0&&this.getParsed(c-1);for(let ct=0;ct<at;++ct){const Lt=r[ct],rt=Be?Lt:{};if(ct<c||ct>=Ke){rt.skip=!0;continue}const Ut=this.getParsed(ct),si=bn(Ut[ne]),It=rt[te]=E.getPixelForValue(Ut[te],ct),Pt=rt[ne]=b||si?i.getBasePixel():i.getPixelForValue(R?this.applyStack(i,Ut,R):Ut[ne],ct);rt.skip=isNaN(It)||isNaN(Pt)||si,rt.stop=ct>0&&Math.abs(Ut[te]-Ye[te])>Fe,xe&&(rt.parsed=Ut,rt.raw=V.data[ct]),W&&(rt.options=j||this.resolveDataElementOptions(ct,Lt.active?"active":g)),Be||this.updateElement(Lt,ct,rt,g),Ye=Ut}}getMaxOverflow(){const r=this._cachedMeta,c=r.dataset,p=c.options&&c.options.borderWidth||0,g=r.data||[];if(!g.length)return p;const b=g[0].size(this.resolveDataElementOptions(0)),E=g[g.length-1].size(this.resolveDataElementOptions(g.length-1));return Math.max(p,b,E)/2}draw(){const r=this._cachedMeta;r.dataset.updateControlPoints(this.chart.chartArea,r.iScale.axis),super.draw()}}Yt(K_,"id","line"),Yt(K_,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),Yt(K_,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class cp extends Do{constructor(r,c){super(r,c),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(r){const c=this._cachedMeta,p=this.chart,g=p.data.labels||[],b=Dp(c._parsed[r].r,p.options.locale);return{label:g[r]||"",value:b}}parseObjectData(r,c,p,g){return RM.bind(this)(r,c,p,g)}update(r){const c=this._cachedMeta.data;this._updateRadius(),this.updateElements(c,0,c.length,r)}getMinMax(){const r=this._cachedMeta,c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return r.data.forEach((p,g)=>{const b=this.getParsed(g).r;!isNaN(b)&&this.chart.getDataVisibility(g)&&(b<c.min&&(c.min=b),b>c.max&&(c.max=b))}),c}_updateRadius(){const r=this.chart,c=r.chartArea,p=r.options,g=Math.min(c.right-c.left,c.bottom-c.top),b=Math.max(g/2,0),E=Math.max(p.cutoutPercentage?b/100*p.cutoutPercentage:1,0),i=(b-E)/r.getVisibleDatasetCount();this.outerRadius=b-i*this.index,this.innerRadius=this.outerRadius-i}updateElements(r,c,p,g){const b=g==="reset",E=this.chart,R=E.options.animation,V=this._cachedMeta.rScale,j=V.xCenter,W=V.yCenter,te=V.getIndexAngle(0)-.5*Jn;let ne=te,ge;const xe=360/this.countVisibleElements();for(ge=0;ge<c;++ge)ne+=this._computeAngle(ge,g,xe);for(ge=c;ge<c+p;ge++){const Fe=r[ge];let Be=ne,Ke=ne+this._computeAngle(ge,g,xe),at=E.getDataVisibility(ge)?V.getDistanceFromCenterForValue(this.getParsed(ge).r):0;ne=Ke,b&&(R.animateScale&&(at=0),R.animateRotate&&(Be=Ke=te));const Ye={x:j,y:W,innerRadius:0,outerRadius:at,startAngle:Be,endAngle:Ke,options:this.resolveDataElementOptions(ge,Fe.active?"active":g)};this.updateElement(Fe,ge,Ye,g)}}countVisibleElements(){const r=this._cachedMeta;let c=0;return r.data.forEach((p,g)=>{!isNaN(this.getParsed(g).r)&&this.chart.getDataVisibility(g)&&c++}),c}_computeAngle(r,c,p){return this.chart.getDataVisibility(r)?Io(this.resolveDataElementOptions(r,c).angle||p):0}}Yt(cp,"id","polarArea"),Yt(cp,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),Yt(cp,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(r){const c=r.data;if(c.labels.length&&c.datasets.length){const{labels:{pointStyle:p,color:g}}=r.legend.options;return c.labels.map((b,E)=>{const R=r.getDatasetMeta(0).controller.getStyle(E);return{text:b,fillStyle:R.backgroundColor,strokeStyle:R.borderColor,fontColor:g,lineWidth:R.borderWidth,pointStyle:p,hidden:!r.getDataVisibility(E),index:E}})}return[]}},onClick(r,c,p){p.chart.toggleDataVisibility(c.index),p.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class x0 extends eu{}Yt(x0,"id","pie"),Yt(x0,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class J_ extends Do{getLabelAndValue(r){const c=this._cachedMeta.vScale,p=this.getParsed(r);return{label:c.getLabels()[r],value:""+c.getLabelForValue(p[c.axis])}}parseObjectData(r,c,p,g){return RM.bind(this)(r,c,p,g)}update(r){const c=this._cachedMeta,p=c.dataset,g=c.data||[],b=c.iScale.getLabels();if(p.points=g,r!=="resize"){const E=this.resolveDatasetElementOptions(r);this.options.showLine||(E.borderWidth=0);const i={_loop:!0,_fullLoop:b.length===g.length,options:E};this.updateElement(p,void 0,i,r)}this.updateElements(g,0,g.length,r)}updateElements(r,c,p,g){const b=this._cachedMeta.rScale,E=g==="reset";for(let i=c;i<c+p;i++){const R=r[i],V=this.resolveDataElementOptions(i,R.active?"active":g),j=b.getPointPositionForValue(i,this.getParsed(i).r),W=E?b.xCenter:j.x,te=E?b.yCenter:j.y,ne={x:W,y:te,angle:j.angle,skip:isNaN(W)||isNaN(te),options:V};this.updateElement(R,i,ne,g)}}}Yt(J_,"id","radar"),Yt(J_,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),Yt(J_,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Q_ extends Do{getLabelAndValue(r){const c=this._cachedMeta,p=this.chart.data.labels||[],{xScale:g,yScale:b}=c,E=this.getParsed(r),i=g.getLabelForValue(E.x),R=b.getLabelForValue(E.y);return{label:p[r]||"",value:"("+i+", "+R+")"}}update(r){const c=this._cachedMeta,{data:p=[]}=c,g=this.chart._animationsDisabled;let{start:b,count:E}=SM(c,p,g);if(this._drawStart=b,this._drawCount=E,MM(c)&&(b=0,E=p.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:i,_dataset:R}=c;i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!R._decimated,i.points=p;const V=this.resolveDatasetElementOptions(r);V.segment=this.options.segment,this.updateElement(i,void 0,{animated:!g,options:V},r)}else this.datasetElementType&&(delete c.dataset,this.datasetElementType=!1);this.updateElements(p,b,E,r)}addElements(){const{showLine:r}=this.options;!this.datasetElementType&&r&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(r,c,p,g){const b=g==="reset",{iScale:E,vScale:i,_stacked:R,_dataset:V}=this._cachedMeta,j=this.resolveDataElementOptions(c,g),W=this.getSharedOptions(j),te=this.includeOptions(g,W),ne=E.axis,ge=i.axis,{spanGaps:xe,segment:Fe}=this.options,Be=Xh(xe)?xe:Number.POSITIVE_INFINITY,Ke=this.chart._animationsDisabled||b||g==="none";let at=c>0&&this.getParsed(c-1);for(let Ye=c;Ye<c+p;++Ye){const ct=r[Ye],Lt=this.getParsed(Ye),rt=Ke?ct:{},Ut=bn(Lt[ge]),si=rt[ne]=E.getPixelForValue(Lt[ne],Ye),It=rt[ge]=b||Ut?i.getBasePixel():i.getPixelForValue(R?this.applyStack(i,Lt,R):Lt[ge],Ye);rt.skip=isNaN(si)||isNaN(It)||Ut,rt.stop=Ye>0&&Math.abs(Lt[ne]-at[ne])>Be,Fe&&(rt.parsed=Lt,rt.raw=V.data[Ye]),te&&(rt.options=W||this.resolveDataElementOptions(Ye,ct.active?"active":g)),Ke||this.updateElement(ct,Ye,rt,g),at=Lt}this.updateSharedOptions(W,g,j)}getMaxOverflow(){const r=this._cachedMeta,c=r.data||[];if(!this.options.showLine){let i=0;for(let R=c.length-1;R>=0;--R)i=Math.max(i,c[R].size(this.resolveDataElementOptions(R))/2);return i>0&&i}const p=r.dataset,g=p.options&&p.options.borderWidth||0;if(!c.length)return g;const b=c[0].size(this.resolveDataElementOptions(0)),E=c[c.length-1].size(this.resolveDataElementOptions(c.length-1));return Math.max(g,b,E)/2}}Yt(Q_,"id","scatter"),Yt(Q_,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),Yt(Q_,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var rR=Object.freeze({__proto__:null,BarController:X_,BubbleController:Y_,DoughnutController:eu,LineController:K_,PieController:x0,PolarAreaController:cp,RadarController:J_,ScatterController:Q_});function Xc(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class fv{constructor(r){Yt(this,"options");this.options=r||{}}static override(r){Object.assign(fv.prototype,r)}init(){}formats(){return Xc()}parse(){return Xc()}format(){return Xc()}add(){return Xc()}diff(){return Xc()}startOf(){return Xc()}endOf(){return Xc()}}var sR={_date:fv};function oR(a,r,c,p){const{controller:g,data:b,_sorted:E}=a,i=g._cachedMeta.iScale;if(i&&r===i.axis&&r!=="r"&&E&&b.length){const R=i._reversePixels?Cz:Ga;if(p){if(g._sharedOptions){const V=b[0],j=typeof V.getRange=="function"&&V.getRange(r);if(j){const W=R(b,r,c-j),te=R(b,r,c+j);return{lo:W.lo,hi:te.hi}}}}else return R(b,r,c)}return{lo:0,hi:b.length-1}}function zp(a,r,c,p,g){const b=a.getSortedVisibleDatasetMetas(),E=c[r];for(let i=0,R=b.length;i<R;++i){const{index:V,data:j}=b[i],{lo:W,hi:te}=oR(b[i],r,E,g);for(let ne=W;ne<=te;++ne){const ge=j[ne];ge.skip||p(ge,V,ne)}}}function aR(a){const r=a.indexOf("x")!==-1,c=a.indexOf("y")!==-1;return function(p,g){const b=r?Math.abs(p.x-g.x):0,E=c?Math.abs(p.y-g.y):0;return Math.sqrt(Math.pow(b,2)+Math.pow(E,2))}}function Xx(a,r,c,p,g){const b=[];return!g&&!a.isPointInArea(r)||zp(a,c,r,function(i,R,V){!g&&!Ha(i,a.chartArea,0)||i.inRange(r.x,r.y,p)&&b.push({element:i,datasetIndex:R,index:V})},!0),b}function lR(a,r,c,p){let g=[];function b(E,i,R){const{startAngle:V,endAngle:j}=E.getProps(["startAngle","endAngle"],p),{angle:W}=xM(E,{x:r.x,y:r.y});bp(W,V,j)&&g.push({element:E,datasetIndex:i,index:R})}return zp(a,c,r,b),g}function cR(a,r,c,p,g,b){let E=[];const i=aR(c);let R=Number.POSITIVE_INFINITY;function V(j,W,te){const ne=j.inRange(r.x,r.y,g);if(p&&!ne)return;const ge=j.getCenterPoint(g);if(!(!!b||a.isPointInArea(ge))&&!ne)return;const Fe=i(r,ge);Fe<R?(E=[{element:j,datasetIndex:W,index:te}],R=Fe):Fe===R&&E.push({element:j,datasetIndex:W,index:te})}return zp(a,c,r,V),E}function Yx(a,r,c,p,g,b){return!b&&!a.isPointInArea(r)?[]:c==="r"&&!p?lR(a,r,c,g):cR(a,r,c,p,g,b)}function J2(a,r,c,p,g){const b=[],E=c==="x"?"inXRange":"inYRange";let i=!1;return zp(a,c,r,(R,V,j)=>{R[E]&&R[E](r[c],g)&&(b.push({element:R,datasetIndex:V,index:j}),i=i||R.inRange(r.x,r.y,g))}),p&&!i?[]:b}var uR={evaluateInteractionItems:zp,modes:{index(a,r,c,p){const g=Jc(r,a),b=c.axis||"x",E=c.includeInvisible||!1,i=c.intersect?Xx(a,g,b,p,E):Yx(a,g,b,!1,p,E),R=[];return i.length?(a.getSortedVisibleDatasetMetas().forEach(V=>{const j=i[0].index,W=V.data[j];W&&!W.skip&&R.push({element:W,datasetIndex:V.index,index:j})}),R):[]},dataset(a,r,c,p){const g=Jc(r,a),b=c.axis||"xy",E=c.includeInvisible||!1;let i=c.intersect?Xx(a,g,b,p,E):Yx(a,g,b,!1,p,E);if(i.length>0){const R=i[0].datasetIndex,V=a.getDatasetMeta(R).data;i=[];for(let j=0;j<V.length;++j)i.push({element:V[j],datasetIndex:R,index:j})}return i},point(a,r,c,p){const g=Jc(r,a),b=c.axis||"xy",E=c.includeInvisible||!1;return Xx(a,g,b,p,E)},nearest(a,r,c,p){const g=Jc(r,a),b=c.axis||"xy",E=c.includeInvisible||!1;return Yx(a,g,b,c.intersect,p,E)},x(a,r,c,p){const g=Jc(r,a);return J2(a,g,"x",c.intersect,p)},y(a,r,c,p){const g=Jc(r,a);return J2(a,g,"y",c.intersect,p)}}};const GM=["left","top","right","bottom"];function Nf(a,r){return a.filter(c=>c.pos===r)}function Q2(a,r){return a.filter(c=>GM.indexOf(c.pos)===-1&&c.box.axis===r)}function Vf(a,r){return a.sort((c,p)=>{const g=r?p:c,b=r?c:p;return g.weight===b.weight?g.index-b.index:g.weight-b.weight})}function hR(a){const r=[];let c,p,g,b,E,i;for(c=0,p=(a||[]).length;c<p;++c)g=a[c],{position:b,options:{stack:E,stackWeight:i=1}}=g,r.push({index:c,box:g,pos:b,horizontal:g.isHorizontal(),weight:g.weight,stack:E&&b+E,stackWeight:i});return r}function dR(a){const r={};for(const c of a){const{stack:p,pos:g,stackWeight:b}=c;if(!p||!GM.includes(g))continue;const E=r[p]||(r[p]={count:0,placed:0,weight:0,size:0});E.count++,E.weight+=b}return r}function fR(a,r){const c=dR(a),{vBoxMaxWidth:p,hBoxMaxHeight:g}=r;let b,E,i;for(b=0,E=a.length;b<E;++b){i=a[b];const{fullSize:R}=i.box,V=c[i.stack],j=V&&i.stackWeight/V.weight;i.horizontal?(i.width=j?j*p:R&&r.availableWidth,i.height=g):(i.width=p,i.height=j?j*g:R&&r.availableHeight)}return c}function pR(a){const r=hR(a),c=Vf(r.filter(V=>V.box.fullSize),!0),p=Vf(Nf(r,"left"),!0),g=Vf(Nf(r,"right")),b=Vf(Nf(r,"top"),!0),E=Vf(Nf(r,"bottom")),i=Q2(r,"x"),R=Q2(r,"y");return{fullSize:c,leftAndTop:p.concat(b),rightAndBottom:g.concat(R).concat(E).concat(i),chartArea:Nf(r,"chartArea"),vertical:p.concat(g).concat(R),horizontal:b.concat(E).concat(i)}}function eT(a,r,c,p){return Math.max(a[c],r[c])+Math.max(a[p],r[p])}function HM(a,r){a.top=Math.max(a.top,r.top),a.left=Math.max(a.left,r.left),a.bottom=Math.max(a.bottom,r.bottom),a.right=Math.max(a.right,r.right)}function mR(a,r,c,p){const{pos:g,box:b}=c,E=a.maxPadding;if(!pn(g)){c.size&&(a[g]-=c.size);const W=p[c.stack]||{size:0,count:1};W.size=Math.max(W.size,c.horizontal?b.height:b.width),c.size=W.size/W.count,a[g]+=c.size}b.getPadding&&HM(E,b.getPadding());const i=Math.max(0,r.outerWidth-eT(E,a,"left","right")),R=Math.max(0,r.outerHeight-eT(E,a,"top","bottom")),V=i!==a.w,j=R!==a.h;return a.w=i,a.h=R,c.horizontal?{same:V,other:j}:{same:j,other:V}}function _R(a){const r=a.maxPadding;function c(p){const g=Math.max(r[p]-a[p],0);return a[p]+=g,g}a.y+=c("top"),a.x+=c("left"),c("right"),c("bottom")}function gR(a,r){const c=r.maxPadding;function p(g){const b={left:0,top:0,right:0,bottom:0};return g.forEach(E=>{b[E]=Math.max(r[E],c[E])}),b}return p(a?["left","right"]:["top","bottom"])}function Zf(a,r,c,p){const g=[];let b,E,i,R,V,j;for(b=0,E=a.length,V=0;b<E;++b){i=a[b],R=i.box,R.update(i.width||r.w,i.height||r.h,gR(i.horizontal,r));const{same:W,other:te}=mR(r,c,i,p);V|=W&&g.length,j=j||te,R.fullSize||g.push(i)}return V&&Zf(g,r,c,p)||j}function k_(a,r,c,p,g){a.top=c,a.left=r,a.right=r+p,a.bottom=c+g,a.width=p,a.height=g}function tT(a,r,c,p){const g=c.padding;let{x:b,y:E}=r;for(const i of a){const R=i.box,V=p[i.stack]||{count:1,placed:0,weight:1},j=i.stackWeight/V.weight||1;if(i.horizontal){const W=r.w*j,te=V.size||R.height;vp(V.start)&&(E=V.start),R.fullSize?k_(R,g.left,E,c.outerWidth-g.right-g.left,te):k_(R,r.left+V.placed,E,W,te),V.start=E,V.placed+=W,E=R.bottom}else{const W=r.h*j,te=V.size||R.width;vp(V.start)&&(b=V.start),R.fullSize?k_(R,b,g.top,te,c.outerHeight-g.bottom-g.top):k_(R,b,r.top+V.placed,te,W),V.start=b,V.placed+=W,b=R.right}}r.x=b,r.y=E}var ns={addBox(a,r){a.boxes||(a.boxes=[]),r.fullSize=r.fullSize||!1,r.position=r.position||"top",r.weight=r.weight||0,r._layers=r._layers||function(){return[{z:0,draw(c){r.draw(c)}}]},a.boxes.push(r)},removeBox(a,r){const c=a.boxes?a.boxes.indexOf(r):-1;c!==-1&&a.boxes.splice(c,1)},configure(a,r,c){r.fullSize=c.fullSize,r.position=c.position,r.weight=c.weight},update(a,r,c,p){if(!a)return;const g=os(a.options.layout.padding),b=Math.max(r-g.width,0),E=Math.max(c-g.height,0),i=pR(a.boxes),R=i.vertical,V=i.horizontal;Ln(a.boxes,xe=>{typeof xe.beforeLayout=="function"&&xe.beforeLayout()});const j=R.reduce((xe,Fe)=>Fe.box.options&&Fe.box.options.display===!1?xe:xe+1,0)||1,W=Object.freeze({outerWidth:r,outerHeight:c,padding:g,availableWidth:b,availableHeight:E,vBoxMaxWidth:b/2/j,hBoxMaxHeight:E/2}),te=Object.assign({},g);HM(te,os(p));const ne=Object.assign({maxPadding:te,w:b,h:E,x:g.left,y:g.top},g),ge=fR(R.concat(V),W);Zf(i.fullSize,ne,W,ge),Zf(R,ne,W,ge),Zf(V,ne,W,ge)&&Zf(R,ne,W,ge),_R(ne),tT(i.leftAndTop,ne,W,ge),ne.x+=ne.w,ne.y+=ne.h,tT(i.rightAndBottom,ne,W,ge),a.chartArea={left:ne.left,top:ne.top,right:ne.left+ne.w,bottom:ne.top+ne.h,height:ne.h,width:ne.w},Ln(i.chartArea,xe=>{const Fe=xe.box;Object.assign(Fe,a.chartArea),Fe.update(ne.w,ne.h,{left:0,top:0,right:0,bottom:0})})}};class qM{acquireContext(r,c){}releaseContext(r){return!1}addEventListener(r,c,p){}removeEventListener(r,c,p){}getDevicePixelRatio(){return 1}getMaximumSize(r,c,p,g){return c=Math.max(0,c||r.width),p=p||r.height,{width:c,height:Math.max(0,g?Math.floor(c/g):p)}}isAttached(r){return!0}updateConfig(r){}}class yR extends qM{acquireContext(r){return r&&r.getContext&&r.getContext("2d")||null}updateConfig(r){r.options.animation=!1}}const eg="$chartjs",xR={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},iT=a=>a===null||a==="";function vR(a,r){const c=a.style,p=a.getAttribute("height"),g=a.getAttribute("width");if(a[eg]={initial:{height:p,width:g,style:{display:c.display,height:c.height,width:c.width}}},c.display=c.display||"block",c.boxSizing=c.boxSizing||"border-box",iT(g)){const b=N2(a,"width");b!==void 0&&(a.width=b)}if(iT(p))if(a.style.height==="")a.height=a.width/(r||2);else{const b=N2(a,"height");b!==void 0&&(a.height=b)}return a}const $M=w3?{passive:!0}:!1;function bR(a,r,c){a&&a.addEventListener(r,c,$M)}function wR(a,r,c){a&&a.canvas&&a.canvas.removeEventListener(r,c,$M)}function TR(a,r){const c=xR[a.type]||a.type,{x:p,y:g}=Jc(a,r);return{type:c,chart:r,native:a,x:p!==void 0?p:null,y:g!==void 0?g:null}}function mg(a,r){for(const c of a)if(c===r||c.contains(r))return!0}function SR(a,r,c){const p=a.canvas,g=new MutationObserver(b=>{let E=!1;for(const i of b)E=E||mg(i.addedNodes,p),E=E&&!mg(i.removedNodes,p);E&&c()});return g.observe(document,{childList:!0,subtree:!0}),g}function MR(a,r,c){const p=a.canvas,g=new MutationObserver(b=>{let E=!1;for(const i of b)E=E||mg(i.removedNodes,p),E=E&&!mg(i.addedNodes,p);E&&c()});return g.observe(document,{childList:!0,subtree:!0}),g}const Tp=new Map;let nT=0;function WM(){const a=window.devicePixelRatio;a!==nT&&(nT=a,Tp.forEach((r,c)=>{c.currentDevicePixelRatio!==a&&r()}))}function ER(a,r){Tp.size||window.addEventListener("resize",WM),Tp.set(a,r)}function AR(a){Tp.delete(a),Tp.size||window.removeEventListener("resize",WM)}function IR(a,r,c){const p=a.canvas,g=p&&dv(p);if(!g)return;const b=TM((i,R)=>{const V=g.clientWidth;c(i,R),V<g.clientWidth&&c()},window),E=new ResizeObserver(i=>{const R=i[0],V=R.contentRect.width,j=R.contentRect.height;V===0&&j===0||b(V,j)});return E.observe(g),ER(a,b),E}function Kx(a,r,c){c&&c.disconnect(),r==="resize"&&AR(a)}function CR(a,r,c){const p=a.canvas,g=TM(b=>{a.ctx!==null&&c(TR(b,a))},a);return bR(p,r,g),g}class PR extends qM{acquireContext(r,c){const p=r&&r.getContext&&r.getContext("2d");return p&&p.canvas===r?(vR(r,c),p):null}releaseContext(r){const c=r.canvas;if(!c[eg])return!1;const p=c[eg].initial;["height","width"].forEach(b=>{const E=p[b];bn(E)?c.removeAttribute(b):c.setAttribute(b,E)});const g=p.style||{};return Object.keys(g).forEach(b=>{c.style[b]=g[b]}),c.width=c.width,delete c[eg],!0}addEventListener(r,c,p){this.removeEventListener(r,c);const g=r.$proxies||(r.$proxies={}),E={attach:SR,detach:MR,resize:IR}[c]||CR;g[c]=E(r,c,p)}removeEventListener(r,c){const p=r.$proxies||(r.$proxies={}),g=p[c];if(!g)return;({attach:Kx,detach:Kx,resize:Kx}[c]||wR)(r,c,g),p[c]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(r,c,p,g){return b3(r,c,p,g)}isAttached(r){const c=r&&dv(r);return!!(c&&c.isConnected)}}function DR(a){return!hv()||typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas?yR:PR}var G_;let Za=(G_=class{constructor(){Yt(this,"x");Yt(this,"y");Yt(this,"active",!1);Yt(this,"options");Yt(this,"$animations")}tooltipPosition(r){const{x:c,y:p}=this.getProps(["x","y"],r);return{x:c,y:p}}hasValue(){return Xh(this.x)&&Xh(this.y)}getProps(r,c){const p=this.$animations;if(!c||!p)return this;const g={};return r.forEach(b=>{g[b]=p[b]&&p[b].active()?p[b]._to:this[b]}),g}},Yt(G_,"defaults",{}),Yt(G_,"defaultRoutes"),G_);function zR(a,r){const c=a.options.ticks,p=RR(a),g=Math.min(c.maxTicksLimit||p,p),b=c.major.enabled?kR(r):[],E=b.length,i=b[0],R=b[E-1],V=[];if(E>g)return OR(r,V,b,E/g),V;const j=LR(b,r,g);if(E>0){let W,te;const ne=E>1?Math.round((R-i)/(E-1)):null;for(O_(r,V,j,bn(ne)?0:i-ne,i),W=0,te=E-1;W<te;W++)O_(r,V,j,b[W],b[W+1]);return O_(r,V,j,R,bn(ne)?r.length:R+ne),V}return O_(r,V,j),V}function RR(a){const r=a.options.offset,c=a._tickSize(),p=a._length/c+(r?0:1),g=a._maxLength/c;return Math.floor(Math.min(p,g))}function LR(a,r,c){const p=FR(a),g=r.length/c;if(!p)return Math.max(g,1);const b=Mz(p);for(let E=0,i=b.length-1;E<i;E++){const R=b[E];if(R>g)return R}return Math.max(g,1)}function kR(a){const r=[];let c,p;for(c=0,p=a.length;c<p;c++)a[c].major&&r.push(c);return r}function OR(a,r,c,p){let g=0,b=c[0],E;for(p=Math.ceil(p),E=0;E<a.length;E++)E===b&&(r.push(a[E]),g++,b=c[g*p])}function O_(a,r,c,p,g){const b=Wi(p,0),E=Math.min(Wi(g,a.length),a.length);let i=0,R,V,j;for(c=Math.ceil(c),g&&(R=g-p,c=R/Math.floor(R/c)),j=b;j<0;)i++,j=Math.round(b+i*c);for(V=Math.max(b,0);V<E;V++)V===j&&(r.push(a[V]),i++,j=Math.round(b+i*c))}function FR(a){const r=a.length;let c,p;if(r<2)return!1;for(p=a[0],c=1;c<r;++c)if(a[c]-a[c-1]!==p)return!1;return p}const BR=a=>a==="left"?"right":a==="right"?"left":a,rT=(a,r,c)=>r==="top"||r==="left"?a[r]+c:a[r]-c,sT=(a,r)=>Math.min(r||a,a);function oT(a,r){const c=[],p=a.length/r,g=a.length;let b=0;for(;b<g;b+=p)c.push(a[Math.floor(b)]);return c}function NR(a,r,c){const p=a.ticks.length,g=Math.min(r,p-1),b=a._startPixel,E=a._endPixel,i=1e-6;let R=a.getPixelForTick(g),V;if(!(c&&(p===1?V=Math.max(R-b,E-R):r===0?V=(a.getPixelForTick(1)-R)/2:V=(R-a.getPixelForTick(g-1))/2,R+=g<r?V:-V,R<b-i||R>E+i)))return R}function VR(a,r){Ln(a,c=>{const p=c.gc,g=p.length/2;let b;if(g>r){for(b=0;b<g;++b)delete c.data[p[b]];p.splice(0,g)}})}function Uf(a){return a.drawTicks?a.tickLength:0}function aT(a,r){if(!a.display)return 0;const c=Cr(a.font,r),p=os(a.padding);return(er(a.text)?a.text.length:1)*c.lineHeight+p.height}function UR(a,r){return Ql(a,{scale:r,type:"scale"})}function jR(a,r,c){return Ql(a,{tick:c,index:r,type:"tick"})}function GR(a,r,c){let p=sv(a);return(c&&r!=="right"||!c&&r==="right")&&(p=BR(p)),p}function HR(a,r,c,p){const{top:g,left:b,bottom:E,right:i,chart:R}=a,{chartArea:V,scales:j}=R;let W=0,te,ne,ge;const xe=E-g,Fe=i-b;if(a.isHorizontal()){if(ne=es(p,b,i),pn(c)){const Be=Object.keys(c)[0],Ke=c[Be];ge=j[Be].getPixelForValue(Ke)+xe-r}else c==="center"?ge=(V.bottom+V.top)/2+xe-r:ge=rT(a,c,r);te=i-b}else{if(pn(c)){const Be=Object.keys(c)[0],Ke=c[Be];ne=j[Be].getPixelForValue(Ke)-Fe+r}else c==="center"?ne=(V.left+V.right)/2-Fe+r:ne=rT(a,c,r);ge=es(p,E,g),W=c==="left"?-_r:_r}return{titleX:ne,titleY:ge,maxWidth:te,rotation:W}}class cu extends Za{constructor(r){super(),this.id=r.id,this.type=r.type,this.options=void 0,this.ctx=r.ctx,this.chart=r.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(r){this.options=r.setContext(this.getContext()),this.axis=r.axis,this._userMin=this.parse(r.min),this._userMax=this.parse(r.max),this._suggestedMin=this.parse(r.suggestedMin),this._suggestedMax=this.parse(r.suggestedMax)}parse(r,c){return r}getUserBounds(){let{_userMin:r,_userMax:c,_suggestedMin:p,_suggestedMax:g}=this;return r=Us(r,Number.POSITIVE_INFINITY),c=Us(c,Number.NEGATIVE_INFINITY),p=Us(p,Number.POSITIVE_INFINITY),g=Us(g,Number.NEGATIVE_INFINITY),{min:Us(r,p),max:Us(c,g),minDefined:fr(r),maxDefined:fr(c)}}getMinMax(r){let{min:c,max:p,minDefined:g,maxDefined:b}=this.getUserBounds(),E;if(g&&b)return{min:c,max:p};const i=this.getMatchingVisibleMetas();for(let R=0,V=i.length;R<V;++R)E=i[R].controller.getMinMax(this,r),g||(c=Math.min(c,E.min)),b||(p=Math.max(p,E.max));return c=b&&c>p?p:c,p=g&&c>p?c:p,{min:Us(c,Us(p,c)),max:Us(p,Us(c,p))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const r=this.chart.data;return this.options.labels||(this.isHorizontal()?r.xLabels:r.yLabels)||r.labels||[]}getLabelItems(r=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(r))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Un(this.options.beforeUpdate,[this])}update(r,c,p){const{beginAtZero:g,grace:b,ticks:E}=this.options,i=E.sampleSize;this.beforeUpdate(),this.maxWidth=r,this.maxHeight=c,this._margins=p=Object.assign({left:0,right:0,top:0,bottom:0},p),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+p.left+p.right:this.height+p.top+p.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Qz(this,b,g),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const R=i<this.ticks.length;this._convertTicksToLabels(R?oT(this.ticks,i):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),E.display&&(E.autoSkip||E.source==="auto")&&(this.ticks=zR(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),R&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let r=this.options.reverse,c,p;this.isHorizontal()?(c=this.left,p=this.right):(c=this.top,p=this.bottom,r=!r),this._startPixel=c,this._endPixel=p,this._reversePixels=r,this._length=p-c,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Un(this.options.afterUpdate,[this])}beforeSetDimensions(){Un(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Un(this.options.afterSetDimensions,[this])}_callHooks(r){this.chart.notifyPlugins(r,this.getContext()),Un(this.options[r],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Un(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(r){const c=this.options.ticks;let p,g,b;for(p=0,g=r.length;p<g;p++)b=r[p],b.label=Un(c.callback,[b.value,p,r],this)}afterTickToLabelConversion(){Un(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Un(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const r=this.options,c=r.ticks,p=sT(this.ticks.length,r.ticks.maxTicksLimit),g=c.minRotation||0,b=c.maxRotation;let E=g,i,R,V;if(!this._isVisible()||!c.display||g>=b||p<=1||!this.isHorizontal()){this.labelRotation=g;return}const j=this._getLabelSizes(),W=j.widest.width,te=j.highest.height,ne=Lr(this.chart.width-W,0,this.maxWidth);i=r.offset?this.maxWidth/p:ne/(p-1),W+6>i&&(i=ne/(p-(r.offset?.5:1)),R=this.maxHeight-Uf(r.grid)-c.padding-aT(r.title,this.chart.options.font),V=Math.sqrt(W*W+te*te),E=nv(Math.min(Math.asin(Lr((j.highest.height+6)/i,-1,1)),Math.asin(Lr(R/V,-1,1))-Math.asin(Lr(te/V,-1,1)))),E=Math.max(g,Math.min(b,E))),this.labelRotation=E}afterCalculateLabelRotation(){Un(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Un(this.options.beforeFit,[this])}fit(){const r={width:0,height:0},{chart:c,options:{ticks:p,title:g,grid:b}}=this,E=this._isVisible(),i=this.isHorizontal();if(E){const R=aT(g,c.options.font);if(i?(r.width=this.maxWidth,r.height=Uf(b)+R):(r.height=this.maxHeight,r.width=Uf(b)+R),p.display&&this.ticks.length){const{first:V,last:j,widest:W,highest:te}=this._getLabelSizes(),ne=p.padding*2,ge=Io(this.labelRotation),xe=Math.cos(ge),Fe=Math.sin(ge);if(i){const Be=p.mirror?0:Fe*W.width+xe*te.height;r.height=Math.min(this.maxHeight,r.height+Be+ne)}else{const Be=p.mirror?0:xe*W.width+Fe*te.height;r.width=Math.min(this.maxWidth,r.width+Be+ne)}this._calculatePadding(V,j,Fe,xe)}}this._handleMargins(),i?(this.width=this._length=c.width-this._margins.left-this._margins.right,this.height=r.height):(this.width=r.width,this.height=this._length=c.height-this._margins.top-this._margins.bottom)}_calculatePadding(r,c,p,g){const{ticks:{align:b,padding:E},position:i}=this.options,R=this.labelRotation!==0,V=i!=="top"&&this.axis==="x";if(this.isHorizontal()){const j=this.getPixelForTick(0)-this.left,W=this.right-this.getPixelForTick(this.ticks.length-1);let te=0,ne=0;R?V?(te=g*r.width,ne=p*c.height):(te=p*r.height,ne=g*c.width):b==="start"?ne=c.width:b==="end"?te=r.width:b!=="inner"&&(te=r.width/2,ne=c.width/2),this.paddingLeft=Math.max((te-j+E)*this.width/(this.width-j),0),this.paddingRight=Math.max((ne-W+E)*this.width/(this.width-W),0)}else{let j=c.height/2,W=r.height/2;b==="start"?(j=0,W=r.height):b==="end"&&(j=c.height,W=0),this.paddingTop=j+E,this.paddingBottom=W+E}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Un(this.options.afterFit,[this])}isHorizontal(){const{axis:r,position:c}=this.options;return c==="top"||c==="bottom"||r==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(r){this.beforeTickToLabelConversion(),this.generateTickLabels(r);let c,p;for(c=0,p=r.length;c<p;c++)bn(r[c].label)&&(r.splice(c,1),p--,c--);this.afterTickToLabelConversion()}_getLabelSizes(){let r=this._labelSizes;if(!r){const c=this.options.ticks.sampleSize;let p=this.ticks;c<p.length&&(p=oT(p,c)),this._labelSizes=r=this._computeLabelSizes(p,p.length,this.options.ticks.maxTicksLimit)}return r}_computeLabelSizes(r,c,p){const{ctx:g,_longestTextCache:b}=this,E=[],i=[],R=Math.floor(c/sT(c,p));let V=0,j=0,W,te,ne,ge,xe,Fe,Be,Ke,at,Ye,ct;for(W=0;W<c;W+=R){if(ge=r[W].label,xe=this._resolveTickFontOptions(W),g.font=Fe=xe.string,Be=b[Fe]=b[Fe]||{data:{},gc:[]},Ke=xe.lineHeight,at=Ye=0,!bn(ge)&&!er(ge))at=fg(g,Be.data,Be.gc,at,ge),Ye=Ke;else if(er(ge))for(te=0,ne=ge.length;te<ne;++te)ct=ge[te],!bn(ct)&&!er(ct)&&(at=fg(g,Be.data,Be.gc,at,ct),Ye+=Ke);E.push(at),i.push(Ye),V=Math.max(at,V),j=Math.max(Ye,j)}VR(b,c);const Lt=E.indexOf(V),rt=i.indexOf(j),Ut=si=>({width:E[si]||0,height:i[si]||0});return{first:Ut(0),last:Ut(c-1),widest:Ut(Lt),highest:Ut(rt),widths:E,heights:i}}getLabelForValue(r){return r}getPixelForValue(r,c){return NaN}getValueForPixel(r){}getPixelForTick(r){const c=this.ticks;return r<0||r>c.length-1?null:this.getPixelForValue(c[r].value)}getPixelForDecimal(r){this._reversePixels&&(r=1-r);const c=this._startPixel+r*this._length;return Iz(this._alignToPixels?Zc(this.chart,c,0):c)}getDecimalForPixel(r){const c=(r-this._startPixel)/this._length;return this._reversePixels?1-c:c}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:r,max:c}=this;return r<0&&c<0?c:r>0&&c>0?r:0}getContext(r){const c=this.ticks||[];if(r>=0&&r<c.length){const p=c[r];return p.$context||(p.$context=jR(this.getContext(),r,p))}return this.$context||(this.$context=UR(this.chart.getContext(),this))}_tickSize(){const r=this.options.ticks,c=Io(this.labelRotation),p=Math.abs(Math.cos(c)),g=Math.abs(Math.sin(c)),b=this._getLabelSizes(),E=r.autoSkipPadding||0,i=b?b.widest.width+E:0,R=b?b.highest.height+E:0;return this.isHorizontal()?R*p>i*g?i/p:R/g:R*g<i*p?R/p:i/g}_isVisible(){const r=this.options.display;return r!=="auto"?!!r:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(r){const c=this.axis,p=this.chart,g=this.options,{grid:b,position:E,border:i}=g,R=b.offset,V=this.isHorizontal(),W=this.ticks.length+(R?1:0),te=Uf(b),ne=[],ge=i.setContext(this.getContext()),xe=ge.display?ge.width:0,Fe=xe/2,Be=function(mi){return Zc(p,mi,xe)};let Ke,at,Ye,ct,Lt,rt,Ut,si,It,Pt,Ii,tn;if(E==="top")Ke=Be(this.bottom),rt=this.bottom-te,si=Ke-Fe,Pt=Be(r.top)+Fe,tn=r.bottom;else if(E==="bottom")Ke=Be(this.top),Pt=r.top,tn=Be(r.bottom)-Fe,rt=Ke+Fe,si=this.top+te;else if(E==="left")Ke=Be(this.right),Lt=this.right-te,Ut=Ke-Fe,It=Be(r.left)+Fe,Ii=r.right;else if(E==="right")Ke=Be(this.left),It=r.left,Ii=Be(r.right)-Fe,Lt=Ke+Fe,Ut=this.left+te;else if(c==="x"){if(E==="center")Ke=Be((r.top+r.bottom)/2+.5);else if(pn(E)){const mi=Object.keys(E)[0],pi=E[mi];Ke=Be(this.chart.scales[mi].getPixelForValue(pi))}Pt=r.top,tn=r.bottom,rt=Ke+Fe,si=rt+te}else if(c==="y"){if(E==="center")Ke=Be((r.left+r.right)/2);else if(pn(E)){const mi=Object.keys(E)[0],pi=E[mi];Ke=Be(this.chart.scales[mi].getPixelForValue(pi))}Lt=Ke-Fe,Ut=Lt-te,It=r.left,Ii=r.right}const Fn=Wi(g.ticks.maxTicksLimit,W),Gt=Math.max(1,Math.ceil(W/Fn));for(at=0;at<W;at+=Gt){const mi=this.getContext(at),pi=b.setContext(mi),Di=i.setContext(mi),qt=pi.lineWidth,Hn=pi.color,ir=Di.dash||[],Sn=Di.dashOffset,Qt=pi.tickWidth,ar=pi.tickColor,Qn=pi.tickBorderDash||[],mn=pi.tickBorderDashOffset;Ye=NR(this,at,R),Ye!==void 0&&(ct=Zc(p,Ye,qt),V?Lt=Ut=It=Ii=ct:rt=si=Pt=tn=ct,ne.push({tx1:Lt,ty1:rt,tx2:Ut,ty2:si,x1:It,y1:Pt,x2:Ii,y2:tn,width:qt,color:Hn,borderDash:ir,borderDashOffset:Sn,tickWidth:Qt,tickColor:ar,tickBorderDash:Qn,tickBorderDashOffset:mn}))}return this._ticksLength=W,this._borderValue=Ke,ne}_computeLabelItems(r){const c=this.axis,p=this.options,{position:g,ticks:b}=p,E=this.isHorizontal(),i=this.ticks,{align:R,crossAlign:V,padding:j,mirror:W}=b,te=Uf(p.grid),ne=te+j,ge=W?-j:ne,xe=-Io(this.labelRotation),Fe=[];let Be,Ke,at,Ye,ct,Lt,rt,Ut,si,It,Pt,Ii,tn="middle";if(g==="top")Lt=this.bottom-ge,rt=this._getXAxisLabelAlignment();else if(g==="bottom")Lt=this.top+ge,rt=this._getXAxisLabelAlignment();else if(g==="left"){const Gt=this._getYAxisLabelAlignment(te);rt=Gt.textAlign,ct=Gt.x}else if(g==="right"){const Gt=this._getYAxisLabelAlignment(te);rt=Gt.textAlign,ct=Gt.x}else if(c==="x"){if(g==="center")Lt=(r.top+r.bottom)/2+ne;else if(pn(g)){const Gt=Object.keys(g)[0],mi=g[Gt];Lt=this.chart.scales[Gt].getPixelForValue(mi)+ne}rt=this._getXAxisLabelAlignment()}else if(c==="y"){if(g==="center")ct=(r.left+r.right)/2-ne;else if(pn(g)){const Gt=Object.keys(g)[0],mi=g[Gt];ct=this.chart.scales[Gt].getPixelForValue(mi)}rt=this._getYAxisLabelAlignment(te).textAlign}c==="y"&&(R==="start"?tn="top":R==="end"&&(tn="bottom"));const Fn=this._getLabelSizes();for(Be=0,Ke=i.length;Be<Ke;++Be){at=i[Be],Ye=at.label;const Gt=b.setContext(this.getContext(Be));Ut=this.getPixelForTick(Be)+b.labelOffset,si=this._resolveTickFontOptions(Be),It=si.lineHeight,Pt=er(Ye)?Ye.length:1;const mi=Pt/2,pi=Gt.color,Di=Gt.textStrokeColor,qt=Gt.textStrokeWidth;let Hn=rt;E?(ct=Ut,rt==="inner"&&(Be===Ke-1?Hn=this.options.reverse?"left":"right":Be===0?Hn=this.options.reverse?"right":"left":Hn="center"),g==="top"?V==="near"||xe!==0?Ii=-Pt*It+It/2:V==="center"?Ii=-Fn.highest.height/2-mi*It+It:Ii=-Fn.highest.height+It/2:V==="near"||xe!==0?Ii=It/2:V==="center"?Ii=Fn.highest.height/2-mi*It:Ii=Fn.highest.height-Pt*It,W&&(Ii*=-1),xe!==0&&!Gt.showLabelBackdrop&&(ct+=It/2*Math.sin(xe))):(Lt=Ut,Ii=(1-Pt)*It/2);let ir;if(Gt.showLabelBackdrop){const Sn=os(Gt.backdropPadding),Qt=Fn.heights[Be],ar=Fn.widths[Be];let Qn=Ii-Sn.top,mn=0-Sn.left;switch(tn){case"middle":Qn-=Qt/2;break;case"bottom":Qn-=Qt;break}switch(rt){case"center":mn-=ar/2;break;case"right":mn-=ar;break;case"inner":Be===Ke-1?mn-=ar:Be>0&&(mn-=ar/2);break}ir={left:mn,top:Qn,width:ar+Sn.width,height:Qt+Sn.height,color:Gt.backdropColor}}Fe.push({label:Ye,font:si,textOffset:Ii,options:{rotation:xe,color:pi,strokeColor:Di,strokeWidth:qt,textAlign:Hn,textBaseline:tn,translation:[ct,Lt],backdrop:ir}})}return Fe}_getXAxisLabelAlignment(){const{position:r,ticks:c}=this.options;if(-Io(this.labelRotation))return r==="top"?"left":"right";let g="center";return c.align==="start"?g="left":c.align==="end"?g="right":c.align==="inner"&&(g="inner"),g}_getYAxisLabelAlignment(r){const{position:c,ticks:{crossAlign:p,mirror:g,padding:b}}=this.options,E=this._getLabelSizes(),i=r+b,R=E.widest.width;let V,j;return c==="left"?g?(j=this.right+b,p==="near"?V="left":p==="center"?(V="center",j+=R/2):(V="right",j+=R)):(j=this.right-i,p==="near"?V="right":p==="center"?(V="center",j-=R/2):(V="left",j=this.left)):c==="right"?g?(j=this.left+b,p==="near"?V="right":p==="center"?(V="center",j-=R/2):(V="left",j-=R)):(j=this.left+i,p==="near"?V="left":p==="center"?(V="center",j+=R/2):(V="right",j=this.right)):V="right",{textAlign:V,x:j}}_computeLabelArea(){if(this.options.ticks.mirror)return;const r=this.chart,c=this.options.position;if(c==="left"||c==="right")return{top:0,left:this.left,bottom:r.height,right:this.right};if(c==="top"||c==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:r.width}}drawBackground(){const{ctx:r,options:{backgroundColor:c},left:p,top:g,width:b,height:E}=this;c&&(r.save(),r.fillStyle=c,r.fillRect(p,g,b,E),r.restore())}getLineWidthForValue(r){const c=this.options.grid;if(!this._isVisible()||!c.display)return 0;const g=this.ticks.findIndex(b=>b.value===r);return g>=0?c.setContext(this.getContext(g)).lineWidth:0}drawGrid(r){const c=this.options.grid,p=this.ctx,g=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(r));let b,E;const i=(R,V,j)=>{!j.width||!j.color||(p.save(),p.lineWidth=j.width,p.strokeStyle=j.color,p.setLineDash(j.borderDash||[]),p.lineDashOffset=j.borderDashOffset,p.beginPath(),p.moveTo(R.x,R.y),p.lineTo(V.x,V.y),p.stroke(),p.restore())};if(c.display)for(b=0,E=g.length;b<E;++b){const R=g[b];c.drawOnChartArea&&i({x:R.x1,y:R.y1},{x:R.x2,y:R.y2},R),c.drawTicks&&i({x:R.tx1,y:R.ty1},{x:R.tx2,y:R.ty2},{color:R.tickColor,width:R.tickWidth,borderDash:R.tickBorderDash,borderDashOffset:R.tickBorderDashOffset})}}drawBorder(){const{chart:r,ctx:c,options:{border:p,grid:g}}=this,b=p.setContext(this.getContext()),E=p.display?b.width:0;if(!E)return;const i=g.setContext(this.getContext(0)).lineWidth,R=this._borderValue;let V,j,W,te;this.isHorizontal()?(V=Zc(r,this.left,E)-E/2,j=Zc(r,this.right,i)+i/2,W=te=R):(W=Zc(r,this.top,E)-E/2,te=Zc(r,this.bottom,i)+i/2,V=j=R),c.save(),c.lineWidth=b.width,c.strokeStyle=b.color,c.beginPath(),c.moveTo(V,W),c.lineTo(j,te),c.stroke(),c.restore()}drawLabels(r){if(!this.options.ticks.display)return;const p=this.ctx,g=this._computeLabelArea();g&&Pg(p,g);const b=this.getLabelItems(r);for(const E of b){const i=E.options,R=E.font,V=E.label,j=E.textOffset;ou(p,V,0,j,R,i)}g&&Dg(p)}drawTitle(){const{ctx:r,options:{position:c,title:p,reverse:g}}=this;if(!p.display)return;const b=Cr(p.font),E=os(p.padding),i=p.align;let R=b.lineHeight/2;c==="bottom"||c==="center"||pn(c)?(R+=E.bottom,er(p.text)&&(R+=b.lineHeight*(p.text.length-1))):R+=E.top;const{titleX:V,titleY:j,maxWidth:W,rotation:te}=HR(this,R,c,i);ou(r,p.text,0,0,b,{color:p.color,maxWidth:W,rotation:te,textAlign:GR(i,c,g),textBaseline:"middle",translation:[V,j]})}draw(r){this._isVisible()&&(this.drawBackground(),this.drawGrid(r),this.drawBorder(),this.drawTitle(),this.drawLabels(r))}_layers(){const r=this.options,c=r.ticks&&r.ticks.z||0,p=Wi(r.grid&&r.grid.z,-1),g=Wi(r.border&&r.border.z,0);return!this._isVisible()||this.draw!==cu.prototype.draw?[{z:c,draw:b=>{this.draw(b)}}]:[{z:p,draw:b=>{this.drawBackground(),this.drawGrid(b),this.drawTitle()}},{z:g,draw:()=>{this.drawBorder()}},{z:c,draw:b=>{this.drawLabels(b)}}]}getMatchingVisibleMetas(r){const c=this.chart.getSortedVisibleDatasetMetas(),p=this.axis+"AxisID",g=[];let b,E;for(b=0,E=c.length;b<E;++b){const i=c[b];i[p]===this.id&&(!r||i.type===r)&&g.push(i)}return g}_resolveTickFontOptions(r){const c=this.options.ticks.setContext(this.getContext(r));return Cr(c.font)}_maxDigits(){const r=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/r}}class F_{constructor(r,c,p){this.type=r,this.scope=c,this.override=p,this.items=Object.create(null)}isForType(r){return Object.prototype.isPrototypeOf.call(this.type.prototype,r.prototype)}register(r){const c=Object.getPrototypeOf(r);let p;WR(c)&&(p=this.register(c));const g=this.items,b=r.id,E=this.scope+"."+b;if(!b)throw new Error("class does not have id: "+r);return b in g||(g[b]=r,qR(r,E,p),this.override&&tr.override(r.id,r.overrides)),E}get(r){return this.items[r]}unregister(r){const c=this.items,p=r.id,g=this.scope;p in c&&delete c[p],g&&p in tr[g]&&(delete tr[g][p],this.override&&delete su[p])}}function qR(a,r,c){const p=xp(Object.create(null),[c?tr.get(c):{},tr.get(r),a.defaults]);tr.set(r,p),a.defaultRoutes&&$R(r,a.defaultRoutes),a.descriptors&&tr.describe(r,a.descriptors)}function $R(a,r){Object.keys(r).forEach(c=>{const p=c.split("."),g=p.pop(),b=[a].concat(p).join("."),E=r[c].split("."),i=E.pop(),R=E.join(".");tr.route(b,g,R,i)})}function WR(a){return"id"in a&&"defaults"in a}class ZR{constructor(){this.controllers=new F_(Do,"datasets",!0),this.elements=new F_(Za,"elements"),this.plugins=new F_(Object,"plugins"),this.scales=new F_(cu,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...r){this._each("register",r)}remove(...r){this._each("unregister",r)}addControllers(...r){this._each("register",r,this.controllers)}addElements(...r){this._each("register",r,this.elements)}addPlugins(...r){this._each("register",r,this.plugins)}addScales(...r){this._each("register",r,this.scales)}getController(r){return this._get(r,this.controllers,"controller")}getElement(r){return this._get(r,this.elements,"element")}getPlugin(r){return this._get(r,this.plugins,"plugin")}getScale(r){return this._get(r,this.scales,"scale")}removeControllers(...r){this._each("unregister",r,this.controllers)}removeElements(...r){this._each("unregister",r,this.elements)}removePlugins(...r){this._each("unregister",r,this.plugins)}removeScales(...r){this._each("unregister",r,this.scales)}_each(r,c,p){[...c].forEach(g=>{const b=p||this._getRegistryForType(g);p||b.isForType(g)||b===this.plugins&&g.id?this._exec(r,b,g):Ln(g,E=>{const i=p||this._getRegistryForType(E);this._exec(r,i,E)})})}_exec(r,c,p){const g=iv(r);Un(p["before"+g],[],p),c[r](p),Un(p["after"+g],[],p)}_getRegistryForType(r){for(let c=0;c<this._typedRegistries.length;c++){const p=this._typedRegistries[c];if(p.isForType(r))return p}return this.plugins}_get(r,c,p){const g=c.get(r);if(g===void 0)throw new Error('"'+r+'" is not a registered '+p+".");return g}}var na=new ZR;class XR{constructor(){this._init=[]}notify(r,c,p,g){c==="beforeInit"&&(this._init=this._createDescriptors(r,!0),this._notify(this._init,r,"install"));const b=g?this._descriptors(r).filter(g):this._descriptors(r),E=this._notify(b,r,c,p);return c==="afterDestroy"&&(this._notify(b,r,"stop"),this._notify(this._init,r,"uninstall")),E}_notify(r,c,p,g){g=g||{};for(const b of r){const E=b.plugin,i=E[p],R=[c,g,b.options];if(Un(i,R,E)===!1&&g.cancelable)return!1}return!0}invalidate(){bn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(r){if(this._cache)return this._cache;const c=this._cache=this._createDescriptors(r);return this._notifyStateChanges(r),c}_createDescriptors(r,c){const p=r&&r.config,g=Wi(p.options&&p.options.plugins,{}),b=YR(p);return g===!1&&!c?[]:JR(r,b,g,c)}_notifyStateChanges(r){const c=this._oldCache||[],p=this._cache,g=(b,E)=>b.filter(i=>!E.some(R=>i.plugin.id===R.plugin.id));this._notify(g(c,p),r,"stop"),this._notify(g(p,c),r,"start")}}function YR(a){const r={},c=[],p=Object.keys(na.plugins.items);for(let b=0;b<p.length;b++)c.push(na.getPlugin(p[b]));const g=a.plugins||[];for(let b=0;b<g.length;b++){const E=g[b];c.indexOf(E)===-1&&(c.push(E),r[E.id]=!0)}return{plugins:c,localIds:r}}function KR(a,r){return!r&&a===!1?null:a===!0?{}:a}function JR(a,{plugins:r,localIds:c},p,g){const b=[],E=a.getContext();for(const i of r){const R=i.id,V=KR(p[R],g);V!==null&&b.push({plugin:i,options:QR(a.config,{plugin:i,local:c[R]},V,E)})}return b}function QR(a,{plugin:r,local:c},p,g){const b=a.pluginScopeKeys(r),E=a.getOptionScopes(p,b);return c&&r.defaults&&E.push(r.defaults),a.createResolver(E,g,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function v0(a,r){const c=tr.datasets[a]||{};return((r.datasets||{})[a]||{}).indexAxis||r.indexAxis||c.indexAxis||"x"}function eL(a,r){let c=a;return a==="_index_"?c=r:a==="_value_"&&(c=r==="x"?"y":"x"),c}function tL(a,r){return a===r?"_index_":"_value_"}function lT(a){if(a==="x"||a==="y"||a==="r")return a}function iL(a){if(a==="top"||a==="bottom")return"x";if(a==="left"||a==="right")return"y"}function b0(a,...r){if(lT(a))return a;for(const c of r){const p=c.axis||iL(c.position)||a.length>1&&lT(a[0].toLowerCase());if(p)return p}throw new Error(`Cannot determine type of '${a}' axis. Please provide 'axis' or 'position' option.`)}function cT(a,r,c){if(c[r+"AxisID"]===a)return{axis:r}}function nL(a,r){if(r.data&&r.data.datasets){const c=r.data.datasets.filter(p=>p.xAxisID===a||p.yAxisID===a);if(c.length)return cT(a,"x",c[0])||cT(a,"y",c[0])}return{}}function rL(a,r){const c=su[a.type]||{scales:{}},p=r.scales||{},g=v0(a.type,r),b=Object.create(null);return Object.keys(p).forEach(E=>{const i=p[E];if(!pn(i))return console.error(`Invalid scale configuration for scale: ${E}`);if(i._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${E}`);const R=b0(E,i,nL(E,a),tr.scales[i.type]),V=tL(R,g),j=c.scales||{};b[E]=sp(Object.create(null),[{axis:R},i,j[R],j[V]])}),a.data.datasets.forEach(E=>{const i=E.type||a.type,R=E.indexAxis||v0(i,r),j=(su[i]||{}).scales||{};Object.keys(j).forEach(W=>{const te=eL(W,R),ne=E[te+"AxisID"]||te;b[ne]=b[ne]||Object.create(null),sp(b[ne],[{axis:te},p[ne],j[W]])})}),Object.keys(b).forEach(E=>{const i=b[E];sp(i,[tr.scales[i.type],tr.scale])}),b}function ZM(a){const r=a.options||(a.options={});r.plugins=Wi(r.plugins,{}),r.scales=rL(a,r)}function XM(a){return a=a||{},a.datasets=a.datasets||[],a.labels=a.labels||[],a}function sL(a){return a=a||{},a.data=XM(a.data),ZM(a),a}const uT=new Map,YM=new Set;function B_(a,r){let c=uT.get(a);return c||(c=r(),uT.set(a,c),YM.add(c)),c}const jf=(a,r,c)=>{const p=Xl(r,c);p!==void 0&&a.add(p)};class oL{constructor(r){this._config=sL(r),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(r){this._config.type=r}get data(){return this._config.data}set data(r){this._config.data=XM(r)}get options(){return this._config.options}set options(r){this._config.options=r}get plugins(){return this._config.plugins}update(){const r=this._config;this.clearCache(),ZM(r)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(r){return B_(r,()=>[[`datasets.${r}`,""]])}datasetAnimationScopeKeys(r,c){return B_(`${r}.transition.${c}`,()=>[[`datasets.${r}.transitions.${c}`,`transitions.${c}`],[`datasets.${r}`,""]])}datasetElementScopeKeys(r,c){return B_(`${r}-${c}`,()=>[[`datasets.${r}.elements.${c}`,`datasets.${r}`,`elements.${c}`,""]])}pluginScopeKeys(r){const c=r.id,p=this.type;return B_(`${p}-plugin-${c}`,()=>[[`plugins.${c}`,...r.additionalOptionScopes||[]]])}_cachedScopes(r,c){const p=this._scopeCache;let g=p.get(r);return(!g||c)&&(g=new Map,p.set(r,g)),g}getOptionScopes(r,c,p){const{options:g,type:b}=this,E=this._cachedScopes(r,p),i=E.get(c);if(i)return i;const R=new Set;c.forEach(j=>{r&&(R.add(r),j.forEach(W=>jf(R,r,W))),j.forEach(W=>jf(R,g,W)),j.forEach(W=>jf(R,su[b]||{},W)),j.forEach(W=>jf(R,tr,W)),j.forEach(W=>jf(R,g0,W))});const V=Array.from(R);return V.length===0&&V.push(Object.create(null)),YM.has(c)&&E.set(c,V),V}chartOptionScopes(){const{options:r,type:c}=this;return[r,su[c]||{},tr.datasets[c]||{},{type:c},tr,g0]}resolveNamedOptions(r,c,p,g=[""]){const b={$shared:!0},{resolver:E,subPrefixes:i}=hT(this._resolverCache,r,g);let R=E;if(lL(E,c)){b.$shared=!1,p=Yl(p)?p():p;const V=this.createResolver(r,p,i);R=Yh(E,p,V)}for(const V of c)b[V]=R[V];return b}createResolver(r,c,p=[""],g){const{resolver:b}=hT(this._resolverCache,r,p);return pn(c)?Yh(b,c,void 0,g):b}}function hT(a,r,c){let p=a.get(r);p||(p=new Map,a.set(r,p));const g=c.join();let b=p.get(g);return b||(b={resolver:lv(r,c),subPrefixes:c.filter(i=>!i.toLowerCase().includes("hover"))},p.set(g,b)),b}const aL=a=>pn(a)&&Object.getOwnPropertyNames(a).some(r=>Yl(a[r]));function lL(a,r){const{isScriptable:c,isIndexable:p}=CM(a);for(const g of r){const b=c(g),E=p(g),i=(E||b)&&a[g];if(b&&(Yl(i)||aL(i))||E&&er(i))return!0}return!1}var cL="4.4.7";const uL=["top","bottom","left","right","chartArea"];function dT(a,r){return a==="top"||a==="bottom"||uL.indexOf(a)===-1&&r==="x"}function fT(a,r){return function(c,p){return c[a]===p[a]?c[r]-p[r]:c[a]-p[a]}}function pT(a){const r=a.chart,c=r.options.animation;r.notifyPlugins("afterRender"),Un(c&&c.onComplete,[a],r)}function hL(a){const r=a.chart,c=r.options.animation;Un(c&&c.onProgress,[a],r)}function KM(a){return hv()&&typeof a=="string"?a=document.getElementById(a):a&&a.length&&(a=a[0]),a&&a.canvas&&(a=a.canvas),a}const tg={},mT=a=>{const r=KM(a);return Object.values(tg).filter(c=>c.canvas===r).pop()};function dL(a,r,c){const p=Object.keys(a);for(const g of p){const b=+g;if(b>=r){const E=a[g];delete a[g],(c>0||b>r)&&(a[b+c]=E)}}}function fL(a,r,c,p){return!c||a.type==="mouseout"?null:p?r:a}function N_(a,r,c){return a.options.clip?a[c]:r[c]}function pL(a,r){const{xScale:c,yScale:p}=a;return c&&p?{left:N_(c,r,"left"),right:N_(c,r,"right"),top:N_(p,r,"top"),bottom:N_(p,r,"bottom")}:r}class Va{static register(...r){na.add(...r),_T()}static unregister(...r){na.remove(...r),_T()}constructor(r,c){const p=this.config=new oL(c),g=KM(r),b=mT(g);if(b)throw new Error("Canvas is already in use. Chart with ID '"+b.id+"' must be destroyed before the canvas with ID '"+b.canvas.id+"' can be reused.");const E=p.createResolver(p.chartOptionScopes(),this.getContext());this.platform=new(p.platform||DR(g)),this.platform.updateConfig(p);const i=this.platform.acquireContext(g,E.aspectRatio),R=i&&i.canvas,V=R&&R.height,j=R&&R.width;if(this.id=_z(),this.ctx=i,this.canvas=R,this.width=j,this.height=V,this._options=E,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new XR,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=zz(W=>this.update(W),E.resizeDelay||0),this._dataChanges=[],tg[this.id]=this,!i||!R){console.error("Failed to create chart: can't acquire context from the given item");return}Oa.listen(this,"complete",pT),Oa.listen(this,"progress",hL),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:r,maintainAspectRatio:c},width:p,height:g,_aspectRatio:b}=this;return bn(r)?c&&b?b:g?p/g:null:r}get data(){return this.config.data}set data(r){this.config.data=r}get options(){return this._options}set options(r){this.config.options=r}get registry(){return na}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():B2(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return k2(this.canvas,this.ctx),this}stop(){return Oa.stop(this),this}resize(r,c){Oa.running(this)?this._resizeBeforeDraw={width:r,height:c}:this._resize(r,c)}_resize(r,c){const p=this.options,g=this.canvas,b=p.maintainAspectRatio&&this.aspectRatio,E=this.platform.getMaximumSize(g,r,c,b),i=p.devicePixelRatio||this.platform.getDevicePixelRatio(),R=this.width?"resize":"attach";this.width=E.width,this.height=E.height,this._aspectRatio=this.aspectRatio,B2(this,i,!0)&&(this.notifyPlugins("resize",{size:E}),Un(p.onResize,[this,E],this),this.attached&&this._doResize(R)&&this.render())}ensureScalesHaveIDs(){const c=this.options.scales||{};Ln(c,(p,g)=>{p.id=g})}buildOrUpdateScales(){const r=this.options,c=r.scales,p=this.scales,g=Object.keys(p).reduce((E,i)=>(E[i]=!1,E),{});let b=[];c&&(b=b.concat(Object.keys(c).map(E=>{const i=c[E],R=b0(E,i),V=R==="r",j=R==="x";return{options:i,dposition:V?"chartArea":j?"bottom":"left",dtype:V?"radialLinear":j?"category":"linear"}}))),Ln(b,E=>{const i=E.options,R=i.id,V=b0(R,i),j=Wi(i.type,E.dtype);(i.position===void 0||dT(i.position,V)!==dT(E.dposition))&&(i.position=E.dposition),g[R]=!0;let W=null;if(R in p&&p[R].type===j)W=p[R];else{const te=na.getScale(j);W=new te({id:R,type:j,ctx:this.ctx,chart:this}),p[W.id]=W}W.init(i,r)}),Ln(g,(E,i)=>{E||delete p[i]}),Ln(p,E=>{ns.configure(this,E,E.options),ns.addBox(this,E)})}_updateMetasets(){const r=this._metasets,c=this.data.datasets.length,p=r.length;if(r.sort((g,b)=>g.index-b.index),p>c){for(let g=c;g<p;++g)this._destroyDatasetMeta(g);r.splice(c,p-c)}this._sortedMetasets=r.slice(0).sort(fT("order","index"))}_removeUnreferencedMetasets(){const{_metasets:r,data:{datasets:c}}=this;r.length>c.length&&delete this._stacks,r.forEach((p,g)=>{c.filter(b=>b===p._dataset).length===0&&this._destroyDatasetMeta(g)})}buildOrUpdateControllers(){const r=[],c=this.data.datasets;let p,g;for(this._removeUnreferencedMetasets(),p=0,g=c.length;p<g;p++){const b=c[p];let E=this.getDatasetMeta(p);const i=b.type||this.config.type;if(E.type&&E.type!==i&&(this._destroyDatasetMeta(p),E=this.getDatasetMeta(p)),E.type=i,E.indexAxis=b.indexAxis||v0(i,this.options),E.order=b.order||0,E.index=p,E.label=""+b.label,E.visible=this.isDatasetVisible(p),E.controller)E.controller.updateIndex(p),E.controller.linkScales();else{const R=na.getController(i),{datasetElementType:V,dataElementType:j}=tr.datasets[i];Object.assign(R,{dataElementType:na.getElement(j),datasetElementType:V&&na.getElement(V)}),E.controller=new R(this,p),r.push(E.controller)}}return this._updateMetasets(),r}_resetElements(){Ln(this.data.datasets,(r,c)=>{this.getDatasetMeta(c).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(r){const c=this.config;c.update();const p=this._options=c.createResolver(c.chartOptionScopes(),this.getContext()),g=this._animationsDisabled=!p.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:r,cancelable:!0})===!1)return;const b=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let E=0;for(let V=0,j=this.data.datasets.length;V<j;V++){const{controller:W}=this.getDatasetMeta(V),te=!g&&b.indexOf(W)===-1;W.buildOrUpdateElements(te),E=Math.max(+W.getMaxOverflow(),E)}E=this._minPadding=p.layout.autoPadding?E:0,this._updateLayout(E),g||Ln(b,V=>{V.reset()}),this._updateDatasets(r),this.notifyPlugins("afterUpdate",{mode:r}),this._layers.sort(fT("z","_idx"));const{_active:i,_lastEvent:R}=this;R?this._eventHandler(R,!0):i.length&&this._updateHoverStyles(i,i,!0),this.render()}_updateScales(){Ln(this.scales,r=>{ns.removeBox(this,r)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const r=this.options,c=new Set(Object.keys(this._listeners)),p=new Set(r.events);(!E2(c,p)||!!this._responsiveListeners!==r.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:r}=this,c=this._getUniformDataChanges()||[];for(const{method:p,start:g,count:b}of c){const E=p==="_removeElements"?-b:b;dL(r,g,E)}}_getUniformDataChanges(){const r=this._dataChanges;if(!r||!r.length)return;this._dataChanges=[];const c=this.data.datasets.length,p=b=>new Set(r.filter(E=>E[0]===b).map((E,i)=>i+","+E.splice(1).join(","))),g=p(0);for(let b=1;b<c;b++)if(!E2(g,p(b)))return;return Array.from(g).map(b=>b.split(",")).map(b=>({method:b[1],start:+b[2],count:+b[3]}))}_updateLayout(r){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ns.update(this,this.width,this.height,r);const c=this.chartArea,p=c.width<=0||c.height<=0;this._layers=[],Ln(this.boxes,g=>{p&&g.position==="chartArea"||(g.configure&&g.configure(),this._layers.push(...g._layers()))},this),this._layers.forEach((g,b)=>{g._idx=b}),this.notifyPlugins("afterLayout")}_updateDatasets(r){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:r,cancelable:!0})!==!1){for(let c=0,p=this.data.datasets.length;c<p;++c)this.getDatasetMeta(c).controller.configure();for(let c=0,p=this.data.datasets.length;c<p;++c)this._updateDataset(c,Yl(r)?r({datasetIndex:c}):r);this.notifyPlugins("afterDatasetsUpdate",{mode:r})}}_updateDataset(r,c){const p=this.getDatasetMeta(r),g={meta:p,index:r,mode:c,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",g)!==!1&&(p.controller._update(c),g.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",g))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Oa.has(this)?this.attached&&!Oa.running(this)&&Oa.start(this):(this.draw(),pT({chart:this})))}draw(){let r;if(this._resizeBeforeDraw){const{width:p,height:g}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(p,g)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const c=this._layers;for(r=0;r<c.length&&c[r].z<=0;++r)c[r].draw(this.chartArea);for(this._drawDatasets();r<c.length;++r)c[r].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(r){const c=this._sortedMetasets,p=[];let g,b;for(g=0,b=c.length;g<b;++g){const E=c[g];(!r||E.visible)&&p.push(E)}return p}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const r=this.getSortedVisibleDatasetMetas();for(let c=r.length-1;c>=0;--c)this._drawDataset(r[c]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(r){const c=this.ctx,p=r._clip,g=!p.disabled,b=pL(r,this.chartArea),E={meta:r,index:r.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",E)!==!1&&(g&&Pg(c,{left:p.left===!1?0:b.left-p.left,right:p.right===!1?this.width:b.right+p.right,top:p.top===!1?0:b.top-p.top,bottom:p.bottom===!1?this.height:b.bottom+p.bottom}),r.controller.draw(),g&&Dg(c),E.cancelable=!1,this.notifyPlugins("afterDatasetDraw",E))}isPointInArea(r){return Ha(r,this.chartArea,this._minPadding)}getElementsAtEventForMode(r,c,p,g){const b=uR.modes[c];return typeof b=="function"?b(this,r,p,g):[]}getDatasetMeta(r){const c=this.data.datasets[r],p=this._metasets;let g=p.filter(b=>b&&b._dataset===c).pop();return g||(g={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:c&&c.order||0,index:r,_dataset:c,_parsed:[],_sorted:!1},p.push(g)),g}getContext(){return this.$context||(this.$context=Ql(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(r){const c=this.data.datasets[r];if(!c)return!1;const p=this.getDatasetMeta(r);return typeof p.hidden=="boolean"?!p.hidden:!c.hidden}setDatasetVisibility(r,c){const p=this.getDatasetMeta(r);p.hidden=!c}toggleDataVisibility(r){this._hiddenIndices[r]=!this._hiddenIndices[r]}getDataVisibility(r){return!this._hiddenIndices[r]}_updateVisibility(r,c,p){const g=p?"show":"hide",b=this.getDatasetMeta(r),E=b.controller._resolveAnimations(void 0,g);vp(c)?(b.data[c].hidden=!p,this.update()):(this.setDatasetVisibility(r,p),E.update(b,{visible:p}),this.update(i=>i.datasetIndex===r?g:void 0))}hide(r,c){this._updateVisibility(r,c,!1)}show(r,c){this._updateVisibility(r,c,!0)}_destroyDatasetMeta(r){const c=this._metasets[r];c&&c.controller&&c.controller._destroy(),delete this._metasets[r]}_stop(){let r,c;for(this.stop(),Oa.remove(this),r=0,c=this.data.datasets.length;r<c;++r)this._destroyDatasetMeta(r)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:r,ctx:c}=this;this._stop(),this.config.clearCache(),r&&(this.unbindEvents(),k2(r,c),this.platform.releaseContext(c),this.canvas=null,this.ctx=null),delete tg[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...r){return this.canvas.toDataURL(...r)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const r=this._listeners,c=this.platform,p=(b,E)=>{c.addEventListener(this,b,E),r[b]=E},g=(b,E,i)=>{b.offsetX=E,b.offsetY=i,this._eventHandler(b)};Ln(this.options.events,b=>p(b,g))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const r=this._responsiveListeners,c=this.platform,p=(R,V)=>{c.addEventListener(this,R,V),r[R]=V},g=(R,V)=>{r[R]&&(c.removeEventListener(this,R,V),delete r[R])},b=(R,V)=>{this.canvas&&this.resize(R,V)};let E;const i=()=>{g("attach",i),this.attached=!0,this.resize(),p("resize",b),p("detach",E)};E=()=>{this.attached=!1,g("resize",b),this._stop(),this._resize(0,0),p("attach",i)},c.isAttached(this.canvas)?i():E()}unbindEvents(){Ln(this._listeners,(r,c)=>{this.platform.removeEventListener(this,c,r)}),this._listeners={},Ln(this._responsiveListeners,(r,c)=>{this.platform.removeEventListener(this,c,r)}),this._responsiveListeners=void 0}updateHoverStyle(r,c,p){const g=p?"set":"remove";let b,E,i,R;for(c==="dataset"&&(b=this.getDatasetMeta(r[0].datasetIndex),b.controller["_"+g+"DatasetHoverStyle"]()),i=0,R=r.length;i<R;++i){E=r[i];const V=E&&this.getDatasetMeta(E.datasetIndex).controller;V&&V[g+"HoverStyle"](E.element,E.datasetIndex,E.index)}}getActiveElements(){return this._active||[]}setActiveElements(r){const c=this._active||[],p=r.map(({datasetIndex:b,index:E})=>{const i=this.getDatasetMeta(b);if(!i)throw new Error("No dataset found at index "+b);return{datasetIndex:b,element:i.data[E],index:E}});!ug(p,c)&&(this._active=p,this._lastEvent=null,this._updateHoverStyles(p,c))}notifyPlugins(r,c,p){return this._plugins.notify(this,r,c,p)}isPluginEnabled(r){return this._plugins._cache.filter(c=>c.plugin.id===r).length===1}_updateHoverStyles(r,c,p){const g=this.options.hover,b=(R,V)=>R.filter(j=>!V.some(W=>j.datasetIndex===W.datasetIndex&&j.index===W.index)),E=b(c,r),i=p?r:b(r,c);E.length&&this.updateHoverStyle(E,g.mode,!1),i.length&&g.mode&&this.updateHoverStyle(i,g.mode,!0)}_eventHandler(r,c){const p={event:r,replay:c,cancelable:!0,inChartArea:this.isPointInArea(r)},g=E=>(E.options.events||this.options.events).includes(r.native.type);if(this.notifyPlugins("beforeEvent",p,g)===!1)return;const b=this._handleEvent(r,c,p.inChartArea);return p.cancelable=!1,this.notifyPlugins("afterEvent",p,g),(b||p.changed)&&this.render(),this}_handleEvent(r,c,p){const{_active:g=[],options:b}=this,E=c,i=this._getActiveElements(r,g,p,E),R=wz(r),V=fL(r,this._lastEvent,p,R);p&&(this._lastEvent=null,Un(b.onHover,[r,i,this],this),R&&Un(b.onClick,[r,i,this],this));const j=!ug(i,g);return(j||c)&&(this._active=i,this._updateHoverStyles(i,g,c)),this._lastEvent=V,j}_getActiveElements(r,c,p,g){if(r.type==="mouseout")return[];if(!p)return c;const b=this.options.hover;return this.getElementsAtEventForMode(r,b.mode,b,g)}}Yt(Va,"defaults",tr),Yt(Va,"instances",tg),Yt(Va,"overrides",su),Yt(Va,"registry",na),Yt(Va,"version",cL),Yt(Va,"getChart",mT);function _T(){return Ln(Va.instances,a=>a._plugins.invalidate())}function mL(a,r,c){const{startAngle:p,pixelMargin:g,x:b,y:E,outerRadius:i,innerRadius:R}=r;let V=g/i;a.beginPath(),a.arc(b,E,i,p-V,c+V),R>g?(V=g/R,a.arc(b,E,R,c+V,p-V,!0)):a.arc(b,E,g,c+_r,p-_r),a.closePath(),a.clip()}function _L(a){return av(a,["outerStart","outerEnd","innerStart","innerEnd"])}function gL(a,r,c,p){const g=_L(a.options.borderRadius),b=(c-r)/2,E=Math.min(b,p*r/2),i=R=>{const V=(c-Math.min(b,R))*p/2;return Lr(R,0,Math.min(b,V))};return{outerStart:i(g.outerStart),outerEnd:i(g.outerEnd),innerStart:Lr(g.innerStart,0,E),innerEnd:Lr(g.innerEnd,0,E)}}function Bh(a,r,c,p){return{x:c+a*Math.cos(r),y:p+a*Math.sin(r)}}function _g(a,r,c,p,g,b){const{x:E,y:i,startAngle:R,pixelMargin:V,innerRadius:j}=r,W=Math.max(r.outerRadius+p+c-V,0),te=j>0?j+p+c+V:0;let ne=0;const ge=g-R;if(p){const Gt=j>0?j-p:0,mi=W>0?W-p:0,pi=(Gt+mi)/2,Di=pi!==0?ge*pi/(pi+p):ge;ne=(ge-Di)/2}const xe=Math.max(.001,ge*W-c/Jn)/W,Fe=(ge-xe)/2,Be=R+Fe+ne,Ke=g-Fe-ne,{outerStart:at,outerEnd:Ye,innerStart:ct,innerEnd:Lt}=gL(r,te,W,Ke-Be),rt=W-at,Ut=W-Ye,si=Be+at/rt,It=Ke-Ye/Ut,Pt=te+ct,Ii=te+Lt,tn=Be+ct/Pt,Fn=Ke-Lt/Ii;if(a.beginPath(),b){const Gt=(si+It)/2;if(a.arc(E,i,W,si,Gt),a.arc(E,i,W,Gt,It),Ye>0){const qt=Bh(Ut,It,E,i);a.arc(qt.x,qt.y,Ye,It,Ke+_r)}const mi=Bh(Ii,Ke,E,i);if(a.lineTo(mi.x,mi.y),Lt>0){const qt=Bh(Ii,Fn,E,i);a.arc(qt.x,qt.y,Lt,Ke+_r,Fn+Math.PI)}const pi=(Ke-Lt/te+(Be+ct/te))/2;if(a.arc(E,i,te,Ke-Lt/te,pi,!0),a.arc(E,i,te,pi,Be+ct/te,!0),ct>0){const qt=Bh(Pt,tn,E,i);a.arc(qt.x,qt.y,ct,tn+Math.PI,Be-_r)}const Di=Bh(rt,Be,E,i);if(a.lineTo(Di.x,Di.y),at>0){const qt=Bh(rt,si,E,i);a.arc(qt.x,qt.y,at,Be-_r,si)}}else{a.moveTo(E,i);const Gt=Math.cos(si)*W+E,mi=Math.sin(si)*W+i;a.lineTo(Gt,mi);const pi=Math.cos(It)*W+E,Di=Math.sin(It)*W+i;a.lineTo(pi,Di)}a.closePath()}function yL(a,r,c,p,g){const{fullCircles:b,startAngle:E,circumference:i}=r;let R=r.endAngle;if(b){_g(a,r,c,p,R,g);for(let V=0;V<b;++V)a.fill();isNaN(i)||(R=E+(i%Kn||Kn))}return _g(a,r,c,p,R,g),a.fill(),R}function xL(a,r,c,p,g){const{fullCircles:b,startAngle:E,circumference:i,options:R}=r,{borderWidth:V,borderJoinStyle:j,borderDash:W,borderDashOffset:te}=R,ne=R.borderAlign==="inner";if(!V)return;a.setLineDash(W||[]),a.lineDashOffset=te,ne?(a.lineWidth=V*2,a.lineJoin=j||"round"):(a.lineWidth=V,a.lineJoin=j||"bevel");let ge=r.endAngle;if(b){_g(a,r,c,p,ge,g);for(let xe=0;xe<b;++xe)a.stroke();isNaN(i)||(ge=E+(i%Kn||Kn))}ne&&mL(a,r,ge),b||(_g(a,r,c,p,ge,g),a.stroke())}class Xf extends Za{constructor(c){super();Yt(this,"circumference");Yt(this,"endAngle");Yt(this,"fullCircles");Yt(this,"innerRadius");Yt(this,"outerRadius");Yt(this,"pixelMargin");Yt(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,c&&Object.assign(this,c)}inRange(c,p,g){const b=this.getProps(["x","y"],g),{angle:E,distance:i}=xM(b,{x:c,y:p}),{startAngle:R,endAngle:V,innerRadius:j,outerRadius:W,circumference:te}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],g),ne=(this.options.spacing+this.options.borderWidth)/2,ge=Wi(te,V-R),xe=bp(E,R,V)&&R!==V,Fe=ge>=Kn||xe,Be=ja(i,j+ne,W+ne);return Fe&&Be}getCenterPoint(c){const{x:p,y:g,startAngle:b,endAngle:E,innerRadius:i,outerRadius:R}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],c),{offset:V,spacing:j}=this.options,W=(b+E)/2,te=(i+R+j+V)/2;return{x:p+Math.cos(W)*te,y:g+Math.sin(W)*te}}tooltipPosition(c){return this.getCenterPoint(c)}draw(c){const{options:p,circumference:g}=this,b=(p.offset||0)/4,E=(p.spacing||0)/2,i=p.circular;if(this.pixelMargin=p.borderAlign==="inner"?.33:0,this.fullCircles=g>Kn?Math.floor(g/Kn):0,g===0||this.innerRadius<0||this.outerRadius<0)return;c.save();const R=(this.startAngle+this.endAngle)/2;c.translate(Math.cos(R)*b,Math.sin(R)*b);const V=1-Math.sin(Math.min(Jn,g||0)),j=b*V;c.fillStyle=p.backgroundColor,c.strokeStyle=p.borderColor,yL(c,this,j,E,i),xL(c,this,j,E,i),c.restore()}}Yt(Xf,"id","arc"),Yt(Xf,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),Yt(Xf,"defaultRoutes",{backgroundColor:"backgroundColor"}),Yt(Xf,"descriptors",{_scriptable:!0,_indexable:c=>c!=="borderDash"});function JM(a,r,c=r){a.lineCap=Wi(c.borderCapStyle,r.borderCapStyle),a.setLineDash(Wi(c.borderDash,r.borderDash)),a.lineDashOffset=Wi(c.borderDashOffset,r.borderDashOffset),a.lineJoin=Wi(c.borderJoinStyle,r.borderJoinStyle),a.lineWidth=Wi(c.borderWidth,r.borderWidth),a.strokeStyle=Wi(c.borderColor,r.borderColor)}function vL(a,r,c){a.lineTo(c.x,c.y)}function bL(a){return a.stepped?Hz:a.tension||a.cubicInterpolationMode==="monotone"?qz:vL}function QM(a,r,c={}){const p=a.length,{start:g=0,end:b=p-1}=c,{start:E,end:i}=r,R=Math.max(g,E),V=Math.min(b,i),j=g<E&&b<E||g>i&&b>i;return{count:p,start:R,loop:r.loop,ilen:V<R&&!j?p+V-R:V-R}}function wL(a,r,c,p){const{points:g,options:b}=r,{count:E,start:i,loop:R,ilen:V}=QM(g,c,p),j=bL(b);let{move:W=!0,reverse:te}=p||{},ne,ge,xe;for(ne=0;ne<=V;++ne)ge=g[(i+(te?V-ne:ne))%E],!ge.skip&&(W?(a.moveTo(ge.x,ge.y),W=!1):j(a,xe,ge,te,b.stepped),xe=ge);return R&&(ge=g[(i+(te?V:0))%E],j(a,xe,ge,te,b.stepped)),!!R}function TL(a,r,c,p){const g=r.points,{count:b,start:E,ilen:i}=QM(g,c,p),{move:R=!0,reverse:V}=p||{};let j=0,W=0,te,ne,ge,xe,Fe,Be;const Ke=Ye=>(E+(V?i-Ye:Ye))%b,at=()=>{xe!==Fe&&(a.lineTo(j,Fe),a.lineTo(j,xe),a.lineTo(j,Be))};for(R&&(ne=g[Ke(0)],a.moveTo(ne.x,ne.y)),te=0;te<=i;++te){if(ne=g[Ke(te)],ne.skip)continue;const Ye=ne.x,ct=ne.y,Lt=Ye|0;Lt===ge?(ct<xe?xe=ct:ct>Fe&&(Fe=ct),j=(W*j+Ye)/++W):(at(),a.lineTo(Ye,ct),ge=Lt,W=0,xe=Fe=ct),Be=ct}at()}function w0(a){const r=a.options,c=r.borderDash&&r.borderDash.length;return!a._decimated&&!a._loop&&!r.tension&&r.cubicInterpolationMode!=="monotone"&&!r.stepped&&!c?TL:wL}function SL(a){return a.stepped?T3:a.tension||a.cubicInterpolationMode==="monotone"?S3:Qc}function ML(a,r,c,p){let g=r._path;g||(g=r._path=new Path2D,r.path(g,c,p)&&g.closePath()),JM(a,r.options),a.stroke(g)}function EL(a,r,c,p){const{segments:g,options:b}=r,E=w0(r);for(const i of g)JM(a,b,i.style),a.beginPath(),E(a,r,i,{start:c,end:c+p-1})&&a.closePath(),a.stroke()}const AL=typeof Path2D=="function";function IL(a,r,c,p){AL&&!r.options.segment?ML(a,r,c,p):EL(a,r,c,p)}class ql extends Za{constructor(r){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,r&&Object.assign(this,r)}updateControlPoints(r,c){const p=this.options;if((p.tension||p.cubicInterpolationMode==="monotone")&&!p.stepped&&!this._pointsUpdated){const g=p.spanGaps?this._loop:this._fullLoop;m3(this._points,p,r,g,c),this._pointsUpdated=!0}}set points(r){this._points=r,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=P3(this,this.options.segment))}first(){const r=this.segments,c=this.points;return r.length&&c[r[0].start]}last(){const r=this.segments,c=this.points,p=r.length;return p&&c[r[p-1].end]}interpolate(r,c){const p=this.options,g=r[c],b=this.points,E=NM(this,{property:c,start:g,end:g});if(!E.length)return;const i=[],R=SL(p);let V,j;for(V=0,j=E.length;V<j;++V){const{start:W,end:te}=E[V],ne=b[W],ge=b[te];if(ne===ge){i.push(ne);continue}const xe=Math.abs((g-ne[c])/(ge[c]-ne[c])),Fe=R(ne,ge,xe,p.stepped);Fe[c]=r[c],i.push(Fe)}return i.length===1?i[0]:i}pathSegment(r,c,p){return w0(this)(r,this,c,p)}path(r,c,p){const g=this.segments,b=w0(this);let E=this._loop;c=c||0,p=p||this.points.length-c;for(const i of g)E&=b(r,this,i,{start:c,end:c+p-1});return!!E}draw(r,c,p,g){const b=this.options||{};(this.points||[]).length&&b.borderWidth&&(r.save(),IL(r,this,p,g),r.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}Yt(ql,"id","line"),Yt(ql,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),Yt(ql,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),Yt(ql,"descriptors",{_scriptable:!0,_indexable:r=>r!=="borderDash"&&r!=="fill"});function gT(a,r,c,p){const g=a.options,{[c]:b}=a.getProps([c],p);return Math.abs(r-b)<g.radius+g.hitRadius}class ig extends Za{constructor(c){super();Yt(this,"parsed");Yt(this,"skip");Yt(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,c&&Object.assign(this,c)}inRange(c,p,g){const b=this.options,{x:E,y:i}=this.getProps(["x","y"],g);return Math.pow(c-E,2)+Math.pow(p-i,2)<Math.pow(b.hitRadius+b.radius,2)}inXRange(c,p){return gT(this,c,"x",p)}inYRange(c,p){return gT(this,c,"y",p)}getCenterPoint(c){const{x:p,y:g}=this.getProps(["x","y"],c);return{x:p,y:g}}size(c){c=c||this.options||{};let p=c.radius||0;p=Math.max(p,p&&c.hoverRadius||0);const g=p&&c.borderWidth||0;return(p+g)*2}draw(c,p){const g=this.options;this.skip||g.radius<.1||!Ha(this,p,this.size(g)/2)||(c.strokeStyle=g.borderColor,c.lineWidth=g.borderWidth,c.fillStyle=g.backgroundColor,y0(c,g,this.x,this.y))}getRange(){const c=this.options||{};return c.radius+c.hitRadius}}Yt(ig,"id","point"),Yt(ig,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),Yt(ig,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function eE(a,r){const{x:c,y:p,base:g,width:b,height:E}=a.getProps(["x","y","base","width","height"],r);let i,R,V,j,W;return a.horizontal?(W=E/2,i=Math.min(c,g),R=Math.max(c,g),V=p-W,j=p+W):(W=b/2,i=c-W,R=c+W,V=Math.min(p,g),j=Math.max(p,g)),{left:i,top:V,right:R,bottom:j}}function $l(a,r,c,p){return a?0:Lr(r,c,p)}function CL(a,r,c){const p=a.options.borderWidth,g=a.borderSkipped,b=IM(p);return{t:$l(g.top,b.top,0,c),r:$l(g.right,b.right,0,r),b:$l(g.bottom,b.bottom,0,c),l:$l(g.left,b.left,0,r)}}function PL(a,r,c){const{enableBorderRadius:p}=a.getProps(["enableBorderRadius"]),g=a.options.borderRadius,b=iu(g),E=Math.min(r,c),i=a.borderSkipped,R=p||pn(g);return{topLeft:$l(!R||i.top||i.left,b.topLeft,0,E),topRight:$l(!R||i.top||i.right,b.topRight,0,E),bottomLeft:$l(!R||i.bottom||i.left,b.bottomLeft,0,E),bottomRight:$l(!R||i.bottom||i.right,b.bottomRight,0,E)}}function DL(a){const r=eE(a),c=r.right-r.left,p=r.bottom-r.top,g=CL(a,c/2,p/2),b=PL(a,c/2,p/2);return{outer:{x:r.left,y:r.top,w:c,h:p,radius:b},inner:{x:r.left+g.l,y:r.top+g.t,w:c-g.l-g.r,h:p-g.t-g.b,radius:{topLeft:Math.max(0,b.topLeft-Math.max(g.t,g.l)),topRight:Math.max(0,b.topRight-Math.max(g.t,g.r)),bottomLeft:Math.max(0,b.bottomLeft-Math.max(g.b,g.l)),bottomRight:Math.max(0,b.bottomRight-Math.max(g.b,g.r))}}}}function Jx(a,r,c,p){const g=r===null,b=c===null,i=a&&!(g&&b)&&eE(a,p);return i&&(g||ja(r,i.left,i.right))&&(b||ja(c,i.top,i.bottom))}function zL(a){return a.topLeft||a.topRight||a.bottomLeft||a.bottomRight}function RL(a,r){a.rect(r.x,r.y,r.w,r.h)}function Qx(a,r,c={}){const p=a.x!==c.x?-r:0,g=a.y!==c.y?-r:0,b=(a.x+a.w!==c.x+c.w?r:0)-p,E=(a.y+a.h!==c.y+c.h?r:0)-g;return{x:a.x+p,y:a.y+g,w:a.w+b,h:a.h+E,radius:a.radius}}class ng extends Za{constructor(r){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,r&&Object.assign(this,r)}draw(r){const{inflateAmount:c,options:{borderColor:p,backgroundColor:g}}=this,{inner:b,outer:E}=DL(this),i=zL(E.radius)?wp:RL;r.save(),(E.w!==b.w||E.h!==b.h)&&(r.beginPath(),i(r,Qx(E,c,b)),r.clip(),i(r,Qx(b,-c,E)),r.fillStyle=p,r.fill("evenodd")),r.beginPath(),i(r,Qx(b,c)),r.fillStyle=g,r.fill(),r.restore()}inRange(r,c,p){return Jx(this,r,c,p)}inXRange(r,c){return Jx(this,r,null,c)}inYRange(r,c){return Jx(this,null,r,c)}getCenterPoint(r){const{x:c,y:p,base:g,horizontal:b}=this.getProps(["x","y","base","horizontal"],r);return{x:b?(c+g)/2:c,y:b?p:(p+g)/2}}getRange(r){return r==="x"?this.width/2:this.height/2}}Yt(ng,"id","bar"),Yt(ng,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Yt(ng,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var LL=Object.freeze({__proto__:null,ArcElement:Xf,BarElement:ng,LineElement:ql,PointElement:ig});const T0=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],yT=T0.map(a=>a.replace("rgb(","rgba(").replace(")",", 0.5)"));function tE(a){return T0[a%T0.length]}function iE(a){return yT[a%yT.length]}function kL(a,r){return a.borderColor=tE(r),a.backgroundColor=iE(r),++r}function OL(a,r){return a.backgroundColor=a.data.map(()=>tE(r++)),r}function FL(a,r){return a.backgroundColor=a.data.map(()=>iE(r++)),r}function BL(a){let r=0;return(c,p)=>{const g=a.getDatasetMeta(p).controller;g instanceof eu?r=OL(c,r):g instanceof cp?r=FL(c,r):g&&(r=kL(c,r))}}function xT(a){let r;for(r in a)if(a[r].borderColor||a[r].backgroundColor)return!0;return!1}function NL(a){return a&&(a.borderColor||a.backgroundColor)}function VL(){return tr.borderColor!=="rgba(0,0,0,0.1)"||tr.backgroundColor!=="rgba(0,0,0,0.1)"}var UL={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(a,r,c){if(!c.enabled)return;const{data:{datasets:p},options:g}=a.config,{elements:b}=g,E=xT(p)||NL(g)||b&&xT(b)||VL();if(!c.forceOverride&&E)return;const i=BL(a);p.forEach(i)}};function jL(a,r,c,p,g){const b=g.samples||p;if(b>=c)return a.slice(r,r+c);const E=[],i=(c-2)/(b-2);let R=0;const V=r+c-1;let j=r,W,te,ne,ge,xe;for(E[R++]=a[j],W=0;W<b-2;W++){let Fe=0,Be=0,Ke;const at=Math.floor((W+1)*i)+1+r,Ye=Math.min(Math.floor((W+2)*i)+1,c)+r,ct=Ye-at;for(Ke=at;Ke<Ye;Ke++)Fe+=a[Ke].x,Be+=a[Ke].y;Fe/=ct,Be/=ct;const Lt=Math.floor(W*i)+1+r,rt=Math.min(Math.floor((W+1)*i)+1,c)+r,{x:Ut,y:si}=a[j];for(ne=ge=-1,Ke=Lt;Ke<rt;Ke++)ge=.5*Math.abs((Ut-Fe)*(a[Ke].y-si)-(Ut-a[Ke].x)*(Be-si)),ge>ne&&(ne=ge,te=a[Ke],xe=Ke);E[R++]=te,j=xe}return E[R++]=a[V],E}function GL(a,r,c,p){let g=0,b=0,E,i,R,V,j,W,te,ne,ge,xe;const Fe=[],Be=r+c-1,Ke=a[r].x,Ye=a[Be].x-Ke;for(E=r;E<r+c;++E){i=a[E],R=(i.x-Ke)/Ye*p,V=i.y;const ct=R|0;if(ct===j)V<ge?(ge=V,W=E):V>xe&&(xe=V,te=E),g=(b*g+i.x)/++b;else{const Lt=E-1;if(!bn(W)&&!bn(te)){const rt=Math.min(W,te),Ut=Math.max(W,te);rt!==ne&&rt!==Lt&&Fe.push({...a[rt],x:g}),Ut!==ne&&Ut!==Lt&&Fe.push({...a[Ut],x:g})}E>0&&Lt!==ne&&Fe.push(a[Lt]),Fe.push(i),j=ct,b=0,ge=xe=V,W=te=ne=E}}return Fe}function nE(a){if(a._decimated){const r=a._data;delete a._decimated,delete a._data,Object.defineProperty(a,"data",{configurable:!0,enumerable:!0,writable:!0,value:r})}}function vT(a){a.data.datasets.forEach(r=>{nE(r)})}function HL(a,r){const c=r.length;let p=0,g;const{iScale:b}=a,{min:E,max:i,minDefined:R,maxDefined:V}=b.getUserBounds();return R&&(p=Lr(Ga(r,b.axis,E).lo,0,c-1)),V?g=Lr(Ga(r,b.axis,i).hi+1,p,c)-p:g=c-p,{start:p,count:g}}var qL={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(a,r,c)=>{if(!c.enabled){vT(a);return}const p=a.width;a.data.datasets.forEach((g,b)=>{const{_data:E,indexAxis:i}=g,R=a.getDatasetMeta(b),V=E||g.data;if(Wf([i,a.options.indexAxis])==="y"||!R.controller.supportsDecimation)return;const j=a.scales[R.xAxisID];if(j.type!=="linear"&&j.type!=="time"||a.options.parsing)return;let{start:W,count:te}=HL(R,V);const ne=c.threshold||4*p;if(te<=ne){nE(g);return}bn(E)&&(g._data=V,delete g.data,Object.defineProperty(g,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(xe){this._data=xe}}));let ge;switch(c.algorithm){case"lttb":ge=jL(V,W,te,p,c);break;case"min-max":ge=GL(V,W,te,p);break;default:throw new Error(`Unsupported decimation algorithm '${c.algorithm}'`)}g._decimated=ge})},destroy(a){vT(a)}};function $L(a,r,c){const p=a.segments,g=a.points,b=r.points,E=[];for(const i of p){let{start:R,end:V}=i;V=pv(R,V,g);const j=S0(c,g[R],g[V],i.loop);if(!r.segments){E.push({source:i,target:j,start:g[R],end:g[V]});continue}const W=NM(r,j);for(const te of W){const ne=S0(c,b[te.start],b[te.end],te.loop),ge=BM(i,g,ne);for(const xe of ge)E.push({source:xe,target:te,start:{[c]:bT(j,ne,"start",Math.max)},end:{[c]:bT(j,ne,"end",Math.min)}})}}return E}function S0(a,r,c,p){if(p)return;let g=r[a],b=c[a];return a==="angle"&&(g=Gs(g),b=Gs(b)),{property:a,start:g,end:b}}function WL(a,r){const{x:c=null,y:p=null}=a||{},g=r.points,b=[];return r.segments.forEach(({start:E,end:i})=>{i=pv(E,i,g);const R=g[E],V=g[i];p!==null?(b.push({x:R.x,y:p}),b.push({x:V.x,y:p})):c!==null&&(b.push({x:c,y:R.y}),b.push({x:c,y:V.y}))}),b}function pv(a,r,c){for(;r>a;r--){const p=c[r];if(!isNaN(p.x)&&!isNaN(p.y))break}return r}function bT(a,r,c,p){return a&&r?p(a[c],r[c]):a?a[c]:r?r[c]:0}function rE(a,r){let c=[],p=!1;return er(a)?(p=!0,c=a):c=WL(a,r),c.length?new ql({points:c,options:{tension:0},_loop:p,_fullLoop:p}):null}function wT(a){return a&&a.fill!==!1}function ZL(a,r,c){let g=a[r].fill;const b=[r];let E;if(!c)return g;for(;g!==!1&&b.indexOf(g)===-1;){if(!fr(g))return g;if(E=a[g],!E)return!1;if(E.visible)return g;b.push(g),g=E.fill}return!1}function XL(a,r,c){const p=QL(a);if(pn(p))return isNaN(p.value)?!1:p;let g=parseFloat(p);return fr(g)&&Math.floor(g)===g?YL(p[0],r,g,c):["origin","start","end","stack","shape"].indexOf(p)>=0&&p}function YL(a,r,c,p){return(a==="-"||a==="+")&&(c=r+c),c===r||c<0||c>=p?!1:c}function KL(a,r){let c=null;return a==="start"?c=r.bottom:a==="end"?c=r.top:pn(a)?c=r.getPixelForValue(a.value):r.getBasePixel&&(c=r.getBasePixel()),c}function JL(a,r,c){let p;return a==="start"?p=c:a==="end"?p=r.options.reverse?r.min:r.max:pn(a)?p=a.value:p=r.getBaseValue(),p}function QL(a){const r=a.options,c=r.fill;let p=Wi(c&&c.target,c);return p===void 0&&(p=!!r.backgroundColor),p===!1||p===null?!1:p===!0?"origin":p}function ek(a){const{scale:r,index:c,line:p}=a,g=[],b=p.segments,E=p.points,i=tk(r,c);i.push(rE({x:null,y:r.bottom},p));for(let R=0;R<b.length;R++){const V=b[R];for(let j=V.start;j<=V.end;j++)ik(g,E[j],i)}return new ql({points:g,options:{}})}function tk(a,r){const c=[],p=a.getMatchingVisibleMetas("line");for(let g=0;g<p.length;g++){const b=p[g];if(b.index===r)break;b.hidden||c.unshift(b.dataset)}return c}function ik(a,r,c){const p=[];for(let g=0;g<c.length;g++){const b=c[g],{first:E,last:i,point:R}=nk(b,r,"x");if(!(!R||E&&i)){if(E)p.unshift(R);else if(a.push(R),!i)break}}a.push(...p)}function nk(a,r,c){const p=a.interpolate(r,c);if(!p)return{};const g=p[c],b=a.segments,E=a.points;let i=!1,R=!1;for(let V=0;V<b.length;V++){const j=b[V],W=E[j.start][c],te=E[j.end][c];if(ja(g,W,te)){i=g===W,R=g===te;break}}return{first:i,last:R,point:p}}class sE{constructor(r){this.x=r.x,this.y=r.y,this.radius=r.radius}pathSegment(r,c,p){const{x:g,y:b,radius:E}=this;return c=c||{start:0,end:Kn},r.arc(g,b,E,c.end,c.start,!0),!p.bounds}interpolate(r){const{x:c,y:p,radius:g}=this,b=r.angle;return{x:c+Math.cos(b)*g,y:p+Math.sin(b)*g,angle:b}}}function rk(a){const{chart:r,fill:c,line:p}=a;if(fr(c))return sk(r,c);if(c==="stack")return ek(a);if(c==="shape")return!0;const g=ok(a);return g instanceof sE?g:rE(g,p)}function sk(a,r){const c=a.getDatasetMeta(r);return c&&a.isDatasetVisible(r)?c.dataset:null}function ok(a){return(a.scale||{}).getPointPositionForValue?lk(a):ak(a)}function ak(a){const{scale:r={},fill:c}=a,p=KL(c,r);if(fr(p)){const g=r.isHorizontal();return{x:g?p:null,y:g?null:p}}return null}function lk(a){const{scale:r,fill:c}=a,p=r.options,g=r.getLabels().length,b=p.reverse?r.max:r.min,E=JL(c,r,b),i=[];if(p.grid.circular){const R=r.getPointPositionForValue(0,b);return new sE({x:R.x,y:R.y,radius:r.getDistanceFromCenterForValue(E)})}for(let R=0;R<g;++R)i.push(r.getPointPositionForValue(R,E));return i}function e0(a,r,c){const p=rk(r),{line:g,scale:b,axis:E}=r,i=g.options,R=i.fill,V=i.backgroundColor,{above:j=V,below:W=V}=R||{};p&&g.points.length&&(Pg(a,c),ck(a,{line:g,target:p,above:j,below:W,area:c,scale:b,axis:E}),Dg(a))}function ck(a,r){const{line:c,target:p,above:g,below:b,area:E,scale:i}=r,R=c._loop?"angle":r.axis;a.save(),R==="x"&&b!==g&&(TT(a,p,E.top),ST(a,{line:c,target:p,color:g,scale:i,property:R}),a.restore(),a.save(),TT(a,p,E.bottom)),ST(a,{line:c,target:p,color:b,scale:i,property:R}),a.restore()}function TT(a,r,c){const{segments:p,points:g}=r;let b=!0,E=!1;a.beginPath();for(const i of p){const{start:R,end:V}=i,j=g[R],W=g[pv(R,V,g)];b?(a.moveTo(j.x,j.y),b=!1):(a.lineTo(j.x,c),a.lineTo(j.x,j.y)),E=!!r.pathSegment(a,i,{move:E}),E?a.closePath():a.lineTo(W.x,c)}a.lineTo(r.first().x,c),a.closePath(),a.clip()}function ST(a,r){const{line:c,target:p,property:g,color:b,scale:E}=r,i=$L(c,p,g);for(const{source:R,target:V,start:j,end:W}of i){const{style:{backgroundColor:te=b}={}}=R,ne=p!==!0;a.save(),a.fillStyle=te,uk(a,E,ne&&S0(g,j,W)),a.beginPath();const ge=!!c.pathSegment(a,R);let xe;if(ne){ge?a.closePath():MT(a,p,W,g);const Fe=!!p.pathSegment(a,V,{move:ge,reverse:!0});xe=ge&&Fe,xe||MT(a,p,j,g)}a.closePath(),a.fill(xe?"evenodd":"nonzero"),a.restore()}}function uk(a,r,c){const{top:p,bottom:g}=r.chart.chartArea,{property:b,start:E,end:i}=c||{};b==="x"&&(a.beginPath(),a.rect(E,p,i-E,g-p),a.clip())}function MT(a,r,c,p){const g=r.interpolate(c,p);g&&a.lineTo(g.x,g.y)}var hk={id:"filler",afterDatasetsUpdate(a,r,c){const p=(a.data.datasets||[]).length,g=[];let b,E,i,R;for(E=0;E<p;++E)b=a.getDatasetMeta(E),i=b.dataset,R=null,i&&i.options&&i instanceof ql&&(R={visible:a.isDatasetVisible(E),index:E,fill:XL(i,E,p),chart:a,axis:b.controller.options.indexAxis,scale:b.vScale,line:i}),b.$filler=R,g.push(R);for(E=0;E<p;++E)R=g[E],!(!R||R.fill===!1)&&(R.fill=ZL(g,E,c.propagate))},beforeDraw(a,r,c){const p=c.drawTime==="beforeDraw",g=a.getSortedVisibleDatasetMetas(),b=a.chartArea;for(let E=g.length-1;E>=0;--E){const i=g[E].$filler;i&&(i.line.updateControlPoints(b,i.axis),p&&i.fill&&e0(a.ctx,i,b))}},beforeDatasetsDraw(a,r,c){if(c.drawTime!=="beforeDatasetsDraw")return;const p=a.getSortedVisibleDatasetMetas();for(let g=p.length-1;g>=0;--g){const b=p[g].$filler;wT(b)&&e0(a.ctx,b,a.chartArea)}},beforeDatasetDraw(a,r,c){const p=r.meta.$filler;!wT(p)||c.drawTime!=="beforeDatasetDraw"||e0(a.ctx,p,a.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const ET=(a,r)=>{let{boxHeight:c=r,boxWidth:p=r}=a;return a.usePointStyle&&(c=Math.min(c,r),p=a.pointStyleWidth||Math.min(p,r)),{boxWidth:p,boxHeight:c,itemHeight:Math.max(r,c)}},dk=(a,r)=>a!==null&&r!==null&&a.datasetIndex===r.datasetIndex&&a.index===r.index;class AT extends Za{constructor(r){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,c,p){this.maxWidth=r,this.maxHeight=c,this._margins=p,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const r=this.options.labels||{};let c=Un(r.generateLabels,[this.chart],this)||[];r.filter&&(c=c.filter(p=>r.filter(p,this.chart.data))),r.sort&&(c=c.sort((p,g)=>r.sort(p,g,this.chart.data))),this.options.reverse&&c.reverse(),this.legendItems=c}fit(){const{options:r,ctx:c}=this;if(!r.display){this.width=this.height=0;return}const p=r.labels,g=Cr(p.font),b=g.size,E=this._computeTitleHeight(),{boxWidth:i,itemHeight:R}=ET(p,b);let V,j;c.font=g.string,this.isHorizontal()?(V=this.maxWidth,j=this._fitRows(E,b,i,R)+10):(j=this.maxHeight,V=this._fitCols(E,g,i,R)+10),this.width=Math.min(V,r.maxWidth||this.maxWidth),this.height=Math.min(j,r.maxHeight||this.maxHeight)}_fitRows(r,c,p,g){const{ctx:b,maxWidth:E,options:{labels:{padding:i}}}=this,R=this.legendHitBoxes=[],V=this.lineWidths=[0],j=g+i;let W=r;b.textAlign="left",b.textBaseline="middle";let te=-1,ne=-j;return this.legendItems.forEach((ge,xe)=>{const Fe=p+c/2+b.measureText(ge.text).width;(xe===0||V[V.length-1]+Fe+2*i>E)&&(W+=j,V[V.length-(xe>0?0:1)]=0,ne+=j,te++),R[xe]={left:0,top:ne,row:te,width:Fe,height:g},V[V.length-1]+=Fe+i}),W}_fitCols(r,c,p,g){const{ctx:b,maxHeight:E,options:{labels:{padding:i}}}=this,R=this.legendHitBoxes=[],V=this.columnSizes=[],j=E-r;let W=i,te=0,ne=0,ge=0,xe=0;return this.legendItems.forEach((Fe,Be)=>{const{itemWidth:Ke,itemHeight:at}=fk(p,c,b,Fe,g);Be>0&&ne+at+2*i>j&&(W+=te+i,V.push({width:te,height:ne}),ge+=te+i,xe++,te=ne=0),R[Be]={left:ge,top:ne,col:xe,width:Ke,height:at},te=Math.max(te,Ke),ne+=at+i}),W+=te,V.push({width:te,height:ne}),W}adjustHitBoxes(){if(!this.options.display)return;const r=this._computeTitleHeight(),{legendHitBoxes:c,options:{align:p,labels:{padding:g},rtl:b}}=this,E=$h(b,this.left,this.width);if(this.isHorizontal()){let i=0,R=es(p,this.left+g,this.right-this.lineWidths[i]);for(const V of c)i!==V.row&&(i=V.row,R=es(p,this.left+g,this.right-this.lineWidths[i])),V.top+=this.top+r+g,V.left=E.leftForLtr(E.x(R),V.width),R+=V.width+g}else{let i=0,R=es(p,this.top+r+g,this.bottom-this.columnSizes[i].height);for(const V of c)V.col!==i&&(i=V.col,R=es(p,this.top+r+g,this.bottom-this.columnSizes[i].height)),V.top=R,V.left+=this.left+g,V.left=E.leftForLtr(E.x(V.left),V.width),R+=V.height+g}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const r=this.ctx;Pg(r,this),this._draw(),Dg(r)}}_draw(){const{options:r,columnSizes:c,lineWidths:p,ctx:g}=this,{align:b,labels:E}=r,i=tr.color,R=$h(r.rtl,this.left,this.width),V=Cr(E.font),{padding:j}=E,W=V.size,te=W/2;let ne;this.drawTitle(),g.textAlign=R.textAlign("left"),g.textBaseline="middle",g.lineWidth=.5,g.font=V.string;const{boxWidth:ge,boxHeight:xe,itemHeight:Fe}=ET(E,W),Be=function(Lt,rt,Ut){if(isNaN(ge)||ge<=0||isNaN(xe)||xe<0)return;g.save();const si=Wi(Ut.lineWidth,1);if(g.fillStyle=Wi(Ut.fillStyle,i),g.lineCap=Wi(Ut.lineCap,"butt"),g.lineDashOffset=Wi(Ut.lineDashOffset,0),g.lineJoin=Wi(Ut.lineJoin,"miter"),g.lineWidth=si,g.strokeStyle=Wi(Ut.strokeStyle,i),g.setLineDash(Wi(Ut.lineDash,[])),E.usePointStyle){const It={radius:xe*Math.SQRT2/2,pointStyle:Ut.pointStyle,rotation:Ut.rotation,borderWidth:si},Pt=R.xPlus(Lt,ge/2),Ii=rt+te;AM(g,It,Pt,Ii,E.pointStyleWidth&&ge)}else{const It=rt+Math.max((W-xe)/2,0),Pt=R.leftForLtr(Lt,ge),Ii=iu(Ut.borderRadius);g.beginPath(),Object.values(Ii).some(tn=>tn!==0)?wp(g,{x:Pt,y:It,w:ge,h:xe,radius:Ii}):g.rect(Pt,It,ge,xe),g.fill(),si!==0&&g.stroke()}g.restore()},Ke=function(Lt,rt,Ut){ou(g,Ut.text,Lt,rt+Fe/2,V,{strikethrough:Ut.hidden,textAlign:R.textAlign(Ut.textAlign)})},at=this.isHorizontal(),Ye=this._computeTitleHeight();at?ne={x:es(b,this.left+j,this.right-p[0]),y:this.top+j+Ye,line:0}:ne={x:this.left+j,y:es(b,this.top+Ye+j,this.bottom-c[0].height),line:0},kM(this.ctx,r.textDirection);const ct=Fe+j;this.legendItems.forEach((Lt,rt)=>{g.strokeStyle=Lt.fontColor,g.fillStyle=Lt.fontColor;const Ut=g.measureText(Lt.text).width,si=R.textAlign(Lt.textAlign||(Lt.textAlign=E.textAlign)),It=ge+te+Ut;let Pt=ne.x,Ii=ne.y;R.setWidth(this.width),at?rt>0&&Pt+It+j>this.right&&(Ii=ne.y+=ct,ne.line++,Pt=ne.x=es(b,this.left+j,this.right-p[ne.line])):rt>0&&Ii+ct>this.bottom&&(Pt=ne.x=Pt+c[ne.line].width+j,ne.line++,Ii=ne.y=es(b,this.top+Ye+j,this.bottom-c[ne.line].height));const tn=R.x(Pt);if(Be(tn,Ii,Lt),Pt=Rz(si,Pt+ge+te,at?Pt+It:this.right,r.rtl),Ke(R.x(Pt),Ii,Lt),at)ne.x+=It+j;else if(typeof Lt.text!="string"){const Fn=V.lineHeight;ne.y+=oE(Lt,Fn)+j}else ne.y+=ct}),OM(this.ctx,r.textDirection)}drawTitle(){const r=this.options,c=r.title,p=Cr(c.font),g=os(c.padding);if(!c.display)return;const b=$h(r.rtl,this.left,this.width),E=this.ctx,i=c.position,R=p.size/2,V=g.top+R;let j,W=this.left,te=this.width;if(this.isHorizontal())te=Math.max(...this.lineWidths),j=this.top+V,W=es(r.align,W,this.right-te);else{const ge=this.columnSizes.reduce((xe,Fe)=>Math.max(xe,Fe.height),0);j=V+es(r.align,this.top,this.bottom-ge-r.labels.padding-this._computeTitleHeight())}const ne=es(i,W,W+te);E.textAlign=b.textAlign(sv(i)),E.textBaseline="middle",E.strokeStyle=c.color,E.fillStyle=c.color,E.font=p.string,ou(E,c.text,ne,j,p)}_computeTitleHeight(){const r=this.options.title,c=Cr(r.font),p=os(r.padding);return r.display?c.lineHeight+p.height:0}_getLegendItemAt(r,c){let p,g,b;if(ja(r,this.left,this.right)&&ja(c,this.top,this.bottom)){for(b=this.legendHitBoxes,p=0;p<b.length;++p)if(g=b[p],ja(r,g.left,g.left+g.width)&&ja(c,g.top,g.top+g.height))return this.legendItems[p]}return null}handleEvent(r){const c=this.options;if(!_k(r.type,c))return;const p=this._getLegendItemAt(r.x,r.y);if(r.type==="mousemove"||r.type==="mouseout"){const g=this._hoveredItem,b=dk(g,p);g&&!b&&Un(c.onLeave,[r,g,this],this),this._hoveredItem=p,p&&!b&&Un(c.onHover,[r,p,this],this)}else p&&Un(c.onClick,[r,p,this],this)}}function fk(a,r,c,p,g){const b=pk(p,a,r,c),E=mk(g,p,r.lineHeight);return{itemWidth:b,itemHeight:E}}function pk(a,r,c,p){let g=a.text;return g&&typeof g!="string"&&(g=g.reduce((b,E)=>b.length>E.length?b:E)),r+c.size/2+p.measureText(g).width}function mk(a,r,c){let p=a;return typeof r.text!="string"&&(p=oE(r,c)),p}function oE(a,r){const c=a.text?a.text.length:0;return r*c}function _k(a,r){return!!((a==="mousemove"||a==="mouseout")&&(r.onHover||r.onLeave)||r.onClick&&(a==="click"||a==="mouseup"))}var gk={id:"legend",_element:AT,start(a,r,c){const p=a.legend=new AT({ctx:a.ctx,options:c,chart:a});ns.configure(a,p,c),ns.addBox(a,p)},stop(a){ns.removeBox(a,a.legend),delete a.legend},beforeUpdate(a,r,c){const p=a.legend;ns.configure(a,p,c),p.options=c},afterUpdate(a){const r=a.legend;r.buildLabels(),r.adjustHitBoxes()},afterEvent(a,r){r.replay||a.legend.handleEvent(r.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(a,r,c){const p=r.datasetIndex,g=c.chart;g.isDatasetVisible(p)?(g.hide(p),r.hidden=!0):(g.show(p),r.hidden=!1)},onHover:null,onLeave:null,labels:{color:a=>a.chart.options.color,boxWidth:40,padding:10,generateLabels(a){const r=a.data.datasets,{labels:{usePointStyle:c,pointStyle:p,textAlign:g,color:b,useBorderRadius:E,borderRadius:i}}=a.legend.options;return a._getSortedDatasetMetas().map(R=>{const V=R.controller.getStyle(c?0:void 0),j=os(V.borderWidth);return{text:r[R.index].label,fillStyle:V.backgroundColor,fontColor:b,hidden:!R.visible,lineCap:V.borderCapStyle,lineDash:V.borderDash,lineDashOffset:V.borderDashOffset,lineJoin:V.borderJoinStyle,lineWidth:(j.width+j.height)/4,strokeStyle:V.borderColor,pointStyle:p||V.pointStyle,rotation:V.rotation,textAlign:g||V.textAlign,borderRadius:E&&(i||V.borderRadius),datasetIndex:R.index}},this)}},title:{color:a=>a.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:a=>!a.startsWith("on"),labels:{_scriptable:a=>!["generateLabels","filter","sort"].includes(a)}}};class mv extends Za{constructor(r){super(),this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,c){const p=this.options;if(this.left=0,this.top=0,!p.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=r,this.height=this.bottom=c;const g=er(p.text)?p.text.length:1;this._padding=os(p.padding);const b=g*Cr(p.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=b:this.width=b}isHorizontal(){const r=this.options.position;return r==="top"||r==="bottom"}_drawArgs(r){const{top:c,left:p,bottom:g,right:b,options:E}=this,i=E.align;let R=0,V,j,W;return this.isHorizontal()?(j=es(i,p,b),W=c+r,V=b-p):(E.position==="left"?(j=p+r,W=es(i,g,c),R=Jn*-.5):(j=b-r,W=es(i,c,g),R=Jn*.5),V=g-c),{titleX:j,titleY:W,maxWidth:V,rotation:R}}draw(){const r=this.ctx,c=this.options;if(!c.display)return;const p=Cr(c.font),b=p.lineHeight/2+this._padding.top,{titleX:E,titleY:i,maxWidth:R,rotation:V}=this._drawArgs(b);ou(r,c.text,0,0,p,{color:c.color,maxWidth:R,rotation:V,textAlign:sv(c.align),textBaseline:"middle",translation:[E,i]})}}function yk(a,r){const c=new mv({ctx:a.ctx,options:r,chart:a});ns.configure(a,c,r),ns.addBox(a,c),a.titleBlock=c}var xk={id:"title",_element:mv,start(a,r,c){yk(a,c)},stop(a){const r=a.titleBlock;ns.removeBox(a,r),delete a.titleBlock},beforeUpdate(a,r,c){const p=a.titleBlock;ns.configure(a,p,c),p.options=c},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const V_=new WeakMap;var vk={id:"subtitle",start(a,r,c){const p=new mv({ctx:a.ctx,options:c,chart:a});ns.configure(a,p,c),ns.addBox(a,p),V_.set(a,p)},stop(a){ns.removeBox(a,V_.get(a)),V_.delete(a)},beforeUpdate(a,r,c){const p=V_.get(a);ns.configure(a,p,c),p.options=c},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Yf={average(a){if(!a.length)return!1;let r,c,p=new Set,g=0,b=0;for(r=0,c=a.length;r<c;++r){const i=a[r].element;if(i&&i.hasValue()){const R=i.tooltipPosition();p.add(R.x),g+=R.y,++b}}return b===0||p.size===0?!1:{x:[...p].reduce((i,R)=>i+R)/p.size,y:g/b}},nearest(a,r){if(!a.length)return!1;let c=r.x,p=r.y,g=Number.POSITIVE_INFINITY,b,E,i;for(b=0,E=a.length;b<E;++b){const R=a[b].element;if(R&&R.hasValue()){const V=R.getCenterPoint(),j=_0(r,V);j<g&&(g=j,i=R)}}if(i){const R=i.tooltipPosition();c=R.x,p=R.y}return{x:c,y:p}}};function ta(a,r){return r&&(er(r)?Array.prototype.push.apply(a,r):a.push(r)),a}function Fa(a){return(typeof a=="string"||a instanceof String)&&a.indexOf(`
`)>-1?a.split(`
`):a}function bk(a,r){const{element:c,datasetIndex:p,index:g}=r,b=a.getDatasetMeta(p).controller,{label:E,value:i}=b.getLabelAndValue(g);return{chart:a,label:E,parsed:b.getParsed(g),raw:a.data.datasets[p].data[g],formattedValue:i,dataset:b.getDataset(),dataIndex:g,datasetIndex:p,element:c}}function IT(a,r){const c=a.chart.ctx,{body:p,footer:g,title:b}=a,{boxWidth:E,boxHeight:i}=r,R=Cr(r.bodyFont),V=Cr(r.titleFont),j=Cr(r.footerFont),W=b.length,te=g.length,ne=p.length,ge=os(r.padding);let xe=ge.height,Fe=0,Be=p.reduce((Ye,ct)=>Ye+ct.before.length+ct.lines.length+ct.after.length,0);if(Be+=a.beforeBody.length+a.afterBody.length,W&&(xe+=W*V.lineHeight+(W-1)*r.titleSpacing+r.titleMarginBottom),Be){const Ye=r.displayColors?Math.max(i,R.lineHeight):R.lineHeight;xe+=ne*Ye+(Be-ne)*R.lineHeight+(Be-1)*r.bodySpacing}te&&(xe+=r.footerMarginTop+te*j.lineHeight+(te-1)*r.footerSpacing);let Ke=0;const at=function(Ye){Fe=Math.max(Fe,c.measureText(Ye).width+Ke)};return c.save(),c.font=V.string,Ln(a.title,at),c.font=R.string,Ln(a.beforeBody.concat(a.afterBody),at),Ke=r.displayColors?E+2+r.boxPadding:0,Ln(p,Ye=>{Ln(Ye.before,at),Ln(Ye.lines,at),Ln(Ye.after,at)}),Ke=0,c.font=j.string,Ln(a.footer,at),c.restore(),Fe+=ge.width,{width:Fe,height:xe}}function wk(a,r){const{y:c,height:p}=r;return c<p/2?"top":c>a.height-p/2?"bottom":"center"}function Tk(a,r,c,p){const{x:g,width:b}=p,E=c.caretSize+c.caretPadding;if(a==="left"&&g+b+E>r.width||a==="right"&&g-b-E<0)return!0}function Sk(a,r,c,p){const{x:g,width:b}=c,{width:E,chartArea:{left:i,right:R}}=a;let V="center";return p==="center"?V=g<=(i+R)/2?"left":"right":g<=b/2?V="left":g>=E-b/2&&(V="right"),Tk(V,a,r,c)&&(V="center"),V}function CT(a,r,c){const p=c.yAlign||r.yAlign||wk(a,c);return{xAlign:c.xAlign||r.xAlign||Sk(a,r,c,p),yAlign:p}}function Mk(a,r){let{x:c,width:p}=a;return r==="right"?c-=p:r==="center"&&(c-=p/2),c}function Ek(a,r,c){let{y:p,height:g}=a;return r==="top"?p+=c:r==="bottom"?p-=g+c:p-=g/2,p}function PT(a,r,c,p){const{caretSize:g,caretPadding:b,cornerRadius:E}=a,{xAlign:i,yAlign:R}=c,V=g+b,{topLeft:j,topRight:W,bottomLeft:te,bottomRight:ne}=iu(E);let ge=Mk(r,i);const xe=Ek(r,R,V);return R==="center"?i==="left"?ge+=V:i==="right"&&(ge-=V):i==="left"?ge-=Math.max(j,te)+g:i==="right"&&(ge+=Math.max(W,ne)+g),{x:Lr(ge,0,p.width-r.width),y:Lr(xe,0,p.height-r.height)}}function U_(a,r,c){const p=os(c.padding);return r==="center"?a.x+a.width/2:r==="right"?a.x+a.width-p.right:a.x+p.left}function DT(a){return ta([],Fa(a))}function Ak(a,r,c){return Ql(a,{tooltip:r,tooltipItems:c,type:"tooltip"})}function zT(a,r){const c=r&&r.dataset&&r.dataset.tooltip&&r.dataset.tooltip.callbacks;return c?a.override(c):a}const aE={beforeTitle:La,title(a){if(a.length>0){const r=a[0],c=r.chart.data.labels,p=c?c.length:0;if(this&&this.options&&this.options.mode==="dataset")return r.dataset.label||"";if(r.label)return r.label;if(p>0&&r.dataIndex<p)return c[r.dataIndex]}return""},afterTitle:La,beforeBody:La,beforeLabel:La,label(a){if(this&&this.options&&this.options.mode==="dataset")return a.label+": "+a.formattedValue||a.formattedValue;let r=a.dataset.label||"";r&&(r+=": ");const c=a.formattedValue;return bn(c)||(r+=c),r},labelColor(a){const c=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{borderColor:c.borderColor,backgroundColor:c.backgroundColor,borderWidth:c.borderWidth,borderDash:c.borderDash,borderDashOffset:c.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(a){const c=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{pointStyle:c.pointStyle,rotation:c.rotation}},afterLabel:La,afterBody:La,beforeFooter:La,footer:La,afterFooter:La};function Ms(a,r,c,p){const g=a[r].call(c,p);return typeof g>"u"?aE[r].call(c,p):g}class M0 extends Za{constructor(r){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=r.chart,this.options=r.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(r){this.options=r,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const r=this._cachedAnimations;if(r)return r;const c=this.chart,p=this.options.setContext(this.getContext()),g=p.enabled&&c.options.animation&&p.animations,b=new VM(this.chart,g);return g._cacheable&&(this._cachedAnimations=Object.freeze(b)),b}getContext(){return this.$context||(this.$context=Ak(this.chart.getContext(),this,this._tooltipItems))}getTitle(r,c){const{callbacks:p}=c,g=Ms(p,"beforeTitle",this,r),b=Ms(p,"title",this,r),E=Ms(p,"afterTitle",this,r);let i=[];return i=ta(i,Fa(g)),i=ta(i,Fa(b)),i=ta(i,Fa(E)),i}getBeforeBody(r,c){return DT(Ms(c.callbacks,"beforeBody",this,r))}getBody(r,c){const{callbacks:p}=c,g=[];return Ln(r,b=>{const E={before:[],lines:[],after:[]},i=zT(p,b);ta(E.before,Fa(Ms(i,"beforeLabel",this,b))),ta(E.lines,Ms(i,"label",this,b)),ta(E.after,Fa(Ms(i,"afterLabel",this,b))),g.push(E)}),g}getAfterBody(r,c){return DT(Ms(c.callbacks,"afterBody",this,r))}getFooter(r,c){const{callbacks:p}=c,g=Ms(p,"beforeFooter",this,r),b=Ms(p,"footer",this,r),E=Ms(p,"afterFooter",this,r);let i=[];return i=ta(i,Fa(g)),i=ta(i,Fa(b)),i=ta(i,Fa(E)),i}_createItems(r){const c=this._active,p=this.chart.data,g=[],b=[],E=[];let i=[],R,V;for(R=0,V=c.length;R<V;++R)i.push(bk(this.chart,c[R]));return r.filter&&(i=i.filter((j,W,te)=>r.filter(j,W,te,p))),r.itemSort&&(i=i.sort((j,W)=>r.itemSort(j,W,p))),Ln(i,j=>{const W=zT(r.callbacks,j);g.push(Ms(W,"labelColor",this,j)),b.push(Ms(W,"labelPointStyle",this,j)),E.push(Ms(W,"labelTextColor",this,j))}),this.labelColors=g,this.labelPointStyles=b,this.labelTextColors=E,this.dataPoints=i,i}update(r,c){const p=this.options.setContext(this.getContext()),g=this._active;let b,E=[];if(!g.length)this.opacity!==0&&(b={opacity:0});else{const i=Yf[p.position].call(this,g,this._eventPosition);E=this._createItems(p),this.title=this.getTitle(E,p),this.beforeBody=this.getBeforeBody(E,p),this.body=this.getBody(E,p),this.afterBody=this.getAfterBody(E,p),this.footer=this.getFooter(E,p);const R=this._size=IT(this,p),V=Object.assign({},i,R),j=CT(this.chart,p,V),W=PT(p,V,j,this.chart);this.xAlign=j.xAlign,this.yAlign=j.yAlign,b={opacity:1,x:W.x,y:W.y,width:R.width,height:R.height,caretX:i.x,caretY:i.y}}this._tooltipItems=E,this.$context=void 0,b&&this._resolveAnimations().update(this,b),r&&p.external&&p.external.call(this,{chart:this.chart,tooltip:this,replay:c})}drawCaret(r,c,p,g){const b=this.getCaretPosition(r,p,g);c.lineTo(b.x1,b.y1),c.lineTo(b.x2,b.y2),c.lineTo(b.x3,b.y3)}getCaretPosition(r,c,p){const{xAlign:g,yAlign:b}=this,{caretSize:E,cornerRadius:i}=p,{topLeft:R,topRight:V,bottomLeft:j,bottomRight:W}=iu(i),{x:te,y:ne}=r,{width:ge,height:xe}=c;let Fe,Be,Ke,at,Ye,ct;return b==="center"?(Ye=ne+xe/2,g==="left"?(Fe=te,Be=Fe-E,at=Ye+E,ct=Ye-E):(Fe=te+ge,Be=Fe+E,at=Ye-E,ct=Ye+E),Ke=Fe):(g==="left"?Be=te+Math.max(R,j)+E:g==="right"?Be=te+ge-Math.max(V,W)-E:Be=this.caretX,b==="top"?(at=ne,Ye=at-E,Fe=Be-E,Ke=Be+E):(at=ne+xe,Ye=at+E,Fe=Be+E,Ke=Be-E),ct=at),{x1:Fe,x2:Be,x3:Ke,y1:at,y2:Ye,y3:ct}}drawTitle(r,c,p){const g=this.title,b=g.length;let E,i,R;if(b){const V=$h(p.rtl,this.x,this.width);for(r.x=U_(this,p.titleAlign,p),c.textAlign=V.textAlign(p.titleAlign),c.textBaseline="middle",E=Cr(p.titleFont),i=p.titleSpacing,c.fillStyle=p.titleColor,c.font=E.string,R=0;R<b;++R)c.fillText(g[R],V.x(r.x),r.y+E.lineHeight/2),r.y+=E.lineHeight+i,R+1===b&&(r.y+=p.titleMarginBottom-i)}}_drawColorBox(r,c,p,g,b){const E=this.labelColors[p],i=this.labelPointStyles[p],{boxHeight:R,boxWidth:V}=b,j=Cr(b.bodyFont),W=U_(this,"left",b),te=g.x(W),ne=R<j.lineHeight?(j.lineHeight-R)/2:0,ge=c.y+ne;if(b.usePointStyle){const xe={radius:Math.min(V,R)/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:1},Fe=g.leftForLtr(te,V)+V/2,Be=ge+R/2;r.strokeStyle=b.multiKeyBackground,r.fillStyle=b.multiKeyBackground,y0(r,xe,Fe,Be),r.strokeStyle=E.borderColor,r.fillStyle=E.backgroundColor,y0(r,xe,Fe,Be)}else{r.lineWidth=pn(E.borderWidth)?Math.max(...Object.values(E.borderWidth)):E.borderWidth||1,r.strokeStyle=E.borderColor,r.setLineDash(E.borderDash||[]),r.lineDashOffset=E.borderDashOffset||0;const xe=g.leftForLtr(te,V),Fe=g.leftForLtr(g.xPlus(te,1),V-2),Be=iu(E.borderRadius);Object.values(Be).some(Ke=>Ke!==0)?(r.beginPath(),r.fillStyle=b.multiKeyBackground,wp(r,{x:xe,y:ge,w:V,h:R,radius:Be}),r.fill(),r.stroke(),r.fillStyle=E.backgroundColor,r.beginPath(),wp(r,{x:Fe,y:ge+1,w:V-2,h:R-2,radius:Be}),r.fill()):(r.fillStyle=b.multiKeyBackground,r.fillRect(xe,ge,V,R),r.strokeRect(xe,ge,V,R),r.fillStyle=E.backgroundColor,r.fillRect(Fe,ge+1,V-2,R-2))}r.fillStyle=this.labelTextColors[p]}drawBody(r,c,p){const{body:g}=this,{bodySpacing:b,bodyAlign:E,displayColors:i,boxHeight:R,boxWidth:V,boxPadding:j}=p,W=Cr(p.bodyFont);let te=W.lineHeight,ne=0;const ge=$h(p.rtl,this.x,this.width),xe=function(Ut){c.fillText(Ut,ge.x(r.x+ne),r.y+te/2),r.y+=te+b},Fe=ge.textAlign(E);let Be,Ke,at,Ye,ct,Lt,rt;for(c.textAlign=E,c.textBaseline="middle",c.font=W.string,r.x=U_(this,Fe,p),c.fillStyle=p.bodyColor,Ln(this.beforeBody,xe),ne=i&&Fe!=="right"?E==="center"?V/2+j:V+2+j:0,Ye=0,Lt=g.length;Ye<Lt;++Ye){for(Be=g[Ye],Ke=this.labelTextColors[Ye],c.fillStyle=Ke,Ln(Be.before,xe),at=Be.lines,i&&at.length&&(this._drawColorBox(c,r,Ye,ge,p),te=Math.max(W.lineHeight,R)),ct=0,rt=at.length;ct<rt;++ct)xe(at[ct]),te=W.lineHeight;Ln(Be.after,xe)}ne=0,te=W.lineHeight,Ln(this.afterBody,xe),r.y-=b}drawFooter(r,c,p){const g=this.footer,b=g.length;let E,i;if(b){const R=$h(p.rtl,this.x,this.width);for(r.x=U_(this,p.footerAlign,p),r.y+=p.footerMarginTop,c.textAlign=R.textAlign(p.footerAlign),c.textBaseline="middle",E=Cr(p.footerFont),c.fillStyle=p.footerColor,c.font=E.string,i=0;i<b;++i)c.fillText(g[i],R.x(r.x),r.y+E.lineHeight/2),r.y+=E.lineHeight+p.footerSpacing}}drawBackground(r,c,p,g){const{xAlign:b,yAlign:E}=this,{x:i,y:R}=r,{width:V,height:j}=p,{topLeft:W,topRight:te,bottomLeft:ne,bottomRight:ge}=iu(g.cornerRadius);c.fillStyle=g.backgroundColor,c.strokeStyle=g.borderColor,c.lineWidth=g.borderWidth,c.beginPath(),c.moveTo(i+W,R),E==="top"&&this.drawCaret(r,c,p,g),c.lineTo(i+V-te,R),c.quadraticCurveTo(i+V,R,i+V,R+te),E==="center"&&b==="right"&&this.drawCaret(r,c,p,g),c.lineTo(i+V,R+j-ge),c.quadraticCurveTo(i+V,R+j,i+V-ge,R+j),E==="bottom"&&this.drawCaret(r,c,p,g),c.lineTo(i+ne,R+j),c.quadraticCurveTo(i,R+j,i,R+j-ne),E==="center"&&b==="left"&&this.drawCaret(r,c,p,g),c.lineTo(i,R+W),c.quadraticCurveTo(i,R,i+W,R),c.closePath(),c.fill(),g.borderWidth>0&&c.stroke()}_updateAnimationTarget(r){const c=this.chart,p=this.$animations,g=p&&p.x,b=p&&p.y;if(g||b){const E=Yf[r.position].call(this,this._active,this._eventPosition);if(!E)return;const i=this._size=IT(this,r),R=Object.assign({},E,this._size),V=CT(c,r,R),j=PT(r,R,V,c);(g._to!==j.x||b._to!==j.y)&&(this.xAlign=V.xAlign,this.yAlign=V.yAlign,this.width=i.width,this.height=i.height,this.caretX=E.x,this.caretY=E.y,this._resolveAnimations().update(this,j))}}_willRender(){return!!this.opacity}draw(r){const c=this.options.setContext(this.getContext());let p=this.opacity;if(!p)return;this._updateAnimationTarget(c);const g={width:this.width,height:this.height},b={x:this.x,y:this.y};p=Math.abs(p)<.001?0:p;const E=os(c.padding),i=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;c.enabled&&i&&(r.save(),r.globalAlpha=p,this.drawBackground(b,r,g,c),kM(r,c.textDirection),b.y+=E.top,this.drawTitle(b,r,c),this.drawBody(b,r,c),this.drawFooter(b,r,c),OM(r,c.textDirection),r.restore())}getActiveElements(){return this._active||[]}setActiveElements(r,c){const p=this._active,g=r.map(({datasetIndex:i,index:R})=>{const V=this.chart.getDatasetMeta(i);if(!V)throw new Error("Cannot find a dataset at index "+i);return{datasetIndex:i,element:V.data[R],index:R}}),b=!ug(p,g),E=this._positionChanged(g,c);(b||E)&&(this._active=g,this._eventPosition=c,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(r,c,p=!0){if(c&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const g=this.options,b=this._active||[],E=this._getActiveElements(r,b,c,p),i=this._positionChanged(E,r),R=c||!ug(E,b)||i;return R&&(this._active=E,(g.enabled||g.external)&&(this._eventPosition={x:r.x,y:r.y},this.update(!0,c))),R}_getActiveElements(r,c,p,g){const b=this.options;if(r.type==="mouseout")return[];if(!g)return c.filter(i=>this.chart.data.datasets[i.datasetIndex]&&this.chart.getDatasetMeta(i.datasetIndex).controller.getParsed(i.index)!==void 0);const E=this.chart.getElementsAtEventForMode(r,b.mode,b,p);return b.reverse&&E.reverse(),E}_positionChanged(r,c){const{caretX:p,caretY:g,options:b}=this,E=Yf[b.position].call(this,r,c);return E!==!1&&(p!==E.x||g!==E.y)}}Yt(M0,"positioners",Yf);var Ik={id:"tooltip",_element:M0,positioners:Yf,afterInit(a,r,c){c&&(a.tooltip=new M0({chart:a,options:c}))},beforeUpdate(a,r,c){a.tooltip&&a.tooltip.initialize(c)},reset(a,r,c){a.tooltip&&a.tooltip.initialize(c)},afterDraw(a){const r=a.tooltip;if(r&&r._willRender()){const c={tooltip:r};if(a.notifyPlugins("beforeTooltipDraw",{...c,cancelable:!0})===!1)return;r.draw(a.ctx),a.notifyPlugins("afterTooltipDraw",c)}},afterEvent(a,r){if(a.tooltip){const c=r.replay;a.tooltip.handleEvent(r.event,c,r.inChartArea)&&(r.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(a,r)=>r.bodyFont.size,boxWidth:(a,r)=>r.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:aE},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:a=>a!=="filter"&&a!=="itemSort"&&a!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Ck=Object.freeze({__proto__:null,Colors:UL,Decimation:qL,Filler:hk,Legend:gk,SubTitle:vk,Title:xk,Tooltip:Ik});const Pk=(a,r,c,p)=>(typeof r=="string"?(c=a.push(r)-1,p.unshift({index:c,label:r})):isNaN(r)&&(c=null),c);function Dk(a,r,c,p){const g=a.indexOf(r);if(g===-1)return Pk(a,r,c,p);const b=a.lastIndexOf(r);return g!==b?c:g}const zk=(a,r)=>a===null?null:Lr(Math.round(a),0,r);function RT(a){const r=this.getLabels();return a>=0&&a<r.length?r[a]:a}class E0 extends cu{constructor(r){super(r),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(r){const c=this._addedLabels;if(c.length){const p=this.getLabels();for(const{index:g,label:b}of c)p[g]===b&&p.splice(g,1);this._addedLabels=[]}super.init(r)}parse(r,c){if(bn(r))return null;const p=this.getLabels();return c=isFinite(c)&&p[c]===r?c:Dk(p,r,Wi(c,r),this._addedLabels),zk(c,p.length-1)}determineDataLimits(){const{minDefined:r,maxDefined:c}=this.getUserBounds();let{min:p,max:g}=this.getMinMax(!0);this.options.bounds==="ticks"&&(r||(p=0),c||(g=this.getLabels().length-1)),this.min=p,this.max=g}buildTicks(){const r=this.min,c=this.max,p=this.options.offset,g=[];let b=this.getLabels();b=r===0&&c===b.length-1?b:b.slice(r,c+1),this._valueRange=Math.max(b.length-(p?0:1),1),this._startValue=this.min-(p?.5:0);for(let E=r;E<=c;E++)g.push({value:E});return g}getLabelForValue(r){return RT.call(this,r)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(r){return typeof r!="number"&&(r=this.parse(r)),r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getPixelForTick(r){const c=this.ticks;return r<0||r>c.length-1?null:this.getPixelForValue(c[r].value)}getValueForPixel(r){return Math.round(this._startValue+this.getDecimalForPixel(r)*this._valueRange)}getBasePixel(){return this.bottom}}Yt(E0,"id","category"),Yt(E0,"defaults",{ticks:{callback:RT}});function Rk(a,r){const c=[],{bounds:g,step:b,min:E,max:i,precision:R,count:V,maxTicks:j,maxDigits:W,includeBounds:te}=a,ne=b||1,ge=j-1,{min:xe,max:Fe}=r,Be=!bn(E),Ke=!bn(i),at=!bn(V),Ye=(Fe-xe)/(W+1);let ct=I2((Fe-xe)/ge/ne)*ne,Lt,rt,Ut,si;if(ct<1e-14&&!Be&&!Ke)return[{value:xe},{value:Fe}];si=Math.ceil(Fe/ct)-Math.floor(xe/ct),si>ge&&(ct=I2(si*ct/ge/ne)*ne),bn(R)||(Lt=Math.pow(10,R),ct=Math.ceil(ct*Lt)/Lt),g==="ticks"?(rt=Math.floor(xe/ct)*ct,Ut=Math.ceil(Fe/ct)*ct):(rt=xe,Ut=Fe),Be&&Ke&&b&&Ez((i-E)/b,ct/1e3)?(si=Math.round(Math.min((i-E)/ct,j)),ct=(i-E)/si,rt=E,Ut=i):at?(rt=Be?E:rt,Ut=Ke?i:Ut,si=V-1,ct=(Ut-rt)/si):(si=(Ut-rt)/ct,op(si,Math.round(si),ct/1e3)?si=Math.round(si):si=Math.ceil(si));const It=Math.max(C2(ct),C2(rt));Lt=Math.pow(10,bn(R)?It:R),rt=Math.round(rt*Lt)/Lt,Ut=Math.round(Ut*Lt)/Lt;let Pt=0;for(Be&&(te&&rt!==E?(c.push({value:E}),rt<E&&Pt++,op(Math.round((rt+Pt*ct)*Lt)/Lt,E,LT(E,Ye,a))&&Pt++):rt<E&&Pt++);Pt<si;++Pt){const Ii=Math.round((rt+Pt*ct)*Lt)/Lt;if(Ke&&Ii>i)break;c.push({value:Ii})}return Ke&&te&&Ut!==i?c.length&&op(c[c.length-1].value,i,LT(i,Ye,a))?c[c.length-1].value=i:c.push({value:i}):(!Ke||Ut===i)&&c.push({value:Ut}),c}function LT(a,r,{horizontal:c,minRotation:p}){const g=Io(p),b=(c?Math.sin(g):Math.cos(g))||.001,E=.75*r*(""+a).length;return Math.min(r/b,E)}class gg extends cu{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(r,c){return bn(r)||(typeof r=="number"||r instanceof Number)&&!isFinite(+r)?null:+r}handleTickRangeOptions(){const{beginAtZero:r}=this.options,{minDefined:c,maxDefined:p}=this.getUserBounds();let{min:g,max:b}=this;const E=R=>g=c?g:R,i=R=>b=p?b:R;if(r){const R=oa(g),V=oa(b);R<0&&V<0?i(0):R>0&&V>0&&E(0)}if(g===b){let R=b===0?1:Math.abs(b*.05);i(b+R),r||E(g-R)}this.min=g,this.max=b}getTickLimit(){const r=this.options.ticks;let{maxTicksLimit:c,stepSize:p}=r,g;return p?(g=Math.ceil(this.max/p)-Math.floor(this.min/p)+1,g>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${p} would result generating up to ${g} ticks. Limiting to 1000.`),g=1e3)):(g=this.computeTickLimit(),c=c||11),c&&(g=Math.min(c,g)),g}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const r=this.options,c=r.ticks;let p=this.getTickLimit();p=Math.max(2,p);const g={maxTicks:p,bounds:r.bounds,min:r.min,max:r.max,precision:c.precision,step:c.stepSize,count:c.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:c.minRotation||0,includeBounds:c.includeBounds!==!1},b=this._range||this,E=Rk(g,b);return r.bounds==="ticks"&&yM(E,this,"value"),r.reverse?(E.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),E}configure(){const r=this.ticks;let c=this.min,p=this.max;if(super.configure(),this.options.offset&&r.length){const g=(p-c)/Math.max(r.length-1,1)/2;c-=g,p+=g}this._startValue=c,this._endValue=p,this._valueRange=p-c}getLabelForValue(r){return Dp(r,this.chart.options.locale,this.options.ticks.format)}}class A0 extends gg{determineDataLimits(){const{min:r,max:c}=this.getMinMax(!0);this.min=fr(r)?r:0,this.max=fr(c)?c:1,this.handleTickRangeOptions()}computeTickLimit(){const r=this.isHorizontal(),c=r?this.width:this.height,p=Io(this.options.ticks.minRotation),g=(r?Math.sin(p):Math.cos(p))||.001,b=this._resolveTickFontOptions(0);return Math.ceil(c/Math.min(40,b.lineHeight/g))}getPixelForValue(r){return r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getValueForPixel(r){return this._startValue+this.getDecimalForPixel(r)*this._valueRange}}Yt(A0,"id","linear"),Yt(A0,"defaults",{ticks:{callback:Cg.formatters.numeric}});const Sp=a=>Math.floor(Hl(a)),Yc=(a,r)=>Math.pow(10,Sp(a)+r);function kT(a){return a/Math.pow(10,Sp(a))===1}function OT(a,r,c){const p=Math.pow(10,c),g=Math.floor(a/p);return Math.ceil(r/p)-g}function Lk(a,r){const c=r-a;let p=Sp(c);for(;OT(a,r,p)>10;)p++;for(;OT(a,r,p)<10;)p--;return Math.min(p,Sp(a))}function kk(a,{min:r,max:c}){r=Us(a.min,r);const p=[],g=Sp(r);let b=Lk(r,c),E=b<0?Math.pow(10,Math.abs(b)):1;const i=Math.pow(10,b),R=g>b?Math.pow(10,g):0,V=Math.round((r-R)*E)/E,j=Math.floor((r-R)/i/10)*i*10;let W=Math.floor((V-j)/Math.pow(10,b)),te=Us(a.min,Math.round((R+j+W*Math.pow(10,b))*E)/E);for(;te<c;)p.push({value:te,major:kT(te),significand:W}),W>=10?W=W<15?15:20:W++,W>=20&&(b++,W=2,E=b>=0?1:E),te=Math.round((R+j+W*Math.pow(10,b))*E)/E;const ne=Us(a.max,te);return p.push({value:ne,major:kT(ne),significand:W}),p}class I0 extends cu{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(r,c){const p=gg.prototype.parse.apply(this,[r,c]);if(p===0){this._zero=!0;return}return fr(p)&&p>0?p:null}determineDataLimits(){const{min:r,max:c}=this.getMinMax(!0);this.min=fr(r)?Math.max(0,r):null,this.max=fr(c)?Math.max(0,c):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!fr(this._userMin)&&(this.min=r===Yc(this.min,0)?Yc(this.min,-1):Yc(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:r,maxDefined:c}=this.getUserBounds();let p=this.min,g=this.max;const b=i=>p=r?p:i,E=i=>g=c?g:i;p===g&&(p<=0?(b(1),E(10)):(b(Yc(p,-1)),E(Yc(g,1)))),p<=0&&b(Yc(g,-1)),g<=0&&E(Yc(p,1)),this.min=p,this.max=g}buildTicks(){const r=this.options,c={min:this._userMin,max:this._userMax},p=kk(c,this);return r.bounds==="ticks"&&yM(p,this,"value"),r.reverse?(p.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),p}getLabelForValue(r){return r===void 0?"0":Dp(r,this.chart.options.locale,this.options.ticks.format)}configure(){const r=this.min;super.configure(),this._startValue=Hl(r),this._valueRange=Hl(this.max)-Hl(r)}getPixelForValue(r){return(r===void 0||r===0)&&(r=this.min),r===null||isNaN(r)?NaN:this.getPixelForDecimal(r===this.min?0:(Hl(r)-this._startValue)/this._valueRange)}getValueForPixel(r){const c=this.getDecimalForPixel(r);return Math.pow(10,this._startValue+c*this._valueRange)}}Yt(I0,"id","logarithmic"),Yt(I0,"defaults",{ticks:{callback:Cg.formatters.logarithmic,major:{enabled:!0}}});function C0(a){const r=a.ticks;if(r.display&&a.display){const c=os(r.backdropPadding);return Wi(r.font&&r.font.size,tr.font.size)+c.height}return 0}function Ok(a,r,c){return c=er(c)?c:[c],{w:Gz(a,r.string,c),h:c.length*r.lineHeight}}function FT(a,r,c,p,g){return a===p||a===g?{start:r-c/2,end:r+c/2}:a<p||a>g?{start:r-c,end:r}:{start:r,end:r+c}}function Fk(a){const r={l:a.left+a._padding.left,r:a.right-a._padding.right,t:a.top+a._padding.top,b:a.bottom-a._padding.bottom},c=Object.assign({},r),p=[],g=[],b=a._pointLabels.length,E=a.options.pointLabels,i=E.centerPointLabels?Jn/b:0;for(let R=0;R<b;R++){const V=E.setContext(a.getPointLabelContext(R));g[R]=V.padding;const j=a.getPointPosition(R,a.drawingArea+g[R],i),W=Cr(V.font),te=Ok(a.ctx,W,a._pointLabels[R]);p[R]=te;const ne=Gs(a.getIndexAngle(R)+i),ge=Math.round(nv(ne)),xe=FT(ge,j.x,te.w,0,180),Fe=FT(ge,j.y,te.h,90,270);Bk(c,r,ne,xe,Fe)}a.setCenterPoint(r.l-c.l,c.r-r.r,r.t-c.t,c.b-r.b),a._pointLabelItems=Uk(a,p,g)}function Bk(a,r,c,p,g){const b=Math.abs(Math.sin(c)),E=Math.abs(Math.cos(c));let i=0,R=0;p.start<r.l?(i=(r.l-p.start)/b,a.l=Math.min(a.l,r.l-i)):p.end>r.r&&(i=(p.end-r.r)/b,a.r=Math.max(a.r,r.r+i)),g.start<r.t?(R=(r.t-g.start)/E,a.t=Math.min(a.t,r.t-R)):g.end>r.b&&(R=(g.end-r.b)/E,a.b=Math.max(a.b,r.b+R))}function Nk(a,r,c){const p=a.drawingArea,{extra:g,additionalAngle:b,padding:E,size:i}=c,R=a.getPointPosition(r,p+g+E,b),V=Math.round(nv(Gs(R.angle+_r))),j=Hk(R.y,i.h,V),W=jk(V),te=Gk(R.x,i.w,W);return{visible:!0,x:R.x,y:j,textAlign:W,left:te,top:j,right:te+i.w,bottom:j+i.h}}function Vk(a,r){if(!r)return!0;const{left:c,top:p,right:g,bottom:b}=a;return!(Ha({x:c,y:p},r)||Ha({x:c,y:b},r)||Ha({x:g,y:p},r)||Ha({x:g,y:b},r))}function Uk(a,r,c){const p=[],g=a._pointLabels.length,b=a.options,{centerPointLabels:E,display:i}=b.pointLabels,R={extra:C0(b)/2,additionalAngle:E?Jn/g:0};let V;for(let j=0;j<g;j++){R.padding=c[j],R.size=r[j];const W=Nk(a,j,R);p.push(W),i==="auto"&&(W.visible=Vk(W,V),W.visible&&(V=W))}return p}function jk(a){return a===0||a===180?"center":a<180?"left":"right"}function Gk(a,r,c){return c==="right"?a-=r:c==="center"&&(a-=r/2),a}function Hk(a,r,c){return c===90||c===270?a-=r/2:(c>270||c<90)&&(a-=r),a}function qk(a,r,c){const{left:p,top:g,right:b,bottom:E}=c,{backdropColor:i}=r;if(!bn(i)){const R=iu(r.borderRadius),V=os(r.backdropPadding);a.fillStyle=i;const j=p-V.left,W=g-V.top,te=b-p+V.width,ne=E-g+V.height;Object.values(R).some(ge=>ge!==0)?(a.beginPath(),wp(a,{x:j,y:W,w:te,h:ne,radius:R}),a.fill()):a.fillRect(j,W,te,ne)}}function $k(a,r){const{ctx:c,options:{pointLabels:p}}=a;for(let g=r-1;g>=0;g--){const b=a._pointLabelItems[g];if(!b.visible)continue;const E=p.setContext(a.getPointLabelContext(g));qk(c,E,b);const i=Cr(E.font),{x:R,y:V,textAlign:j}=b;ou(c,a._pointLabels[g],R,V+i.lineHeight/2,i,{color:E.color,textAlign:j,textBaseline:"middle"})}}function lE(a,r,c,p){const{ctx:g}=a;if(c)g.arc(a.xCenter,a.yCenter,r,0,Kn);else{let b=a.getPointPosition(0,r);g.moveTo(b.x,b.y);for(let E=1;E<p;E++)b=a.getPointPosition(E,r),g.lineTo(b.x,b.y)}}function Wk(a,r,c,p,g){const b=a.ctx,E=r.circular,{color:i,lineWidth:R}=r;!E&&!p||!i||!R||c<0||(b.save(),b.strokeStyle=i,b.lineWidth=R,b.setLineDash(g.dash||[]),b.lineDashOffset=g.dashOffset,b.beginPath(),lE(a,c,E,p),b.closePath(),b.stroke(),b.restore())}function Zk(a,r,c){return Ql(a,{label:c,index:r,type:"pointLabel"})}class Kf extends gg{constructor(r){super(r),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const r=this._padding=os(C0(this.options)/2),c=this.width=this.maxWidth-r.width,p=this.height=this.maxHeight-r.height;this.xCenter=Math.floor(this.left+c/2+r.left),this.yCenter=Math.floor(this.top+p/2+r.top),this.drawingArea=Math.floor(Math.min(c,p)/2)}determineDataLimits(){const{min:r,max:c}=this.getMinMax(!1);this.min=fr(r)&&!isNaN(r)?r:0,this.max=fr(c)&&!isNaN(c)?c:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/C0(this.options))}generateTickLabels(r){gg.prototype.generateTickLabels.call(this,r),this._pointLabels=this.getLabels().map((c,p)=>{const g=Un(this.options.pointLabels.callback,[c,p],this);return g||g===0?g:""}).filter((c,p)=>this.chart.getDataVisibility(p))}fit(){const r=this.options;r.display&&r.pointLabels.display?Fk(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(r,c,p,g){this.xCenter+=Math.floor((r-c)/2),this.yCenter+=Math.floor((p-g)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(r,c,p,g))}getIndexAngle(r){const c=Kn/(this._pointLabels.length||1),p=this.options.startAngle||0;return Gs(r*c+Io(p))}getDistanceFromCenterForValue(r){if(bn(r))return NaN;const c=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-r)*c:(r-this.min)*c}getValueForDistanceFromCenter(r){if(bn(r))return NaN;const c=r/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-c:this.min+c}getPointLabelContext(r){const c=this._pointLabels||[];if(r>=0&&r<c.length){const p=c[r];return Zk(this.getContext(),r,p)}}getPointPosition(r,c,p=0){const g=this.getIndexAngle(r)-_r+p;return{x:Math.cos(g)*c+this.xCenter,y:Math.sin(g)*c+this.yCenter,angle:g}}getPointPositionForValue(r,c){return this.getPointPosition(r,this.getDistanceFromCenterForValue(c))}getBasePosition(r){return this.getPointPositionForValue(r||0,this.getBaseValue())}getPointLabelPosition(r){const{left:c,top:p,right:g,bottom:b}=this._pointLabelItems[r];return{left:c,top:p,right:g,bottom:b}}drawBackground(){const{backgroundColor:r,grid:{circular:c}}=this.options;if(r){const p=this.ctx;p.save(),p.beginPath(),lE(this,this.getDistanceFromCenterForValue(this._endValue),c,this._pointLabels.length),p.closePath(),p.fillStyle=r,p.fill(),p.restore()}}drawGrid(){const r=this.ctx,c=this.options,{angleLines:p,grid:g,border:b}=c,E=this._pointLabels.length;let i,R,V;if(c.pointLabels.display&&$k(this,E),g.display&&this.ticks.forEach((j,W)=>{if(W!==0||W===0&&this.min<0){R=this.getDistanceFromCenterForValue(j.value);const te=this.getContext(W),ne=g.setContext(te),ge=b.setContext(te);Wk(this,ne,R,E,ge)}}),p.display){for(r.save(),i=E-1;i>=0;i--){const j=p.setContext(this.getPointLabelContext(i)),{color:W,lineWidth:te}=j;!te||!W||(r.lineWidth=te,r.strokeStyle=W,r.setLineDash(j.borderDash),r.lineDashOffset=j.borderDashOffset,R=this.getDistanceFromCenterForValue(c.reverse?this.min:this.max),V=this.getPointPosition(i,R),r.beginPath(),r.moveTo(this.xCenter,this.yCenter),r.lineTo(V.x,V.y),r.stroke())}r.restore()}}drawBorder(){}drawLabels(){const r=this.ctx,c=this.options,p=c.ticks;if(!p.display)return;const g=this.getIndexAngle(0);let b,E;r.save(),r.translate(this.xCenter,this.yCenter),r.rotate(g),r.textAlign="center",r.textBaseline="middle",this.ticks.forEach((i,R)=>{if(R===0&&this.min>=0&&!c.reverse)return;const V=p.setContext(this.getContext(R)),j=Cr(V.font);if(b=this.getDistanceFromCenterForValue(this.ticks[R].value),V.showLabelBackdrop){r.font=j.string,E=r.measureText(i.label).width,r.fillStyle=V.backdropColor;const W=os(V.backdropPadding);r.fillRect(-E/2-W.left,-b-j.size/2-W.top,E+W.width,j.size+W.height)}ou(r,i.label,0,-b,j,{color:V.color,strokeColor:V.textStrokeColor,strokeWidth:V.textStrokeWidth})}),r.restore()}drawTitle(){}}Yt(Kf,"id","radialLinear"),Yt(Kf,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Cg.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(r){return r},padding:5,centerPointLabels:!1}}),Yt(Kf,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),Yt(Kf,"descriptors",{angleLines:{_fallback:"grid"}});const Rg={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Es=Object.keys(Rg);function BT(a,r){return a-r}function NT(a,r){if(bn(r))return null;const c=a._adapter,{parser:p,round:g,isoWeekday:b}=a._parseOpts;let E=r;return typeof p=="function"&&(E=p(E)),fr(E)||(E=typeof p=="string"?c.parse(E,p):c.parse(E)),E===null?null:(g&&(E=g==="week"&&(Xh(b)||b===!0)?c.startOf(E,"isoWeek",b):c.startOf(E,g)),+E)}function VT(a,r,c,p){const g=Es.length;for(let b=Es.indexOf(a);b<g-1;++b){const E=Rg[Es[b]],i=E.steps?E.steps:Number.MAX_SAFE_INTEGER;if(E.common&&Math.ceil((c-r)/(i*E.size))<=p)return Es[b]}return Es[g-1]}function Xk(a,r,c,p,g){for(let b=Es.length-1;b>=Es.indexOf(c);b--){const E=Es[b];if(Rg[E].common&&a._adapter.diff(g,p,E)>=r-1)return E}return Es[c?Es.indexOf(c):0]}function Yk(a){for(let r=Es.indexOf(a)+1,c=Es.length;r<c;++r)if(Rg[Es[r]].common)return Es[r]}function UT(a,r,c){if(!c)a[r]=!0;else if(c.length){const{lo:p,hi:g}=rv(c,r),b=c[p]>=r?c[p]:c[g];a[b]=!0}}function Kk(a,r,c,p){const g=a._adapter,b=+g.startOf(r[0].value,p),E=r[r.length-1].value;let i,R;for(i=b;i<=E;i=+g.add(i,1,p))R=c[i],R>=0&&(r[R].major=!0);return r}function jT(a,r,c){const p=[],g={},b=r.length;let E,i;for(E=0;E<b;++E)i=r[E],g[i]=E,p.push({value:i,major:!1});return b===0||!c?p:Kk(a,p,g,c)}class Mp extends cu{constructor(r){super(r),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(r,c={}){const p=r.time||(r.time={}),g=this._adapter=new sR._date(r.adapters.date);g.init(c),sp(p.displayFormats,g.formats()),this._parseOpts={parser:p.parser,round:p.round,isoWeekday:p.isoWeekday},super.init(r),this._normalized=c.normalized}parse(r,c){return r===void 0?null:NT(this,r)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const r=this.options,c=this._adapter,p=r.time.unit||"day";let{min:g,max:b,minDefined:E,maxDefined:i}=this.getUserBounds();function R(V){!E&&!isNaN(V.min)&&(g=Math.min(g,V.min)),!i&&!isNaN(V.max)&&(b=Math.max(b,V.max))}(!E||!i)&&(R(this._getLabelBounds()),(r.bounds!=="ticks"||r.ticks.source!=="labels")&&R(this.getMinMax(!1))),g=fr(g)&&!isNaN(g)?g:+c.startOf(Date.now(),p),b=fr(b)&&!isNaN(b)?b:+c.endOf(Date.now(),p)+1,this.min=Math.min(g,b-1),this.max=Math.max(g+1,b)}_getLabelBounds(){const r=this.getLabelTimestamps();let c=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY;return r.length&&(c=r[0],p=r[r.length-1]),{min:c,max:p}}buildTicks(){const r=this.options,c=r.time,p=r.ticks,g=p.source==="labels"?this.getLabelTimestamps():this._generate();r.bounds==="ticks"&&g.length&&(this.min=this._userMin||g[0],this.max=this._userMax||g[g.length-1]);const b=this.min,E=this.max,i=Pz(g,b,E);return this._unit=c.unit||(p.autoSkip?VT(c.minUnit,this.min,this.max,this._getLabelCapacity(b)):Xk(this,i.length,c.minUnit,this.min,this.max)),this._majorUnit=!p.major.enabled||this._unit==="year"?void 0:Yk(this._unit),this.initOffsets(g),r.reverse&&i.reverse(),jT(this,i,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(r=>+r.value))}initOffsets(r=[]){let c=0,p=0,g,b;this.options.offset&&r.length&&(g=this.getDecimalForValue(r[0]),r.length===1?c=1-g:c=(this.getDecimalForValue(r[1])-g)/2,b=this.getDecimalForValue(r[r.length-1]),r.length===1?p=b:p=(b-this.getDecimalForValue(r[r.length-2]))/2);const E=r.length<3?.5:.25;c=Lr(c,0,E),p=Lr(p,0,E),this._offsets={start:c,end:p,factor:1/(c+1+p)}}_generate(){const r=this._adapter,c=this.min,p=this.max,g=this.options,b=g.time,E=b.unit||VT(b.minUnit,c,p,this._getLabelCapacity(c)),i=Wi(g.ticks.stepSize,1),R=E==="week"?b.isoWeekday:!1,V=Xh(R)||R===!0,j={};let W=c,te,ne;if(V&&(W=+r.startOf(W,"isoWeek",R)),W=+r.startOf(W,V?"day":E),r.diff(p,c,E)>1e5*i)throw new Error(c+" and "+p+" are too far apart with stepSize of "+i+" "+E);const ge=g.ticks.source==="data"&&this.getDataTimestamps();for(te=W,ne=0;te<p;te=+r.add(te,i,E),ne++)UT(j,te,ge);return(te===p||g.bounds==="ticks"||ne===1)&&UT(j,te,ge),Object.keys(j).sort(BT).map(xe=>+xe)}getLabelForValue(r){const c=this._adapter,p=this.options.time;return p.tooltipFormat?c.format(r,p.tooltipFormat):c.format(r,p.displayFormats.datetime)}format(r,c){const g=this.options.time.displayFormats,b=this._unit,E=c||g[b];return this._adapter.format(r,E)}_tickFormatFunction(r,c,p,g){const b=this.options,E=b.ticks.callback;if(E)return Un(E,[r,c,p],this);const i=b.time.displayFormats,R=this._unit,V=this._majorUnit,j=R&&i[R],W=V&&i[V],te=p[c],ne=V&&W&&te&&te.major;return this._adapter.format(r,g||(ne?W:j))}generateTickLabels(r){let c,p,g;for(c=0,p=r.length;c<p;++c)g=r[c],g.label=this._tickFormatFunction(g.value,c,r)}getDecimalForValue(r){return r===null?NaN:(r-this.min)/(this.max-this.min)}getPixelForValue(r){const c=this._offsets,p=this.getDecimalForValue(r);return this.getPixelForDecimal((c.start+p)*c.factor)}getValueForPixel(r){const c=this._offsets,p=this.getDecimalForPixel(r)/c.factor-c.end;return this.min+p*(this.max-this.min)}_getLabelSize(r){const c=this.options.ticks,p=this.ctx.measureText(r).width,g=Io(this.isHorizontal()?c.maxRotation:c.minRotation),b=Math.cos(g),E=Math.sin(g),i=this._resolveTickFontOptions(0).size;return{w:p*b+i*E,h:p*E+i*b}}_getLabelCapacity(r){const c=this.options.time,p=c.displayFormats,g=p[c.unit]||p.millisecond,b=this._tickFormatFunction(r,0,jT(this,[r],this._majorUnit),g),E=this._getLabelSize(b),i=Math.floor(this.isHorizontal()?this.width/E.w:this.height/E.h)-1;return i>0?i:1}getDataTimestamps(){let r=this._cache.data||[],c,p;if(r.length)return r;const g=this.getMatchingVisibleMetas();if(this._normalized&&g.length)return this._cache.data=g[0].controller.getAllParsedValues(this);for(c=0,p=g.length;c<p;++c)r=r.concat(g[c].controller.getAllParsedValues(this));return this._cache.data=this.normalize(r)}getLabelTimestamps(){const r=this._cache.labels||[];let c,p;if(r.length)return r;const g=this.getLabels();for(c=0,p=g.length;c<p;++c)r.push(NT(this,g[c]));return this._cache.labels=this._normalized?r:this.normalize(r)}normalize(r){return bM(r.sort(BT))}}Yt(Mp,"id","time"),Yt(Mp,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function j_(a,r,c){let p=0,g=a.length-1,b,E,i,R;c?(r>=a[p].pos&&r<=a[g].pos&&({lo:p,hi:g}=Ga(a,"pos",r)),{pos:b,time:i}=a[p],{pos:E,time:R}=a[g]):(r>=a[p].time&&r<=a[g].time&&({lo:p,hi:g}=Ga(a,"time",r)),{time:b,pos:i}=a[p],{time:E,pos:R}=a[g]);const V=E-b;return V?i+(R-i)*(r-b)/V:i}class P0 extends Mp{constructor(r){super(r),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const r=this._getTimestampsForTable(),c=this._table=this.buildLookupTable(r);this._minPos=j_(c,this.min),this._tableRange=j_(c,this.max)-this._minPos,super.initOffsets(r)}buildLookupTable(r){const{min:c,max:p}=this,g=[],b=[];let E,i,R,V,j;for(E=0,i=r.length;E<i;++E)V=r[E],V>=c&&V<=p&&g.push(V);if(g.length<2)return[{time:c,pos:0},{time:p,pos:1}];for(E=0,i=g.length;E<i;++E)j=g[E+1],R=g[E-1],V=g[E],Math.round((j+R)/2)!==V&&b.push({time:V,pos:E/(i-1)});return b}_generate(){const r=this.min,c=this.max;let p=super.getDataTimestamps();return(!p.includes(r)||!p.length)&&p.splice(0,0,r),(!p.includes(c)||p.length===1)&&p.push(c),p.sort((g,b)=>g-b)}_getTimestampsForTable(){let r=this._cache.all||[];if(r.length)return r;const c=this.getDataTimestamps(),p=this.getLabelTimestamps();return c.length&&p.length?r=this.normalize(c.concat(p)):r=c.length?c:p,r=this._cache.all=r,r}getDecimalForValue(r){return(j_(this._table,r)-this._minPos)/this._tableRange}getValueForPixel(r){const c=this._offsets,p=this.getDecimalForPixel(r)/c.factor-c.end;return j_(this._table,p*this._tableRange+this._minPos,!0)}}Yt(P0,"id","timeseries"),Yt(P0,"defaults",Mp.defaults);var Jk=Object.freeze({__proto__:null,CategoryScale:E0,LinearScale:A0,LogarithmicScale:I0,RadialLinearScale:Kf,TimeScale:Mp,TimeSeriesScale:P0});const Qk=[rR,LL,Ck,Jk];Va.register(...Qk);const eO={name:"StationChart",props:{stationChartData:{type:Object,required:!0}},data(){return{chartInstance:null}},watch:{stationChartData:{handler(){this.renderChart()},deep:!0}},mounted(){this.renderChart()},methods:{renderChart(){if(this.chartInstance&&this.chartInstance.destroy(),!this.stationChartData){console.warn("No stationChartData provided!");return}const a=this.$refs.chartCanvas;if(!a){console.error("Canvas element is not available!");return}const r=a.getContext("2d");if(!r){console.error("Failed to get canvas context!");return}const c={responsive:!0,plugins:{legend:{position:"top"},tooltip:{enabled:!0}}},g={type:"bar",data:{labels:this.stationChartData.labels,datasets:this.stationChartData.datasets.map(b=>({label:b.label,data:b.data,backgroundColor:b.backgroundColor||"rgba(75, 192, 192, 0.2)",borderColor:b.borderColor||"rgba(75, 192, 192, 1)",borderWidth:b.borderWidth||1}))},options:c};this.chartInstance=new Va(r,g)}}},tO={ref:"chartCanvas"};function iO(a,r,c,p,g,b){return $s(),Ro("div",null,[cn("canvas",tO,null,512)])}const nO=Wa(eO,[["render",iO]]);function rO(a,r){const c={};return a.forEach((p,g)=>{const b=p.filter(E=>E.RENT_ID===r);c[g]=b.length}),{countPerHour:c,stationId:r}}function sO(a,r){const c={};return r.forEach((p,g)=>{const b=String(g);c[b]=c[b]||{},a.forEach(E=>{const R=p.filter(V=>V.RENT_ID===E.id).length;c[b][E.name]={name:E.name,id:E.id,district:E.district,count:R}})}),console.log(c),c}function oO(a,r,c="rgba(85,89,180,0.2)",p="rgba(85,89,180,1)"){const g=Object.keys(a).map(String),b=Object.values(a);return{labels:g,datasets:[{label:r,data:b,backgroundColor:c,borderColor:p,borderWidth:1}]}}const aO={name:"App",data(){return{mapboxToken:"pk.eyJ1IjoibWFuZHUxNSIsImEiOiJjbTV1eW1zaTcwMjFmMmlyMXdsMXphYzMzIn0.xVokHFMuTIx5faHkZLw7Tw",seoulToken:"784e567959796f6f36355068644977",stationList:[],usageDataByTime:[],stationChartData:{labels:[],datasets:[]}}},components:{MapboxComponent:WD,StationChart:nO},methods:{handleFetchStationData(a){const r=a.id;a.district;const c=rO(this.usageDataByTime,r);console.log(c.countPerHour),this.stationChartData=oO(c.countPerHour,"Activity by Hour")},async loadData(){try{const r=Array.from({length:24},(p,g)=>`usage_info_bytime_20240416_${g}.json`).map(p=>fetch(`/data/${p}`).then(g=>{if(!g.ok)throw new Error(`Failed to load ${p}: ${g.statusText}`);return g.json()})),c=await Promise.all(r);this.usageDataByTime=c,console.log("All data loaded:",this.usageDataByTime)}catch(a){console.error("Error loading JSON files:",a)}},async loadStationList(){try{const r=await(await fetch("/seoul_bike_stations.geojson")).json();this.stationList=r.features.map(c=>c.properties),console.log("Station data loaded:",this.stationList)}catch(a){console.error("Error loading JSON files:",a)}sO(this.stationList,this.usageDataByTime)},async loadAll(){await this.loadData()}},mounted(){this.loadAll()}},lO={id:"app"},cO={class:"container"},uO={class:"sector"},hO={class:"sector"};function dO(a,r,c,p,g,b){const E=Ww("MapboxComponent"),i=Ww("StationChart");return $s(),Ro("div",lO,[cn("div",cO,[cn("div",uO,[r[0]||(r[0]=cn("h2",null,"Map",-1)),jn(E,{mapboxToken:g.mapboxToken,onFetchStationData:b.handleFetchStationData},null,8,["mapboxToken","onFetchStationData"])]),cn("div",hO,[r[1]||(r[1]=cn("h2",null,"Station Chart",-1)),jn(i,{stationChartData:g.stationChartData},null,8,["stationChartData"])])])])}const fO=Wa(aO,[["render",dO]]),pO="modulepreload",mO=function(a){return"/"+a},GT={},_O=function(r,c,p){let g=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const E=document.querySelector("meta[property=csp-nonce]"),i=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));g=Promise.allSettled(c.map(R=>{if(R=mO(R),R in GT)return;GT[R]=!0;const V=R.endsWith(".css"),j=V?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${R}"]${j}`))return;const W=document.createElement("link");if(W.rel=V?"stylesheet":pO,V||(W.as="script"),W.crossOrigin="",W.href=R,i&&W.setAttribute("nonce",i),document.head.appendChild(W),V)return new Promise((te,ne)=>{W.addEventListener("load",te),W.addEventListener("error",()=>ne(new Error(`Unable to preload CSS for ${R}`)))})}))}function b(E){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=E,window.dispatchEvent(i),!i.defaultPrevented)throw E}return g.then(E=>{for(const i of E||[])i.status==="rejected"&&b(i.reason);return r().catch(b)})};/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Vh=typeof document<"u";function cE(a){return typeof a=="object"||"displayName"in a||"props"in a||"__vccOpts"in a}function gO(a){return a.__esModule||a[Symbol.toStringTag]==="Module"||a.default&&cE(a.default)}const Cn=Object.assign;function t0(a,r){const c={};for(const p in r){const g=r[p];c[p]=zo(g)?g.map(a):a(g)}return c}const up=()=>{},zo=Array.isArray,uE=/#/g,yO=/&/g,xO=/\//g,vO=/=/g,bO=/\?/g,hE=/\+/g,wO=/%5B/g,TO=/%5D/g,dE=/%5E/g,SO=/%60/g,fE=/%7B/g,MO=/%7C/g,pE=/%7D/g,EO=/%20/g;function _v(a){return encodeURI(""+a).replace(MO,"|").replace(wO,"[").replace(TO,"]")}function AO(a){return _v(a).replace(fE,"{").replace(pE,"}").replace(dE,"^")}function D0(a){return _v(a).replace(hE,"%2B").replace(EO,"+").replace(uE,"%23").replace(yO,"%26").replace(SO,"`").replace(fE,"{").replace(pE,"}").replace(dE,"^")}function IO(a){return D0(a).replace(vO,"%3D")}function CO(a){return _v(a).replace(uE,"%23").replace(bO,"%3F")}function PO(a){return a==null?"":CO(a).replace(xO,"%2F")}function Ep(a){try{return decodeURIComponent(""+a)}catch{}return""+a}const DO=/\/$/,zO=a=>a.replace(DO,"");function i0(a,r,c="/"){let p,g={},b="",E="";const i=r.indexOf("#");let R=r.indexOf("?");return i<R&&i>=0&&(R=-1),R>-1&&(p=r.slice(0,R),b=r.slice(R+1,i>-1?i:r.length),g=a(b)),i>-1&&(p=p||r.slice(0,i),E=r.slice(i,r.length)),p=OO(p??r,c),{fullPath:p+(b&&"?")+b+E,path:p,query:g,hash:Ep(E)}}function RO(a,r){const c=r.query?a(r.query):"";return r.path+(c&&"?")+c+(r.hash||"")}function HT(a,r){return!r||!a.toLowerCase().startsWith(r.toLowerCase())?a:a.slice(r.length)||"/"}function LO(a,r,c){const p=r.matched.length-1,g=c.matched.length-1;return p>-1&&p===g&&Jh(r.matched[p],c.matched[g])&&mE(r.params,c.params)&&a(r.query)===a(c.query)&&r.hash===c.hash}function Jh(a,r){return(a.aliasOf||a)===(r.aliasOf||r)}function mE(a,r){if(Object.keys(a).length!==Object.keys(r).length)return!1;for(const c in a)if(!kO(a[c],r[c]))return!1;return!0}function kO(a,r){return zo(a)?qT(a,r):zo(r)?qT(r,a):a===r}function qT(a,r){return zo(r)?a.length===r.length&&a.every((c,p)=>c===r[p]):a.length===1&&a[0]===r}function OO(a,r){if(a.startsWith("/"))return a;if(!a)return r;const c=r.split("/"),p=a.split("/"),g=p[p.length-1];(g===".."||g===".")&&p.push("");let b=c.length-1,E,i;for(E=0;E<p.length;E++)if(i=p[E],i!==".")if(i==="..")b>1&&b--;else break;return c.slice(0,b).join("/")+"/"+p.slice(E).join("/")}const Bl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Ap;(function(a){a.pop="pop",a.push="push"})(Ap||(Ap={}));var hp;(function(a){a.back="back",a.forward="forward",a.unknown=""})(hp||(hp={}));function FO(a){if(!a)if(Vh){const r=document.querySelector("base");a=r&&r.getAttribute("href")||"/",a=a.replace(/^\w+:\/\/[^\/]+/,"")}else a="/";return a[0]!=="/"&&a[0]!=="#"&&(a="/"+a),zO(a)}const BO=/^[^#]+#/;function NO(a,r){return a.replace(BO,"#")+r}function VO(a,r){const c=document.documentElement.getBoundingClientRect(),p=a.getBoundingClientRect();return{behavior:r.behavior,left:p.left-c.left-(r.left||0),top:p.top-c.top-(r.top||0)}}const Lg=()=>({left:window.scrollX,top:window.scrollY});function UO(a){let r;if("el"in a){const c=a.el,p=typeof c=="string"&&c.startsWith("#"),g=typeof c=="string"?p?document.getElementById(c.slice(1)):document.querySelector(c):c;if(!g)return;r=VO(g,a)}else r=a;"scrollBehavior"in document.documentElement.style?window.scrollTo(r):window.scrollTo(r.left!=null?r.left:window.scrollX,r.top!=null?r.top:window.scrollY)}function $T(a,r){return(history.state?history.state.position-r:-1)+a}const z0=new Map;function jO(a,r){z0.set(a,r)}function GO(a){const r=z0.get(a);return z0.delete(a),r}let HO=()=>location.protocol+"//"+location.host;function _E(a,r){const{pathname:c,search:p,hash:g}=r,b=a.indexOf("#");if(b>-1){let i=g.includes(a.slice(b))?a.slice(b).length:1,R=g.slice(i);return R[0]!=="/"&&(R="/"+R),HT(R,"")}return HT(c,a)+p+g}function qO(a,r,c,p){let g=[],b=[],E=null;const i=({state:te})=>{const ne=_E(a,location),ge=c.value,xe=r.value;let Fe=0;if(te){if(c.value=ne,r.value=te,E&&E===ge){E=null;return}Fe=xe?te.position-xe.position:0}else p(ne);g.forEach(Be=>{Be(c.value,ge,{delta:Fe,type:Ap.pop,direction:Fe?Fe>0?hp.forward:hp.back:hp.unknown})})};function R(){E=c.value}function V(te){g.push(te);const ne=()=>{const ge=g.indexOf(te);ge>-1&&g.splice(ge,1)};return b.push(ne),ne}function j(){const{history:te}=window;te.state&&te.replaceState(Cn({},te.state,{scroll:Lg()}),"")}function W(){for(const te of b)te();b=[],window.removeEventListener("popstate",i),window.removeEventListener("beforeunload",j)}return window.addEventListener("popstate",i),window.addEventListener("beforeunload",j,{passive:!0}),{pauseListeners:R,listen:V,destroy:W}}function WT(a,r,c,p=!1,g=!1){return{back:a,current:r,forward:c,replaced:p,position:window.history.length,scroll:g?Lg():null}}function $O(a){const{history:r,location:c}=window,p={value:_E(a,c)},g={value:r.state};g.value||b(p.value,{back:null,current:p.value,forward:null,position:r.length-1,replaced:!0,scroll:null},!0);function b(R,V,j){const W=a.indexOf("#"),te=W>-1?(c.host&&document.querySelector("base")?a:a.slice(W))+R:HO()+a+R;try{r[j?"replaceState":"pushState"](V,"",te),g.value=V}catch(ne){console.error(ne),c[j?"replace":"assign"](te)}}function E(R,V){const j=Cn({},r.state,WT(g.value.back,R,g.value.forward,!0),V,{position:g.value.position});b(R,j,!0),p.value=R}function i(R,V){const j=Cn({},g.value,r.state,{forward:R,scroll:Lg()});b(j.current,j,!0);const W=Cn({},WT(p.value,R,null),{position:j.position+1},V);b(R,W,!1),p.value=R}return{location:p,state:g,push:i,replace:E}}function WO(a){a=FO(a);const r=$O(a),c=qO(a,r.state,r.location,r.replace);function p(b,E=!0){E||c.pauseListeners(),history.go(b)}const g=Cn({location:"",base:a,go:p,createHref:NO.bind(null,a)},r,c);return Object.defineProperty(g,"location",{enumerable:!0,get:()=>r.location.value}),Object.defineProperty(g,"state",{enumerable:!0,get:()=>r.state.value}),g}function ZO(a){return typeof a=="string"||a&&typeof a=="object"}function gE(a){return typeof a=="string"||typeof a=="symbol"}const yE=Symbol("");var ZT;(function(a){a[a.aborted=4]="aborted",a[a.cancelled=8]="cancelled",a[a.duplicated=16]="duplicated"})(ZT||(ZT={}));function Qh(a,r){return Cn(new Error,{type:a,[yE]:!0},r)}function ka(a,r){return a instanceof Error&&yE in a&&(r==null||!!(a.type&r))}const XT="[^/]+?",XO={sensitive:!1,strict:!1,start:!0,end:!0},YO=/[.+*?^${}()[\]/\\]/g;function KO(a,r){const c=Cn({},XO,r),p=[];let g=c.start?"^":"";const b=[];for(const V of a){const j=V.length?[]:[90];c.strict&&!V.length&&(g+="/");for(let W=0;W<V.length;W++){const te=V[W];let ne=40+(c.sensitive?.25:0);if(te.type===0)W||(g+="/"),g+=te.value.replace(YO,"\\$&"),ne+=40;else if(te.type===1){const{value:ge,repeatable:xe,optional:Fe,regexp:Be}=te;b.push({name:ge,repeatable:xe,optional:Fe});const Ke=Be||XT;if(Ke!==XT){ne+=10;try{new RegExp(`(${Ke})`)}catch(Ye){throw new Error(`Invalid custom RegExp for param "${ge}" (${Ke}): `+Ye.message)}}let at=xe?`((?:${Ke})(?:/(?:${Ke}))*)`:`(${Ke})`;W||(at=Fe&&V.length<2?`(?:/${at})`:"/"+at),Fe&&(at+="?"),g+=at,ne+=20,Fe&&(ne+=-8),xe&&(ne+=-20),Ke===".*"&&(ne+=-50)}j.push(ne)}p.push(j)}if(c.strict&&c.end){const V=p.length-1;p[V][p[V].length-1]+=.7000000000000001}c.strict||(g+="/?"),c.end?g+="$":c.strict&&!g.endsWith("/")&&(g+="(?:/|$)");const E=new RegExp(g,c.sensitive?"":"i");function i(V){const j=V.match(E),W={};if(!j)return null;for(let te=1;te<j.length;te++){const ne=j[te]||"",ge=b[te-1];W[ge.name]=ne&&ge.repeatable?ne.split("/"):ne}return W}function R(V){let j="",W=!1;for(const te of a){(!W||!j.endsWith("/"))&&(j+="/"),W=!1;for(const ne of te)if(ne.type===0)j+=ne.value;else if(ne.type===1){const{value:ge,repeatable:xe,optional:Fe}=ne,Be=ge in V?V[ge]:"";if(zo(Be)&&!xe)throw new Error(`Provided param "${ge}" is an array but it is not repeatable (* or + modifiers)`);const Ke=zo(Be)?Be.join("/"):Be;if(!Ke)if(Fe)te.length<2&&(j.endsWith("/")?j=j.slice(0,-1):W=!0);else throw new Error(`Missing required param "${ge}"`);j+=Ke}}return j||"/"}return{re:E,score:p,keys:b,parse:i,stringify:R}}function JO(a,r){let c=0;for(;c<a.length&&c<r.length;){const p=r[c]-a[c];if(p)return p;c++}return a.length<r.length?a.length===1&&a[0]===80?-1:1:a.length>r.length?r.length===1&&r[0]===80?1:-1:0}function xE(a,r){let c=0;const p=a.score,g=r.score;for(;c<p.length&&c<g.length;){const b=JO(p[c],g[c]);if(b)return b;c++}if(Math.abs(g.length-p.length)===1){if(YT(p))return 1;if(YT(g))return-1}return g.length-p.length}function YT(a){const r=a[a.length-1];return a.length>0&&r[r.length-1]<0}const QO={type:0,value:""},eF=/[a-zA-Z0-9_]/;function tF(a){if(!a)return[[]];if(a==="/")return[[QO]];if(!a.startsWith("/"))throw new Error(`Invalid path "${a}"`);function r(ne){throw new Error(`ERR (${c})/"${V}": ${ne}`)}let c=0,p=c;const g=[];let b;function E(){b&&g.push(b),b=[]}let i=0,R,V="",j="";function W(){V&&(c===0?b.push({type:0,value:V}):c===1||c===2||c===3?(b.length>1&&(R==="*"||R==="+")&&r(`A repeatable param (${V}) must be alone in its segment. eg: '/:ids+.`),b.push({type:1,value:V,regexp:j,repeatable:R==="*"||R==="+",optional:R==="*"||R==="?"})):r("Invalid state to consume buffer"),V="")}function te(){V+=R}for(;i<a.length;){if(R=a[i++],R==="\\"&&c!==2){p=c,c=4;continue}switch(c){case 0:R==="/"?(V&&W(),E()):R===":"?(W(),c=1):te();break;case 4:te(),c=p;break;case 1:R==="("?c=2:eF.test(R)?te():(W(),c=0,R!=="*"&&R!=="?"&&R!=="+"&&i--);break;case 2:R===")"?j[j.length-1]=="\\"?j=j.slice(0,-1)+R:c=3:j+=R;break;case 3:W(),c=0,R!=="*"&&R!=="?"&&R!=="+"&&i--,j="";break;default:r("Unknown state");break}}return c===2&&r(`Unfinished custom RegExp for param "${V}"`),W(),E(),g}function iF(a,r,c){const p=KO(tF(a.path),c),g=Cn(p,{record:a,parent:r,children:[],alias:[]});return r&&!g.record.aliasOf==!r.record.aliasOf&&r.children.push(g),g}function nF(a,r){const c=[],p=new Map;r=eS({strict:!1,end:!0,sensitive:!1},r);function g(W){return p.get(W)}function b(W,te,ne){const ge=!ne,xe=JT(W);xe.aliasOf=ne&&ne.record;const Fe=eS(r,W),Be=[xe];if("alias"in W){const Ye=typeof W.alias=="string"?[W.alias]:W.alias;for(const ct of Ye)Be.push(JT(Cn({},xe,{components:ne?ne.record.components:xe.components,path:ct,aliasOf:ne?ne.record:xe})))}let Ke,at;for(const Ye of Be){const{path:ct}=Ye;if(te&&ct[0]!=="/"){const Lt=te.record.path,rt=Lt[Lt.length-1]==="/"?"":"/";Ye.path=te.record.path+(ct&&rt+ct)}if(Ke=iF(Ye,te,Fe),ne?ne.alias.push(Ke):(at=at||Ke,at!==Ke&&at.alias.push(Ke),ge&&W.name&&!QT(Ke)&&E(W.name)),vE(Ke)&&R(Ke),xe.children){const Lt=xe.children;for(let rt=0;rt<Lt.length;rt++)b(Lt[rt],Ke,ne&&ne.children[rt])}ne=ne||Ke}return at?()=>{E(at)}:up}function E(W){if(gE(W)){const te=p.get(W);te&&(p.delete(W),c.splice(c.indexOf(te),1),te.children.forEach(E),te.alias.forEach(E))}else{const te=c.indexOf(W);te>-1&&(c.splice(te,1),W.record.name&&p.delete(W.record.name),W.children.forEach(E),W.alias.forEach(E))}}function i(){return c}function R(W){const te=oF(W,c);c.splice(te,0,W),W.record.name&&!QT(W)&&p.set(W.record.name,W)}function V(W,te){let ne,ge={},xe,Fe;if("name"in W&&W.name){if(ne=p.get(W.name),!ne)throw Qh(1,{location:W});Fe=ne.record.name,ge=Cn(KT(te.params,ne.keys.filter(at=>!at.optional).concat(ne.parent?ne.parent.keys.filter(at=>at.optional):[]).map(at=>at.name)),W.params&&KT(W.params,ne.keys.map(at=>at.name))),xe=ne.stringify(ge)}else if(W.path!=null)xe=W.path,ne=c.find(at=>at.re.test(xe)),ne&&(ge=ne.parse(xe),Fe=ne.record.name);else{if(ne=te.name?p.get(te.name):c.find(at=>at.re.test(te.path)),!ne)throw Qh(1,{location:W,currentLocation:te});Fe=ne.record.name,ge=Cn({},te.params,W.params),xe=ne.stringify(ge)}const Be=[];let Ke=ne;for(;Ke;)Be.unshift(Ke.record),Ke=Ke.parent;return{name:Fe,path:xe,params:ge,matched:Be,meta:sF(Be)}}a.forEach(W=>b(W));function j(){c.length=0,p.clear()}return{addRoute:b,resolve:V,removeRoute:E,clearRoutes:j,getRoutes:i,getRecordMatcher:g}}function KT(a,r){const c={};for(const p of r)p in a&&(c[p]=a[p]);return c}function JT(a){const r={path:a.path,redirect:a.redirect,name:a.name,meta:a.meta||{},aliasOf:a.aliasOf,beforeEnter:a.beforeEnter,props:rF(a),children:a.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in a?a.components||null:a.component&&{default:a.component}};return Object.defineProperty(r,"mods",{value:{}}),r}function rF(a){const r={},c=a.props||!1;if("component"in a)r.default=c;else for(const p in a.components)r[p]=typeof c=="object"?c[p]:c;return r}function QT(a){for(;a;){if(a.record.aliasOf)return!0;a=a.parent}return!1}function sF(a){return a.reduce((r,c)=>Cn(r,c.meta),{})}function eS(a,r){const c={};for(const p in a)c[p]=p in r?r[p]:a[p];return c}function oF(a,r){let c=0,p=r.length;for(;c!==p;){const b=c+p>>1;xE(a,r[b])<0?p=b:c=b+1}const g=aF(a);return g&&(p=r.lastIndexOf(g,p-1)),p}function aF(a){let r=a;for(;r=r.parent;)if(vE(r)&&xE(a,r)===0)return r}function vE({record:a}){return!!(a.name||a.components&&Object.keys(a.components).length||a.redirect)}function lF(a){const r={};if(a===""||a==="?")return r;const p=(a[0]==="?"?a.slice(1):a).split("&");for(let g=0;g<p.length;++g){const b=p[g].replace(hE," "),E=b.indexOf("="),i=Ep(E<0?b:b.slice(0,E)),R=E<0?null:Ep(b.slice(E+1));if(i in r){let V=r[i];zo(V)||(V=r[i]=[V]),V.push(R)}else r[i]=R}return r}function tS(a){let r="";for(let c in a){const p=a[c];if(c=IO(c),p==null){p!==void 0&&(r+=(r.length?"&":"")+c);continue}(zo(p)?p.map(b=>b&&D0(b)):[p&&D0(p)]).forEach(b=>{b!==void 0&&(r+=(r.length?"&":"")+c,b!=null&&(r+="="+b))})}return r}function cF(a){const r={};for(const c in a){const p=a[c];p!==void 0&&(r[c]=zo(p)?p.map(g=>g==null?null:""+g):p==null?p:""+p)}return r}const uF=Symbol(""),iS=Symbol(""),gv=Symbol(""),bE=Symbol(""),R0=Symbol("");function Gf(){let a=[];function r(p){return a.push(p),()=>{const g=a.indexOf(p);g>-1&&a.splice(g,1)}}function c(){a=[]}return{add:r,list:()=>a.slice(),reset:c}}function Ul(a,r,c,p,g,b=E=>E()){const E=p&&(p.enterCallbacks[g]=p.enterCallbacks[g]||[]);return()=>new Promise((i,R)=>{const V=te=>{te===!1?R(Qh(4,{from:c,to:r})):te instanceof Error?R(te):ZO(te)?R(Qh(2,{from:r,to:te})):(E&&p.enterCallbacks[g]===E&&typeof te=="function"&&E.push(te),i())},j=b(()=>a.call(p&&p.instances[g],r,c,V));let W=Promise.resolve(j);a.length<3&&(W=W.then(V)),W.catch(te=>R(te))})}function n0(a,r,c,p,g=b=>b()){const b=[];for(const E of a)for(const i in E.components){let R=E.components[i];if(!(r!=="beforeRouteEnter"&&!E.instances[i]))if(cE(R)){const j=(R.__vccOpts||R)[r];j&&b.push(Ul(j,c,p,E,i,g))}else{let V=R();b.push(()=>V.then(j=>{if(!j)throw new Error(`Couldn't resolve component "${i}" at "${E.path}"`);const W=gO(j)?j.default:j;E.mods[i]=j,E.components[i]=W;const ne=(W.__vccOpts||W)[r];return ne&&Ul(ne,c,p,E,i,g)()}))}}return b}function nS(a){const r=qa(gv),c=qa(bE),p=Ao(()=>{const R=jh(a.to);return r.resolve(R)}),g=Ao(()=>{const{matched:R}=p.value,{length:V}=R,j=R[V-1],W=c.matched;if(!j||!W.length)return-1;const te=W.findIndex(Jh.bind(null,j));if(te>-1)return te;const ne=rS(R[V-2]);return V>1&&rS(j)===ne&&W[W.length-1].path!==ne?W.findIndex(Jh.bind(null,R[V-2])):te}),b=Ao(()=>g.value>-1&&mF(c.params,p.value.params)),E=Ao(()=>g.value>-1&&g.value===c.matched.length-1&&mE(c.params,p.value.params));function i(R={}){if(pF(R)){const V=r[jh(a.replace)?"replace":"push"](jh(a.to)).catch(up);return a.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>V),V}return Promise.resolve()}return{route:p,href:Ao(()=>p.value.href),isActive:b,isExactActive:E,navigate:i}}function hF(a){return a.length===1?a[0]:a}const dF=Mg({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:nS,setup(a,{slots:r}){const c=Tg(nS(a)),{options:p}=qa(gv),g=Ao(()=>({[sS(a.activeClass,p.linkActiveClass,"router-link-active")]:c.isActive,[sS(a.exactActiveClass,p.linkExactActiveClass,"router-link-exact-active")]:c.isExactActive}));return()=>{const b=r.default&&hF(r.default(c));return a.custom?b:uM("a",{"aria-current":c.isExactActive?a.ariaCurrentValue:null,href:c.href,onClick:c.navigate,class:g.value},b)}}}),fF=dF;function pF(a){if(!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&!a.defaultPrevented&&!(a.button!==void 0&&a.button!==0)){if(a.currentTarget&&a.currentTarget.getAttribute){const r=a.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(r))return}return a.preventDefault&&a.preventDefault(),!0}}function mF(a,r){for(const c in r){const p=r[c],g=a[c];if(typeof p=="string"){if(p!==g)return!1}else if(!zo(g)||g.length!==p.length||p.some((b,E)=>b!==g[E]))return!1}return!0}function rS(a){return a?a.aliasOf?a.aliasOf.path:a.path:""}const sS=(a,r,c)=>a??r??c,_F=Mg({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(a,{attrs:r,slots:c}){const p=qa(R0),g=Ao(()=>a.route||p.value),b=qa(iS,0),E=Ao(()=>{let V=jh(b);const{matched:j}=g.value;let W;for(;(W=j[V])&&!W.components;)V++;return V}),i=Ao(()=>g.value.matched[E.value]);H_(iS,Ao(()=>E.value+1)),H_(uF,i),H_(R0,g);const R=IS();return q_(()=>[R.value,i.value,a.name],([V,j,W],[te,ne,ge])=>{j&&(j.instances[W]=V,ne&&ne!==j&&V&&V===te&&(j.leaveGuards.size||(j.leaveGuards=ne.leaveGuards),j.updateGuards.size||(j.updateGuards=ne.updateGuards))),V&&j&&(!ne||!Jh(j,ne)||!te)&&(j.enterCallbacks[W]||[]).forEach(xe=>xe(V))},{flush:"post"}),()=>{const V=g.value,j=a.name,W=i.value,te=W&&W.components[j];if(!te)return oS(c.default,{Component:te,route:V});const ne=W.props[j],ge=ne?ne===!0?V.params:typeof ne=="function"?ne(V):ne:null,Fe=uM(te,Cn({},ge,r,{onVnodeUnmounted:Be=>{Be.component.isUnmounted&&(W.instances[j]=null)},ref:R}));return oS(c.default,{Component:Fe,route:V})||Fe}}});function oS(a,r){if(!a)return null;const c=a(r);return c.length===1?c[0]:c}const gF=_F;function yF(a){const r=nF(a.routes,a),c=a.parseQuery||lF,p=a.stringifyQuery||tS,g=a.history,b=Gf(),E=Gf(),i=Gf(),R=QC(Bl);let V=Bl;Vh&&a.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const j=t0.bind(null,Mt=>""+Mt),W=t0.bind(null,PO),te=t0.bind(null,Ep);function ne(Mt,ti){let Xt,me;return gE(Mt)?(Xt=r.getRecordMatcher(Mt),me=ti):me=Mt,r.addRoute(me,Xt)}function ge(Mt){const ti=r.getRecordMatcher(Mt);ti&&r.removeRoute(ti)}function xe(){return r.getRoutes().map(Mt=>Mt.record)}function Fe(Mt){return!!r.getRecordMatcher(Mt)}function Be(Mt,ti){if(ti=Cn({},ti||R.value),typeof Mt=="string"){const Ae=i0(c,Mt,ti.path),bt=r.resolve({path:Ae.path},ti),yt=g.createHref(Ae.fullPath);return Cn(Ae,bt,{params:te(bt.params),hash:Ep(Ae.hash),redirectedFrom:void 0,href:yt})}let Xt;if(Mt.path!=null)Xt=Cn({},Mt,{path:i0(c,Mt.path,ti.path).path});else{const Ae=Cn({},Mt.params);for(const bt in Ae)Ae[bt]==null&&delete Ae[bt];Xt=Cn({},Mt,{params:W(Ae)}),ti.params=W(ti.params)}const me=r.resolve(Xt,ti),nn=Mt.hash||"";me.params=j(te(me.params));const ke=RO(p,Cn({},Mt,{hash:AO(nn),path:me.path})),Ue=g.createHref(ke);return Cn({fullPath:ke,hash:nn,query:p===tS?cF(Mt.query):Mt.query||{}},me,{redirectedFrom:void 0,href:Ue})}function Ke(Mt){return typeof Mt=="string"?i0(c,Mt,R.value.path):Cn({},Mt)}function at(Mt,ti){if(V!==Mt)return Qh(8,{from:ti,to:Mt})}function Ye(Mt){return rt(Mt)}function ct(Mt){return Ye(Cn(Ke(Mt),{replace:!0}))}function Lt(Mt){const ti=Mt.matched[Mt.matched.length-1];if(ti&&ti.redirect){const{redirect:Xt}=ti;let me=typeof Xt=="function"?Xt(Mt):Xt;return typeof me=="string"&&(me=me.includes("?")||me.includes("#")?me=Ke(me):{path:me},me.params={}),Cn({query:Mt.query,hash:Mt.hash,params:me.path!=null?{}:Mt.params},me)}}function rt(Mt,ti){const Xt=V=Be(Mt),me=R.value,nn=Mt.state,ke=Mt.force,Ue=Mt.replace===!0,Ae=Lt(Xt);if(Ae)return rt(Cn(Ke(Ae),{state:typeof Ae=="object"?Cn({},nn,Ae.state):nn,force:ke,replace:Ue}),ti||Xt);const bt=Xt;bt.redirectedFrom=ti;let yt;return!ke&&LO(p,me,Xt)&&(yt=Qh(16,{to:bt,from:me}),ir(me,me,!0,!1)),(yt?Promise.resolve(yt):It(bt,me)).catch(St=>ka(St)?ka(St,2)?St:Hn(St):Di(St,bt,me)).then(St=>{if(St){if(ka(St,2))return rt(Cn({replace:Ue},Ke(St.to),{state:typeof St.to=="object"?Cn({},nn,St.to.state):nn,force:ke}),ti||bt)}else St=Ii(bt,me,!0,Ue,nn);return Pt(bt,me,St),St})}function Ut(Mt,ti){const Xt=at(Mt,ti);return Xt?Promise.reject(Xt):Promise.resolve()}function si(Mt){const ti=ar.values().next().value;return ti&&typeof ti.runWithContext=="function"?ti.runWithContext(Mt):Mt()}function It(Mt,ti){let Xt;const[me,nn,ke]=xF(Mt,ti);Xt=n0(me.reverse(),"beforeRouteLeave",Mt,ti);for(const Ae of me)Ae.leaveGuards.forEach(bt=>{Xt.push(Ul(bt,Mt,ti))});const Ue=Ut.bind(null,Mt,ti);return Xt.push(Ue),mn(Xt).then(()=>{Xt=[];for(const Ae of b.list())Xt.push(Ul(Ae,Mt,ti));return Xt.push(Ue),mn(Xt)}).then(()=>{Xt=n0(nn,"beforeRouteUpdate",Mt,ti);for(const Ae of nn)Ae.updateGuards.forEach(bt=>{Xt.push(Ul(bt,Mt,ti))});return Xt.push(Ue),mn(Xt)}).then(()=>{Xt=[];for(const Ae of ke)if(Ae.beforeEnter)if(zo(Ae.beforeEnter))for(const bt of Ae.beforeEnter)Xt.push(Ul(bt,Mt,ti));else Xt.push(Ul(Ae.beforeEnter,Mt,ti));return Xt.push(Ue),mn(Xt)}).then(()=>(Mt.matched.forEach(Ae=>Ae.enterCallbacks={}),Xt=n0(ke,"beforeRouteEnter",Mt,ti,si),Xt.push(Ue),mn(Xt))).then(()=>{Xt=[];for(const Ae of E.list())Xt.push(Ul(Ae,Mt,ti));return Xt.push(Ue),mn(Xt)}).catch(Ae=>ka(Ae,8)?Ae:Promise.reject(Ae))}function Pt(Mt,ti,Xt){i.list().forEach(me=>si(()=>me(Mt,ti,Xt)))}function Ii(Mt,ti,Xt,me,nn){const ke=at(Mt,ti);if(ke)return ke;const Ue=ti===Bl,Ae=Vh?history.state:{};Xt&&(me||Ue?g.replace(Mt.fullPath,Cn({scroll:Ue&&Ae&&Ae.scroll},nn)):g.push(Mt.fullPath,nn)),R.value=Mt,ir(Mt,ti,Xt,Ue),Hn()}let tn;function Fn(){tn||(tn=g.listen((Mt,ti,Xt)=>{if(!Qn.listening)return;const me=Be(Mt),nn=Lt(me);if(nn){rt(Cn(nn,{replace:!0,force:!0}),me).catch(up);return}V=me;const ke=R.value;Vh&&jO($T(ke.fullPath,Xt.delta),Lg()),It(me,ke).catch(Ue=>ka(Ue,12)?Ue:ka(Ue,2)?(rt(Cn(Ke(Ue.to),{force:!0}),me).then(Ae=>{ka(Ae,20)&&!Xt.delta&&Xt.type===Ap.pop&&g.go(-1,!1)}).catch(up),Promise.reject()):(Xt.delta&&g.go(-Xt.delta,!1),Di(Ue,me,ke))).then(Ue=>{Ue=Ue||Ii(me,ke,!1),Ue&&(Xt.delta&&!ka(Ue,8)?g.go(-Xt.delta,!1):Xt.type===Ap.pop&&ka(Ue,20)&&g.go(-1,!1)),Pt(me,ke,Ue)}).catch(up)}))}let Gt=Gf(),mi=Gf(),pi;function Di(Mt,ti,Xt){Hn(Mt);const me=mi.list();return me.length?me.forEach(nn=>nn(Mt,ti,Xt)):console.error(Mt),Promise.reject(Mt)}function qt(){return pi&&R.value!==Bl?Promise.resolve():new Promise((Mt,ti)=>{Gt.add([Mt,ti])})}function Hn(Mt){return pi||(pi=!Mt,Fn(),Gt.list().forEach(([ti,Xt])=>Mt?Xt(Mt):ti()),Gt.reset()),Mt}function ir(Mt,ti,Xt,me){const{scrollBehavior:nn}=a;if(!Vh||!nn)return Promise.resolve();const ke=!Xt&&GO($T(Mt.fullPath,0))||(me||!Xt)&&history.state&&history.state.scroll||null;return zS().then(()=>nn(Mt,ti,ke)).then(Ue=>Ue&&UO(Ue)).catch(Ue=>Di(Ue,Mt,ti))}const Sn=Mt=>g.go(Mt);let Qt;const ar=new Set,Qn={currentRoute:R,listening:!0,addRoute:ne,removeRoute:ge,clearRoutes:r.clearRoutes,hasRoute:Fe,getRoutes:xe,resolve:Be,options:a,push:Ye,replace:ct,go:Sn,back:()=>Sn(-1),forward:()=>Sn(1),beforeEach:b.add,beforeResolve:E.add,afterEach:i.add,onError:mi.add,isReady:qt,install(Mt){const ti=this;Mt.component("RouterLink",fF),Mt.component("RouterView",gF),Mt.config.globalProperties.$router=ti,Object.defineProperty(Mt.config.globalProperties,"$route",{enumerable:!0,get:()=>jh(R)}),Vh&&!Qt&&R.value===Bl&&(Qt=!0,Ye(g.location).catch(nn=>{}));const Xt={};for(const nn in Bl)Object.defineProperty(Xt,nn,{get:()=>R.value[nn],enumerable:!0});Mt.provide(gv,ti),Mt.provide(bE,MS(Xt)),Mt.provide(R0,R);const me=Mt.unmount;ar.add(Mt),Mt.unmount=function(){ar.delete(Mt),ar.size<1&&(V=Bl,tn&&tn(),tn=null,R.value=Bl,Qt=!1,pi=!1),me()}}};function mn(Mt){return Mt.reduce((ti,Xt)=>ti.then(()=>si(Xt)),Promise.resolve())}return Qn}function xF(a,r){const c=[],p=[],g=[],b=Math.max(r.matched.length,a.matched.length);for(let E=0;E<b;E++){const i=r.matched[E];i&&(a.matched.find(V=>Jh(V,i))?p.push(i):c.push(i));const R=a.matched[E];R&&(r.matched.find(V=>Jh(V,R))||g.push(R))}return[c,p,g]}const vF={},bF={class:"item"},wF={class:"details"};function TF(a,r){return $s(),Ro("div",bF,[cn("i",null,[Ox(a.$slots,"icon",{},void 0)]),cn("div",wF,[cn("h3",null,[Ox(a.$slots,"heading",{},void 0)]),Ox(a.$slots,"default",{},void 0)])])}const Hf=Wa(vF,[["render",TF],["__scopeId","data-v-fd0742eb"]]),SF={},MF={xmlns:"http://www.w3.org/2000/svg",width:"20",height:"17",fill:"currentColor"};function EF(a,r){return $s(),Ro("svg",MF,r[0]||(r[0]=[cn("path",{d:"M11 2.253a1 1 0 1 0-2 0h2zm-2 13a1 1 0 1 0 2 0H9zm.447-12.167a1 1 0 1 0 1.107-1.666L9.447 3.086zM1 2.253L.447 1.42A1 1 0 0 0 0 2.253h1zm0 13H0a1 1 0 0 0 1.553.833L1 15.253zm8.447.833a1 1 0 1 0 1.107-1.666l-1.107 1.666zm0-14.666a1 1 0 1 0 1.107 1.666L9.447 1.42zM19 2.253h1a1 1 0 0 0-.447-.833L19 2.253zm0 13l-.553.833A1 1 0 0 0 20 15.253h-1zm-9.553-.833a1 1 0 1 0 1.107 1.666L9.447 14.42zM9 2.253v13h2v-13H9zm1.553-.833C9.203.523 7.42 0 5.5 0v2c1.572 0 2.961.431 3.947 1.086l1.107-1.666zM5.5 0C3.58 0 1.797.523.447 1.42l1.107 1.666C2.539 2.431 3.928 2 5.5 2V0zM0 2.253v13h2v-13H0zm1.553 13.833C2.539 15.431 3.928 15 5.5 15v-2c-1.92 0-3.703.523-5.053 1.42l1.107 1.666zM5.5 15c1.572 0 2.961.431 3.947 1.086l1.107-1.666C9.203 13.523 7.42 13 5.5 13v2zm5.053-11.914C11.539 2.431 12.928 2 14.5 2V0c-1.92 0-3.703.523-5.053 1.42l1.107 1.666zM14.5 2c1.573 0 2.961.431 3.947 1.086l1.107-1.666C18.203.523 16.421 0 14.5 0v2zm3.5.253v13h2v-13h-2zm1.553 12.167C18.203 13.523 16.421 13 14.5 13v2c1.573 0 2.961.431 3.947 1.086l1.107-1.666zM14.5 13c-1.92 0-3.703.523-5.053 1.42l1.107 1.666C11.539 15.431 12.928 15 14.5 15v-2z"},null,-1)]))}const AF=Wa(SF,[["render",EF]]),IF={},CF={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",class:"iconify iconify--mdi",width:"24",height:"24",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24"};function PF(a,r){return $s(),Ro("svg",CF,r[0]||(r[0]=[cn("path",{d:"M20 18v-4h-3v1h-2v-1H9v1H7v-1H4v4h16M6.33 8l-1.74 4H7v-1h2v1h6v-1h2v1h2.41l-1.74-4H6.33M9 5v1h6V5H9m12.84 7.61c.1.22.16.48.16.8V18c0 .53-.21 1-.6 1.41c-.4.4-.85.59-1.4.59H4c-.55 0-1-.19-1.4-.59C2.21 19 2 18.53 2 18v-4.59c0-.32.06-.58.16-.8L4.5 7.22C4.84 6.41 5.45 6 6.33 6H7V5c0-.55.18-1 .57-1.41C7.96 3.2 8.44 3 9 3h6c.56 0 1.04.2 1.43.59c.39.41.57.86.57 1.41v1h.67c.88 0 1.49.41 1.83 1.22l2.34 5.39z",fill:"currentColor"},null,-1)]))}const DF=Wa(IF,[["render",PF]]),zF={},RF={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"20",fill:"currentColor"};function LF(a,r){return $s(),Ro("svg",RF,r[0]||(r[0]=[cn("path",{d:"M11.447 8.894a1 1 0 1 0-.894-1.789l.894 1.789zm-2.894-.789a1 1 0 1 0 .894 1.789l-.894-1.789zm0 1.789a1 1 0 1 0 .894-1.789l-.894 1.789zM7.447 7.106a1 1 0 1 0-.894 1.789l.894-1.789zM10 9a1 1 0 1 0-2 0h2zm-2 2.5a1 1 0 1 0 2 0H8zm9.447-5.606a1 1 0 1 0-.894-1.789l.894 1.789zm-2.894-.789a1 1 0 1 0 .894 1.789l-.894-1.789zm2 .789a1 1 0 1 0 .894-1.789l-.894 1.789zm-1.106-2.789a1 1 0 1 0-.894 1.789l.894-1.789zM18 5a1 1 0 1 0-2 0h2zm-2 2.5a1 1 0 1 0 2 0h-2zm-5.447-4.606a1 1 0 1 0 .894-1.789l-.894 1.789zM9 1l.447-.894a1 1 0 0 0-.894 0L9 1zm-2.447.106a1 1 0 1 0 .894 1.789l-.894-1.789zm-6 3a1 1 0 1 0 .894 1.789L.553 4.106zm2.894.789a1 1 0 1 0-.894-1.789l.894 1.789zm-2-.789a1 1 0 1 0-.894 1.789l.894-1.789zm1.106 2.789a1 1 0 1 0 .894-1.789l-.894 1.789zM2 5a1 1 0 1 0-2 0h2zM0 7.5a1 1 0 1 0 2 0H0zm8.553 12.394a1 1 0 1 0 .894-1.789l-.894 1.789zm-1.106-2.789a1 1 0 1 0-.894 1.789l.894-1.789zm1.106 1a1 1 0 1 0 .894 1.789l-.894-1.789zm2.894.789a1 1 0 1 0-.894-1.789l.894 1.789zM8 19a1 1 0 1 0 2 0H8zm2-2.5a1 1 0 1 0-2 0h2zm-7.447.394a1 1 0 1 0 .894-1.789l-.894 1.789zM1 15H0a1 1 0 0 0 .553.894L1 15zm1-2.5a1 1 0 1 0-2 0h2zm12.553 2.606a1 1 0 1 0 .894 1.789l-.894-1.789zM17 15l.447.894A1 1 0 0 0 18 15h-1zm1-2.5a1 1 0 1 0-2 0h2zm-7.447-5.394l-2 1 .894 1.789 2-1-.894-1.789zm-1.106 1l-2-1-.894 1.789 2 1 .894-1.789zM8 9v2.5h2V9H8zm8.553-4.894l-2 1 .894 1.789 2-1-.894-1.789zm.894 0l-2-1-.894 1.789 2 1 .894-1.789zM16 5v2.5h2V5h-2zm-4.553-3.894l-2-1-.894 1.789 2 1 .894-1.789zm-2.894-1l-2 1 .894 1.789 2-1L8.553.106zM1.447 5.894l2-1-.894-1.789-2 1 .894 1.789zm-.894 0l2 1 .894-1.789-2-1-.894 1.789zM0 5v2.5h2V5H0zm9.447 13.106l-2-1-.894 1.789 2 1 .894-1.789zm0 1.789l2-1-.894-1.789-2 1 .894 1.789zM10 19v-2.5H8V19h2zm-6.553-3.894l-2-1-.894 1.789 2 1 .894-1.789zM2 15v-2.5H0V15h2zm13.447 1.894l2-1-.894-1.789-2 1 .894 1.789zM18 15v-2.5h-2V15h2z"},null,-1)]))}const kF=Wa(zF,[["render",LF]]),OF={},FF={xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor"};function BF(a,r){return $s(),Ro("svg",FF,r[0]||(r[0]=[cn("path",{d:"M15 4a1 1 0 1 0 0 2V4zm0 11v-1a1 1 0 0 0-1 1h1zm0 4l-.707.707A1 1 0 0 0 16 19h-1zm-4-4l.707-.707A1 1 0 0 0 11 14v1zm-4.707-1.293a1 1 0 0 0-1.414 1.414l1.414-1.414zm-.707.707l-.707-.707.707.707zM9 11v-1a1 1 0 0 0-.707.293L9 11zm-4 0h1a1 1 0 0 0-1-1v1zm0 4H4a1 1 0 0 0 1.707.707L5 15zm10-9h2V4h-2v2zm2 0a1 1 0 0 1 1 1h2a3 3 0 0 0-3-3v2zm1 1v6h2V7h-2zm0 6a1 1 0 0 1-1 1v2a3 3 0 0 0 3-3h-2zm-1 1h-2v2h2v-2zm-3 1v4h2v-4h-2zm1.707 3.293l-4-4-1.414 1.414 4 4 1.414-1.414zM11 14H7v2h4v-2zm-4 0c-.276 0-.525-.111-.707-.293l-1.414 1.414C5.42 15.663 6.172 16 7 16v-2zm-.707 1.121l3.414-3.414-1.414-1.414-3.414 3.414 1.414 1.414zM9 12h4v-2H9v2zm4 0a3 3 0 0 0 3-3h-2a1 1 0 0 1-1 1v2zm3-3V3h-2v6h2zm0-6a3 3 0 0 0-3-3v2a1 1 0 0 1 1 1h2zm-3-3H3v2h10V0zM3 0a3 3 0 0 0-3 3h2a1 1 0 0 1 1-1V0zM0 3v6h2V3H0zm0 6a3 3 0 0 0 3 3v-2a1 1 0 0 1-1-1H0zm3 3h2v-2H3v2zm1-1v4h2v-4H4zm1.707 4.707l.586-.586-1.414-1.414-.586.586 1.414 1.414z"},null,-1)]))}const NF=Wa(OF,[["render",BF]]),VF={},UF={xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor"};function jF(a,r){return $s(),Ro("svg",UF,r[0]||(r[0]=[cn("path",{d:"M10 3.22l-.61-.6a5.5 5.5 0 0 0-7.666.105 5.5 5.5 0 0 0-.114 7.665L10 18.78l8.39-8.4a5.5 5.5 0 0 0-.114-7.665 5.5 5.5 0 0 0-7.666-.105l-.61.61z"},null,-1)]))}const GF=Wa(VF,[["render",jF]]),HF=Mg({__name:"TheWelcome",setup(a){const r=()=>fetch("/__open-in-editor?file=README.md");return(c,p)=>($s(),Ro(Hs,null,[jn(Hf,null,{icon:Qr(()=>[jn(AF)]),heading:Qr(()=>p[0]||(p[0]=[In("Documentation")])),default:Qr(()=>[p[1]||(p[1]=In(" Vue’s ")),p[2]||(p[2]=cn("a",{href:"https://vuejs.org/",target:"_blank",rel:"noopener"},"official documentation",-1)),p[3]||(p[3]=In(" provides you with all information you need to get started. "))]),_:1}),jn(Hf,null,{icon:Qr(()=>[jn(DF)]),heading:Qr(()=>p[4]||(p[4]=[In("Tooling")])),default:Qr(()=>[p[6]||(p[6]=In(" This project is served and bundled with ")),p[7]||(p[7]=cn("a",{href:"https://vite.dev/guide/features.html",target:"_blank",rel:"noopener"},"Vite",-1)),p[8]||(p[8]=In(". The recommended IDE setup is ")),p[9]||(p[9]=cn("a",{href:"https://code.visualstudio.com/",target:"_blank",rel:"noopener"},"VSCode",-1)),p[10]||(p[10]=In(" + ")),p[11]||(p[11]=cn("a",{href:"https://github.com/johnsoncodehk/volar",target:"_blank",rel:"noopener"},"Volar",-1)),p[12]||(p[12]=In(". If you need to test your components and web pages, check out ")),p[13]||(p[13]=cn("a",{href:"https://vitest.dev/",target:"_blank",rel:"noopener"},"Vite",-1)),p[14]||(p[14]=In(" and ")),p[15]||(p[15]=cn("a",{href:"https://www.cypress.io/",target:"_blank",rel:"noopener"},"Cypress",-1)),p[16]||(p[16]=In(" / ")),p[17]||(p[17]=cn("a",{href:"https://playwright.dev/",target:"_blank",rel:"noopener"},"Playwright",-1)),p[18]||(p[18]=In(". ")),p[19]||(p[19]=cn("br",null,null,-1)),p[20]||(p[20]=In(" More instructions are available in ")),cn("a",{href:"javascript:void(0)",onClick:r},p[5]||(p[5]=[cn("code",null,"README.md",-1)])),p[21]||(p[21]=In(". "))]),_:1}),jn(Hf,null,{icon:Qr(()=>[jn(kF)]),heading:Qr(()=>p[22]||(p[22]=[In("Ecosystem")])),default:Qr(()=>[p[23]||(p[23]=In(" Get official tools and libraries for your project: ")),p[24]||(p[24]=cn("a",{href:"https://pinia.vuejs.org/",target:"_blank",rel:"noopener"},"Pinia",-1)),p[25]||(p[25]=In(", ")),p[26]||(p[26]=cn("a",{href:"https://router.vuejs.org/",target:"_blank",rel:"noopener"},"Vue Router",-1)),p[27]||(p[27]=In(", ")),p[28]||(p[28]=cn("a",{href:"https://test-utils.vuejs.org/",target:"_blank",rel:"noopener"},"Vue Test Utils",-1)),p[29]||(p[29]=In(", and ")),p[30]||(p[30]=cn("a",{href:"https://github.com/vuejs/devtools",target:"_blank",rel:"noopener"},"Vue Dev Tools",-1)),p[31]||(p[31]=In(". If you need more resources, we suggest paying ")),p[32]||(p[32]=cn("a",{href:"https://github.com/vuejs/awesome-vue",target:"_blank",rel:"noopener"},"Awesome Vue",-1)),p[33]||(p[33]=In(" a visit. "))]),_:1}),jn(Hf,null,{icon:Qr(()=>[jn(NF)]),heading:Qr(()=>p[34]||(p[34]=[In("Community")])),default:Qr(()=>[p[35]||(p[35]=In(" Got stuck? Ask your question on ")),p[36]||(p[36]=cn("a",{href:"https://chat.vuejs.org",target:"_blank",rel:"noopener"},"Vue Land",-1)),p[37]||(p[37]=In(" (our official Discord server), or ")),p[38]||(p[38]=cn("a",{href:"https://stackoverflow.com/questions/tagged/vue.js",target:"_blank",rel:"noopener"},"StackOverflow",-1)),p[39]||(p[39]=In(". You should also follow the official ")),p[40]||(p[40]=cn("a",{href:"https://bsky.app/profile/vuejs.org",target:"_blank",rel:"noopener"},"@vuejs.org",-1)),p[41]||(p[41]=In(" Bluesky account or the ")),p[42]||(p[42]=cn("a",{href:"https://x.com/vuejs",target:"_blank",rel:"noopener"},"@vuejs",-1)),p[43]||(p[43]=In(" X account for latest news in the Vue world. "))]),_:1}),jn(Hf,null,{icon:Qr(()=>[jn(GF)]),heading:Qr(()=>p[44]||(p[44]=[In("Support Vue")])),default:Qr(()=>[p[45]||(p[45]=In(" As an independent project, Vue relies on community backing for its sustainability. You can help us by ")),p[46]||(p[46]=cn("a",{href:"https://vuejs.org/sponsor/",target:"_blank",rel:"noopener"},"becoming a sponsor",-1)),p[47]||(p[47]=In(". "))]),_:1})],64))}}),qF=Mg({__name:"HomeView",setup(a){return(r,c)=>($s(),Ro("main",null,[jn(HF)]))}}),$F=yF({history:WO("/"),routes:[{path:"/",name:"home",component:qF},{path:"/about",name:"about",component:()=>_O(()=>import("./AboutView-ByZ0hWpW.js"),__vite__mapDeps([0,1]))}]}),yv=OD(fO);yv.use(VD());yv.use($F);yv.mount("#app");export{Wa as _,cn as a,Ro as c,$s as o};
